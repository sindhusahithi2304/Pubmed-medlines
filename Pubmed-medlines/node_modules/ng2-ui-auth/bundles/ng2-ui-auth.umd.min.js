!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ng2-ui-auth",["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators"],e):e((t=t||self)["ng2-ui-auth"]={},t.ng.core,t.ng.common.http,t.rxjs,t.rxjs.operators)}(this,function(t,e,o,r,n){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};var a=function(){return(a=Object.assign||function(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function s(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var r,n,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(s){n={error:s}}finally{try{r&&!r.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}return a}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}function u(t,e){return/^(?:[a-z]+:)?\/\//i.test(e)?e:[t,e].join("/").replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function c(t){return Object.keys(t).map(function(e){return t[e]?encodeURIComponent(e)+"="+encodeURIComponent(t[e]):e}).join("&")}function h(t){t||"undefined"==typeof window||(t=window);try{return t&&t.location?t.location.origin?t.location.origin:t.location.protocol+"//"+t.location.hostname+(t.location.port?":"+t.location.port:""):null}catch(e){return null}}var d={facebook:{name:"facebook",url:"/auth/facebook",redirectUri:h()+"/",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",additionalUrlParams:{display:"popup"},scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/v2/auth",additionalUrlParams:{display:"popup",prompt:undefined,login_hint:undefined,access_type:undefined,include_granted_scopes:undefined,"openid.realm":undefined,hd:undefined},scope:["openid","email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:452,height:633},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",scope:["basic"],scopeDelimiter:"+",oauthType:"2.0"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",scope:["r_emailaddress"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:527,height:582},state:"STATE"},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",oauthType:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",scope:["user_read"],scopeDelimiter:" ",additionalUrlParams:{display:"popup"},oauthType:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",additionalUrlParams:{display:"popup"},scope:["wl.emails"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",scope:[],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:559,height:519}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:h()+"/",scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:1028,height:529}},spotify:{name:"spotify",url:"/auth/spotify",authorizationEndpoint:"https://accounts.spotify.com/authorize",scope:["","user-read-email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:500,height:530},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}}},l={NONE:"none",MEMORY:"memory",LOCAL_STORAGE:"localStorage",SESSION_STORAGE:"sessionStorage",COOKIE:"cookie",SESSION_COOKIE:"sessionCookie"},f=new e.InjectionToken("config.options"),g=function(){function t(t){this.options={withCredentials:!1,tokenRoot:null,baseUrl:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",unlinkUrl:"/auth/unlink/",tokenName:"token",tokenSeparator:"_",tokenPrefix:"ng2-ui-auth",authHeader:"Authorization",authToken:"Bearer",storageType:l.LOCAL_STORAGE,cordova:undefined,resolveToken:function(t,e){var o=t&&(t.access_token||t.token||t.data);if(!o)return null;if("string"==typeof o)return o;if("object"!=typeof o)return null;var r=e.tokenRoot&&e.tokenRoot.split(".").reduce(function(t,e){return t[e]},o),n=r?r[e.tokenName]:o[e.tokenName];return n||null},providers:{}},this.options=a({},this.options,t),this.mergeWithDefaultProviders()}return t.prototype.updateProviders=function(t){this.options.providers=a({},this.options.providers||{},t),this.mergeWithDefaultProviders()},t.prototype.mergeWithDefaultProviders=function(){var t=this;Object.keys(this.options.providers).forEach(function(e){e in d&&(t.options.providers[e]=a({},d[e],t.options.providers[e]))})},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:e.Inject,args:[f]}]}]},t}(),y=function(){},v=function(t){function o(e){var o=t.call(this)||this;return o.config=e,o.store={},o.storageType=l.MEMORY,o.updateStorageType(e.options.storageType)||console.warn(e.options.storageType+" is not available."),o}return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(o,t),o.prototype.updateStorageType=function(t){return!!this.checkIsStorageAvailable(t)&&(this.storageType=t,!0)},o.prototype.get=function(t){switch(this.storageType){case l.COOKIE:case l.SESSION_COOKIE:return this.getCookie(t);case l.LOCAL_STORAGE:case l.SESSION_STORAGE:return window[this.storageType].getItem(t);case l.MEMORY:return this.store[t];case l.NONE:default:return null}},o.prototype.set=function(t,e,o){switch(this.storageType){case l.COOKIE:case l.SESSION_COOKIE:this.setCookie(t,e,this.storageType===l.COOKIE?o:"");break;case l.LOCAL_STORAGE:case l.SESSION_STORAGE:window[this.storageType].setItem(t,e);break;case l.MEMORY:this.store[t]=e;break;case l.NONE:}},o.prototype.remove=function(t){switch(this.storageType){case l.COOKIE:case l.SESSION_COOKIE:this.removeCookie(t);break;case l.LOCAL_STORAGE:case l.SESSION_STORAGE:window[this.storageType].removeItem(t);break;case l.MEMORY:delete this.store[t];break;case l.NONE:}},o.prototype.checkIsStorageAvailable=function(t){switch(t){case l.COOKIE:case l.SESSION_COOKIE:return this.isCookieStorageAvailable();case l.LOCAL_STORAGE:case l.SESSION_STORAGE:return this.isWindowStorageAvailable(t);case l.NONE:case l.MEMORY:return!0;default:return!1}},o.prototype.isWindowStorageAvailable=function(t){try{var e=window&&t in window&&null!==window[t];if(e){var o=Math.random().toString(36).substring(7);window[t].setItem(o,""),window[t].removeItem(o)}return e}catch(r){return!1}},o.prototype.isCookieStorageAvailable=function(){try{if(document&&"cookie"in document){var t=Math.random().toString(36).substring(7);this.setCookie(t,"test",new Date(Date.now()+6e4).toUTCString());var e=this.getCookie(t);return this.removeCookie(t),"test"===e}return!1}catch(o){return!1}},o.prototype.setCookie=function(t,e,o,r){void 0===o&&(o=""),void 0===r&&(r="/"),document.cookie=t+"="+e+(o?"; expires="+o:"")+"; path="+r},o.prototype.removeCookie=function(t,e){void 0===e&&(e="/"),this.setCookie(t,"",new Date(0).toUTCString(),e)},o.prototype.getCookie=function(t){return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")},o.decorators=[{type:e.Injectable}],o.ctorParameters=function(){return[{type:g}]},o}(y),m=function(){function t(t,e){this.storage=t,this.config=e,this.tokenName=this.config.options.tokenPrefix?[this.config.options.tokenPrefix,this.config.options.tokenName].join(this.config.options.tokenSeparator):this.config.options.tokenName}return t.prototype.getToken=function(){return this.storage.get(this.tokenName)},t.prototype.getPayload=function(t){if(void 0===t&&(t=this.getToken()),t&&3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(this.b64DecodeUnicode(e))}catch(o){return undefined}},t.prototype.setToken=function(t){var e;if(t&&(e="string"==typeof t?t:this.config.options.resolveToken(t,this.config.options))){var o=this.getExpirationDate(e);this.storage.set(this.tokenName,e,o?o.toUTCString():"")}},t.prototype.removeToken=function(){this.storage.remove(this.tokenName)},t.prototype.isAuthenticated=function(t){if(void 0===t&&(t=this.getToken()),t){if(3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(this.b64DecodeUnicode(e)).exp;if(o)return!(Math.round((new Date).getTime()/1e3)>=o)||(this.storage.remove(this.tokenName),!1)}catch(r){return!0}return!0}return!1},t.prototype.getExpirationDate=function(t){void 0===t&&(t=this.getToken());var e=this.getPayload(t);if(e&&e.exp&&Math.round((new Date).getTime()/1e3)<e.exp){var o=new Date(0);return o.setUTCSeconds(e.exp),o}return null},t.prototype.logout=function(){var t=this;return r.Observable.create(function(e){t.storage.remove(t.tokenName),e.next(),e.complete()})},t.prototype.setStorageType=function(t){return this.storage.updateStorageType(t)},t.prototype.b64DecodeUnicode=function(t){return decodeURIComponent(Array.prototype.map.call(atob(t),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:y},{type:g}]},t}(),w=function(){function t(t,e){this.shared=t,this.config=e}return t.prototype.intercept=function(t,e){var o,r=this.config.options,n=r.authHeader,i=r.authToken,a=this.shared.getToken(),s=this.shared.isAuthenticated()&&!t.headers.has(n)?t.clone({setHeaders:(o={},o[n]=i+" "+a,o)}):t;return e.handle(s)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:m},{type:g}]},t}(),O=function(){function t(){}return t.prototype.open=function(t,e,o){void 0===o&&(o=this.isCordovaApp());var n=this.stringifyOptions(this.prepareOptions(e.popupOptions)),i=o?"_blank":e.name,a="undefined"!=typeof window?window.open(t,i,n):null;return a?(a.focus&&a.focus(),r.of(a)):r.empty()},t.prototype.waitForClose=function(t,e,o){return void 0===e&&(e=this.isCordovaApp()),void 0===o&&(o=h()),e?this.eventListener(t,o):this.pollPopup(t,o)},t.prototype.eventListener=function(t,e){var o=this;if(void 0===e&&(e=h()),!t)throw new Error("Popup was not created");return r.merge(r.fromEvent(t,"exit").pipe(n.delay(100),n.map(function(){throw new Error("Authentication Canceled")})),r.fromEvent(t,"loadstart")).pipe(n.switchMap(function(n){if(!t||t.closed)return r.Observable["throw"](new Error("Authentication Canceled"));if(0!==n.url.indexOf(e))return r.empty();var i=document.createElement("a");if(i.href=n.url,i.search||i.hash){var s=i.search.substring(1).replace(/\/$/,""),p=i.hash.substring(1).replace(/\/$/,""),u=o.parseQueryString(p),c=o.parseQueryString(s),h=a({},c,u);if(t.close(),h.error)throw h.error;return r.of(h)}return r.empty()}),n.take(1))},t.prototype.pollPopup=function(t,e){var o=this;return void 0===e&&(e=h()),r.interval(50).pipe(n.switchMap(function(){if(!t||t.closed)return r.throwError(new Error("Authentication Canceled"));var n=h(t);if(n&&(0===e.indexOf(n)||0===n.indexOf(e))&&(t.location.search||t.location.hash)){var i=t.location.search.substring(1).replace(/\/$/,""),s=t.location.hash.substring(1).replace(/[\/$]/,""),p=o.parseQueryString(s),u=o.parseQueryString(i);t.close();var c=a({},u,p);if(c.error)throw c.error;return r.of(c)}return r.empty()}),n.take(1))},t.prototype.prepareOptions=function(t){var e=(t=t||{}).width||500,o=t.height||500;return a({width:e,height:o,left:window.screenX+(window.outerWidth-e)/2,top:window.screenY+(window.outerHeight-o)/2.5,toolbar:t.visibleToolbar?"yes":"no"},t)},t.prototype.stringifyOptions=function(t){return Object.keys(t).map(function(e){return null===t[e]||t[e]===undefined?e:e+"="+t[e]}).join(",")},t.prototype.parseQueryString=function(t){var e;return t.split("&").reduce(function(t,o){return o&&(e=o.split("="),t[decodeURIComponent(e[0])]="undefined"==typeof e[1]||decodeURIComponent(e[1])),t},{})},t.prototype.isCordovaApp=function(){return"object"==typeof cordova||-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")},t.decorators=[{type:e.Injectable}],t}(),k=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(t,e){var o=this,r=this.config.options.baseUrl?u(this.config.options.baseUrl,t.url):t.url;return this.popup.open("about:blank",t,this.config.options.cordova).pipe(n.switchMap(function(e){return o.http.post(r,t).pipe(n.tap(function(o){return e?e.location.replace([t.authorizationEndpoint,c(o)].join("?")):undefined}),n.switchMap(function(r){return o.popup.waitForClose(e,o.config.options.cordova,t.redirectUri).pipe(n.map(function(t){return{authorizationData:r,oauthData:t}}))}))}),n.switchMap(function(r){var n=r.authorizationData,i=r.oauthData;return o.exchangeForToken(t,n,i,e)}))},t.prototype.exchangeForToken=function(t,e,o,r){var n={oauthOptions:t,authorizationData:e,oauthData:o,userData:r},i=this.config.options,a=i.withCredentials,s=i.baseUrl,p=t.method,c=void 0===p?"POST":p,h=t.url,d=s?u(s,h):h;return this.http.request(c,d,{body:n,withCredentials:a})},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:O},{type:g}]},t}(),S=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(t,e){var o=this,i=this.getAuthorizationData(t),a=[t.authorizationEndpoint,c(i)].join("?");return this.popup.open(a,t,this.config.options.cordova).pipe(n.switchMap(function(e){return e?o.popup.waitForClose(e,o.config.options.cordova,t.redirectUri):r.empty()}),n.switchMap(function(n){if("token"===t.responseType||!t.url)return r.of(n);if(n.state&&n.state!==i.state)throw new Error('OAuth "state" mismatch');return o.exchangeForToken(t,i,n,e)}))},t.prototype.exchangeForToken=function(t,e,o,r){var n={authorizationData:e,oauthData:o,userData:r},i=this.config.options,a=i.baseUrl,s=i.withCredentials,p=t.url,c=t.method,h=void 0===c?"POST":c,d=a?u(a,p):p;return this.http.request(h,d,{body:n,withCredentials:s})},t.prototype.getAuthorizationData=function(t){var e=t.responseType,o=void 0===e?"code":e,r=t.clientId,n=t.redirectUri,i=void 0===n?h()||"":n,s=t.scopeDelimiter,u=void 0===s?",":s,c=t.scope,d=t.state,l=t.additionalUrlParams,f="function"==typeof d?d():d;return p([["response_type",o],["client_id",r],["redirect_uri",i]],d?[["state",f]]:[],c?[["scope",c.join(u)]]:[],l?Object.keys(l).map(function(t){var e=l[t];return"string"==typeof e?[t,e]:"function"==typeof e?[t,e()]:null===e?[t,""]:["",""]}):[]).filter(function(t){return!!t[0]}).reduce(function(t,e){var o;return a({},t,((o={})[e[0]]=e[1],o))},{})},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:O},{type:g}]},t}(),b=function(){function t(t,e,r,n){this.http=t,this.shared=e,this.config=r,this.popup=n,this.depProviders=[{provide:o.HttpClient,useValue:this.http},{provide:O,useValue:this.popup},{provide:g,useValue:this.config}],this.deps=[o.HttpClient,O,g]}return t.prototype.authenticate=function(t,o){var r=this;return("1.0"===this.config.options.providers[t].oauthType?e.Injector.create(p(this.depProviders,[{provide:k,deps:this.deps}])).get(k):e.Injector.create(p(this.depProviders,[{provide:S,deps:this.deps}])).get(S)).open(this.config.options.providers[t],o||{}).pipe(n.tap(function(e){r.config.options.providers[t].url&&r.shared.setToken(e)}))},t.prototype.unlink=function(t,e,o){return void 0===e&&(e=u(this.config.options.baseUrl,this.config.options.unlinkUrl)),void 0===o&&(o="POST"),this.http.request(o,e,{body:{provider:t}})},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:m},{type:g},{type:O}]},t}(),T=function(){function t(t,e,o){this.http=t,this.shared=e,this.config=o}return t.prototype.login=function(t,e){var o=this;return this.http.post(e||u(this.config.options.baseUrl,this.config.options.loginUrl),t).pipe(n.tap(function(t){return o.shared.setToken(t)}))},t.prototype.signup=function(t,e){return this.http.post(e||u(this.config.options.baseUrl,this.config.options.signupUrl),t)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:m},{type:g}]},t}(),C=function(){function t(t,e,o){this.shared=t,this.local=e,this.oauth=o}return t.prototype.login=function(t,e){return this.local.login(t,e)},t.prototype.signup=function(t,e){return this.local.signup(t,e)},t.prototype.logout=function(){return this.shared.logout()},t.prototype.authenticate=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.link=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.unlink=function(t,e){return this.oauth.unlink(t,e)},t.prototype.isAuthenticated=function(){return this.shared.isAuthenticated()},t.prototype.getToken=function(){return this.shared.getToken()},t.prototype.setToken=function(t){this.shared.setToken(t)},t.prototype.removeToken=function(){this.shared.removeToken()},t.prototype.getPayload=function(){return this.shared.getPayload()},t.prototype.setStorageType=function(t){return this.shared.setStorageType(t)},t.prototype.getExpirationDate=function(){return this.shared.getExpirationDate()},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:m},{type:T},{type:b}]},t}(),E=function(){function t(){}return t.forRoot=function(e,r){return void 0===r&&(r=!0),{ngModule:t,providers:p(e?[{provide:f,useValue:e}]:[],[{provide:g,useClass:g,deps:[f]},{provide:y,useClass:v,deps:[g]},{provide:m,useClass:m,deps:[y,g]},{provide:T,useClass:T,deps:[o.HttpClient,m,g]},{provide:O,useClass:O,deps:[g]},{provide:b,useClass:b,deps:[o.HttpClient,m,g,O]},{provide:C,useClass:C,deps:[m,T,b]}],r?[{provide:o.HTTP_INTERCEPTORS,useClass:w,multi:!0,deps:[m,g]}]:[])}},t.decorators=[{type:e.NgModule,args:[{imports:[o.HttpClientModule],declarations:[],exports:[]}]}],t}();t.AuthService=C,t.BrowserStorageService=v,t.CONFIG_OPTIONS=f,t.ConfigService=g,t.JwtInterceptor=w,t.LocalService=T,t.Ng2UiAuthModule=E,t.Oauth1Service=k,t.Oauth2Service=S,t.OauthService=b,t.PopupService=O,t.SharedService=m,t.StorageService=y,t.StorageType=l,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ng2-ui-auth.umd.min.js.map