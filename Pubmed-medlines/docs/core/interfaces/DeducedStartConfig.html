<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Core</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Core</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>DeducedStartConfig</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>web-services/start-config.web.service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Defines members whose values are automatically deduced from direct <a href="../interfaces/StartConfig.html">StartConfig</a> members</p>

            </p>


        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#apiPath">apiPath</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#applicationPath">applicationPath</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#browserUrl">browserUrl</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#corsActive">corsActive</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#origin">origin</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="apiPath"></a>
                                        <span class="name"><b>apiPath</b><a href="#apiPath"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>apiPath:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The path used to make Sinequa API calls, including any virtual directories.
If CORS is active then it will be prefixed by the Sinequa server origin</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="applicationPath"></a>
                                        <span class="name"><b>applicationPath</b><a href="#applicationPath"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>applicationPath:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The application path of the url used to make Sinequa API calls</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="browserUrl"></a>
                                        <span class="name"><b>browserUrl</b><a href="#browserUrl"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>browserUrl:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The url in the browser (origin + pathname)</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="corsActive"></a>
                                        <span class="name"><b>corsActive</b><a href="#corsActive"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>corsActive:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>A flag indicating whether the app is running in a CORS context.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="origin"></a>
                                        <span class="name"><b>origin</b><a href="#origin"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>origin:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The origin of the url used to make Sinequa API calls</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {Injectable, InjectionToken, Optional, Inject} from &quot;@angular/core&quot;;
import {Observable} from &quot;rxjs&quot;;
import atomic from &quot;atomicjs&quot;;
import {IProviders} from &quot;ng2-ui-auth&quot;;
import {Utils} from &quot;@sinequa/core/base&quot;;

/**
 * An {@link InjectionToken} to access the app&#x27;s {@link StartConfig} instance
 */
export const START_CONFIG &#x3D; new InjectionToken&lt;StartConfig&gt;(&quot;START_CONFIG&quot;);

/**
 * Defines members whose values are automatically deduced from direct {@link StartConfig} members
 */
export interface DeducedStartConfig {
    /**
     * The origin of the url used to make Sinequa API calls
     */
    origin?: string;
    /**
     * The application path of the url used to make Sinequa API calls
     */
    applicationPath?: string;
    /**
     * The url in the browser (origin + pathname)
     */
    browserUrl?: string;
    /**
     * The path used to make Sinequa API calls, including any virtual directories.
     * If CORS is active then it will be prefixed by the Sinequa server origin
     */
    apiPath?: string;
    /**
     * A flag indicating whether the app is running in a CORS context.
     */
    corsActive?: boolean;
}

/**
 * Defines members whose values are retrieved from the Sinequa app configuration and that are available prior to user login
 */
export interface PreloginAppConfig {
    /**
     * Specifies which storage should be used to hold the CSRF token used to protect Sinequa API calls against
     * CSRF attacks
     */
    authenticationStorage?: &#x27;session&#x27; | &#x27;local&#x27;;
    /**
     * Contains the available login providers (only used for popup-based login)
     */
    providers?: IProviders;
    /**
     * Contains the OAuth auto login provider
     */
    autoOAuthProvider?: string;
    /**
     * Contains the OAuth auto login provider
     */
    autoSAMLProvider?: string;
    /**
     * A boolean value indicating whether popup-based login should be used
     */
    usePopupForLogin?: boolean;
    /**
     * The URL to be used to display online help
     */
    helpUrl?: string;
    /**
     * A boolean value indicating whether auditing is enabled
     */
    auditEnabled?: boolean;
    /**
     * A boolean value indicating whether ML auditing is enabled
     */
    mlAuditEnabled?: boolean;
    /**
     * The version of Sinequa running on the server
     */
    version?: string;
    /**
     * The date of the version of Sinequa running on the server
     */
    versionDate?: Date;
}

/**
 * Contains start-up configuration for the application. An instance of this object
 * must be provided when registering the {@link WebServicesModule} either by providing the START_CONFIG
 * injection token or by using the [forRoot]{@link WebServicesModule#forRoot} static method.
 *
 * Typically only the members declared directly (url, app, production) should be specified.
 * The other values are either deduced from these members or are retrieved from the Sinequa configuration
 */
export interface StartConfig extends DeducedStartConfig, PreloginAppConfig {
    /**
     * The url of the sinequa server including any virtual directories - defaults to the browser url
     */
    url?: string;
    /**
     * The app name (can be deduced from the browser url when the app is served by Sinequa)
     */
    app?: string;
    /**
     * A flag indicating whether the app is running in production mode or not
     * (can be deduced from the browser url when the app is served by Sinequa)
     */
    production?: boolean;
}

/**
 * Defines Sinequa server configuration that can be held on a web server and retrieved using
 * [StartConfigWebService.fetchServerConfig]{@link StartConfigWebService#fetchServerConfig}
 */
export interface ServerConfig {
    /**
     * The URL of the Sinequa server including any virtual directories
     */
    url?: string;
    /**
     * The name of the application
     */
    app?: string;
}

/**
 * A service to manage the initialization of the app&#x27;s {@link StartConfig} instance. The service
 * is automatically instantiated by an {@link APP_INITIALIZER} in {@link WebServicesModule} and the
 * initialization is performed in the constructor.
 */
@Injectable({
    providedIn: &quot;root&quot;
})
export class StartConfigWebService {
    private static API_PATH &#x3D; &quot;/api/v1&quot;;

    /**
     * Initializes the injected {@link StartConfig} instance. Outputs an error to the
     * console if no instance is injected.
     *
     * @param startConfig The start configuration instance
     */
    constructor(@Optional() @Inject(START_CONFIG) private startConfig: StartConfig) {
        if (!startConfig) {
            console.error(&quot;START_CONFIG must be provided in your app module&quot;);
            return;
        }
        this.initStartConfig();
    }

    private getDefaultStartConfig(): StartConfig {
        const startConfig: StartConfig &#x3D; {};
        const browserUrl &#x3D; Utils.makeURL(window.location.href);
        let parts &#x3D; Utils.split(browserUrl.pathname, &quot;/&quot;);
        const appSpecifierIndex &#x3D; parts.findIndex(value &#x3D;&gt; Utils.eqNCN(value, &quot;app&quot;, &quot;app-debug&quot;));
        if (appSpecifierIndex !&#x3D;&#x3D; -1 &amp;&amp; appSpecifierIndex &lt; parts.length - 1) {
            const appSpecifier &#x3D; parts[appSpecifierIndex];
            startConfig.app &#x3D; parts[appSpecifierIndex + 1];
            startConfig.production &#x3D; appSpecifier &#x3D;&#x3D;&#x3D; &quot;app&quot; ? true : false;
            parts &#x3D; parts.slice(0, appSpecifierIndex);
        }
        startConfig.url &#x3D; Utils.addUrl(browserUrl.origin, ...parts);
        return startConfig;
    }

    private initStartConfig() {
        const defaultStartConfig &#x3D; this.getDefaultStartConfig();
        const initialStartConfig &#x3D; Utils.copy(this.startConfig);
        Utils.extend(this.startConfig, defaultStartConfig, initialStartConfig);
        const browserUrl &#x3D; Utils.makeURL(window.location.href);
        const url &#x3D; Utils.makeURL(this.startConfig.url!);
        let apiPath &#x3D; Utils.addUrl(url.pathname, StartConfigWebService.API_PATH);
        let applicationPath &#x3D; url.pathname;
        const corsActive &#x3D; url.origin !&#x3D;&#x3D; browserUrl.origin;
        if (corsActive) {
            apiPath &#x3D; Utils.addUrl(url.origin, apiPath);
            applicationPath &#x3D; Utils.addUrl(url.origin, applicationPath);
        }
        this.startConfig.origin &#x3D; url.origin;
        this.startConfig.applicationPath &#x3D; applicationPath;
        this.startConfig.apiPath &#x3D; apiPath;
        this.startConfig.corsActive &#x3D; corsActive;
        this.startConfig.browserUrl &#x3D; Utils.addUrl(browserUrl.origin, browserUrl.pathname);
    }

    /**
     * Fetches pre-login app configuration from the Sinequa server and merges it
     * into the start config instance
     *
     * @returns An observable of the start config after being merged with the pre-login app configuration
     */
    fetchPreLoginAppConfig(): Observable&lt;StartConfig&gt; {
        return Observable.create(observer &#x3D;&gt; {
            let _url &#x3D; Utils.addUrl(this.startConfig.apiPath!, &quot;app&quot;);
            _url &#x3D; Utils.addSearchParams(_url, {
                app: this.startConfig.app,
                preLogin: true
            });
            atomic(_url, {
                headers: {
                    &quot;sinequa-force-camel-case&quot;: true
                }
            })
                .then(response &#x3D;&gt; {
                    const initialStartConfig &#x3D; Utils.copy(this.startConfig);
                    Utils.extend(this.startConfig, response.data, initialStartConfig);
                    const versionDate &#x3D; this.startConfig.versionDate;
                    if (Utils.isString(versionDate)) { // it will be
                        this.startConfig.versionDate &#x3D; Utils.fromSysDateStr(versionDate);
                    }
                    observer.next(this.startConfig);
                    observer.complete();
                })
                .catch(error &#x3D;&gt; {
                    console.error(&quot;Error retrieving app config&quot;);
                    observer.error(error);
                });
        });
    }

    /**
     * Retrieves Sinequa server configuration from a web server hosting the app
     *
     * @param url A URL to a JSON file containing the Sinequa server configuration
     *
     * @returns An observable of the Sinequa server configuration
     */
    fetchServerConfig(url?: string): Observable&lt;ServerConfig&gt; {
        return Observable.create(observer &#x3D;&gt; {
            if (!url) {
                const _url &#x3D; Utils.makeURL(window.location.href);
                url &#x3D; Utils.addUrl(_url.pathname, &quot;sinequa-config.json&quot;);
            }
            atomic(url)
                .then(response &#x3D;&gt; {
                    // If the config file is empty or not valid json we&#x27;ll most likely get a string for data
                    let serverConfig &#x3D; response.data;
                    if (!Utils.isObject(serverConfig)) {
                        console.warn(&quot;invalid sinequa-config.json file&quot;);
                        serverConfig &#x3D; {};
                    }
                    observer.next(serverConfig);
                    observer.complete();
                })
                .catch(error &#x3D;&gt; {
                    console.log(&quot;sinequa-config.json not found&quot;);
                    observer.next({});
                    observer.complete();
                });
        });
    }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'DeducedStartConfig.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
