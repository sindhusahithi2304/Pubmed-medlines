!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@sinequa/core/app-utils"),require("@sinequa/core/base"),require("@angular/core"),require("@angular/router"),require("rxjs"),require("rxjs/operators"),require("@sinequa/core/web-services"),require("@sinequa/core/login"),require("@sinequa/core/intl"),require("@sinequa/core/notification"),require("@angular/common"),require("@sinequa/components/utils"),require("@sinequa/components/action"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@sinequa/components/search",["exports","@sinequa/core/app-utils","@sinequa/core/base","@angular/core","@angular/router","rxjs","rxjs/operators","@sinequa/core/web-services","@sinequa/core/login","@sinequa/core/intl","@sinequa/core/notification","@angular/common","@sinequa/components/utils","@sinequa/components/action","@angular/forms"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.components=e.sinequa.components||{},e.sinequa.components.search={}),e.sinequa.core["app-utils"],e.sinequa.core.base,e.ng.core,e.ng.router,e.rxjs,e.rxjs.operators,e.sinequa.core["web-services"],e.sinequa.core.login,e.sinequa.core.intl,e.sinequa.core.notification,e.ng.common,e.sinequa.components.utils,e.sinequa.components.action,e.ng.forms)}(this,(function(e,t,r,i,n,s,a,o,c,u,l,p,h,d,f){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function g(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return a}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}Object.create;var y=function(){function e(e,t,r){this.appService=e,this.searchService=t,this.query=r.copy(),this.items=[],this.advanced=[],this.fields=new Set}return e.create=function(t,r,i){return new e(t,r,i).init()},Object.defineProperty(e.prototype,"activeIndex",{get:function(){return this.items.findIndex((function(e){return e.active}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeItem",{get:function(){var e=this.activeIndex;if(-1!==e)return this.items[e]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.items[0].display},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textExpr",{get:function(){return this.items[0].expr},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selects",{get:function(){return this.items.slice(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeSelects",{get:function(){return this.items.slice(1,this.activeIndex+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeItems",{get:function(){return this.items.slice(0,this.activeIndex+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.items.length||!(1!==this.items.length||!this.items[0].hidden)},enumerable:!1,configurable:!0}),e.prototype.find=function(e){var r,i,n,s,a=this,o=e,c=e;if(e instanceof t.Expr||(o=new t.Expr(c)),o.every((function(e){var t=e.exprContext.appService.resolveColumnAlias(e.field);return!t||a.fields.has(t)}))){try{for(var u=g(this.advanced),l=u.next();!l.done;l=u.next()){if(f=l.value.find(o))return f}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}try{for(var p=g(this.selects),h=p.next();!h.done;h=p.next()){var d=h.value;if(d.expr)if(f=d.expr.find(o))return f}}catch(e){n={error:e}}finally{try{h&&!h.done&&(s=p.return)&&s.call(p)}finally{if(n)throw n.error}}if(this.textExpr){var f;if(f=this.textExpr.find(o,(function(e){return e.isStructured})))return f;if(f=this.textExpr.find(o,(function(e){return!e.isStructured})))return f}}},e.prototype.findSelect=function(e,t){for(var i=this.activeSelects,n=i.length-1;n>=0;n--){var s=i[n];if(s.expr&&(!e||r.Utils.eqNC(e,s.facet||""))){if(!t)return s.expr;if(r.Utils.isString(t)){if(r.Utils.eqNC(t,s.expr.field||""))return s.expr}else{var a=s.expr.find(t);if(a)return a}}}},e.prototype.addFields=function(e){var t=this;e&&e.getFields().forEach((function(e){t.fields.add(e)}))},e.prototype.makeBreadcrumbsItemFromExpr=function(e){var r=this.appService.parseExpr(e);return r instanceof t.Expr||(r=this.appService.parseExpr(t.ExprParser.escape(e))),r instanceof t.Expr?{expr:r,display:r}:{expr:void 0,display:r}},e.prototype.initItems=function(){var e,t;if(this.query&&this.query.text){var r=this.makeBreadcrumbsItemFromExpr(this.query.text);this.items.push(r),this.addFields(r.expr)}else this.items.push({expr:void 0,display:this.query&&this.query.basket?this.query.basket:"msg#breadcrumbs.emptySearch",hidden:this.appService.ccquery&&!this.appService.ccquery.allowEmptySearch&&this.searchService.isEmptySearchIgnoreSelects(this.query)});if(this.query&&this.query.select)try{for(var i=g(this.query.select),n=i.next();!n.done;n=i.next()){var s=n.value;(r=this.makeBreadcrumbsItemFromExpr(s.expression)).facet=s.facet,this.items.push(r),this.addFields(r.expr)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.items[this.items.length-1].active=!0},e.prototype.init=function(){return this.initItems(),this},e.prototype.selectItem=function(e){var t=this.items.indexOf(e);if(this.query&&-1!==t){var r=this.query.copy();return r.select&&r.select.splice(t),this.items.forEach((function(e){return e.active=!1})),e.active=!0,r}},e.prototype.removeItem=function(e){var t=this.items.indexOf(e);if(this.query&&-1!==t){var r=void 0;if(0===t)(this.query.text||this.query.basket)&&(delete this.query.text,delete this.query.basket,e.expr=void 0,e.display="msg#breadcrumbs.emptySearch",e.hidden=this.appService.ccquery&&!this.appService.ccquery.allowEmptySearch&&this.searchService.isEmptySearchIgnoreSelects(this.query)),e.hidden?this.items.length>1&&(r=this.items[this.items.length-1]):r=this.activeItem;else{var i=this.activeIndex;i>=t&&(i>t?r=this.items[i]:(r=t===this.items.length-1?this.items[t-1]:this.items[t+1]).hidden&&(r=void 0)),this.query.select&&this.query.select.splice(t-1,1),this.items.splice(t,1)}return r}},e.prototype.update=function(e){if(this.query||(this.query=e.copy()),this.query.text=e.text,this.query.basket=e.basket,!this.query.text&&!this.query.basket){var t=this.items[0];t.expr=void 0,t.display="msg#breadcrumbs.emptySearch",t.hidden=this.appService.ccquery&&!this.appService.ccquery.allowEmptySearch&&this.searchService.isEmptySearchIgnoreSelects(this.query)}},e}(),S=new i.InjectionToken("SEARCH_OPTIONS");e.SearchService=function(){function e(e,t,r,i,a,o,c,u,l,p){var h=this;this.options=e,this.router=t,this.appService=r,this.queryService=i,this.loginService=a,this.intlService=o,this.formatService=c,this.auditService=u,this.notificationsService=l,this.exprBuilder=p,this.queryStringParams={},this.fetchingLoadMore=!1,this._events=new s.Subject,this._queryStream=new s.BehaviorSubject(void 0),this._resultsStream=new s.BehaviorSubject(void 0),this.options||(this.options={routes:["search"]}),this.results=void 0,this.breadcrumbs=void 0,this.loginSubscription=this.loginService.events.subscribe((function(e){"session-changed"===e.type&&h.handleLogin()})),this.routerSubscription=this.router.events.subscribe((function(e){if(e instanceof n.NavigationStart){var t=h.router.getCurrentNavigation();t&&"popstate"===e.navigationTrigger&&!t.extras.state&&e.restoredState&&(t.extras.state=e.restoredState)}else e instanceof n.NavigationEnd&&h.handleNavigation()})),this.appSubscription=this.appService.events.subscribe((function(e){"query-changed"===e.type&&(!h._query||h.appService.ccquery&&h._query.name===h.appService.ccquery.name||h.clearQuery())}))}return e.prototype.ngOnDestroy=function(){this.loginSubscription.unsubscribe(),this.routerSubscription.unsubscribe(),this.appSubscription.unsubscribe(),this._events.complete(),this._queryStream.complete(),this._resultsStream.complete()},Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"queryStream",{get:function(){return this._queryStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resultsStream",{get:function(){return this._resultsStream.asObservable()},enumerable:!1,configurable:!0}),e.prototype.getTabConfig=function(e){if(this.appService.ccquery&&this.appService.ccquery.tabSearch&&this.appService.ccquery.tabSearch.tabs)return this.appService.ccquery.tabSearch.tabs.find((function(t){return r.Utils.eqNC(t.name,e)}))},Object.defineProperty(e.prototype,"query",{get:function(){return this._query||(this._query=this.makeQuery(),this._events.next({type:"new-query",query:this._query})),this._query},enumerable:!1,configurable:!0}),e.prototype.setQuery=function(e,t){if(void 0===t&&(t=!0),e!==this._query){if(this._query=e,this._query){var r=void 0;this.options.preventQueryNameChanges?r=this.appService.ccquery||this.appService.defaultCCQuery:(r=this.appService.getCCQuery(this._query.name))||(console.warn("Query '"+this._query.name+"' not found"),r=this.appService.defaultCCQuery),r&&(this._query.name=r.name,this.appService.ccquery!==r&&(this.appService.ccquery=r))}t&&this._events.next({type:"new-query",query:this._query})}},e.prototype.clearQuery=function(){this.setQuery(void 0)},e.prototype.updateBreadcrumbs=function(e,t){e?this.breadcrumbs&&(t.resuseBreadcrumbs||t.advanced)?t.advanced&&this.breadcrumbs.update(this.query):this.breadcrumbs=y.create(this.appService,this,this.query):this.breadcrumbs=void 0},e.prototype._setResults=function(e,t){void 0===t&&(t={}),e!==this.results&&(this._events.next({type:"before-new-results",results:e}),this.results=e,this.treatQueryIntents(e),this.updateBreadcrumbs(e,t),this.results&&(this.results.tab&&(this.query.tab=this.results.tab),this.results.attributes&&this.results.attributes.queryid&&(this.query.queryId=this.results.attributes.queryid)),this._events.next({type:"new-results",results:this.results}),this._resultsStream.next(this.results))},e.prototype.setResults=function(e){return this._setResults(e)},e.prototype.treatQueryIntents=function(e){var t,i,n,s;if(e&&e.queryAnalysis&&e.queryIntents){var a=e.queryIntents;try{for(var o=g(a),c=o.next();!c.done;c=o.next()){var u=c.value;if(u.actions)try{for(var l=(n=void 0,g(u.actions)),p=l.next();!p.done;p=l.next()){var h=p.value,d={type:"process-query-intent-action",action:h,intent:u,analysis:e.queryAnalysis};if(this._events.next(d),!d.actionProcessed&&h.data)switch(h.type){case"tab":e.queryAnalysis.initial&&this.query&&!r.Utils.eqNC(this.query.tab||"",h.data)&&this.selectTab(h.data,{skipLocationChange:!0})}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(s=l.return)&&s.call(l)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}}},Object.defineProperty(e.prototype,"haveRecords",{get:function(){return!!this.results&&!!this.results.records&&this.results.records.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowCount",{get:function(){return this.results&&this.results.rowCount?this.results.rowCount:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"totalRowCount",{get:function(){return this.results&&this.results.totalRowCount?this.results.totalRowCount:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageSize",{get:function(){return this.query&&this.query.pageSize?this.query.pageSize:this.appService.ccquery&&this.appService.ccquery.pageSize?this.appService.ccquery.pageSize:e.DefaultPageSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"page",{get:function(){return this.results?this.results.page:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pageCount",{get:function(){return this.results&&this.results.rowCount?Math.ceil(this.results.rowCount/this.results.pageSize):0},enumerable:!1,configurable:!0}),e.prototype.makeQuery=function(e){var r=this.appService.ccquery,i=new t.Query(r?r.name:"_unknown");return e&&Object.assign(i,e),this._events.next({type:"make-query",query:i}),i},e.prototype.makeAuditEvent=function(e){return this._events.next({type:"make-audit-event",event:e}),e},e.prototype.selectBreadcrumbsItem=function(e){if(this.breadcrumbs){var t=this.breadcrumbs.selectItem(e);t&&(this.setQuery(t,!1),this.search({reuseBreadcrumbs:!0}))}},e.prototype.removeBreadcrumbsItem=function(e){if(this.breadcrumbs){var t=this.breadcrumbs.removeItem(e);if(this.isEmptySearch(this.breadcrumbs.query))return void this.clear();t&&this.selectBreadcrumbsItem(t)}},e.prototype.removeSelect=function(e){if(this.breadcrumbs){var t=this.breadcrumbs.items[e+1];this.removeBreadcrumbsItem(t)}},e.prototype.removeText=function(){if(this.breadcrumbs){var e=this.breadcrumbs.items[0];this.removeBreadcrumbsItem(e)}},e.prototype.clear=function(e,t){void 0===e&&(e=!0),this.clearQuery(),t=t||this.options.homeRoute,this._setResults(void 0),this._events.next({type:"clear",path:t}),e&&this.navigate({path:t||this.options.homeRoute})},e.prototype.home=function(e){void 0===e&&(e=this.options.homeRoute),this.clear(!0,e)},e.prototype.makeQueryIntentData=function(e){return this._events.next({type:"make-query-intent-data",intentData:e}),e},e.prototype.isEmptySearchIgnoreSelects=function(e){return!e||(!e.action||"search"===e.action)&&(!e.isFirstPage&&((!e.text||!r.Utils.trim(e.text))&&!e.basket))},e.prototype.isEmptySearch=function(e){return!e||(!e.action||"search"===e.action)&&(!!this.isEmptySearchIgnoreSelects(e)&&!(e.select&&e.select.length>0))},e.prototype.checkEmptySearch=function(e){var t,i;if(this.appService.ccquery&&!this.appService.ccquery.allowEmptySearch){r.Utils.isArray(e)||(e=[e]);try{for(var n=g(e),s=n.next();!s.done;s=n.next()){var a=s.value;if(this.isEmptySearch(a))return this.notificationsService.info("msg#search.emptySearchNotification"),!1}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}}return!0},e.prototype.getResults=function(e,t,r){var i=this;if(void 0===r&&(r={}),!this.checkEmptySearch(e))return s.throwError("empty search");r.searchInactive||(this.searchActive=!0);var n=this.getCurrentTab();return this.queryService.getResults(e,t,this.makeQueryIntentData({tab:n?n.name:void 0,queryIntents:r.queryIntents,queryAnalysis:r.queryAnalysis})).pipe(a.map((function(e){return i.searchActive=!1,e})))},e.prototype.getMultipleResults=function(e,t){return this.checkEmptySearch(e)?this.queryService.getMultipleResults(e,t):s.of({results:[]})},e.prototype.navigate=function(e,t){var i,n;if(e||(e={}),!e.analyzeQueryText&&this.results&&(e.queryIntents=this.results.queryIntents,e.queryAnalysis=this.results.queryAnalysis),this.routingActive){var s=r.Utils.makeURL(this.router.url),a=s.pathname;s.searchParams.delete("$refresh");var o=decodeURIComponent(s.search),c=r.Utils.copy(this.queryStringParams);this._query&&(c.query=this._query.toJsonForQueryString());var u={queryParams:c,state:{audit:t,navigationOptions:e},skipLocationChange:e.skipLocationChange},l=e.path;l||(l=a),l=(s=r.Utils.makeURL(l)).pathname;try{for(var p=g(Object.keys(c)),h=p.next();!h.done;h=p.next()){var d=h.value;s.searchParams.set(d,c[d])}}catch(e){i={error:e}}finally{try{h&&!h.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}var f=decodeURIComponent(s.search);return r.Utils.eq(a,l)&&r.Utils.eq(o,f)&&(u.queryParams.$refresh=r.Utils.now.getTime(),u.skipLocationChange=!0),this.router.navigate([l],u)}return this.handleNavigation(e,t),Promise.resolve(!0)},e.prototype.getHistoryState=function(){var e=this.router.getCurrentNavigation();return e?e.extras&&e.extras.state||{}:window.history.state||{}},e.prototype.isSearchRouteActive=function(){var e=r.Utils.makeURL(this.router.url);return this.isSearchRoute(e.pathname)},e.prototype.isSearchRoute=function(e){return this.checkSearchRoute(e,this.options.routes)},e.prototype.isSkipSearchRoute=function(e){return this.checkSearchRoute(e,this.options.skipSearchRoutes)},e.prototype.checkSearchRoute=function(e,t){var i,n;if(t)try{for(var s=g(t),a=s.next();!a.done;a=s.next()){var o=a.value;if(r.Utils.endsWith(e,r.Utils.addUrl("/",o)))return!0}}catch(e){i={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return!1},e.prototype.getQueryFromUrl=function(){var e,t=r.Utils.makeURL(this.router.url);if(this.isSearchRoute(t.pathname)){var i=t.searchParams.get("query");if(i)try{e=this.makeQuery().fromJson(i)}catch(e){}}return e},e.prototype.ensureQueryFromUrl=function(){var e=this.getQueryFromUrl();return e?(this.setQuery(e,!this._query),e):void this.clear(!1)},e.prototype.handleLogin=function(){return this.loginService.complete?this.ensureQueryFromUrl()?this.navigate():Promise.resolve(!0):Promise.resolve(!1)},Object.defineProperty(e.prototype,"routingActive",{get:function(){return!this.options.deactivateRouting},set:function(e){this.options.deactivateRouting=!e},enumerable:!1,configurable:!0}),e.prototype.makeAuditEventFromCurrentQuery=function(){var e=this.query.lastSelect();if(!e)return this.query.basket?this.makeAuditEvent({type:"Basket_Open",detail:{basket:this.query.basket}}):this.makeAuditEvent({type:"Search_Text",detail:{text:this.query.text,scope:this.query.scope}});var r=this.appService.parseExpr(e.expression);return r instanceof t.Expr?"refine"===r.field?this.makeAuditEvent({type:"Search_Refine",detail:{text:r.value,itembox:e.facet,"from-result-id":this.results?this.results.id:null}}):this.makeAuditEvent({type:"Search_Select_Item",detail:{item:e,itembox:e.facet,itemcolumn:r.field,isitemexclude:r.not,"from-result-id":this.results?this.results.id:null}}):void 0},e.prototype.handleNavigation=function(e,t){var i=this;if(!this.loginService.complete)return Promise.resolve(!1);if(!this.appService.ccquery)return Promise.resolve(!1);var n=this._query;if(this.routingActive&&(n=this.ensureQueryFromUrl()),this._events.next({type:"update-query",query:n}),this._queryStream.next(n),!n)return Promise.resolve(!0);if(this.routingActive){var o=this.getHistoryState();t=o.audit,e=o.navigationOptions}var c=(e=e||{}).path?e.path:r.Utils.makeURL(this.router.url).pathname;if(e.skipSearch||this.isSkipSearchRoute(c))return Promise.resolve(!0);t||(t=this.makeAuditEventFromCurrentQuery())&&"Search_Text"===t.type&&(delete e.queryIntents,delete e.queryAnalysis);var u=this.getResults(this.query,t,{queryIntents:e.queryIntents,queryAnalysis:e.queryAnalysis});if(r.Utils.subscribe(u,(function(t){return e=e||{},i._setResults(t,{resuseBreadcrumbs:e.reuseBreadcrumbs}),t})),e.selectTab){var l={type:"after-select-tab",observable:u};this._events.next(l),u=l.observable}return u.pipe(a.map((function(){return!0})),a.catchError((function(){return s.of(!1)}))).toPromise()},e.prototype.search=function(e,t){return delete this.query.page,delete this.query.spellingCorrectionMode,this.navigate(e,t)},e.prototype.searchText=function(e){return this.checkEmptySearch(this.query)?this.search({path:e,analyzeQueryText:!0},this.makeAuditEvent({type:"Search_Text",detail:{text:this.query.text,scope:this.query.scope,language:this.intlService.currentLocale.name}})):Promise.resolve(!1)},e.prototype.searchRefine=function(e){return this.query.addSelect(this.exprBuilder.makeRefineExpr(e),"refine"),this.search(void 0,this.makeAuditEvent({type:"Search_Refine",detail:{text:e,itembox:"refine","from-result-id":this.results?this.results.id:null}}))},e.prototype.gotoPage=function(e){return this.query.page=e,this.navigate(void 0,this.makeAuditEvent({type:"Search_GotoPage",detail:{page:e,"from-result-id":this.results?this.results.id:null}}))},e.prototype.loadMore=function(){var e=this;if(!this.fetchingLoadMore){var t=this.query.page||this.page;if((t+=t<=this.pageCount?1:0)<=this.pageCount){this.fetchingLoadMore=!0,this.query.page=t;var r=this.makeAuditEvent({type:"Search_GotoPage",detail:{page:t,"from-result-id":this.results?this.results.id:null}});this.getResults(this.query,r).subscribe((function(t){var r;e.results&&t&&(e.results.records=v((null===(r=e.results)||void 0===r?void 0:r.records)||[],t.records)||[],e._resultsStream.next(e.results)),e.fetchingLoadMore=!1}))}}},e.prototype.hasMore=function(){return(this.query.page||this.page)<this.pageCount},e.prototype.didYouMean=function(e,r,i){if("search"===r)this.query.text=e;else{var n=this.query.findSelect("refine");n&&(n.expression="refine:"+t.ExprParser.escape(e))}return this.query.spellingCorrectionMode="dymonly",this.navigate(void 0,this.makeAuditEvent({type:i===o.DidYouMeanKind.Original?"Search_DidYouMean_Original":"Search_DidYouMean_Correction",detail:{text:e}}))},e.prototype.getCurrentRecordIds=function(){return this.results&&this.results.records?this.results.records.map((function(e){return e.id})):[]},e.prototype.getRecordFromId=function(e){if(this.results&&this.results.records)return this.results.records.find((function(t){return r.Utils.eq(t.id,e)}))},e.prototype.addFieldSelect=function(e,t,i){if(t&&(!r.Utils.isArray(t)||t.length>0)){var n=this.exprBuilder.makeFieldExpr(e,t,null==i?void 0:i.and);return(null==i?void 0:i.not)&&(n=this.exprBuilder.makeNotExpr(n)),this.query.addSelect(n,null==i?void 0:i.facetName),!0}return!1},Object.defineProperty(e.prototype,"lastRefineText",{get:function(){if(this.breadcrumbs){var e=this.breadcrumbs.findSelect("refine");if(e)return t.ExprParser.unescape(e.toString(!1))}return""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRelevance",{get:function(){var e;if(!this.breadcrumbs)return!1;if(null===(e=this.breadcrumbs.textExpr)||void 0===e?void 0:e.hasRelevance)return!0;var t=this.breadcrumbs.findSelect("refine");return(null==t?void 0:t.hasRelevance)||!1},enumerable:!1,configurable:!0}),e.prototype.selectTab=function(e,t){void 0===t&&(t={}),t.selectTab=!0;var r="string"==typeof e?e:e.name;return this.query.tab=r,delete this.query.queryId,this._events.next({type:"before-select-tab",query:this.query}),this.search(t,this.makeAuditEvent({type:"Search_GotoTab",detail:{tab:r,"from-result-id":this.results?this.results.id:null}}))},e.prototype.selectScope=function(e){this.query.scope=e},e.prototype.getTab=function(e){var t,i;if(this.results&&this.results.tabs)try{for(var n=g(this.results.tabs),s=n.next();!s.done;s=n.next()){var a=s.value;if(r.Utils.equals(a.name,e))return a}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}},e.prototype.getCurrentTab=function(){if(this.results&&this.results.tab)return this.getTab(this.results.tab)},e.prototype.notifyOpenOriginalDocument=function(e,t){var r,i,n,s,a,o=this.results&&this.results.records&&this.results.records.includes(e)?this.results:void 0;this._events.next({type:"open-original-document",record:e});var c=(null===(i=null===(r=this.results)||void 0===r?void 0:r.queryAnalysis)||void 0===i?void 0:i.queryLanguage)||(null===(n=this.query)||void 0===n?void 0:n.questionLanguage)||(null===(a=null===(s=this.appService)||void 0===s?void 0:s.ccquery)||void 0===a?void 0:a.questionLanguage);this.auditService.notifyDocument("Click_ResultLink",e,o||t||"",{text:this.query.text,querylang:c},{queryhash:o?o.rfmQueryHash:void 0,querytext:this.query.text,querylang:c})},e.prototype.checkBeforeSearch=function(e){var t={type:"before-search"};return this._events.next(t),e&&t.cancelReasons&&e.splice.apply(e,v([0,0],t.cancelReasons)),!t.cancel},e}(),e.SearchService.ɵfac=function(r){return new(r||e.SearchService)(i.ɵɵinject(S,8),i.ɵɵinject(n.Router),i.ɵɵinject(t.AppService),i.ɵɵinject(o.QueryWebService),i.ɵɵinject(c.LoginService),i.ɵɵinject(u.IntlService),i.ɵɵinject(t.FormatService),i.ɵɵinject(o.AuditWebService),i.ɵɵinject(l.NotificationsService),i.ɵɵinject(t.ExprBuilder))},e.SearchService.ɵprov=i.ɵɵdefineInjectable({token:e.SearchService,factory:e.SearchService.ɵfac,providedIn:"root"}),(e.SearchService||(e.SearchService={})).DefaultPageSize=20;var b=new i.InjectionToken("FIRST_PAGE_OPTIONS"),x=function(){function e(e,t,i){var n=this;this.options=e,this.searchService=t,this.router=i,this.options||(this.options={}),this.searchSubscription=this.searchService.events.subscribe((function(e){"clear"===e.type&&n.displayOnHomePage(e.path)&&r.Utils.subscribe(n.getFirstPage(),(function(e){n.searchService.setResults(e)}))}))}return e.prototype.ngOnDestroy=function(){this.searchSubscription.unsubscribe()},Object.defineProperty(e.prototype,"isFirstPage",{get:function(){return this.isCurrentSearchResults},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCurrentSearchResults",{get:function(){return!!this.searchService.results&&this.searchService.results===this.firstPage},enumerable:!1,configurable:!0}),e.prototype.displayOnHomePage=function(e){var t,i;if(r.Utils.isArray(this.options.displayOnHomePage)){if(!e)e=r.Utils.makeURL(this.router.url).pathname;try{for(var n=g(this.options.displayOnHomePage),s=n.next();!s.done;s=n.next()){var a=s.value;if(r.Utils.endsWith(e,r.Utils.addUrl("/",a)))return!0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return!1}return!!this.options.displayOnHomePage},e.prototype.getFirstPage=function(){var e=this;if(this.firstPage)return s.of(this.firstPage);var t=this.searchService.makeQuery();t.isFirstPage=!0;var i=this.searchService.getResults(t,{type:"Search_FirstPage"},{searchInactive:!0});return r.Utils.subscribe(i,(function(t){return e.firstPage=t,t})),i},e}();x.ɵfac=function(t){return new(t||x)(i.ɵɵinject(b,8),i.ɵɵinject(e.SearchService),i.ɵɵinject(n.Router))},x.ɵprov=i.ɵɵdefineInjectable({token:x,factory:x.ɵfac,providedIn:"root"});var q=function(e){return{withFields:e,asHTML:!0}};function C(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"a",9),i.ɵɵlistener("click",(function(){i.ɵɵrestoreView(r);var e=i.ɵɵnextContext(2).$implicit;return i.ɵɵnextContext().selectItem(e)})),i.ɵɵpipe(1,"sqExpr"),i.ɵɵelementEnd()}if(2&e){var n=i.ɵɵnextContext(2).$implicit,s=i.ɵɵnextContext();i.ɵɵproperty("innerHTML",i.ɵɵpipeBind2(1,1,n.display,i.ɵɵpureFunction1(4,q,s.displayFieldNames)),i.ɵɵsanitizeHtml)}}function P(e,t){if(1&e&&(i.ɵɵelement(0,"span",10),i.ɵɵpipe(1,"sqExpr")),2&e){var r=i.ɵɵnextContext(2).$implicit,n=i.ɵɵnextContext();i.ɵɵproperty("innerHTML",i.ɵɵpipeBind2(1,1,r.display,i.ɵɵpureFunction1(4,q,n.displayFieldNames)),i.ɵɵsanitizeHtml)}}function I(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"span",11),i.ɵɵlistener("click",(function(){i.ɵɵrestoreView(r);var e=i.ɵɵnextContext(2).$implicit;return i.ɵɵnextContext().removeItem(e)})),i.ɵɵpipe(1,"sqMessage"),i.ɵɵelementEnd()}2&e&&i.ɵɵpropertyInterpolate("title",i.ɵɵpipeBind1(1,1,"msg#breadcrumbs.itemRemove"))}function w(e,t){if(1&e&&(i.ɵɵelementStart(0,"li"),i.ɵɵtemplate(1,C,2,6,"a",6),i.ɵɵtemplate(2,P,2,6,"span",7),i.ɵɵtemplate(3,I,2,3,"span",8),i.ɵɵelementEnd()),2&e){var r=i.ɵɵnextContext().$implicit,n=i.ɵɵnextContext();i.ɵɵclassMapInterpolate2("breadcrumb-item ",r.active?"active":""," sq-breadcrumb-item  sq-breadcrumb-item-",n.getField(r),""),i.ɵɵadvance(1),i.ɵɵproperty("ngIf",!r.active),i.ɵɵadvance(1),i.ɵɵproperty("ngIf",r.active),i.ɵɵadvance(1),i.ɵɵproperty("ngIf",n.allowDeletion)}}function E(e,t){if(1&e&&(i.ɵɵelementContainerStart(0),i.ɵɵtemplate(1,w,4,7,"li",5),i.ɵɵelementContainerEnd()),2&e){var r=t.$implicit;i.ɵɵadvance(1),i.ɵɵproperty("ngIf",!r.hidden)}}var A=function(){function e(e){this.searchService=e,this.allowDeletion=!0,this.displayFieldNames=!0}return e.prototype.getField=function(e){return e.expr?e.expr.field?e.expr.field:e.expr.isStructured?e.expr.getFields().join("-"):"text":"unknown"},e.prototype.home=function(){return this.searchService.home(),!1},e.prototype.selectItem=function(e){return this.searchService.selectBreadcrumbsItem(e),!1},e.prototype.removeItem=function(e){this.searchService.removeBreadcrumbsItem(e)},e}();function O(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementContainerStart(0),i.ɵɵtext(1),i.ɵɵpipe(2,"sqMessage"),i.ɵɵelementStart(3,"a",3),i.ɵɵlistener("click",(function(){return i.ɵɵrestoreView(r),i.ɵɵnextContext(2).selectCorrected()})),i.ɵɵtext(4),i.ɵɵelementEnd(),i.ɵɵtext(5),i.ɵɵpipe(6,"sqMessage"),i.ɵɵelementContainerEnd()}if(2&e){var n=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵtextInterpolate1(" ",i.ɵɵpipeBind1(2,3,"msg#didYouMean.dymonlyBeforeCorrected"),""),i.ɵɵadvance(3),i.ɵɵtextInterpolate(n.item.corrected),i.ɵɵadvance(1),i.ɵɵtextInterpolate1("",i.ɵɵpipeBind1(6,5,"msg#didYouMean.dymonlyAfterCorrected")," ")}}function M(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementContainerStart(0),i.ɵɵtext(1),i.ɵɵpipe(2,"sqMessage"),i.ɵɵelementStart(3,"a",3),i.ɵɵlistener("click",(function(){return i.ɵɵrestoreView(r),i.ɵɵnextContext(2).selectCorrected()})),i.ɵɵtext(4),i.ɵɵelementEnd(),i.ɵɵtext(5),i.ɵɵpipe(6,"sqMessage"),i.ɵɵelementStart(7,"a",4),i.ɵɵlistener("click",(function(){return i.ɵɵrestoreView(r),i.ɵɵnextContext(2).selectOriginal()})),i.ɵɵtext(8),i.ɵɵelementEnd(),i.ɵɵtext(9),i.ɵɵpipe(10,"sqMessage"),i.ɵɵelementContainerEnd()}if(2&e){var n=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵtextInterpolate1(" ",i.ɵɵpipeBind1(2,5,"msg#didYouMean.correctBeforeCorrected"),""),i.ɵɵadvance(3),i.ɵɵtextInterpolate(n.item.corrected),i.ɵɵadvance(1),i.ɵɵtextInterpolate(i.ɵɵpipeBind1(6,7,"msg#didYouMean.correctBeforeOriginal")),i.ɵɵadvance(3),i.ɵɵtextInterpolate(n.item.original),i.ɵɵadvance(1),i.ɵɵtextInterpolate1("",i.ɵɵpipeBind1(10,9,"msg#didYouMean.correctAfterOriginal")," ")}}function B(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementContainerStart(0),i.ɵɵtext(1),i.ɵɵpipe(2,"sqMessage"),i.ɵɵelementStart(3,"a",4),i.ɵɵlistener("click",(function(){return i.ɵɵrestoreView(r),i.ɵɵnextContext(2).selectOriginal()})),i.ɵɵtext(4),i.ɵɵelementEnd(),i.ɵɵtext(5),i.ɵɵpipe(6,"sqMessage"),i.ɵɵelementStart(7,"a",4),i.ɵɵlistener("click",(function(){return i.ɵɵrestoreView(r),i.ɵɵnextContext(2).selectCorrected()})),i.ɵɵtext(8),i.ɵɵelementEnd(),i.ɵɵtext(9),i.ɵɵpipe(10,"sqMessage"),i.ɵɵelementContainerEnd()}if(2&e){var n=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵtextInterpolate1(" ",i.ɵɵpipeBind1(2,5,"msg#didYouMean.smartBeforeOriginal"),""),i.ɵɵadvance(3),i.ɵɵtextInterpolate(n.item.original),i.ɵɵadvance(1),i.ɵɵtextInterpolate(i.ɵɵpipeBind1(6,7,"msg#didYouMean.smartBeforeCorrected")),i.ɵɵadvance(3),i.ɵɵtextInterpolate(n.item.corrected),i.ɵɵadvance(1),i.ɵɵtextInterpolate1("",i.ɵɵpipeBind1(10,9,"msg#didYouMean.smartAfterCorrected")," ")}}function k(e,t){if(1&e&&(i.ɵɵelementStart(0,"div",1),i.ɵɵtemplate(1,O,7,7,"ng-container",2),i.ɵɵtemplate(2,M,11,11,"ng-container",2),i.ɵɵtemplate(3,B,11,11,"ng-container",2),i.ɵɵelementEnd()),2&e){var r=i.ɵɵnextContext();i.ɵɵclassMapInterpolate1("sq-did-you-mean sq-text ","sq-"+r.context,""),i.ɵɵproperty("ngSwitch",r.results.didYouMean.spellingCorrectionMode),i.ɵɵadvance(1),i.ɵɵproperty("ngSwitchCase","DYMOnly"),i.ɵɵadvance(1),i.ɵɵproperty("ngSwitchCase","Correct"),i.ɵɵadvance(1),i.ɵɵproperty("ngSwitchCase","Smart")}}A.ɵfac=function(t){return new(t||A)(i.ɵɵdirectiveInject(e.SearchService))},A.ɵcmp=i.ɵɵdefineComponent({type:A,selectors:[["sq-breadcrumbs"]],inputs:{results:"results",allowDeletion:"allowDeletion",displayFieldNames:"displayFieldNames"},decls:5,vars:1,consts:[[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#","title","Home",3,"click"],[1,"fas","fa-home"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],["href","#",3,"innerHTML","click",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["class","fas fa-times","role","button",3,"title","click",4,"ngIf"],["href","#",3,"innerHTML","click"],[3,"innerHTML"],["role","button",1,"fas","fa-times",3,"title","click"]],template:function(e,t){1&e&&(i.ɵɵelementStart(0,"ol",0),i.ɵɵelementStart(1,"li",1),i.ɵɵelementStart(2,"a",2),i.ɵɵlistener("click",(function(){return t.home()})),i.ɵɵelement(3,"span",3),i.ɵɵelementEnd(),i.ɵɵelementEnd(),i.ɵɵtemplate(4,E,2,1,"ng-container",4),i.ɵɵelementEnd()),2&e&&(i.ɵɵadvance(4),i.ɵɵproperty("ngForOf",null==t.searchService.breadcrumbs?null:t.searchService.breadcrumbs.items))},directives:[p.NgForOf,p.NgIf],pipes:[h.ExprPipe,u.MessagePipe],styles:[".breadcrumb[_ngcontent-%COMP%]{background-color:inherit;font-size:.85rem;margin-bottom:0;padding:.375rem 0}.sq-breadcrumbs-remove[_ngcontent-%COMP%]{color:#d3d3d3;cursor:pointer}.sq-breadcrumbs-remove[_ngcontent-%COMP%]:hover{color:#a9a9a9}"]});var z=function(){function e(e){this.searchService=e,this.context="search"}return e.prototype.handleResults=function(){if(this.item=void 0,this.results&&this.results.didYouMean)if("search"===this.context){var e=this.results.didYouMean.text;e&&e.corrected&&(this.item=e)}else{var t=this.searchService.query.findSelect("refine");if(t&&r.Utils.startsWith(t.expression,"refine:")&&this.results.didYouMean.refine){var i=this.results.didYouMean.refine[this.results.didYouMean.refine.length-1];i.corrected&&(this.item=i)}}},e.prototype.ngOnChanges=function(e){e.results&&this.handleResults()},e.prototype.selectOriginal=function(){return this.item&&this.searchService.didYouMean(this.item.original,this.context,o.DidYouMeanKind.Original),!1},e.prototype.selectCorrected=function(){return this.item&&this.searchService.didYouMean(this.item.corrected,this.context,o.DidYouMeanKind.Corrected),!1},e}();z.ɵfac=function(t){return new(t||z)(i.ɵɵdirectiveInject(e.SearchService))},z.ɵcmp=i.ɵɵdefineComponent({type:z,selectors:[["sq-did-you-mean"]],inputs:{results:"results",context:"context"},features:[i.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[[3,"class","ngSwitch",4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["href","#",1,"sq-did-you-mean-corrected",3,"click"],["href","#",1,"sq-did-you-mean-original",3,"click"]],template:function(e,t){1&e&&i.ɵɵtemplate(0,k,4,7,"div",0),2&e&&i.ɵɵproperty("ngIf",!!t.item)},directives:[p.NgIf,p.NgSwitch,p.NgSwitchCase],pipes:[u.MessagePipe],styles:[".sq-did-you-mean[_ngcontent-%COMP%]   .sq-did-you-mean-corrected[_ngcontent-%COMP%], .sq-did-you-mean[_ngcontent-%COMP%]   .sq-did-you-mean-original[_ngcontent-%COMP%]{font-style:italic}"]});var _=function(e){return[e]},R=function(e,t){return{items:e,autoAdjust:!0,rightAligned:t}};function F(e,t){if(1&e&&(i.ɵɵelementStart(0,"div",1),i.ɵɵelement(1,"div",2),i.ɵɵelementEnd()),2&e){var r=i.ɵɵnextContext();i.ɵɵadvance(1),i.ɵɵproperty("sq-action-buttons",i.ɵɵpureFunction2(3,R,i.ɵɵpureFunction1(1,_,r.pageSizingAction),r.rightAligned))}}var j=function(){function t(e,t){this.appService=e,this.searchService=t,this.showInRegularView=!0}return t.prototype.ngOnChanges=function(e){this.refreshVisualisation()},Object.defineProperty(t.prototype,"configPageSize",{get:function(){return this.appService.ccquery?this.appService.ccquery.pageSize:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultPageSize",{get:function(){var t=this.configPageSize;return t||(t=e.SearchService.DefaultPageSize),t},enumerable:!1,configurable:!0}),t.prototype.buildPageSizingAction=function(){var e,t,r=this;this.availableSizes=this.pageSizes?this.pageSizes.slice(0):[],this.availableSizes.sort((function(e,t){return e-t}));var i=[];i.push(new d.Action({text:"msg#pageSizeSelector.defaultPageSize",messageParams:{values:{size:this.defaultPageSize}},data:void 0,action:function(e,t){r.updatePageSize(e.data)}}));try{for(var n=g(this.availableSizes),s=n.next();!s.done;s=n.next()){var a=s.value;i.push(new d.Action({text:a.toString(),data:a,action:function(e,t){r.updatePageSize(e.data)}}))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return new d.Action({icon:"fas fa-arrows-alt-v",text:"msg#pageSizeSelector.pageSizeChoice",children:i})},t.prototype.refreshVisualisation=function(){this.pageSizingAction=this.buildPageSizingAction(),this.results&&this.setCurrentSize(this.currentPageSize)},t.prototype.setCurrentSize=function(e){var t;if(e){var r=null===(t=this.pageSizingAction.children)||void 0===t?void 0:t.find((function(t){return t.data===e}));this.pageSizingAction.text="msg#pageSizeSelector.pageSizeChoice",this.pageSizingAction.messageParams={values:{size:null==r?void 0:r.data}}}else this.pageSizingAction.text="msg#pageSizeSelector.defaultPageSizeChoice",this.pageSizingAction.messageParams={values:{size:this.defaultPageSize}}},t.prototype.updatePageSize=function(e){this.currentPageSize!==e&&(this.currentPageSize=e,this.searchService.query.pageSize=e,this.searchService.search()),this.setCurrentSize(e)},t}();j.ɵfac=function(r){return new(r||j)(i.ɵɵdirectiveInject(t.AppService),i.ɵɵdirectiveInject(e.SearchService))},j.ɵcmp=i.ɵɵdefineComponent({type:j,selectors:[["sq-page-size-selector"]],inputs:{results:"results",showInRegularView:"showInRegularView",showInCustomization:"showInCustomization",pageSizes:"pageSizes",rightAligned:"rightAligned"},features:[i.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[["class","btn-toolbar",4,"ngIf"],[1,"btn-toolbar"],[1,"btn-group",3,"sq-action-buttons"]],template:function(e,t){1&e&&i.ɵɵtemplate(0,F,2,6,"div",0),2&e&&i.ɵɵproperty("ngIf",!!t.results)},directives:[p.NgIf,d.BsActionButtons],encapsulation:2});var T,N,U=function(e){return{page:e}},L=function(e){return{values:e}},D=function(e,t,r,i,n){return{active:e,disabled:t,"sq-navigation":r,"sq-page":i,"sq-ellipsis":n}};function Q(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"li",3),i.ɵɵlistener("click",(function(){i.ɵɵrestoreView(r);var e=t.$implicit;return i.ɵɵnextContext(2).gotoPage(e.page)})),i.ɵɵpipe(1,"sqMessage"),i.ɵɵelementStart(2,"a",4),i.ɵɵelementStart(3,"span"),i.ɵɵtext(4),i.ɵɵpipe(5,"sqNumber"),i.ɵɵelementEnd(),i.ɵɵelementEnd(),i.ɵɵelementEnd()}if(2&e){var n=t.$implicit;i.ɵɵpropertyInterpolate("title",i.ɵɵpipeBind2(1,3,n.title,i.ɵɵpureFunction1(10,L,i.ɵɵpureFunction1(8,U,n.page)))),i.ɵɵproperty("ngClass",i.ɵɵpureFunction5(12,D,n.active,n.disabled,n.isNavigation,n.isPage,n.isEllipsis)),i.ɵɵadvance(4),i.ɵɵtextInterpolate(i.ɵɵpipeBind1(5,6,n.display))}}function V(e,t){if(1&e&&(i.ɵɵelementStart(0,"ul",1),i.ɵɵtemplate(1,Q,6,18,"li",2),i.ɵɵelementEnd()),2&e){var r=i.ɵɵnextContext();i.ɵɵadvance(1),i.ɵɵproperty("ngForOf",r.items)}}e.BsPager=function(){function e(e){this.searchService=e,this.showNavigation=!0,this.showFirstLast=!0,this.showPages=!0,this.endPages=1,this.pages=5,this.pageCount=0}return e.prototype.ngOnChanges=function(e){e.results&&this.makeItems()},e.prototype.makeItems=function(){if(this.pageCount=this.searchService.pageCount,this.currentPage=this.searchService.page,0!==this.pageCount){var t=this.endPages;(!t||t<=0)&&(t=1);var r=t+1,i=this.pages;i||(i=3+2*r),i<3+2*r&&(i=3+2*r);var n=-1,s=-1;if(this.pageCount<=i)i=this.pageCount;else{var a=(i=2*Math.floor(i/2)+1)-2*r,o=Math.floor(a/2);this.currentPage-o>t+1+1&&(n=this.currentPage-o),this.currentPage+o<this.pageCount-r&&(s=this.currentPage+o),-1===n&&-1!==s?s+=t+1+1-(this.currentPage-o):-1===s&&-1!==n&&(n-=this.currentPage+o-(this.pageCount-r))}if(this.items=[],this.showNavigation&&(this.showFirstLast&&this.items.push(new e.Item(1,this.currentPage,e.FIRST_PAGE,"msg#pager.firstPage")),this.items.push(new e.Item(this.currentPage>1?this.currentPage-1:1,this.currentPage,e.PREVIOUS_PAGE,"msg#pager.previousPage"))),this.showPages){for(var c=1,u=-1!==n?t:-1!==s?s:this.pageCount;c<=u;c++)this.items.push(new e.Item(c,this.currentPage));if(-1!==n){this.items.push(new e.Item(0,this.currentPage,e.ELLIPSIS));for(c=n,u=-1!==s?s:this.pageCount;c<=u;c++)this.items.push(new e.Item(c,this.currentPage))}if(-1!==s){this.items.push(new e.Item(0,this.currentPage,e.ELLIPSIS));for(c=this.pageCount-t+1,u=this.pageCount;c<=u;c++)this.items.push(new e.Item(c,this.currentPage))}}this.showNavigation&&(this.items.push(new e.Item(this.currentPage<this.pageCount?this.currentPage+1:this.pageCount,this.currentPage,e.NEXT_PAGE,"msg#pager.nextPage")),this.showFirstLast&&this.items.push(new e.Item(this.pageCount,this.currentPage,e.LAST_PAGE,"msg#pager.lastPage")))}else this.items=void 0},e.prototype.gotoPage=function(e){e!==this.currentPage&&e>0&&this.searchService.gotoPage(e)},e}(),e.BsPager.FIRST_PAGE="«",e.BsPager.PREVIOUS_PAGE="‹",e.BsPager.NEXT_PAGE="›",e.BsPager.LAST_PAGE="»",e.BsPager.ELLIPSIS="…",e.BsPager.ɵfac=function(t){return new(t||e.BsPager)(i.ɵɵdirectiveInject(e.SearchService))},e.BsPager.ɵcmp=i.ɵɵdefineComponent({type:e.BsPager,selectors:[["sq-pager"]],inputs:{results:"results",showNavigation:"showNavigation",showFirstLast:"showFirstLast",showPages:"showPages",endPages:"endPages",pages:"pages"},features:[i.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[["class","pagination my-0",4,"ngIf"],[1,"pagination","my-0"],["class","page-item",3,"title","ngClass","click",4,"ngFor","ngForOf"],[1,"page-item",3,"title","ngClass","click"],["href","javascript:void(0)",1,"page-link"]],template:function(e,t){1&e&&i.ɵɵtemplate(0,V,2,1,"ul",0),2&e&&i.ɵɵproperty("ngIf",t.pageCount>1)},directives:[p.NgIf,p.NgForOf,p.NgClass],pipes:[u.MessagePipe,h.NumberPipe],encapsulation:2}),T=e.BsPager||(e.BsPager={}),N=function(){function e(e,t,i,n){this.page=e,this.currentPage=t,this.display=i,this.title=n,this.display=i||e,r.Utils.isUndefined(n)&&e&&(this.title="msg#pager.pageNumberTitle")}return Object.defineProperty(e.prototype,"active",{get:function(){return this.isPage&&this.currentPage===this.page},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this.isEllipsis||this.currentPage===this.page&&this.isNavigation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isNavigation",{get:function(){return this.display===T.FIRST_PAGE||this.display===T.PREVIOUS_PAGE||this.display===T.NEXT_PAGE||this.display===T.LAST_PAGE},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPage",{get:function(){return!!this.page&&!this.isNavigation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEllipsis",{get:function(){return this.display===T.ELLIPSIS},enumerable:!1,configurable:!0}),e}(),T.Item=N;var Y=function(e){return[e]},H=function(e,t,r,i){return{items:e,style:t,autoAdjust:!0,rightAligned:r,size:i}},G=function(){function e(e,t){this.appService=e,this.searchService=t}return e.prototype.ngOnChanges=function(e){e.results&&this.buildSortAction()},e.prototype.setCurrentSort=function(e){if(this.sortAction){var t=this.getSortingChoices(),i=t&&t.find((function(t){return r.Utils.eqNC(t.name,e)}));if(i){var n=this.searchService.query.orderBy;this.sortAction.text=n?"msg#sortSelector.sortOther":i.display||i.name,this.sortAction.icon=n?"fas fa-sort":this.isAscendingSort(i.orderByClause)?"fas fa-sort-amount-up":this.isDescendingSort(i.orderByClause)?"fas fa-sort-amount-down":"fas fa-sort"}else this.sortAction.text="msg#sortSelector.sortOther",this.sortAction.icon="fas fa-sort";this.sortAction.messageParams={values:{text:this.sortAction.text}}}},e.prototype.selectSort=function(e){this.setCurrentSort(e.name),this.searchService.query.sort=e.name;var t={type:"Search_Sort",detail:{sort:e.name,orderByClause:e.orderByClause}};this.searchService.search(void 0,t)},e.prototype.buildSortAction=function(){var e=this,t=this.getSortingChoices();t&&0!==t.length?(this.sortAction=new d.Action({title:"msg#sortSelector.sortByTitle",children:t.filter((function(t){return e.searchService.hasRelevance||!r.Utils.includes(t.orderByClause,"globalrelevance")})).map((function(t){return new d.Action({icon:e.isAscendingSort(t.orderByClause)?"fas fa-sort-amount-up":e.isDescendingSort(t.orderByClause)?"fas fa-sort-amount-down":"",text:t.display||t.name,data:t,action:function(t,r){e.selectSort(t.data)}})}))}),this.searchService.results&&this.setCurrentSort(this.searchService.results.sort)):this.sortAction=void 0},e.prototype.isAscendingSort=function(e){if(!e)return!1;var t=e.substring(e.lastIndexOf(" ")+1);return r.Utils.eqNC("asc",t)},e.prototype.isDescendingSort=function(e){if(!e)return!1;var t=e.substring(e.lastIndexOf(" ")+1);return r.Utils.eqNC("desc",t)},e.prototype.isTabSearch=function(){var e=this.appService.ccquery;if(!e)return!1;var t=e.tabSearch;return!!(t&&t.column&&t.isActive&&t.tabs&&0!==t.tabs.length)},e.prototype.getSortingChoices=function(){var e,t;if(this.isTabSearch()){var r=this.searchService.results&&this.searchService.results.tab;if(r&&this.appService.ccquery)try{for(var i=g(this.appService.ccquery.tabSearch.tabs),n=i.next();!n.done;n=i.next()){var s=n.value;if(s.name===r){var a=s.sortingChoices;if(a&&a.length>0)return a;break}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}}var o=this.appService.ccquery;return o&&o.sortingChoices},e}();G.ɵfac=function(r){return new(r||G)(i.ɵɵdirectiveInject(t.AppService),i.ɵɵdirectiveInject(e.SearchService))},G.ɵcmp=i.ɵɵdefineComponent({type:G,selectors:[["sq-sort-selector"]],inputs:{results:"results",rightAligned:"rightAligned",style:"style",size:"size"},features:[i.ɵɵNgOnChangesFeature],decls:2,vars:9,consts:[["role","toolbar","aria-label","Toolbar",1,"btn-toolbar"],[1,"btn-group",3,"hidden","sq-action-buttons"]],template:function(e,t){1&e&&(i.ɵɵelementStart(0,"div",0),i.ɵɵelement(1,"div",1),i.ɵɵelementEnd()),2&e&&(i.ɵɵadvance(1),i.ɵɵproperty("hidden",!t.searchService.haveRecords||!t.sortAction)("sq-action-buttons",i.ɵɵpureFunction4(4,H,i.ɵɵpureFunction1(2,Y,t.sortAction),t.style,t.rightAligned,t.size)))},directives:[d.BsActionButtons],encapsulation:2});var $=function(e,t){return{active:e,disabled:t}};function W(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"li",4),i.ɵɵelementStart(1,"a",5),i.ɵɵlistener("click",(function(){i.ɵɵrestoreView(r);var e=t.$implicit;return i.ɵɵnextContext(3).selectTab(e)})),i.ɵɵelement(2,"i",6),i.ɵɵtext(3),i.ɵɵpipe(4,"sqMessage"),i.ɵɵelementStart(5,"span",7),i.ɵɵtext(6),i.ɵɵpipe(7,"sqNumber"),i.ɵɵelementEnd(),i.ɵɵelementEnd(),i.ɵɵelementEnd()}if(2&e){var n=t.$implicit,s=i.ɵɵnextContext(3);i.ɵɵadvance(1),i.ɵɵproperty("ngClass",i.ɵɵpureFunction2(8,$,n==s.currentTab,0==n.count)),i.ɵɵadvance(1),i.ɵɵproperty("ngClass",s.iconMap[n.name]),i.ɵɵadvance(1),i.ɵɵtextInterpolate1(" ",i.ɵɵpipeBind1(4,4,n.display||n.name)," "),i.ɵɵadvance(3),i.ɵɵtextInterpolate1("(",i.ɵɵpipeBind1(7,6,n.count),")")}}function J(e,t){if(1&e&&(i.ɵɵelementContainerStart(0),i.ɵɵtemplate(1,W,8,11,"li",3),i.ɵɵelementContainerEnd()),2&e){var r=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵproperty("ngForOf",r.searchtabs)}}function Z(e,t){if(1&e&&(i.ɵɵelementStart(0,"span",7),i.ɵɵtext(1),i.ɵɵpipe(2,"sqNumber"),i.ɵɵelementEnd()),2&e){var r=i.ɵɵnextContext().$implicit;i.ɵɵadvance(1),i.ɵɵtextInterpolate1("(",i.ɵɵpipeBind1(2,1,r.count),")")}}function K(e,t){if(1&e){var r=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"li",4),i.ɵɵelementStart(1,"a",5),i.ɵɵlistener("click",(function(){i.ɵɵrestoreView(r);var e=t.$implicit;return i.ɵɵnextContext(3).selectTab(e,!1)})),i.ɵɵelement(2,"i",6),i.ɵɵtext(3),i.ɵɵpipe(4,"sqMessage"),i.ɵɵtemplate(5,Z,3,3,"span",8),i.ɵɵelementEnd(),i.ɵɵelementEnd()}if(2&e){var n=t.$implicit,s=i.ɵɵnextContext(3);i.ɵɵadvance(1),i.ɵɵproperty("ngClass",i.ɵɵpureFunction2(6,$,n==s.currentTab,0==n.count)),i.ɵɵadvance(1),i.ɵɵproperty("ngClass",s.iconMap[n.name]),i.ɵɵadvance(1),i.ɵɵtextInterpolate1(" ",i.ɵɵpipeBind1(4,4,n.display||n.name)," "),i.ɵɵadvance(2),i.ɵɵproperty("ngIf",n.count>=0)}}function X(e,t){if(1&e&&(i.ɵɵelementContainerStart(0),i.ɵɵtemplate(1,K,6,9,"li",3),i.ɵɵelementContainerEnd()),2&e){var r=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵproperty("ngForOf",r.customtabs)}}function ee(e,t){if(1&e&&(i.ɵɵelementStart(0,"ul",1),i.ɵɵtemplate(1,J,2,1,"ng-container",2),i.ɵɵtemplate(2,X,2,1,"ng-container",2),i.ɵɵelementEnd()),2&e){var r=i.ɵɵnextContext();i.ɵɵadvance(1),i.ɵɵproperty("ngIf",!!r.searchtabs),i.ɵɵadvance(1),i.ɵɵproperty("ngIf",!!r.customtabs)}}var te=function(){function e(e){this.searchService=e,this.iconMap={},this.events=new i.EventEmitter}return e.prototype.update=function(){this.results&&this.results.tabs?(this.currentTab=this.searchService.getCurrentTab(),this.searchtabs=this.results.tabs):(this.currentTab=void 0,this.searchtabs=void 0)},e.prototype.ngOnChanges=function(e){e.results&&this.update()},e.prototype.selectTab=function(e,t){return void 0===t&&(t=!0),e!==this.currentTab&&(t?this.searchService.selectTab(e):this.currentTab=e,this.events.next(e)),!1},e}();function re(e,t){1&e&&(i.ɵɵelementStart(0,"div",1),i.ɵɵelement(1,"div",2),i.ɵɵelement(2,"div",3),i.ɵɵelement(3,"div",4),i.ɵɵelementEnd())}te.ɵfac=function(t){return new(t||te)(i.ɵɵdirectiveInject(e.SearchService))},te.ɵcmp=i.ɵɵdefineComponent({type:te,selectors:[["sq-tabs"]],inputs:{results:"results",customtabs:"customtabs",iconMap:"iconMap"},outputs:{events:"events"},features:[i.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[["class","nav nav-tabs mb-1",4,"ngIf"],[1,"nav","nav-tabs","mb-1"],[4,"ngIf"],["class","nav-item",4,"ngFor","ngForOf"],[1,"nav-item"],["href","#",1,"nav-link",3,"ngClass","click"],[3,"ngClass"],[1,"count"],["class","count",4,"ngIf"]],template:function(e,t){1&e&&i.ɵɵtemplate(0,ee,3,2,"ul",0),2&e&&i.ɵɵproperty("ngIf",!!t.searchtabs||!!t.customtabs)},directives:[p.NgIf,p.NgForOf,p.NgClass],pipes:[u.MessagePipe,h.NumberPipe],encapsulation:2});var ie=function(){function e(e){this.searchService=e}return e.prototype.isActive=function(){return void 0===this.active?this.searchService.searchActive:this.active},e}();ie.ɵfac=function(t){return new(t||ie)(i.ɵɵdirectiveInject(e.SearchService))},ie.ɵcmp=i.ɵɵdefineComponent({type:ie,selectors:[["sq-loading-bar"]],inputs:{active:"active"},decls:1,vars:1,consts:[["class","slider",4,"ngIf"],[1,"slider"],[1,"line"],[1,"subline","inc"],[1,"subline","dec"]],template:function(e,t){1&e&&i.ɵɵtemplate(0,re,4,0,"div",0),2&e&&i.ɵɵproperty("ngIf",t.isActive())},directives:[p.NgIf],styles:[".slider[_ngcontent-%COMP%]{\n  position:absolute;\n  width:100%;\n  height:3px;\n  overflow: hidden;\n  z-index: 3;\n}\n\n.line[_ngcontent-%COMP%]{\n  position:absolute;\n  opacity: 0.4;\n  background:#4a8df8;\n  width:150%;\n  height:5px;\n}\n\n.subline[_ngcontent-%COMP%]{\n  position:absolute;\n  background:#4a8df8;\n  height:5px;\n}\n.inc[_ngcontent-%COMP%]{\nanimation: increase 1s infinite;\n}\n.dec[_ngcontent-%COMP%]{\nanimation: decrease 1s 0.25s infinite;\n}\n\n@keyframes increase {\n from { left: -5%; width: 5%; }\n to { left: 130%; width: 100%;}\n}\n@keyframes decrease {\n from { left: -80%; width: 80%; }\n to { left: 110%; width: 10%;}\n}"]});var ne=["anchor"],se=function(){function e(e){this.searchService=e,this.options={}}return e.prototype.ngAfterViewInit=function(){var e=this,t=Object.assign({root:null},this.options);this.observer=new IntersectionObserver((function(t){m(t,1)[0].isIntersecting&&e.searchService.loadMore()}),t),this.observer.observe(this.anchor.nativeElement)},e.prototype.ngOnDestroy=function(){this.observer.disconnect()},e}();se.ɵfac=function(t){return new(t||se)(i.ɵɵdirectiveInject(e.SearchService))},se.ɵcmp=i.ɵɵdefineComponent({type:se,selectors:[["sq-scroller"]],viewQuery:function(e,t){if(1&e&&i.ɵɵviewQuery(ne,!0),2&e){var r;i.ɵɵqueryRefresh(r=i.ɵɵloadQuery())&&(t.anchor=r.first)}},inputs:{options:"options"},decls:2,vars:0,consts:[[2,"height","5px"],["anchor",""]],template:function(e,t){1&e&&i.ɵɵelement(0,"div",0,1)},encapsulation:2});var ae=function(e){return[e]},oe=function(e,t,r){return{items:e,style:t,size:r,rightAligned:!1}};function ce(e,t){if(1&e&&i.ɵɵelement(0,"div",1),2&e){var r=i.ɵɵnextContext();i.ɵɵproperty("sq-action-buttons",i.ɵɵpureFunction3(3,oe,i.ɵɵpureFunction1(1,ae,r.loadMoreAction),r.buttonsStyle,r.actionsSize))}}var ue=function(){function e(e){var t=this;this.searchService=e,this.buttonsStyle="outline-primary",this.actionsSize="sm",this.subscription=new s.Subscription,this.hasMore=!1,this.loadMoreAction=new d.Action({text:"msg#facet.loadMore",title:"msg#facet.loadMore",action:function(e){t.searchService.loadMore(),e.update()},updater:function(){t.hasMore=!1}})}return e.prototype.ngOnInit=function(){var e=this;this.subscription=this.searchService.resultsStream.subscribe((function(t){e.hasMore=e.searchService.hasMore()}))},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e}();ue.ɵfac=function(t){return new(t||ue)(i.ɵɵdirectiveInject(e.SearchService))},ue.ɵcmp=i.ɵɵdefineComponent({type:ue,selectors:[["sq-load-more"]],inputs:{buttonsStyle:"buttonsStyle",actionsSize:"actionsSize"},decls:1,vars:1,consts:[["class","btn-group",3,"sq-action-buttons",4,"ngIf"],[1,"btn-group",3,"sq-action-buttons"]],template:function(e,t){1&e&&i.ɵɵtemplate(0,ce,1,7,"div",0),2&e&&i.ɵɵproperty("ngIf",t.hasMore)},directives:[p.NgIf,d.BsActionButtons],encapsulation:2});var le=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:S,useValue:t}]}},e}();le.ɵmod=i.ɵɵdefineNgModule({type:le}),le.ɵinj=i.ɵɵdefineInjector({factory:function(e){return new(e||le)},imports:[[p.CommonModule,f.FormsModule,f.ReactiveFormsModule,o.WebServicesModule,u.IntlModule,c.LoginModule,h.UtilsModule,d.BsActionModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&i.ɵɵsetNgModuleScope(le,{declarations:[z,A,e.BsPager,j,G,te,ie,se,ue],imports:[p.CommonModule,f.FormsModule,f.ReactiveFormsModule,o.WebServicesModule,u.IntlModule,c.LoginModule,h.UtilsModule,d.BsActionModule],exports:[z,A,e.BsPager,j,G,te,ie,se,ue]});e.Breadcrumbs=y,e.BsBreadcrumbs=A,e.BsDidYouMean=z,e.BsLoadMore=ue,e.BsLoadingBar=ie,e.BsPageSizeSelector=j,e.BsScroller=se,e.BsSearchModule=le,e.BsSortSelector=G,e.BsTabs=te,e.FIRST_PAGE_OPTIONS=b,e.FirstPageService=x,e.SEARCH_OPTIONS=S,e.deSearch={search:{emptySearchNotification:"Bitte geben Sie einige Suchbegriffe ein, um eine Suche durchzuführen",alreadyFiltered:"bereits ausgewählt"},breadcrumbs:{emptySearch:"<Suche ohne Suchbegriff>",itemRemove:"Entfernen"},didYouMean:{dymonlyBeforeCorrected:"Meinten Sie: ",dymonlyAfterCorrected:"?",correctBeforeCorrected:"Zeige Ergebnisse für [",correctBeforeOriginal:"]. Zeige stattdessen Ergebnisse für [",correctAfterOriginal:"]",smartBeforeOriginal:"Zeige Ergebnisse für [",smartBeforeCorrected:"] und [",smartAfterCorrected:"]"},pageSizeSelector:{pageSizeChoice:"{size, number} pro Seite",defaultPageSize:"Standard ({size, number})",defaultPageSizeChoice:"{size, number} pro Seite (standard)"},pager:{pageNumberTitle:"Seite {page, number}",firstPage:"Erste Seite",nextPage:"Nächste Seite",previousPage:"Vorherige Seite",lastPage:"Letzte Seite"},sortSelector:{sortByTitle:"Sortieren nach: {text}",sortOther:"<Andere>"},sort:{relevance:"Relevanz",date:"Datum",filename:"Dateiname",title:"Titel"},queryIntent:{externalServiceTimeoutError:"Diese Ergebnisseite ist aufgrund eines internen Zeitlimits unvollständig. Bitte versuchen Sie es später noch einmal."}},e.enSearch={search:{emptySearchNotification:"Please enter some search terms to perform a search",alreadyFiltered:"Already selected"},breadcrumbs:{emptySearch:"<empty search>",itemRemove:"Remove"},didYouMean:{dymonlyBeforeCorrected:"Did you mean: ",dymonlyAfterCorrected:"?",correctBeforeCorrected:"Showing results for: ",correctBeforeOriginal:". Search instead for: ",correctAfterOriginal:"",smartBeforeOriginal:"Showing results for: ",smartBeforeCorrected:" and ",smartAfterCorrected:""},pageSizeSelector:{pageSizeChoice:"{size, number} per page",defaultPageSize:"Default ({size, number})",defaultPageSizeChoice:"{size, number} per page (default)"},pager:{pageNumberTitle:"Page {page, number}",firstPage:"First page",nextPage:"Next page",previousPage:"Previous page",lastPage:"Last page"},sortSelector:{sortByTitle:"Sort by: {text}",sortOther:"<Other>"},sort:{relevance:"Relevance",date:"Date",filename:"File name",title:"Title"},queryIntent:{externalServiceTimeoutError:"This result page is incomplete due to an internal timeout. Please retry later."}},e.frSearch={search:{emptySearchNotification:"Veuillez saisir des termes de recherche pour effectuer une recherche",alreadySelected:"Déjà sélectionné"},breadcrumbs:{emptySearch:"<recherche vide>",itemRemove:"Supprimer"},didYouMean:{dymonlyBeforeCorrected:"Essayez avec cette orthographe : ",dymonlyAfterCorrected:"",correctBeforeCorrected:"Résultats pour : ",correctBeforeOriginal:". Essayez avec l'orthographe : ",correctAfterOriginal:"",smartBeforeOriginal:"Résultats pour : ",smartBeforeCorrected:" et ",smartAfterCorrected:""},pageSizeSelector:{pageSizeChoice:"{size, number} par page",defaultPageSize:"Défaut ({size, number})",defaultPageSizeChoice:"{size, number} par page (défaut)"},pager:{pageNumberTitle:"Page {page, number}",firstPage:"Première page",nextPage:"Page suivante",previousPage:"Page précédente",lastPage:"Dernière page"},sortSelector:{sortByTitle:"Trier par: {text}",sortOther:"<Autre>"},sort:{relevance:"Pertinence",date:"Date",filename:"Nom de fichier",title:"Titre"},queryIntent:{externalServiceTimeoutError:"Cette page de résultat est incomplète due à un délai d'attente interne dépassé. S'il vous plaît, réessayez plus tard."}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-components-search.umd.min.js.map