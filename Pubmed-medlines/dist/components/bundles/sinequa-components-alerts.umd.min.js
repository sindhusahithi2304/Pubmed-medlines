!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@sinequa/core/app-utils"),require("@sinequa/core/base"),require("@sinequa/core/web-services"),require("@sinequa/components/search"),require("@sinequa/core/modal"),require("@angular/common"),require("@angular/forms"),require("@angular/cdk/drag-drop"),require("@sinequa/core/intl"),require("@sinequa/core/validation"),require("@sinequa/components/utils"),require("@sinequa/components/action"),require("@sinequa/components/modal"),require("@sinequa/core/login")):"function"==typeof define&&define.amd?define("@sinequa/components/alerts",["exports","@angular/core","rxjs","@sinequa/core/app-utils","@sinequa/core/base","@sinequa/core/web-services","@sinequa/components/search","@sinequa/core/modal","@angular/common","@angular/forms","@angular/cdk/drag-drop","@sinequa/core/intl","@sinequa/core/validation","@sinequa/components/utils","@sinequa/components/action","@sinequa/components/modal","@sinequa/core/login"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.components=e.sinequa.components||{},e.sinequa.components.alerts={}),e.ng.core,e.rxjs,e.sinequa.core["app-utils"],e.sinequa.core.base,e.sinequa.core["web-services"],e.sinequa.components.search,e.sinequa.core.modal,e.ng.common,e.ng.forms,e.ng.cdk.dragDrop,e.sinequa.core.intl,e.sinequa.core.validation,e.sinequa.components.utils,e.sinequa.components.action,e.sinequa.components.modal,e.sinequa.core.login)}(this,(function(e,t,r,n,a,s,o,i,l,c,u,d,p,m,h,y,f){"use strict";var v,g,A;A=e.Alert||(e.Alert={}),(g=A.Frequency||(A.Frequency={}))[g.Daily=0]="Daily",g[g.Hourly=1]="Hourly",g[g.Immediate=2]="Immediate",g[g.Weekly=3]="Weekly",g[g.Monthly=4]="Monthly",(v=A.Days||(A.Days={}))[v.None=0]="None",v[v.Monday=1]="Monday",v[v.Tuesday=2]="Tuesday",v[v.Wednesday=4]="Wednesday",v[v.Thursday=8]="Thursday",v[v.Friday=16]="Friday",v[v.Saturday=32]="Saturday",v[v.Sunday=64]="Sunday",v[v.AllDays=127]="AllDays",v[v.WeekDays=31]="WeekDays";var S=["Alert_Loaded","Alert_Add","Alert_Delete","Alert_Update"],q=new t.InjectionToken("ALERT_COMPONENTS"),M=new t.InjectionToken("WindowToken"),b=function(){function t(e,t,n,a,s){var o=this;this.userSettingsService=e,this.searchService=t,this.modalService=n,this.alertComponents=a,this.window=s,this._events=new r.Subject,this._changes=new r.Subject,this.userSettingsService.events.subscribe((function(e){o.events.next({type:"Alert_Loaded"})})),this._events.subscribe((function(e){-1!==S.indexOf(e.type)&&o.changes.next(e)}))}return Object.defineProperty(t.prototype,"alerts",{get:function(){return this.userSettingsService.userSettings||(this.userSettingsService.userSettings={}),this.userSettingsService.userSettings.alerts||(this.userSettingsService.userSettings.alerts=[]),this.userSettingsService.userSettings.alerts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"changes",{get:function(){return this._changes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasAlert",{get:function(){return this.alerts.length>0},enumerable:!1,configurable:!0}),t.prototype.alert=function(e){var t=this.alertIndex(e);return t>=0?this.alerts[t]:void 0},t.prototype.alertIndex=function(e){for(var t=0,r=this.alerts.length;t<r;t++){var n=this.alerts[t];if(n&&n.name===e)return t}return-1},t.prototype.createAlert=function(e){return!(this.alertIndex(e.name)>=0)&&(this.alerts.unshift(e),this.events.next({type:"Alert_Add",alert:e}),this.patchAlerts([{type:"Alert_Add",detail:{alert:e.name}}]),!0)},t.prototype.updateAlert=function(e,t){var r=this.alertIndex(e.name);return(-1===r||t===r)&&(t>=0&&t<this.alerts.length&&(this.alerts.splice(t,1,e),this.events.next({type:"Alert_Update",alert:e}),this.patchAlerts([{type:"Alert_Update",detail:{alert:e.name}}]),!0))},t.prototype.updateAlerts=function(e,t){return a.Utils.arraySet(this.alerts,e),this.events.next({type:"Alert_Update"}),this.patchAlerts(t),!0},t.prototype.deleteAlert=function(e){var t=this.alertIndex(e.name);return-1!==t&&(this.alerts.splice(t,1),this.events.next({type:"Alert_Delete",alert:e}),this.patchAlerts([{type:"Alert_Delete",detail:{alert:e.name}}]),!0)},t.prototype.setAlertToCurrentQuery=function(e){e.query=n.Query.copy(this.searchService.query)},t.prototype.patchAlerts=function(e){var t=this;return this.userSettingsService.patch({alerts:this.alerts},e).subscribe((function(e){t.events.next({type:"Alert_Patched"})}),(function(e){console.error("Could not patch Alerts!",e)}))},t.prototype.searchAlert=function(e,t){return this.searchService.setQuery(a.Utils.extend(this.searchService.makeQuery(),a.Utils.copy(e.query))),this.events.next({type:"Search_AlertQuery",alert:e}),this.searchService.search({path:t},{type:"Search_AlertQuery",detail:{alert:e.name}})},t.prototype.createAlertModal=function(){var t=this,r={name:"",description:"",timezone:this.userSettingsService.timezone,query:n.Query.copy(this.searchService.query),frequency:e.Alert.Frequency.Daily,days:e.Alert.Days.WeekDays,interval:1,index:1,times:"9:00",active:!0,combine:!0,respectTabSelection:!1},a=this.window.location.href;return this.modalService.open(this.alertComponents.editAlertModal,{model:{alert:r}}).then((function(e){if(-1===e){var n=t.alertIndex(r.name);return-1!==n?t.modalService.yesNo("msg#alerts.alertAlreadyExists").then((function(e){return-3===e&&(r.appQueryUrl=a,t.updateAlert(r,n))})):(r.appQueryUrl=a,t.createAlert(r))}return!1}))},t.prototype.editAlertModal=function(e,t,r){var n=this,a=e.name,s=this.window.location.href;return this.modalService.open(this.alertComponents.editAlertModal,{model:{alert:e,searchRoute:r}}).then((function(r){if(-1===r){if(t)return!0;var o=n.alertIndex(a);if(-1===o)return!1;var i=n.alertIndex(e.name);return-1!==i&&i!==o?n.modalService.yesNo("msg#alerts.alertAlreadyExists").then((function(t){if(-3===t){var r=n.alert(a);return r&&n.deleteAlert(r),e.appQueryUrl=s,n.updateAlert(e,n.alertIndex(e.name))}return!1})):(e.appQueryUrl=s,n.updateAlert(e,o))}return!1}))},t.prototype.manageAlertsModal=function(e){var t=this,r={alerts:a.Utils.copy(this.alerts),searchRoute:e};return this.modalService.open(this.alertComponents.manageAlertsModal,{model:r}).then((function(e){return-1===e&&t.updateAlerts(r.alerts,r.auditEvents)}))},t.prototype.ngOnDestroy=function(){this.events.complete(),this.changes.complete()},t}();b.ɵfac=function(e){return new(e||b)(t.ɵɵinject(s.UserSettingsWebService),t.ɵɵinject(o.SearchService),t.ɵɵinject(i.ModalService),t.ɵɵinject(q),t.ɵɵinject(M))},b.ɵprov=t.ɵɵdefineInjectable({token:b,factory:b.ɵfac,providedIn:"root"});var x=function(){};function C(e,r){if(1&e&&(t.ɵɵelementStart(0,"option",18),t.ɵɵtext(1),t.ɵɵpipe(2,"sqMessage"),t.ɵɵelementEnd()),2&e){var n=r.$implicit,a=t.ɵɵnextContext();t.ɵɵproperty("value",n),t.ɵɵadvance(1),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(2,2,a.frequency[n]))}}function w(e,r){if(1&e){var n=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"label",13),t.ɵɵelementStart(1,"input",19),t.ɵɵlistener("change",(function(e){t.ɵɵrestoreView(n);var a=r.$implicit;return t.ɵɵnextContext().dayChange(e,a.value)})),t.ɵɵelementEnd(),t.ɵɵelementStart(2,"span",15),t.ɵɵtext(3),t.ɵɵpipe(4,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var a=r.$implicit,s=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("checked",s.dayChecked(a.value)),t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(4,2,"msg#editAlert."+a.key))}}function D(e,r){1&e&&(t.ɵɵelementStart(0,"label",13),t.ɵɵelement(1,"input",20),t.ɵɵelementStart(2,"span",15),t.ɵɵtext(3),t.ɵɵpipe(4,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(4,1,"msg#editAlert.updateQuery")))}function k(e,r){1&e&&(t.ɵɵelement(0,"sq-alert-message",21),t.ɵɵpipe(1,"sqMessage")),2&e&&t.ɵɵproperty("message",t.ɵɵpipeBind1(1,1,"msg#editAlert.lossDataMessage"))}x.ɵfac=function(e){return new(e||x)},x.ɵcmp=t.ɵɵdefineComponent({type:x,selectors:[["sq-alert-message"]],inputs:{message:"message"},decls:2,vars:1,consts:[["role","alert",1,"alert","alert-danger","ml-3","mr-3","p-3","text-center"]],template:function(e,r){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵtextInterpolate1(" ",r.message,"\n"))},encapsulation:2});var E=function(){function t(t,r,n,a,s){this.model=t,this.formBuilder=r,this.searchService=n,this.alertsService=a,this.modalRef=s,this.weekdays={monday:e.Alert.Days.Monday,tuesday:e.Alert.Days.Tuesday,wednesday:e.Alert.Days.Wednesday,thursday:e.Alert.Days.Thursday,friday:e.Alert.Days.Friday,saturday:e.Alert.Days.Saturday,sunday:e.Alert.Days.Sunday},this.showDirtyMessage=!1,this.originalOrder=function(e,t){return 0},this.frequencies=[e.Alert.Frequency.Daily,e.Alert.Frequency.Hourly,e.Alert.Frequency.Immediate],this.frequency=e.Alert.Frequency}return Object.defineProperty(t.prototype,"alert",{get:function(){return this.model.alert},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){var t=this;this.alert.days||(this.alert.days=e.Alert.Days.None),this.canUpdateQuery=!!this.alertsService.alert(this.alert.name)&&!!this.searchService.results&&!!this.searchService.results.records,this.alertDaysControl=new c.FormControl(this.alert.days),this.alertNameControl=new c.FormControl(this.alert.name,c.Validators.required),this.alertFrequencyControl=new c.FormControl(this.alert.frequency),this.alertTimesControl=new c.FormControl(this.alert.times),this.alertActiveControl=new c.FormControl(this.alert.active),this.updateQueryControl=new c.FormControl(this.updateQuery),this.form=this.formBuilder.group({alertName:this.alertNameControl,alertFrequency:this.alertFrequencyControl,alertTimes:this.alertTimesControl,alertActive:this.alertActiveControl,updateQuery:this.updateQueryControl}),this.formChanges=a.Utils.subscribe(this.form.valueChanges,(function(e){t.alert.name=t.alertNameControl.value,t.alert.frequency=t.alertFrequencyControl.value,t.alert.times=t.alertTimesControl.value,t.alert.active=t.alertActiveControl.value,t.alert.days=t.alertDaysControl.value,t.updateQuery=t.updateQueryControl.value})),this.createButtons()},t.prototype.createButtons=function(){var e=this;this.buttons=[new i.ModalButton({text:"msg#editAlert.runQuery",result:0,action:function(t){e.runQuery(),e.modalRef.close(-2)},visible:!!this.alertsService.alert(this.alert.name)}),new i.ModalButton({result:-1,primary:!0,validation:this.form,action:function(t){e.updateQuery&&e.alertsService.setAlertToCurrentQuery(e.alert)}}),new i.ModalButton({result:-2,action:function(t){e.form.dirty&&(t.result=0,e.showDirtyMessage=!0,e.createYesNoButtons())}})]},t.prototype.createYesNoButtons=function(){var e=this;this.buttons=[new i.ModalButton({result:-3,primary:!0}),new i.ModalButton({result:-4,action:function(t){t.result=0,e.showDirtyMessage=!1,e.createButtons()}})]},t.prototype.ngOnDestroy=function(){this.formChanges.unsubscribe()},t.prototype.dayChecked=function(e){return 0!=(this.alert.days&e)},t.prototype.dayChange=function(e,t){e.target.checked?this.alertDaysControl.setValue(this.alert.days|=t):this.alertDaysControl.setValue(this.alert.days&=~t),this.form.markAsDirty()},t.prototype.runQuery=function(){this.alertsService.searchAlert(this.alert,this.model.searchRoute)},t}();function I(e,r){if(1&e){var n=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",7),t.ɵɵelementStart(1,"button",8),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(n),t.ɵɵnextContext().reorder()})),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var a=t.ɵɵnextContext();t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(3,1,a.reordering?"msg#manageAlerts.edit":"msg#manageAlerts.reorder"))}}function _(e,r){if(1&e){var n=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",14),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(n);var e=t.ɵɵnextContext(),r=e.$implicit,a=e.index;return t.ɵɵnextContext().remove(r,a)})),t.ɵɵpipe(1,"sqMessage"),t.ɵɵelement(2,"span",15),t.ɵɵelementEnd()}2&e&&t.ɵɵpropertyInterpolate("title",t.ɵɵpipeBind1(1,1,"msg#manageAlerts.remove"))}function B(e,r){1&e&&t.ɵɵelement(0,"span",16)}E.ɵfac=function(e){return new(e||E)(t.ɵɵdirectiveInject(i.MODAL_MODEL),t.ɵɵdirectiveInject(c.FormBuilder),t.ɵɵdirectiveInject(o.SearchService),t.ɵɵdirectiveInject(b),t.ɵɵdirectiveInject(i.ModalRef))},E.ɵcmp=t.ɵɵdefineComponent({type:E,selectors:[["sq-edit-alert"]],decls:33,vars:26,consts:[["name","editAlert","novalidate","",3,"formGroup"],[3,"title","buttons"],[1,"form-group","sq-form-group"],["for","alertName"],["type","text","id","alertName","formControlName","alertName","autocomplete","off","spellcheck","off","sqAutofocus","",1,"form-control",3,"sqValidation"],[1,"form-group"],["for","alertFrequency"],["id","alertFrequency","formControlName","alertFrequency",1,"form-control","custom-select"],[3,"value",4,"ngFor","ngForOf"],[1,"weekdays-grid"],["class","custom-control custom-control-inline custom-checkbox",4,"ngFor","ngForOf"],["for","alertTimes"],["type","text","id","alertTimes","formControlName","alertTimes","autocomplete","off","spellcheck","off",1,"form-control"],[1,"custom-control","custom-control-inline","custom-checkbox"],["type","checkbox","id","alertActive","formControlName","alertActive",1,"custom-control-input"],[1,"custom-control-label","user-select-none","cursor-pointer"],["class","custom-control custom-control-inline custom-checkbox",4,"ngIf"],["footer","",3,"message",4,"ngIf"],[3,"value"],["type","checkbox",1,"custom-control-input",3,"checked","change"],["type","checkbox","id","updateQuery","formControlName","updateQuery",1,"custom-control-input"],["footer","",3,"message"]],template:function(e,r){1&e&&(t.ɵɵelementStart(0,"form",0),t.ɵɵelementStart(1,"sq-modal",1),t.ɵɵelementStart(2,"div",2),t.ɵɵelementStart(3,"label",3),t.ɵɵtext(4),t.ɵɵpipe(5,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelement(6,"input",4),t.ɵɵelementEnd(),t.ɵɵelementStart(7,"div",5),t.ɵɵelementStart(8,"label",6),t.ɵɵtext(9),t.ɵɵpipe(10,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementStart(11,"select",7),t.ɵɵtemplate(12,C,3,4,"option",8),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(13,"div",5),t.ɵɵelementStart(14,"label"),t.ɵɵtext(15),t.ɵɵpipe(16,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementStart(17,"div",9),t.ɵɵtemplate(18,w,5,4,"label",10),t.ɵɵpipe(19,"keyvalue"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementStart(20,"div",5),t.ɵɵelementStart(21,"label",11),t.ɵɵtext(22),t.ɵɵpipe(23,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelement(24,"input",12),t.ɵɵelementEnd(),t.ɵɵelementStart(25,"div",5),t.ɵɵelementStart(26,"label",13),t.ɵɵelement(27,"input",14),t.ɵɵelementStart(28,"span",15),t.ɵɵtext(29),t.ɵɵpipe(30,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(31,D,5,3,"label",16),t.ɵɵelementEnd(),t.ɵɵtemplate(32,k,2,3,"sq-alert-message",17),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵproperty("formGroup",r.form),t.ɵɵadvance(1),t.ɵɵproperty("title","msg#editAlert.title")("buttons",r.buttons),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(5,13,"msg#editAlert.name")),t.ɵɵadvance(2),t.ɵɵproperty("sqValidation",r.form),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(10,15,"msg#editAlert.frequency")),t.ɵɵadvance(3),t.ɵɵproperty("ngForOf",r.frequencies),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(16,17,"msg#editAlert.days")),t.ɵɵadvance(3),t.ɵɵproperty("ngForOf",t.ɵɵpipeBind2(19,19,r.weekdays,r.originalOrder)),t.ɵɵadvance(4),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(23,22,"msg#editAlert.times")),t.ɵɵadvance(7),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(30,24,"msg#editAlert.active")),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",r.canUpdateQuery),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",r.showDirtyMessage))},directives:[c.ɵangular_packages_forms_forms_y,c.NgControlStatusGroup,c.FormGroupDirective,y.BsModal,c.DefaultValueAccessor,c.NgControlStatus,c.FormControlName,m.Autofocus,p.ValidationDirective,c.SelectControlValueAccessor,l.NgForOf,c.CheckboxControlValueAccessor,l.NgIf,c.NgSelectOption,c.ɵangular_packages_forms_forms_x,x],pipes:[d.MessagePipe,l.KeyValuePipe],styles:[".custom-control-label.user-select-none[_ngcontent-%COMP%]{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;user-select:none}.custom-control-label.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}.weekdays-grid[_ngcontent-%COMP%]{display:-ms-grid;display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr))}"]});var F=function(e){return["list-group-item list-group-item-action d-flex w-auto-unimportant",e]},N=function(e){return{"sq-active":e,"sq-alert-text":!0}};function j(e,r){if(1&e){var n=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",9),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(n);var e=r.$implicit;return t.ɵɵnextContext().editAlert(e)})),t.ɵɵelementStart(1,"div",10),t.ɵɵtext(2),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"div",11),t.ɵɵtemplate(4,_,3,3,"a",12),t.ɵɵtemplate(5,B,1,0,"span",13),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var a=r.$implicit,s=t.ɵɵnextContext();t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(5,F,s.reordering?"cursor-move":"")),t.ɵɵadvance(1),t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(7,N,!s.reordering)),t.ɵɵadvance(1),t.ɵɵtextInterpolate(a.name),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",!s.reordering),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",s.reordering)}}function O(e,r){1&e&&(t.ɵɵelement(0,"sq-alert-message",17),t.ɵɵpipe(1,"sqMessage")),2&e&&t.ɵɵproperty("message",t.ɵɵpipeBind1(1,1,"msg#editAlert.lossDataMessage"))}var Q=function(){function e(e,t){this.model=e,this.alertsService=t,this.showDirtyMessage=!1,this.reordering=!1}return e.prototype.ngOnInit=function(){this.createButtons()},e.prototype.addAuditEvent=function(e){this.model.auditEvents||(this.model.auditEvents=[]),this.model.auditEvents.push(e)},e.prototype.reorder=function(){this.reordering=!this.reordering},e.prototype.remove=function(e,t){return this.model.alerts.splice(t,1),this.removeAllButton.visible=this.model.alerts.length>0,this.addAuditEvent({type:"Alert_Delete",detail:{alert:e.name}}),!1},e.prototype.editAlert=function(e){var t=this;if(!this.reordering){var r=a.Utils.copy(e);this.alertsService.editAlertModal(r,!0,this.model.searchRoute).then((function(n){n&&(a.Utils.copy(r,e),t.addAuditEvent({type:"Alert_Edit",detail:{alert:e.name}}))}))}return!1},e.prototype.dropped=function(e){a.Utils.arrayMove(this.model.alerts,e.previousIndex,e.currentIndex)},e.prototype.createButtons=function(){var e=this;this.buttons=[this.removeAllButton=new i.ModalButton({text:"msg#manageAlerts.removeAll",result:0,action:function(t){e.model.alerts.splice(0),t.visible=!1,e.addAuditEvent({type:"Alert_DeleteAll"})},visible:this.model.alerts.length>0}),new i.ModalButton({result:-1,primary:!0}),new i.ModalButton({result:-2,action:function(t){var r;e.model.auditEvents&&(null===(r=e.model.auditEvents)||void 0===r?void 0:r.length)>0&&(t.result=0,e.showDirtyMessage=!0,e.createYesNoButtons())}})]},e.prototype.createYesNoButtons=function(){var e=this;this.buttons=[new i.ModalButton({result:-3,primary:!0}),new i.ModalButton({result:-4,action:function(t){t.result=0,e.showDirtyMessage=!1,e.createButtons()}})]},e}();Q.ɵfac=function(e){return new(e||Q)(t.ɵɵdirectiveInject(i.MODAL_MODEL),t.ɵɵdirectiveInject(b))},Q.ɵcmp=t.ɵɵdefineComponent({type:Q,selectors:[["sq-manage-alerts"]],decls:7,vars:7,consts:[["name","manageAlerts","novalidate",""],[3,"title","buttons"],["class","form-group clearfix",4,"ngIf"],[1,"form-group"],["cdkDropList","",1,"list-group",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["href","#","cdkDrag","",3,"ngClass","click",4,"ngFor","ngForOf"],["footer","",3,"message",4,"ngIf"],[1,"form-group","clearfix"],["type","button",1,"btn","btn-secondary","float-right",3,"click"],["href","#","cdkDrag","",3,"ngClass","click"],[3,"ngClass"],[1,"ml-auto"],["class","ml-2","href","#",3,"title","click",4,"ngIf"],["class","ml-2 fas fa-bars sq-move",4,"ngIf"],["href","#",1,"ml-2",3,"title","click"],[1,"fas","fa-times","sq-remove"],[1,"ml-2","fas","fa-bars","sq-move"],["footer","",3,"message"]],template:function(e,r){1&e&&(t.ɵɵelementStart(0,"form",0),t.ɵɵelementStart(1,"sq-modal",1),t.ɵɵtemplate(2,I,4,3,"div",2),t.ɵɵelementStart(3,"div",3),t.ɵɵelementStart(4,"div",4),t.ɵɵlistener("cdkDropListDropped",(function(e){return r.dropped(e)})),t.ɵɵtemplate(5,j,6,9,"a",5),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵtemplate(6,O,2,3,"sq-alert-message",6),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("title","msg#manageAlerts.title")("buttons",r.buttons),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",r.model.alerts.length),t.ɵɵadvance(2),t.ɵɵproperty("cdkDropListData",r.model.alerts)("cdkDropListDisabled",!r.reordering),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",r.model.alerts),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",r.showDirtyMessage))},directives:[c.ɵangular_packages_forms_forms_y,c.NgControlStatusGroup,c.NgForm,y.BsModal,l.NgIf,u.CdkDropList,l.NgForOf,u.CdkDrag,l.NgClass,x],pipes:[d.MessagePipe],styles:[".list-group[_ngcontent-%COMP%]{max-height:18.5rem;overflow-y:auto;width:100%}.sq-alert-text[_ngcontent-%COMP%]{overflow-wrap:break-word;width:100%;word-break:break-word;word-wrap:break-word}.sq-move[_ngcontent-%COMP%]{cursor:move}span.sq-move[_ngcontent-%COMP%]{color:grey}.sq-remove[_ngcontent-%COMP%]{color:#d3d3d3;cursor:pointer}.sq-remove[_ngcontent-%COMP%]:hover{color:#8b0000}.w-auto-unimportant[_ngcontent-%COMP%]{width:auto}.cursor-move[_ngcontent-%COMP%]{cursor:move}.sq-active[_ngcontent-%COMP%]{color:#007bff}"]});var T=function(e,t,r,n){return{item:e,size:t,autoAdjust:r,autoAdjustBreakpoint:n,inMenu:!0}};function U(e,r){if(1&e&&t.ɵɵelement(0,"li",1),2&e){var n=t.ɵɵnextContext();t.ɵɵproperty("sq-action-item",t.ɵɵpureFunction4(2,T,n.menu,n.size,n.autoAdjust,n.autoAdjustBreakpoint))("collapseBreakpoint",n.collapseBreakpoint)}}var P=function(){function e(e,t,r){var n=this;this.loginService=e,this.alertsService=t,this.searchService=r,this.searchRoute="/search",this.icon="fas fa-bell",this.autoAdjust=!0,this.autoAdjustBreakpoint="xl",this.collapseBreakpoint="sm",this.createAction=new h.Action({text:"msg#alerts.createAlert",title:"msg#alerts.createAlert",action:function(){n.alertsService.createAlertModal()}}),this.manageAction=new h.Action({text:"msg#alerts.manageAlerts",title:"msg#alerts.manageAlerts",action:function(){n.alertsService.manageAlertsModal(n.searchRoute)}})}return e.prototype.ngOnInit=function(){var e=this;this.updateMenu(),this._alertsServiceSubscription=this.alertsService.changes.subscribe({next:function(){e.updateMenu()}}),this._loginServiceSubscription=this.loginService.events.subscribe((function(t){"session-changed"===t.type&&e.updateMenu()})),this._searchServiceSubscription=this.searchService.resultsStream.subscribe((function(t){e.updateMenu()}))},e.prototype.ngOnDestroy=function(){this._alertsServiceSubscription&&this._alertsServiceSubscription.unsubscribe(),this._loginServiceSubscription&&this._loginServiceSubscription.unsubscribe(),this._searchServiceSubscription&&this._searchServiceSubscription.unsubscribe()},e.prototype.updateMenu=function(){var e=this;if(this.loginService.complete){var t=[];if(this.alertsService.hasAlert){var r=new h.Action({scrollGroup:!0,children:this.alertsService.alerts.map((function(t){return new h.Action({text:t.name,data:t,action:function(t){var r=a.Utils.copy(t.data);e.alertsService.editAlertModal(r,void 0,e.searchRoute)}})}))});t.push(r)}this.searchService.results&&t.push(this.createAction),this.alertsService.hasAlert&&t.push(this.manageAction),this.menu=new h.Action({icon:this.icon,text:"msg#alerts.alerts",children:t})}else this.menu=void 0},e}();function V(){return window}P.ɵfac=function(e){return new(e||P)(t.ɵɵdirectiveInject(f.LoginService),t.ɵɵdirectiveInject(b),t.ɵɵdirectiveInject(o.SearchService))},P.ɵcmp=t.ɵɵdefineComponent({type:P,selectors:[["sq-alerts-menu"]],inputs:{searchRoute:"searchRoute",icon:"icon",autoAdjust:"autoAdjust",autoAdjustBreakpoint:"autoAdjustBreakpoint",collapseBreakpoint:"collapseBreakpoint",size:"size"},decls:1,vars:1,consts:[["class","nav-item dropdown",3,"sq-action-item","collapseBreakpoint",4,"ngIf"],[1,"nav-item","dropdown",3,"sq-action-item","collapseBreakpoint"]],template:function(e,r){1&e&&t.ɵɵtemplate(0,U,1,7,"li",0),2&e&&t.ɵɵproperty("ngIf",!!r.menu&&!r.menu.hidden)},directives:[l.NgIf,h.BsActionItem],encapsulation:2});var R=function(){};R.ɵmod=t.ɵɵdefineNgModule({type:R}),R.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||R)},providers:[{provide:q,useValue:{editAlertModal:E,manageAlertsModal:Q}},{provide:M,useFactory:V}],imports:[[l.CommonModule,c.FormsModule,c.ReactiveFormsModule,u.DragDropModule,y.BsModalModule,d.IntlModule,p.ValidationModule,m.UtilsModule,h.BsActionModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(R,{declarations:[E,Q,P,x],imports:[l.CommonModule,c.FormsModule,c.ReactiveFormsModule,u.DragDropModule,y.BsModalModule,d.IntlModule,p.ValidationModule,m.UtilsModule,h.BsActionModule],exports:[E,Q,P]});var L=a.Utils.merge({},{alerts:{alerts:"Alerts",createAlert:"Create Alert",manageAlerts:"Manage Alerts",alertAlreadyExists:"An alert with that name already exists. Would you like to replace it?"},editAlert:{title:"Alert",name:"Name",frequency:"Frequency",days:"Days",monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",sunday:"Sunday",times:"Times",active:"Active",updateQuery:"Update Query",runQuery:"Run Query",lossDataMessage:"Do you want to leave without saving your modifications?"},manageAlerts:{title:"Manage Alerts",edit:"Edit",reorder:"Reorder",remove:"Remove",removeAll:"Remove all"}},o.enSearch,y.enModal),W=a.Utils.merge({},{alerts:{alerts:"Alertes",createAlert:"Créer une alerte",manageAlerts:"Gérer les alertes",alertAlreadyExists:"Une alerte avec ce nom existe déjà. Voulez-vous la remplacer ?"},editAlert:{title:"Alerte",name:"Nom",frequency:"Fréquence",days:"Jours",monday:"lundi",tuesday:"mardi",wednesday:"mercredi",thursday:"jeudi",friday:"vendredi",saturday:"samedi",sunday:"dimanche",times:"Horaires",active:"Active",updateQuery:"Mettre à jour la requête",runQuery:"Exécuter la requête",lossDataMessage:"Voulez-vous quitter sans sauvegarder vos modifications ?"},manageAlerts:{title:"Gérer les alertes",edit:"Editer",reorder:"Réorganiser",remove:"Effacer",removeAll:"Effacer tout"}},o.frSearch,y.frModal),z=a.Utils.merge({},{alerts:{alerts:"Alarme",createAlert:"Alarm erstellen",manageAlerts:"Alarme verwalten",alertAlreadyExists:"Ein Alarm mit diesem Namen existiert bereits. Möchten Sie ihn ersetzen?"},editAlert:{title:"Alarm",name:"Name",frequency:"Häufigkeit",days:"Tage",monday:"Montag",tuesday:"Dienstag",wednesday:"Mittwoch",thursday:"Donnerstag",friday:"Freitag",saturday:"Samstag",sunday:"Sonntag",times:"Uhrzeitangaben",active:"Aktiv",updateQuery:"Aktualisiere Suchanfrage",runQuery:"Führe Suchanfrage aus",lossDataMessage:"Möchten Sie gehen, ohne Ihre Änderungen zu speichern?"},manageAlerts:{title:"Alarme verwalten",edit:"Bearbeiten",reorder:"Neu sortieren",remove:"Entfernen",removeAll:"Alle entfernen"}},o.deSearch,y.deModal);e.ALERT_CHANGE_EVENTS=S,e.ALERT_COMPONENTS=q,e.AlertsService=b,e.BsAlertsMenuComponent=P,e.BsAlertsModule=R,e.BsEditAlert=E,e.BsManageAlerts=Q,e.WINDOW=M,e.deAlerts=z,e.enAlerts=L,e.frAlerts=W,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-components-alerts.umd.min.js.map