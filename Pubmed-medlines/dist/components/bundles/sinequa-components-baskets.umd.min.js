!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@sinequa/core/base"),require("@sinequa/components/action"),require("@sinequa/core/web-services"),require("@sinequa/components/search"),require("@sinequa/core/modal"),require("@sinequa/components/selection"),require("@angular/common"),require("@angular/forms"),require("@angular/cdk/drag-drop"),require("@sinequa/core/intl"),require("@sinequa/core/validation"),require("@sinequa/components/utils"),require("@sinequa/components/modal"),require("@sinequa/core/login"),require("@sinequa/components/facet"),require("@angular/router")):"function"==typeof define&&define.amd?define("@sinequa/components/baskets",["exports","@angular/core","rxjs","@sinequa/core/base","@sinequa/components/action","@sinequa/core/web-services","@sinequa/components/search","@sinequa/core/modal","@sinequa/components/selection","@angular/common","@angular/forms","@angular/cdk/drag-drop","@sinequa/core/intl","@sinequa/core/validation","@sinequa/components/utils","@sinequa/components/modal","@sinequa/core/login","@sinequa/components/facet","@angular/router"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.components=e.sinequa.components||{},e.sinequa.components.baskets={}),e.ng.core,e.rxjs,e.sinequa.core.base,e.sinequa.components.action,e.sinequa.core["web-services"],e.sinequa.components.search,e.sinequa.core.modal,e.sinequa.components.selection,e.ng.common,e.ng.forms,e.ng.cdk.dragDrop,e.sinequa.core.intl,e.sinequa.core.validation,e.sinequa.components.utils,e.sinequa.components.modal,e.sinequa.core.login,e.sinequa.components.facet,e.ng.router)}(this,(function(e,t,n,s,a,i,r,o,c,l,u,d,p,m,k,f,v,h,g){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var b=function(e,t){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};Object.create;function B(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;var y=["Basket_Loaded","Basket_Add","Basket_Delete","Basket_DeleteAll","Basket_Update","Basket_Rename"],S=new t.InjectionToken("BASKET_COMPONENTS"),x=function(){function e(e,t,s,a,i){var r=this;this.userSettingsService=e,this.searchService=t,this.modalService=s,this.selectionService=a,this.basketComponents=i,this._events=new n.Subject,this._changes=new n.Subject,this.userSettingsService.events.subscribe((function(e){r._events.next({type:"Basket_Loaded"})})),this._events.subscribe((function(e){-1!==y.indexOf(e.type)&&r.changes.next(e)})),this.selectedRecordsAction=this.buildBasketsAction()}return Object.defineProperty(e.prototype,"baskets",{get:function(){return this.userSettingsService.userSettings||(this.userSettingsService.userSettings={}),this.userSettingsService.userSettings.baskets||(this.userSettingsService.userSettings.baskets=[]),this.userSettingsService.userSettings.baskets},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changes",{get:function(){return this._changes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasBasket",{get:function(){return this.baskets.length>0},enumerable:!1,configurable:!0}),e.prototype.basket=function(e){var t=this.basketIndex(e);return t>=0?this.baskets[t]:void 0},e.prototype.basketIndex=function(e){for(var t=0,n=this.baskets.length;t<n;t++){var s=this.baskets[t];if(s&&s.name===e)return t}return-1},e.prototype.createBasket=function(e){return!(this.basketIndex(e.name)>=0)&&(this.baskets.unshift(e),this._events.next({type:"Basket_Add",basket:e}),this.patchBaskets([{type:"Basket_Add",detail:{basket:e.name}}]),!0)},e.prototype.updateBasket=function(e,t){var n=this.basketIndex(e.name);return(-1===n||t===n)&&(t>=0&&t<this.baskets.length&&(this.baskets.splice(t,1,e),this._events.next({type:"Basket_Update",basket:e}),this.patchBaskets([{type:"Basket_Update",detail:{basket:e.name}}],!0),!0))},e.prototype.updateBaskets=function(e,t){return s.Utils.arraySet(this.baskets,e),this._events.next({type:"Basket_Update"}),this.patchBaskets(t,!0),!0},e.prototype.deleteBasket=function(e){var t=this.basketIndex(e.name);return-1!==t&&(this.baskets.splice(t,1),this._events.next({type:"Basket_Delete",basket:e}),this.patchBaskets([{type:"Basket_Delete",detail:{savedquery:e.name}}],!0),!0)},e.prototype.addToBasket=function(e,t,n){if(!t)return!1;var a=this.basket(e);if(!a)return!1;if(a.ids||(a.ids=[]),s.Utils.isArray(t))for(var i=0,r=t.length;i<r;i++){var o=t[i];-1===a.ids.indexOf(o)&&a.ids.push(o)}else-1===a.ids.indexOf(t)&&a.ids.push(t);return n||(this._events.next({type:"Basket_AddDoc"}),this.patchBaskets({type:"Basket_AddDoc",detail:{basket:e,"doc-id":a.ids[0]}})),!0},e.prototype.removeFromBasket=function(e,t,n){if(!t)return!1;var a=this.basket(e);if(!a)return!1;if(a.ids||(a.ids=[]),s.Utils.isArray(t))for(var i=0,r=t.length;i<r;i++){var o,c=t[i];-1!==(o=a.ids.indexOf(c))&&a.ids.splice(o,1)}else-1!==(o=a.ids.indexOf(t))&&a.ids.splice(o,1);return n||(this._events.next({type:"Basket_RemoveDoc"}),this.patchBaskets({type:"Basket_RemoveDoc",detail:{basket:e,"doc-id":a.ids[0]}},!0)),!0},e.prototype.removeFromAllBaskets=function(e){var t,n,s=[];try{for(var a=B(this.baskets),i=a.next();!i.done;i=a.next()){var r=i.value;this.removeFromBasket(r.name,e,!0)&&s.push({type:"Basket_RemoveDoc",detail:{basket:r.name,"doc-id":e}})}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return s.length>0&&(this._events.next({type:"Basket_RemoveDoc"}),this.patchBaskets(s,!0),!0)},e.prototype.patchBaskets=function(e,t){var n=this,s=this.userSettingsService.patch({baskets:this.baskets},e);return s.subscribe((function(e){n._events.next({type:"Basked_Patched"}),t&&n.searchService.query.basket&&n.searchService.search()}),(function(e){console.error("Could not patch Baskets!",e)})),s},e.prototype.searchBasket=function(e,t){var n=this.searchService.makeQuery();return n.basket=e.name,this.searchService.setQuery(n),this._events.next({type:"Basket_Open",basket:e}),this.searchService.search({path:t},{type:"Basket_Open",detail:{basket:e.name}})},e.prototype.addToBasketModal=function(e,t){var n=this,s={basket:void 0,basketFilter:t?function(e){return!t.includes(e.name)}:void 0,allowNew:!0};return this.modalService.open(this.basketComponents.selectBasketModal,{model:s}).then((function(t){return!(-1!==t||!s.basket)&&n.addToBasket(s.basket.name,e)}))},e.prototype.removeFromBasketModal=function(e,t){var n=this,s={basket:void 0,basketFilter:t?function(e){return t.includes(e.name)}:void 0};return this.modalService.open(this.basketComponents.selectBasketModal,{model:s}).then((function(t){return!(-1!==t||!s.basket)&&n.removeFromBasket(s.basket.name,e)}))},e.prototype.createBasketModal=function(e){var t=this;return void 0===e&&(e={name:""}),this.modalService.open(this.basketComponents.editBasketModal,{model:e}).then((function(n){if(-1===n){var s=t.basketIndex(e.name);return-1!==s?t.modalService.yesNo("msg#baskets.basketAlreadyExists").then((function(n){return-3===n&&t.updateBasket(e,s)})):t.createBasket(e)}return!1}))},e.prototype.manageBasketsModal=function(){var e=this,t={baskets:s.Utils.copy(this.baskets)};return this.modalService.open(this.basketComponents.manageBasketsModal,{model:t}).then((function(n){return-1===n&&e.updateBaskets(t.baskets,t.auditEvents)}))},e.prototype.buildBasketsAction=function(){var e=this;return new a.Action({icon:"fas fa-shopping-basket",title:"msg#baskets.baskets",hidden:!0,children:[new a.Action({text:"msg#baskets.addToBasket",action:function(t,n){e.addToBasketModal(e.selectionService.getSelectedIds())}}),new a.Action({text:"msg#baskets.removeFromBasket",action:function(t,n){e.removeFromBasketModal(e.selectionService.getSelectedIds())}})],updater:function(t){t.hidden=!e.selectionService.haveSelectedRecords}})},e.prototype.makeQuery=function(e){var t=this.searchService.makeQuery();return t.basket=e.name,t},e.prototype.notifyOpenBasket=function(e){this._events.next({type:"Basket_Open",basket:e})},e.prototype.ngOnDestroy=function(){this.events.complete(),this.changes.complete()},e}();x.ɵfac=function(e){return new(e||x)(t.ɵɵinject(i.UserSettingsWebService),t.ɵɵinject(r.SearchService),t.ɵɵinject(o.ModalService),t.ɵɵinject(c.SelectionService),t.ɵɵinject(S))},x.ɵprov=t.ɵɵdefineInjectable({token:x,factory:x.ɵfac,providedIn:"root"});var A=function(){function e(e,t){this.model=e,this.formBuilder=t}return e.prototype.ngOnInit=function(){var e=this;this.nameControl=new u.FormControl(this.model.name,u.Validators.required),this.form=this.formBuilder.group({basketName:this.nameControl}),this.formChanges=s.Utils.subscribe(this.form.valueChanges,(function(t){e.model.name=e.nameControl.value})),this.buttons=[new o.ModalButton({result:-1,primary:!0,validation:this.form}),new o.ModalButton({result:-2})]},e.prototype.ngOnDestroy=function(){this.formChanges.unsubscribe()},e}();function M(e,n){if(1&e){var s=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",6),t.ɵɵelementStart(1,"button",7),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(s),t.ɵɵnextContext().reorder()})),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var a=t.ɵɵnextContext();t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(3,1,a.reordering?"msg#manageBaskets.edit":"msg#manageBaskets.reorder"))}}function q(e,n){if(1&e&&(t.ɵɵelementStart(0,"div",14),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var s=t.ɵɵnextContext().$implicit;t.ɵɵadvance(1),t.ɵɵtextInterpolate(s.name)}}function w(e,n){if(1&e){var s=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"sq-editable",15),t.ɵɵlistener("valueChange",(function(e){t.ɵɵrestoreView(s);var n=t.ɵɵnextContext().$implicit;return t.ɵɵnextContext().setName(n,e)})),t.ɵɵelementEnd()}if(2&e){var a=t.ɵɵnextContext().$implicit,i=t.ɵɵnextContext();t.ɵɵproperty("value",a.name)("model",a)("validators",i.nameValidators)}}function C(e,n){if(1&e){var s=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",16),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(s);var e=t.ɵɵnextContext(),n=e.$implicit,a=e.index;return t.ɵɵnextContext().remove(n,a)})),t.ɵɵpipe(1,"sqMessage"),t.ɵɵelement(2,"span",17),t.ɵɵelementEnd()}2&e&&t.ɵɵpropertyInterpolate("title",t.ɵɵpipeBind1(1,1,"msg#manageBaskets.remove"))}function _(e,n){1&e&&t.ɵɵelement(0,"span",18)}A.ɵfac=function(e){return new(e||A)(t.ɵɵdirectiveInject(o.MODAL_MODEL),t.ɵɵdirectiveInject(u.FormBuilder))},A.ɵcmp=t.ɵɵdefineComponent({type:A,selectors:[["sq-edit-basket"]],decls:7,vars:7,consts:[["name","editBasket","novalidate","",3,"formGroup"],[3,"title","buttons"],[1,"form-group","sq-form-group"],["for","basketName"],["type","text","id","basketName","formControlName","basketName","spellcheck","off","sqAutofocus","",1,"form-control",3,"sqValidation"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"form",0),t.ɵɵelementStart(1,"sq-modal",1),t.ɵɵelementStart(2,"div",2),t.ɵɵelementStart(3,"label",3),t.ɵɵtext(4),t.ɵɵpipe(5,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelement(6,"input",4),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵproperty("formGroup",n.form),t.ɵɵadvance(1),t.ɵɵproperty("title","msg#editBasket.title")("buttons",n.buttons),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(5,5,"msg#editBasket.name")),t.ɵɵadvance(2),t.ɵɵproperty("sqValidation",n.form))},directives:[u.ɵangular_packages_forms_forms_y,u.NgControlStatusGroup,u.FormGroupDirective,f.BsModal,u.DefaultValueAccessor,u.NgControlStatus,u.FormControlName,k.Autofocus,m.ValidationDirective],pipes:[p.MessagePipe],encapsulation:2});var I=function(e){return["list-group-item list-group-item-action d-flex w-auto-unimportant",e]};function O(e,n){if(1&e&&(t.ɵɵelementStart(0,"div",8),t.ɵɵtemplate(1,q,2,1,"div",9),t.ɵɵtemplate(2,w,1,3,"sq-editable",10),t.ɵɵelementStart(3,"div",11),t.ɵɵtemplate(4,C,3,3,"a",12),t.ɵɵtemplate(5,_,1,0,"span",13),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e){var s=t.ɵɵnextContext();t.ɵɵproperty("ngClass",t.ɵɵpureFunction1(5,I,s.reordering?"cursor-move":"")),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",s.reordering),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!s.reordering),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",!s.reordering),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",s.reordering)}}var F=function(){function e(e){var t=this;this.model=e,this.reordering=!1,this.nameValidators=[u.Validators.required,function(e){var n,s,a=e.root.get("model");if(a)try{for(var i=B(t.model.baskets),r=i.next();!r.done;r=i.next()){var o=r.value;if(a.value!==o&&e.value===o.name)return{unique:!0}}}catch(e){n={error:e}}finally{try{r&&!r.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}return null}]}return e.prototype.ngOnInit=function(){var e=this;this.buttons=[this.removeAllButton=new o.ModalButton({text:"msg#manageBaskets.removeAll",result:0,action:function(t){e.model.baskets.splice(0),t.visible=!1,e.addAuditEvent({type:"Basket_DeleteAll"})},visible:this.model.baskets.length>0}),new o.ModalButton({result:-1,primary:!0}),new o.ModalButton({result:-2})]},e.prototype.addAuditEvent=function(e){this.model.auditEvents||(this.model.auditEvents=[]),this.model.auditEvents.push(e)},e.prototype.reorder=function(){this.reordering=!this.reordering},e.prototype.setName=function(e,t){s.Utils.eqNC(e.name,t)||(this.addAuditEvent({type:"Basket_Rename",detail:{basket:t,"old-name":e.name}}),e.name=t)},e.prototype.remove=function(e,t){return this.model.baskets.splice(t,1),this.removeAllButton.visible=this.model.baskets.length>0,this.addAuditEvent({type:"Basket_Delete",detail:{basket:e.name}}),!1},e.prototype.dropped=function(e){s.Utils.arrayMove(this.model.baskets,e.previousIndex,e.currentIndex)},e}();function E(e,n){if(1&e){var s=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",6),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(s);var e=n.$implicit;return t.ɵɵnextContext().select(e)})),t.ɵɵelementStart(1,"div"),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var a=n.$implicit;t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(3,1,a.name))}}function j(e,n){if(1&e){var s=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",6),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(s),t.ɵɵnextContext().newBasket()})),t.ɵɵelementStart(1,"div"),t.ɵɵelementStart(2,"i"),t.ɵɵtext(3),t.ɵɵpipe(4,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()}2&e&&(t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(4,1,"msg#selectBasket.newBasket")))}F.ɵfac=function(e){return new(e||F)(t.ɵɵdirectiveInject(o.MODAL_MODEL))},F.ɵcmp=t.ɵɵdefineComponent({type:F,selectors:[["sq-manage-baskets"]],decls:6,vars:6,consts:[["name","manageBaskets","novalidate",""],[3,"title","buttons"],["class","form-group clearfix",4,"ngIf"],[1,"form-group"],["cdkDropList","",1,"list-group",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["cdkDrag","",3,"ngClass",4,"ngFor","ngForOf"],[1,"form-group","clearfix"],["type","button",1,"btn","btn-secondary","float-right",3,"click"],["cdkDrag","",3,"ngClass"],["class","sq-basket-text",4,"ngIf"],["name","msg#manageBaskets.name",3,"value","model","validators","valueChange",4,"ngIf"],[1,"ml-auto"],["class","ml-2","href","#",3,"title","click",4,"ngIf"],["class","ml-2 fas fa-bars sq-move",4,"ngIf"],[1,"sq-basket-text"],["name","msg#manageBaskets.name",3,"value","model","validators","valueChange"],["href","#",1,"ml-2",3,"title","click"],[1,"fas","fa-times","sq-remove"],[1,"ml-2","fas","fa-bars","sq-move"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"form",0),t.ɵɵelementStart(1,"sq-modal",1),t.ɵɵtemplate(2,M,4,3,"div",2),t.ɵɵelementStart(3,"div",3),t.ɵɵelementStart(4,"div",4),t.ɵɵlistener("cdkDropListDropped",(function(e){return n.dropped(e)})),t.ɵɵtemplate(5,O,6,7,"div",5),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("title","msg#manageBaskets.title")("buttons",n.buttons),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.model.baskets.length),t.ɵɵadvance(2),t.ɵɵproperty("cdkDropListData",n.model.baskets)("cdkDropListDisabled",!n.reordering),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",n.model.baskets))},directives:[u.ɵangular_packages_forms_forms_y,u.NgControlStatusGroup,u.NgForm,f.BsModal,l.NgIf,d.CdkDropList,l.NgForOf,d.CdkDrag,l.NgClass,f.BsEditable],pipes:[p.MessagePipe],styles:[".list-group[_ngcontent-%COMP%]{max-height:18.5rem;overflow-y:auto;width:100%}.sq-basket-text[_ngcontent-%COMP%]{overflow-wrap:break-word;width:100%;word-break:break-word;word-wrap:break-word}.sq-move[_ngcontent-%COMP%]{cursor:move}span.sq-move[_ngcontent-%COMP%]{color:grey}.sq-remove[_ngcontent-%COMP%]{color:#d3d3d3;cursor:pointer}.sq-remove[_ngcontent-%COMP%]:hover{color:#8b0000}.w-auto-unimportant[_ngcontent-%COMP%]{width:auto}.cursor-move[_ngcontent-%COMP%]{cursor:move}"]});var D=function(){function e(e,t,n){this.model=e,this.basketsService=t,this.modalRef=n,this.baskets=this.basketsService.baskets,this.baskets||(this.baskets=[]),this.buttons=[new o.ModalButton({result:-2})]}return e.prototype.ngOnInit=function(){this.model.basketFilter&&(this.baskets=this.baskets.filter(this.model.basketFilter))},e.prototype.activate=function(e){this.model=e},e.prototype.select=function(e){e&&(this.model.basket=e,this.modalRef.close(-1))},e.prototype.newBasket=function(){var e=this,t={name:""};this.basketsService.createBasketModal(t).then((function(n){n&&e.select(t)}))},e}();D.ɵfac=function(e){return new(e||D)(t.ɵɵdirectiveInject(o.MODAL_MODEL),t.ɵɵdirectiveInject(x),t.ɵɵdirectiveInject(o.ModalRef))},D.ɵcmp=t.ɵɵdefineComponent({type:D,selectors:[["sq-select-basket"]],decls:6,vars:4,consts:[["name","selectBasket","novalidate",""],[3,"title","buttons"],[1,"form-group"],[1,"list-group","sq-list-group"],["href","javascript:void(0)","class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],["href","javascript:void(0)","class","list-group-item list-group-item-action",3,"click",4,"ngIf"],["href","javascript:void(0)",1,"list-group-item","list-group-item-action",3,"click"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"form",0),t.ɵɵelementStart(1,"sq-modal",1),t.ɵɵelementStart(2,"div",2),t.ɵɵelementStart(3,"div",3),t.ɵɵtemplate(4,E,4,3,"a",4),t.ɵɵtemplate(5,j,5,3,"a",5),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("title","msg#selectBasket.title")("buttons",n.buttons),t.ɵɵadvance(3),t.ɵɵproperty("ngForOf",n.baskets),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.model.allowNew))},directives:[u.ɵangular_packages_forms_forms_y,u.NgControlStatusGroup,u.NgForm,f.BsModal,l.NgForOf,l.NgIf],pipes:[p.MessagePipe],encapsulation:2});var P=function(e){return[e]},N=function(e,t){return{items:e,autoAdjust:!0,rightAligned:t}},R=function(){function e(e,t,n){this.modalService=e,this.basketsService=t,this.changeDetectorRef=n,this.baskets=[]}return e.prototype.ngOnChanges=function(e){var t=this;this.initialized||(this.initialized=!0,this.addToBasketAction=this.buildAddToBasketAction(),this.removeFromBasketAction=this.buildRemoveFromBasketAction(),this.removeFromAllBasketsAction=this.buildRemovalFromAllBasketsAction(),this.basketsSubscription=this.basketsService.changes.subscribe((function(e){t.updateRecordBaskets(),t.refreshVisualization()}))),this.updateRecordBaskets(),this.refreshVisualization()},e.prototype.ngOnDestroy=function(){this.basketsSubscription&&this.basketsSubscription.unsubscribe()},Object.defineProperty(e.prototype,"isInBaskets",{get:function(){return this.baskets.length>0},enumerable:!1,configurable:!0}),e.prototype.refreshVisualization=function(){this.basketsAction=this.buildBasketsAction(),this.changeDetectorRef.markForCheck()},e.prototype.updateRecordBaskets=function(){var e,t,n=this.basketsService.baskets;this.baskets=[];try{for(var s=B(n),a=s.next();!a.done;a=s.next()){var i=a.value;i.ids&&i.ids.includes(this.record.id)&&this.baskets.push(i.name)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},e.prototype.buildAddToBasketAction=function(){var e=this;return new a.Action({text:"msg#baskets.addToBasket",action:function(t,n){e.basketsService.addToBasketModal(e.record.id,e.baskets)}})},e.prototype.buildRemoveFromBasketAction=function(){var e=this;return new a.Action({text:"msg#baskets.removeFromBasket",action:function(t,n){e.basketsService.removeFromBasketModal(e.record.id,e.baskets)}})},e.prototype.buildRemovalFromAllBasketsAction=function(){var e=this;return new a.Action({text:"msg#baskets.removeFromAllBaskets",action:function(){e.modalService.yesNo("msg#baskets.removeFromAllBasketsConfirmation",{values:{baskets:e.baskets.join(", ")}}).then((function(t){-3===t&&e.basketsService.removeFromAllBaskets(e.record.id)}))}})},e.prototype.buildBasketsAction=function(){return new a.Action({icon:"fas fa-shopping-basket",title:"msg#baskets.baskets",children:this.isInBaskets?1===this.baskets.length?[this.addToBasketAction,this.removeFromBasketAction]:[this.addToBasketAction,this.removeFromBasketAction,this.removeFromAllBasketsAction]:[this.addToBasketAction]})},e}();R.ɵfac=function(e){return new(e||R)(t.ɵɵdirectiveInject(o.ModalService),t.ɵɵdirectiveInject(x),t.ɵɵdirectiveInject(t.ChangeDetectorRef))},R.ɵcmp=t.ɵɵdefineComponent({type:R,selectors:[["sq-result-baskets"]],inputs:{record:"record",rightAligned:"rightAligned"},features:[t.ɵɵNgOnChangesFeature],decls:1,vars:9,consts:[[3,"sq-action-buttons"]],template:function(e,n){1&e&&t.ɵɵelement(0,"div",0),2&e&&(t.ɵɵclassMapInterpolate1("btn-group ",n.isInBaskets?"sq-document-in-baskets":"sq-document-not-in-baskets",""),t.ɵɵproperty("sq-action-buttons",t.ɵɵpureFunction2(6,N,t.ɵɵpureFunction1(4,P,n.basketsAction),n.rightAligned)))},directives:[a.BsActionButtons],encapsulation:2});var V=function(e,t,n,s){return{item:e,size:t,autoAdjust:n,autoAdjustBreakpoint:s,inMenu:!0}};function T(e,n){if(1&e&&t.ɵɵelement(0,"li",1),2&e){var s=t.ɵɵnextContext();t.ɵɵproperty("sq-action-item",t.ɵɵpureFunction4(2,V,s.menu,s.size,s.autoAdjust,s.autoAdjustBreakpoint))("collapseBreakpoint",s.collapseBreakpoint)}}var L=function(){function e(e,t,n,s,i){var r=this;this.loginService=e,this.basketsService=t,this.principalService=n,this.userSettingsService=s,this.appService=i,this.searchRoute="/search",this.icon="fas fa-shopping-basket",this.autoAdjust=!0,this.autoAdjustBreakpoint="xl",this.collapseBreakpoint="sm",this.basketOptions=["Select","Share"],this.basketCustomOptions=[],this.createAction=new a.Action({text:"msg#baskets.createBasket",title:"msg#baskets.createBasket",action:function(e){r.basketsService.createBasketModal()}}),this.manageAction=new a.Action({text:"msg#baskets.manageBaskets",title:"msg#baskets.manageBaskets",action:function(e){r.basketsService.manageBasketsModal()}})}return e.prototype.ngOnInit=function(){var e=this;this.updateMenu(),this.basketsService.changes.subscribe({next:function(){e.updateMenu()}}),this.loginService.events.subscribe((function(t){"session-changed"===t.type&&e.updateMenu()}))},e.prototype.updateMenu=function(){var e=this;if(this.loginService.complete){var t=[];this.basketsService.hasBasket&&this.basketsService.baskets.map((function(n){return t.push(new a.Action({text:n.name,title:n.name,children:[new a.Action({text:"Select",title:"Select",action:function(){return e.basketsService.searchBasket(n,e.searchRoute)}}),new a.Action({text:"Share",title:"Share",action:function(){return e.sendEmail(n,e.searchRoute)}})]}))})),t.push(new a.Action({separator:!0})),t.push(this.createAction),this.basketsService.hasBasket&&t.push(this.manageAction),this.menu=new a.Action({icon:this.icon,text:"msg#baskets.baskets",title:"msg#baskets.baskets",children:t})}else this.menu=void 0},e.prototype.sendEmail=function(e,t){var n,s,a,i=null===(s=null===(n=this.principalService)||void 0===n?void 0:n.principal)||void 0===s?void 0:s.name,r=e.name,o="#/search?query=%7B%22name%22:%22"+this.appService.appName+"%22,%22basket%22:%22"+r+"%22,%22user%22:%22"+i+"%22,%22tab%22:%22ALL%22%7D&view=list&user="+i+"&sharedBasket="+r,c="https://"+window.location.host+window.location.pathname+encodeURIComponent(o);console.log(c),a="mailto:?subject=Pubmed Search Basket&body="+c,console.log(a),window.location.href=a},e}();function U(e,n){if(1&e&&(t.ɵɵelementStart(0,"span",7),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var s=t.ɵɵnextContext().$implicit;t.ɵɵadvance(1),t.ɵɵtextInterpolate(s.ids.length)}}function z(e,n){if(1&e){var s=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"i",8),t.ɵɵlistener("click",(function(e){t.ɵɵrestoreView(s);var n=t.ɵɵnextContext().$implicit;return t.ɵɵnextContext().deleteBasket(n,e)})),t.ɵɵpipe(1,"sqMessage"),t.ɵɵelementEnd()}2&e&&t.ɵɵproperty("title",t.ɵɵpipeBind1(1,1,"msg#baskets.delete"))}L.ɵfac=function(e){return new(e||L)(t.ɵɵdirectiveInject(v.LoginService),t.ɵɵdirectiveInject(x),t.ɵɵdirectiveInject(i.PrincipalWebService),t.ɵɵdirectiveInject(i.UserSettingsWebService),t.ɵɵdirectiveInject(i.AppWebService))},L.ɵcmp=t.ɵɵdefineComponent({type:L,selectors:[["sq-baskets-menu"]],inputs:{searchRoute:"searchRoute",icon:"icon",autoAdjust:"autoAdjust",autoAdjustBreakpoint:"autoAdjustBreakpoint",collapseBreakpoint:"collapseBreakpoint",size:"size"},decls:1,vars:1,consts:[["class","nav-item dropdown",3,"sq-action-item","collapseBreakpoint",4,"ngIf"],[1,"nav-item","dropdown",3,"sq-action-item","collapseBreakpoint"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,T,1,7,"li",0),2&e&&t.ɵɵproperty("ngIf",!!n.menu&&!n.menu.hidden)},directives:[l.NgIf,a.BsActionItem],encapsulation:2});var $=function(e){return[e]};function G(e,n){if(1&e){var s=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",3),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(s);var e=n.$implicit;return t.ɵɵnextContext().openBasket(e)})),t.ɵɵelementStart(1,"span",4),t.ɵɵtext(2),t.ɵɵelementEnd(),t.ɵɵtemplate(3,U,2,1,"span",5),t.ɵɵtemplate(4,z,2,3,"i",6),t.ɵɵelementEnd()}if(2&e){var a=n.$implicit,i=t.ɵɵnextContext();t.ɵɵproperty("routerLink",t.ɵɵpureFunction1(6,$,i.searchRoute))("queryParams",i.getQueryParams(a))("state",i.getRouterState(a)),t.ɵɵadvance(2),t.ɵɵtextInterpolate(a.name),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",a.ids),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.enableDelete)}}function Q(e,n){1&e&&(t.ɵɵelementStart(0,"div",9),t.ɵɵtext(1),t.ɵɵpipe(2,"sqMessage"),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵtextInterpolate1(" ",t.ɵɵpipeBind1(2,1,"msg#baskets.noBasket")," "))}var W=function(e){function t(t){var n=e.call(this)||this;return n.basketsService=t,n.searchRoute="/search",n.maxBaskets=5,n.enableDelete=!0,n.page=0,n.createBasket=new a.Action({icon:"fas fa-plus",title:"msg#baskets.createBasket",action:function(){n.basketsService.createBasketModal()}}),n.manageBasket=new a.Action({icon:"fas fa-cog",title:"msg#baskets.manageBaskets",action:function(){n.basketsService.manageBasketsModal()}}),n.previousPage=new a.Action({icon:"fas fa-chevron-left",title:"msg#facet.previous",action:function(){n.page--},updater:function(e){e.disabled=n.page<=0,e.hidden=0===n.maxPage}}),n.nextPage=new a.Action({icon:"fas fa-chevron-right",title:"msg#facet.next",action:function(){n.page++},updater:function(e){e.disabled=n.page>=n.maxPage,e.hidden=0===n.maxPage}}),n}return function(e,t){function n(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),Object.defineProperty(t.prototype,"maxPage",{get:function(){return Math.max(0,Math.ceil(this.basketsService.baskets.length/this.maxBaskets)-1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startIndex",{get:function(){return this.page*this.maxBaskets},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endIndex",{get:function(){return(this.page+1)*this.maxBaskets},enumerable:!1,configurable:!0}),t.prototype.openBasket=function(e){return this.basketsService.notifyOpenBasket(e),!0},Object.defineProperty(t.prototype,"actions",{get:function(){return this.previousPage.update(),this.nextPage.update(),[this.createBasket,this.previousPage,this.nextPage,this.manageBasket]},enumerable:!1,configurable:!0}),t.prototype.deleteBasket=function(e,t){return t.stopPropagation(),this.basketsService.deleteBasket(e),this.page=Math.min(this.page,this.maxPage),!1},t.prototype.getQueryParams=function(e){return{query:this.basketsService.makeQuery(e).toJsonForQueryString()}},t.prototype.getRouterState=function(e){return{audit:{type:"Basket_Open",detail:{basket:e.name}}}},t}(h.AbstractFacet);W.ɵfac=function(e){return new(e||W)(t.ɵɵdirectiveInject(x))},W.ɵcmp=t.ɵɵdefineComponent({type:W,selectors:[["sq-facet-baskets"]],inputs:{searchRoute:"searchRoute",maxBaskets:"maxBaskets",enableDelete:"enableDelete"},features:[t.ɵɵInheritDefinitionFeature],decls:4,vars:6,consts:[[1,"list-group","list-group-flush"],["class","basket-item list-group-item list-group-item-action d-flex align-items-center",3,"routerLink","queryParams","state","click",4,"ngFor","ngForOf"],["class","list-group-item text-center text-muted font-italic small py-5",4,"ngIf"],[1,"basket-item","list-group-item","list-group-item-action","d-flex","align-items-center",3,"routerLink","queryParams","state","click"],[1,"basket-name","text-truncate","mr-auto"],["class","basket-count ml-2 text-muted small",4,"ngIf"],["class","basket-delete ml-2 fas fa-times",3,"title","click",4,"ngIf"],[1,"basket-count","ml-2","text-muted","small"],[1,"basket-delete","ml-2","fas","fa-times",3,"title","click"],[1,"list-group-item","text-center","text-muted","font-italic","small","py-5"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵtemplate(1,G,5,8,"a",1),t.ɵɵpipe(2,"slice"),t.ɵɵtemplate(3,Q,3,3,"div",2),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",t.ɵɵpipeBind3(2,2,n.basketsService.baskets,n.startIndex,n.endIndex)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",0==n.basketsService.baskets.length))},directives:[l.NgForOf,l.NgIf,g.RouterLinkWithHref],pipes:[l.SlicePipe,p.MessagePipe],styles:[".basket-item[_ngcontent-%COMP%]   .basket-delete[_ngcontent-%COMP%]{\n    opacity: 0;\n}\n\n.basket-item[_ngcontent-%COMP%]:hover   .basket-delete[_ngcontent-%COMP%]{\n    opacity: 1;\n    transition: opacity 0.2s ease-in-out;\n}"]});var J=function(){};J.ɵmod=t.ɵɵdefineNgModule({type:J}),J.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||J)},providers:[{provide:S,useValue:{selectBasketModal:D,editBasketModal:A,manageBasketsModal:F}}],imports:[[l.CommonModule,u.FormsModule,u.ReactiveFormsModule,d.DragDropModule,g.RouterModule,f.BsModalModule,p.IntlModule,m.ValidationModule,k.UtilsModule,c.BsSelectionModule,a.BsActionModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(J,{declarations:[A,F,D,R,L,W],imports:[l.CommonModule,u.FormsModule,u.ReactiveFormsModule,d.DragDropModule,g.RouterModule,f.BsModalModule,p.IntlModule,m.ValidationModule,k.UtilsModule,c.BsSelectionModule,a.BsActionModule],exports:[A,F,D,R,L,W]});var K=s.Utils.merge({},{baskets:{baskets:"Baskets",addToBasket:"Add to basket",removeFromBasket:"Remove from basket",removeFromAllBaskets:"Remove from all baskets",removeFromAllBasketsConfirmation:"Are you sure you want to remove this result from these baskets: {baskets}?",basketAlreadyExists:"A basket with that name already exists. Would you like to replace it?",noBasket:"You have not yet added a document to a basket...",createBasket:"Create Basket",manageBaskets:"Manage Baskets",delete:"Delete this basket"},editBasket:{title:"Basket",name:"Name"},manageBaskets:{title:"Manage Baskets",edit:"Edit",reorder:"Reorder",remove:"Remove",removeAll:"Remove all",name:"Name"},selectBasket:{title:"Select Basket",newBasket:"New basket..."}},r.enSearch,c.enSelection,f.enModal),H=s.Utils.merge({},{baskets:{baskets:"Paniers",addToBasket:"Ajouter au panier",removeFromBasket:"Supprimer du panier",removeFromAllBaskets:"Supprimer de tous les paniers",removeFromAllBasketsConfirmation:"Êtes-vous sûr de vouloir supprimer ce résultat de ces paniers : {baskets} ?",basketAlreadyExists:"Un panier avec ce nom existe déjà. Voulez-vous le remplacer ?",noBasket:"Vous n'avez pas encore ajouté de document à un panier...",createBasket:"Créer un panier",manageBaskets:"Gérer les paniers",delete:"Supprimer ce panier"},editBasket:{title:"Panier",name:"Nom"},manageBaskets:{title:"Gérer les paniers",edit:"Editer",reorder:"Réorganiser",remove:"Effacer",removeAll:"Effacer tout",name:"Nom"},selectBasket:{title:"Sélectionner un panier",newBasket:"Nouveau panier..."}},r.frSearch,c.frSelection,f.frModal),Y=s.Utils.merge({},{baskets:{baskets:"Ablagekörbe",addToBasket:"Zum Ablagekorb hinzufügen",removeFromBasket:"Aus dem Ablagekorb entfernen",removeFromAllBaskets:"Von allen Ablagekörben entfernen",removeFromAllBasketsConfirmation:"Möchten Sie dieses Eregbnis wirklich von diesen Ablagekörben entfernen: {baskets}?",basketAlreadyExists:"Es existiert bereits ein Ablagekorb mit diesem Namen. Möchten Sie ihn ersetzen?",noBasket:"Sie haben noch kein Dokument zu einem Ablagekorb hinzugefügt...",createBasket:"Ablagekorb erstellen",manageBaskets:"Ablagekörbe verwalten",delete:"Diesen Ablagekorb löschen"},editBasket:{title:"Ablagekorb",name:"Name"},manageBaskets:{title:"Ablagekörbe verwalten",edit:"Bearbeiten",reorder:"Neu sortieren",remove:"Entfernen",removeAll:"Alle entfernen",name:"Name"},selectBasket:{title:"Ablagekorb auswählen",newBasket:"Neuer Ablagekorb..."}},r.deSearch,c.deSelection,f.deModal);e.BASKET_CHANGE_EVENTS=y,e.BASKET_COMPONENTS=S,e.BasketsService=x,e.BsBasketsMenuComponent=L,e.BsBasketsModule=J,e.BsEditBasket=A,e.BsFacetBasketsComponent=W,e.BsManageBaskets=F,e.BsResultBaskets=R,e.BsSelectBasket=D,e.deBaskets=Y,e.enBaskets=K,e.frBaskets=H,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-components-baskets.umd.min.js.map