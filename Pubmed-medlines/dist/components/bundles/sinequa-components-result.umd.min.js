!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@sinequa/core/base"),require("@angular/common"),require("@sinequa/components/collapse"),require("@sinequa/components/utils"),require("@sinequa/core/intl"),require("@angular/forms"),require("@sinequa/components/metadata"),require("@sinequa/components/search"),require("@sinequa/core/app-utils"),require("@sinequa/core/web-services")):"function"==typeof define&&define.amd?define("@sinequa/components/result",["exports","@angular/core","@sinequa/core/base","@angular/common","@sinequa/components/collapse","@sinequa/components/utils","@sinequa/core/intl","@angular/forms","@sinequa/components/metadata","@sinequa/components/search","@sinequa/core/app-utils","@sinequa/core/web-services"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.components=e.sinequa.components||{},e.sinequa.components.result={}),e.ng.core,e.sinequa.core.base,e.ng.common,e.sinequa.components.collapse,e.sinequa.components.utils,e.sinequa.core.intl,e.ng.forms,e.sinequa.components.metadata,e.sinequa.components.search,e.sinequa.core["app-utils"],e.sinequa.core["web-services"])}(this,(function(e,t,n,i,r,s,a,o,l,c,p,u){"use strict";function d(e,n){if(1&e&&(t.ɵɵelementStart(0,"span",5),t.ɵɵtext(1),t.ɵɵpipe(2,"sqDate"),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext(3);t.ɵɵadvance(1),t.ɵɵtextInterpolate2("",t.ɵɵpipeBind2(2,2,i.record.modified,i.dateFormat),"",i.text?" - ":"","")}}function h(e,n){if(1&e&&(t.ɵɵelementStart(0,"p"),t.ɵɵtemplate(1,d,3,5,"span",3),t.ɵɵelement(2,"span",4),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext(2);t.ɵɵclassMapInterpolate1("",i.extractsClass," sq-text"),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.record.modified&&!i.hideDate),t.ɵɵadvance(1),t.ɵɵproperty("innerHTML",i.text,t.ɵɵsanitizeHtml)}}function g(e,n){if(1&e&&(t.ɵɵelementStart(0,"p"),t.ɵɵtext(1),t.ɵɵpipe(2,"sqDate"),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext(3);t.ɵɵclassMapInterpolate1("",i.extractsClass," extracts-date sq-text"),t.ɵɵadvance(1),t.ɵɵtextInterpolate(t.ɵɵpipeBind2(2,4,i.record.modified,i.dateFormat))}}function m(e,n){if(1&e&&t.ɵɵelement(0,"li",7),2&e){var i=n.$implicit;t.ɵɵproperty("innerHTML",i,t.ɵɵsanitizeHtml)}}function f(e,n){if(1&e&&(t.ɵɵelementStart(0,"ul"),t.ɵɵtemplate(1,m,1,1,"li",6),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext(3);t.ɵɵclassMapInterpolate1("",i.extractsClass," sq-text"),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",i.longExtracts)}}function v(e,n){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,g,3,7,"p",1),t.ɵɵtemplate(2,f,2,4,"ul",1),t.ɵɵelementContainerEnd()),2&e){var i=t.ɵɵnextContext(2);t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.record.modified&&!i.hideDate),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.longExtracts)}}function y(e,n){if(1&e){var i=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",8),t.ɵɵlistener("click",(function(e){return t.ɵɵrestoreView(i),t.ɵɵnextContext(2).collapseClick(e)})),t.ɵɵelement(1,"sq-collapse-button",9),t.ɵɵelementEnd()}if(2&e){var r=t.ɵɵnextContext(2);t.ɵɵadvance(1),t.ɵɵproperty("collapsed",r.collapsed)}}function x(e,n){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,h,3,5,"p",1),t.ɵɵtemplate(2,v,3,2,"ng-container",0),t.ɵɵtemplate(3,y,2,1,"a",2),t.ɵɵelementContainerEnd()),2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!i.longExtracts),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.longExtracts),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",i.showLinesExpander)}}var C=function(){function e(){this.dateFormat={year:"numeric",month:"short",day:"numeric"},this.collapsed=!0}return e.prototype.setup=function(){if(this.text=void 0,this.longExtracts=void 0,this.showTextAlways)this.text=n.Utils.encodeHTML(this.record.text),this.extractsClass="sq-text-extracts";else if(this.showLongExtracts&&(this.record.extracts||this.record.extractsperpartname)){this.longExtracts=[];var e=this.record.extracts||this.record.extractsperpartname.highlight[0].data.split(";");this.maxLongExtracts&&(e=e.slice(0,3*this.maxLongExtracts));for(var t=0;t<e.length;t+=3)this.longExtracts.push(e[t].replace(/\{b\}/g,"<strong>").replace(/\{nb\}/g,"</strong>"));this.extractsClass="sq-long-extracts"}else this.record.relevantExtracts?(this.text=this.record.relevantExtracts,this.extractsClass="sq-relevant-extracts"):(this.text=n.Utils.encodeHTML(this.record.text),this.extractsClass="sq-text-extracts");this.limitLinesDisplayed&&this.collapsed||(this.extractsClass+=" sq-show-all")},e.prototype.ngOnChanges=function(e){this.setup()},e.prototype.collapseClick=function(e){this.collapsed=!this.collapsed,this.setup(),e.preventDefault()},e}();C.ɵfac=function(e){return new(e||C)},C.ɵcmp=t.ɵɵdefineComponent({type:C,selectors:[["sq-result-extracts"]],inputs:{record:"record",limitLinesDisplayed:"limitLinesDisplayed",showLinesExpander:"showLinesExpander",showTextAlways:"showTextAlways",showLongExtracts:"showLongExtracts",hideDate:"hideDate",maxLongExtracts:"maxLongExtracts",dateFormat:"dateFormat"},features:[t.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[[4,"ngIf"],[3,"class",4,"ngIf"],["class","sq-text","href","#",3,"click",4,"ngIf"],["class","extracts-date",4,"ngIf"],[1,"extracts-text",3,"innerHTML"],[1,"extracts-date"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],["href","#",1,"sq-text",3,"click"],[3,"collapsed"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,x,4,3,"ng-container",0),2&e&&t.ɵɵproperty("ngIf",n.text||n.longExtracts)},directives:[i.NgIf,i.NgForOf,r.CollapseButton],pipes:[s.DatePipe],styles:["p[_ngcontent-%COMP%], ul[_ngcontent-%COMP%] {\n    margin: 0;\n    color: #676767;\n    font-size: 0.9em;\n}"]});var q=function(){this.size=1};q.ɵfac=function(e){return new(e||q)},q.ɵcmp=t.ɵɵdefineComponent({type:q,selectors:[["sq-result-icon"]],inputs:{record:"record",size:"size"},decls:1,vars:5,consts:[[3,"title"]],template:function(e,n){1&e&&t.ɵɵelement(0,"span",0),2&e&&(t.ɵɵclassMapInterpolate2("far fa-file sq-icon-file-",n.record.fileext," fa-",n.size,"x fa-fw"),t.ɵɵpropertyInterpolate("title",n.record.fileext))},encapsulation:2});Object.create;function k(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;function b(e,n){if(1&e&&(t.ɵɵelementStart(0,"span",4),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var i=n.$implicit;t.ɵɵadvance(1),t.ɵɵtextInterpolate1(" ",i,"")}}function S(e,n){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelementStart(1,"span",1),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"span",2),t.ɵɵtemplate(5,b,2,1,"span",3),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(3,2,"msg#results.missingTerms")),t.ɵɵadvance(3),t.ɵɵproperty("ngForOf",i.missingTerms)}}var w=function(){function e(){}return e.prototype.ngOnChanges=function(e){var t,i;if(e.record&&(this.missingTerms=[],this.record.termspresence))try{for(var r=k(this.record.termspresence),s=r.next();!s.done;s=r.next()){var a=s.value;n.Utils.eqNC(a.presence,"missing")&&this.missingTerms.push(a.term)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e}();function I(e,n){if(1&e&&t.ɵɵelement(0,"span",2),2&e){var i=t.ɵɵnextContext();t.ɵɵpropertyInterpolate("title",i.record.title),t.ɵɵproperty("innerHTML",i.title,t.ɵɵsanitizeHtml)}}function M(e,n){if(1&e){var i=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",3),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(i),t.ɵɵnextContext().click()})),t.ɵɵelementEnd()}if(2&e){var r=t.ɵɵnextContext();t.ɵɵpropertyInterpolate("title",r.record.title),t.ɵɵpropertyInterpolate("href",r.href,t.ɵɵsanitizeUrl),t.ɵɵpropertyInterpolate("target",r.target),t.ɵɵproperty("innerHTML",r.title,t.ɵɵsanitizeHtml)}}w.ɵfac=function(e){return new(e||w)},w.ɵcmp=t.ɵɵdefineComponent({type:w,selectors:[["sq-result-missing-terms"]],inputs:{record:"record"},features:[t.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[[4,"ngIf"],[1,"sq-missing-terms-label","sq-text"],[1,"sq-missing-terms","sq-text"],["class","sq-missing-term",4,"ngFor","ngForOf"],[1,"sq-missing-term"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,S,6,4,"ng-container",0),2&e&&t.ɵɵproperty("ngIf",n.missingTerms.length>0)},directives:[i.NgIf,i.NgForOf],pipes:[a.MessagePipe],styles:["[_nghost-%COMP%]{color:#707070;display:block;font-size:.9rem}.sq-missing-term[_ngcontent-%COMP%]{-webkit-text-decoration-line:line-through;text-decoration-line:line-through}.sq-missing-term[_ngcontent-%COMP%]:not(:first-child){margin-left:.25em}"]});var O=function(){function e(e,n){this.searchService=e,this.appService=n,this.titleLinkBehavior="open",this.field="",this.titleClicked=new t.EventEmitter}return e.prototype.ngOnChanges=function(e){e.record&&(this.titleField=this.appService.resolveColumnAlias(this.field),this.title=this.getTitle(),this.documentUrl=this.record.url1)},Object.defineProperty(e.prototype,"hasLinkBehaviour",{get:function(){return"open"===this.titleLinkBehavior||"open-if-url"===this.titleLinkBehavior&&this.hasUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSpanBehaviour",{get:function(){return"display"===this.titleLinkBehavior||"open-if-url"===this.titleLinkBehavior&&!this.hasUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"href",{get:function(){return this.hasLinkBehaviour&&this.documentUrl||"#"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.hasLinkBehaviour&&this.documentUrl?this.originalDocTarget||"_blank":"_self"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasUrl",{get:function(){return!!this.documentUrl},enumerable:!1,configurable:!0}),e.prototype.getTitle=function(){var e;return this.titleField&&(e=n.Utils.escapeHtml(this.record[this.titleField])),e||(e=this.record.displayTitle||n.Utils.escapeHtml(this.record.title)),e},e.prototype.click=function(){var e=this.hasLinkBehaviour&&!!this.documentUrl;return e&&this.searchService.notifyOpenOriginalDocument(this.record),this.titleClicked.emit(e),e},e}();function E(e,n){1&e&&(t.ɵɵelementStart(0,"span"),t.ɵɵtext(1," › "),t.ɵɵelementEnd())}function L(e,n){if(1&e){var i=t.ɵɵgetCurrentView();t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,E,2,0,"span",2),t.ɵɵelementStart(2,"span",4),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(i);var e=n.$implicit;return t.ɵɵnextContext().select(e)})),t.ɵɵtext(3),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()}if(2&e){var r=n.$implicit,s=n.index;t.ɵɵadvance(1),t.ɵɵproperty("ngIf",s>0),t.ɵɵadvance(2),t.ɵɵtextInterpolate(r.display)}}function T(e,n){1&e&&(t.ɵɵelementStart(0,"span"),t.ɵɵtext(1," - "),t.ɵɵelementEnd())}function R(e,n){if(1&e&&(t.ɵɵelementStart(0,"a",5),t.ɵɵtext(1),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext();t.ɵɵpropertyInterpolate("href",i.url,t.ɵɵsanitizeUrl),t.ɵɵadvance(1),t.ɵɵtextInterpolate(i.url)}}O.ɵfac=function(e){return new(e||O)(t.ɵɵdirectiveInject(c.SearchService),t.ɵɵdirectiveInject(p.AppService))},O.ɵcmp=t.ɵɵdefineComponent({type:O,selectors:[["sq-result-title"]],inputs:{record:"record",titleLinkBehavior:"titleLinkBehavior",field:"field",originalDocTarget:"originalDocTarget"},outputs:{titleClicked:"titleClicked"},features:[t.ɵɵNgOnChangesFeature],decls:2,vars:2,consts:[["class","sq-result-title",3,"title","innerHTML",4,"ngIf"],["class","sq-result-title",3,"title","href","target","innerHTML","click",4,"ngIf"],[1,"sq-result-title",3,"title","innerHTML"],[1,"sq-result-title",3,"title","href","target","innerHTML","click"]],template:function(e,n){1&e&&(t.ɵɵtemplate(0,I,1,2,"span",0),t.ɵɵtemplate(1,M,1,4,"a",1)),2&e&&(t.ɵɵproperty("ngIf",n.hasSpanBehaviour),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!n.hasSpanBehaviour))},directives:[i.NgIf],styles:["\nsq-result-title {\n    font-size: 1.25rem;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n.match-highlight {\n    font-weight: bold;\n    font-style: italic;\n}\n    "],encapsulation:2});var U=function(){function e(e){this.searchService=e,this.displayTreepathMinLevel=0,this.displayUrl=!0,this.source=[]}return e.prototype.ngOnInit=function(){if(this.displayTreepath&&this.record.treepath){var e=this.record.treepath[0];e&&e.length>=2&&(this.source=e.substr(1,e.length-2).split("/").slice(this.displayTreepathMinLevel,this.displayTreepathMaxLevel).map((function(e,t,n){return{display:e,value:"/"+n.slice(0,t+1).join("/")+"/*"}})))}this.displayUrl&&(this.url=this.record.url1)},e.prototype.select=function(e){this.searchService.addFieldSelect("treepath",e)&&this.searchService.search()},e}();function P(e,n){if(1&e){var i=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"a",1),t.ɵɵlistener("click",(function(){return t.ɵɵrestoreView(i),t.ɵɵnextContext().click()})),t.ɵɵelement(1,"img",2),t.ɵɵelementEnd()}if(2&e){var r=t.ɵɵnextContext();t.ɵɵpropertyInterpolate("href",r.href,t.ɵɵsanitizeUrl),t.ɵɵpropertyInterpolate("target",r.target),t.ɵɵadvance(1),t.ɵɵpropertyInterpolate("src",r.thumbnailUrl,t.ɵɵsanitizeUrl)}}U.ɵfac=function(e){return new(e||U)(t.ɵɵdirectiveInject(c.SearchService))},U.ɵcmp=t.ɵɵdefineComponent({type:U,selectors:[["sq-result-source"]],inputs:{record:"record",displayTreepath:"displayTreepath",displayTreepathMinLevel:"displayTreepathMinLevel",displayTreepathMaxLevel:"displayTreepathMaxLevel",displayUrl:"displayUrl"},decls:4,vars:3,consts:[[1,"sq-result-source"],[4,"ngFor","ngForOf"],[4,"ngIf"],["target","_blank",3,"href",4,"ngIf"],["title","Select this source",1,"link",3,"click"],["target","_blank",3,"href"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"span",0),t.ɵɵtemplate(1,L,4,2,"ng-container",1),t.ɵɵtemplate(2,T,2,0,"span",2),t.ɵɵtemplate(3,R,2,2,"a",3),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",n.source),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.source.length>0&&!!n.url),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.url))},directives:[i.NgForOf,i.NgIf],styles:[".sq-result-source[_ngcontent-%COMP%]{color:#006621;display:inline-block;font-size:.9rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.link[_ngcontent-%COMP%]{cursor:pointer}.link[_ngcontent-%COMP%]:hover{text-decoration:underline}a[_ngcontent-%COMP%]{color:inherit}"]});var F=function(){function e(e,n){this.appService=e,this.searchService=n,this.linkBehavior="open",this.defaultThumbnail="",this.thumbnailClicked=new t.EventEmitter}return e.prototype.ngOnChanges=function(e){e.record&&(this.documentUrl=this.record.url1,this.thumbnailColumn&&(this.thumbnailUrl=this.record[this.thumbnailColumn]),!this.thumbnailUrl&&this.record.thumbnailUrl&&(this.thumbnailUrl=this.record.thumbnailUrl),!this.thumbnailUrl&&this.defaultThumbnail&&(this.thumbnailUrl=this.defaultThumbnail),this.thumbnailUrl=this.appService.updateUrlForCors(this.thumbnailUrl))},Object.defineProperty(e.prototype,"hasLinkBehaviour",{get:function(){return"open"===this.linkBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"href",{get:function(){return this.hasLinkBehaviour&&this.documentUrl||"#"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.hasLinkBehaviour&&this.documentUrl?"_blank":"_self"},enumerable:!1,configurable:!0}),e.prototype.click=function(){var e=this.hasLinkBehaviour&&!!this.documentUrl;return e&&this.searchService.notifyOpenOriginalDocument(this.record),this.thumbnailClicked.emit(e),e},e}();function _(e,n){if(1&e&&(t.ɵɵelementStart(0,"li",4),t.ɵɵelementStart(1,"span"),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(3,1,i.caption))}}function D(e,n){if(1&e){var i=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"li",5),t.ɵɵelementStart(1,"a",6),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(i);var e=n.index;return t.ɵɵnextContext().select(e)})),t.ɵɵelement(2,"span"),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var r=n.index,s=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵpropertyInterpolate("title",s.getTitle(r)),t.ɵɵadvance(1),t.ɵɵclassMap(r<=s.userRatingIndex?"fas fa-star":"far fa-star")}}function B(e,n){if(1&e&&(t.ɵɵelementStart(0,"li",7),t.ɵɵelementStart(1,"span"),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind2(3,1,"msg#userRatings.average",i.messageParams))}}F.ɵfac=function(e){return new(e||F)(t.ɵɵdirectiveInject(p.AppService),t.ɵɵdirectiveInject(c.SearchService))},F.ɵcmp=t.ɵɵdefineComponent({type:F,selectors:[["sq-result-thumbnail"]],inputs:{record:"record",linkBehavior:"linkBehavior",thumbnailColumn:"thumbnailColumn",defaultThumbnail:"defaultThumbnail"},outputs:{thumbnailClicked:"thumbnailClicked"},features:[t.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[[3,"href","target","click",4,"ngIf"],[3,"href","target","click"],[3,"src"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,P,2,3,"a",0),2&e&&t.ɵɵproperty("ngIf",n.thumbnailUrl)},directives:[i.NgIf],encapsulation:2});var j=function(){function e(e,t){var n=this;this.userRatingService=e,this.changeDetector=t,this.handleResponse=function(e){n.userRatingIndex=e.rating,n.averageRatingIndex=e.averagerating,n.changeDetector.markForCheck()}}return e.prototype.ngOnInit=function(){this.ensureRatingValues(),this.handleResponse(this.userRatingService.getRecordRating(this.record,this.getCCRating()))},e.prototype.getCCRating=function(){return{ratingsColumn:this.ratingsColumn,averageColumn:this.averageColumn,updateDocWeight:this.updateDocWeight,ratingsDistribution:this.ratingValues}},Object.defineProperty(e.prototype,"messageParams",{get:function(){return{values:{average:this.getAverageRating()}}},enumerable:!1,configurable:!0}),e.prototype.getTitle=function(e){return this.titles&&this.titles.split(";")[e]||""},e.prototype.getRating=function(e){return this.ratingValues[e]},e.prototype.getAverageRating=function(){return this.averageRatingIndex<0?"":this.ratingValues[this.averageRatingIndex]},e.prototype.select=function(e){this.userRatingIndex===e?this.userRatingService.deleteRating(this.record,this.getCCRating()).subscribe(this.handleResponse):this.userRatingService.setRating(this.record,e,this.getCCRating()).subscribe(this.handleResponse)},e.prototype.ensureRatingValues=function(){if(!this.ratingValues){var e=this.count||0;if(this.values){this.ratingValues=this.values.split(";");for(var t=this.ratingValues.length;t<e;t++)this.ratingValues.push((t+1).toString())}else this.ratingValues=Array(e).fill(0).map((function(e,t){return(t+1).toString()}))}},e}();function V(e,n){if(1&e){var i=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"div",9),t.ɵɵelementStart(1,"a",10),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(i);var e=t.ɵɵnextContext().$implicit;return t.ɵɵnextContext(2).click(e)})),t.ɵɵelement(2,"img",11),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var r=t.ɵɵnextContext().$implicit;t.ɵɵadvance(1),t.ɵɵpropertyInterpolate("href",r.url,t.ɵɵsanitizeUrl),t.ɵɵadvance(1),t.ɵɵpropertyInterpolate("src",r.thumbnail,t.ɵɵsanitizeUrl)}}function z(e,n){if(1&e&&(t.ɵɵelementStart(0,"div",12),t.ɵɵtext(1),t.ɵɵpipe(2,"sqMessage"),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext().$implicit;t.ɵɵadvance(1),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(2,1,i.summary))}}function N(e,n){if(1&e){var i=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"li",3),t.ɵɵelementStart(1,"div",4),t.ɵɵtemplate(2,V,3,2,"div",5),t.ɵɵelementStart(3,"div",6),t.ɵɵelementStart(4,"a",7),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(i);var e=n.$implicit;return t.ɵɵnextContext(2).click(e)})),t.ɵɵpipe(5,"sqMessage"),t.ɵɵtext(6),t.ɵɵpipe(7,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵtemplate(8,z,3,3,"div",8),t.ɵɵelementEnd(),t.ɵɵelementEnd(),t.ɵɵelementEnd()}if(2&e){var r=n.$implicit;t.ɵɵadvance(2),t.ɵɵproperty("ngIf",r.thumbnail),t.ɵɵadvance(2),t.ɵɵpropertyInterpolate("href",r.url,t.ɵɵsanitizeUrl),t.ɵɵpropertyInterpolate("title",t.ɵɵpipeBind1(5,5,r.title)),t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(7,7,r.title)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",r.summary)}}function H(e,n){if(1&e&&(t.ɵɵelementStart(0,"ul",1),t.ɵɵtemplate(1,N,9,9,"li",2),t.ɵɵelementEnd()),2&e){var i=t.ɵɵnextContext();t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",i.sponsoredlinks)}}j.ɵfac=function(e){return new(e||j)(t.ɵɵdirectiveInject(u.UserRatingsWebService),t.ɵɵdirectiveInject(t.ChangeDetectorRef))},j.ɵcmp=t.ɵɵdefineComponent({type:j,selectors:[["sq-user-rating"]],inputs:{record:"record",ratingsColumn:"ratingsColumn",averageColumn:"averageColumn",updateDocWeight:"updateDocWeight",count:"count",values:"values",titles:"titles",caption:"caption",showAverage:"showAverage"},decls:4,vars:3,consts:[[1,"sq-user-rating-stars"],["class","sq-user-rating-caption",4,"ngIf"],["class","sq-user-rating-item",4,"ngFor","ngForOf"],["class","sq-user-rating-average",4,"ngIf"],[1,"sq-user-rating-caption"],[1,"sq-user-rating-item"],["href","javascript:void(0)",1,"sq-user-rating-star",3,"title","click"],[1,"sq-user-rating-average"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"ul",0),t.ɵɵtemplate(1,_,4,3,"li",1),t.ɵɵtemplate(2,D,3,4,"li",2),t.ɵɵtemplate(3,B,4,4,"li",3),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.caption),t.ɵɵadvance(1),t.ɵɵproperty("ngForOf",n.ratingValues),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.showAverage&&void 0!==n.getAverageRating()&&""!==n.getAverageRating()))},directives:[i.NgIf,i.NgForOf],pipes:[a.MessagePipe],styles:[".sq-user-rating-stars[_ngcontent-%COMP%]{list-style-type:none;padding:0}.sq-user-rating-item[_ngcontent-%COMP%]{display:inline}.sq-user-rating-star[_ngcontent-%COMP%]{text-decoration:none}.sq-user-rating-caption[_ngcontent-%COMP%]{display:inline;font-size:.875rem;margin-right:4px}.sq-user-rating-average[_ngcontent-%COMP%]{display:inline;font-size:.875rem;margin-left:4px}"]});var A=function(){function e(e,t,n,i,r){this.appService=e,this.searchService=t,this.sponsoredResultsService=n,this.auditService=i,this.changeDetectorRef=r}return e.prototype.updateSponsoredLinksIfNecessary=function(e){var t=this;if(this.appService.app){var i=!1,r=this.getWebService();n.Utils.eqNC(this.webService,r)||(this.webService=r,i=!0),i||n.Utils.eqNC(this.lastText,e)||(this.lastText=e,i=!0),i||this.currentPage===this.searchService.query.page||(this.currentPage=this.searchService.query.page,i=!0),i&&(n.Utils.isEmpty(this.webService)||n.Utils.isEmpty(e)?this.sponsoredlinks=[]:(this.linksQuery.text=e,this.linksQuery.page=this.currentPage,n.Utils.subscribe(this.sponsoredResultsService.getLinks(this.linksQuery,this.webService),(function(e){t.sponsoredlinks=e.links,t.auditLinksDisplay(),t.changeDetectorRef.markForCheck()}),(function(e){return console.log("Could not retrieve sponsored links: "+e+".")}))))}},e.prototype.getWebService=function(){return this.appService.app&&this.appService.app.sponsoredLinks||""},e.prototype.ngOnChanges=function(e){this.initDone||this.initialize(),(e.query||e.results)&&this.updateSponsoredLinksIfNecessary(n.Utils.trim(this.query.text||""))},e.prototype.initialize=function(){this.initDone||this.appService.ccquery&&(this.linksQuery=new p.Query(this.appService.ccquery.name),this.initDone=!0)},e.prototype.ngOnInit=function(){this.initialize()},e.prototype.auditLinksDisplay=function(){var e=this;if(this.sponsoredlinks&&this.sponsoredlinks.length>0){var t=[];this.sponsoredlinks.forEach((function(n){t.push({type:"Link_Display",detail:{resultid:e.searchService.results&&e.searchService.results.id,linkid:n.id,rank:n.rank,title:n.title,url:n.url}})})),this.auditService.notify(t)}},e.prototype.click=function(e){this.auditService.notifySponsoredLink("Link_Click",e,this.searchService.results&&this.searchService.results.id||"")},e}();A.ɵfac=function(e){return new(e||A)(t.ɵɵdirectiveInject(p.AppService),t.ɵɵdirectiveInject(c.SearchService),t.ɵɵdirectiveInject(u.SponsoredLinksWebService),t.ɵɵdirectiveInject(u.AuditWebService),t.ɵɵdirectiveInject(t.ChangeDetectorRef))},A.ɵcmp=t.ɵɵdefineComponent({type:A,selectors:[["sq-sponsored-results"]],inputs:{query:"query"},features:[t.ɵɵNgOnChangesFeature],decls:1,vars:1,consts:[["class","sq-sponsored-links-list",4,"ngIf"],[1,"sq-sponsored-links-list"],["class","sponsored-item",4,"ngFor","ngForOf"],[1,"sponsored-item"],[1,"sq-sponsored-link-view"],["class","sq-sponsored-link-view-thumbnail",4,"ngIf"],[1,"sq-sponsored-link-view-info"],["target","_blank",3,"href","title","click"],["class","sq-sponsored-link-view-summary",4,"ngIf"],[1,"sq-sponsored-link-view-thumbnail"],["target","_blank",3,"href","click"],[3,"src"],[1,"sq-sponsored-link-view-summary"]],template:function(e,n){1&e&&t.ɵɵtemplate(0,H,2,1,"ul",0),2&e&&t.ɵɵproperty("ngIf",!!n.sponsoredlinks)},directives:[i.NgIf,i.NgForOf],pipes:[a.MessagePipe],styles:[".sq-sponsored-links-list[_ngcontent-%COMP%]{list-style:none;padding:0}.sq-sponsored-links-list[_ngcontent-%COMP%] > .sponsored-item[_ngcontent-%COMP%]{overflow:hidden;overflow-wrap:break-word;text-overflow:ellipsis;word-break:break-word;word-wrap:break-word}.sq-sponsored-link-view[_ngcontent-%COMP%]{align-items:center;display:flex}.sq-sponsored-link-view[_ngcontent-%COMP%]   .sq-sponsored-link-view-info[_ngcontent-%COMP%]{flex:1;min-width:0}.sq-sponsored-link-view[_ngcontent-%COMP%]   .sq-sponsored-link-view-info[_ngcontent-%COMP%]   .sq-sponsored-link-view-summary[_ngcontent-%COMP%], .sq-sponsored-link-view[_ngcontent-%COMP%]   .sq-sponsored-link-view-info[_ngcontent-%COMP%]   .sq-sponsored-link-view-title[_ngcontent-%COMP%]{min-width:0}.sq-sponsored-link-view[_ngcontent-%COMP%]   .sq-sponsored-link-view-thumbnail[_ngcontent-%COMP%]{margin-right:1em}.sq-sponsored-link-view[_ngcontent-%COMP%]   .sq-sponsored-link-view-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:7rem;max-width:5rem}"]});var W=function(e){return{count:e}},$=function(e){return{values:e}},Q=function(){};Q.ɵfac=function(e){return new(e||Q)},Q.ɵcmp=t.ɵɵdefineComponent({type:Q,selectors:[["sq-results-counter"]],inputs:{rowCount:"rowCount"},decls:3,vars:8,consts:[[1,"sq-results-count"]],template:function(e,n){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵtext(1),t.ɵɵpipe(2,"sqMessage"),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵtextInterpolate(t.ɵɵpipeBind2(2,1,"msg#results.resultsCount",t.ɵɵpureFunction1(6,$,t.ɵɵpureFunction1(4,W,n.rowCount)))))},pipes:[a.MessagePipe],encapsulation:2});var J=function(){};J.ɵmod=t.ɵɵdefineNgModule({type:J}),J.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||J)},imports:[[i.CommonModule,o.FormsModule,o.ReactiveFormsModule,a.IntlModule,s.UtilsModule,r.CollapseModule,l.MetadataModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(J,{declarations:[O,C,w,F,j,A,Q,q,U],imports:[i.CommonModule,o.FormsModule,o.ReactiveFormsModule,a.IntlModule,s.UtilsModule,r.CollapseModule,l.MetadataModule],exports:[O,C,w,F,j,A,Q,q,U]});var G=n.Utils.merge({},{results:{missingTerms:"Missing terms:",resultsCount:"{count, plural, =0 {no results} one {# result} other {# results}}"},userRatings:{average:"Average: {average}"}},c.enSearch,l.enMetadata,r.enCollapse),K=n.Utils.merge({},{results:{missingTerms:"Termes manquants :",resultsCount:"{count, plural, =0 {aucune réponse} one {# réponse} other {# réponses}}"},userRatings:{average:"Moyenne : {average}"}},c.frSearch,l.frMetadata,r.frCollapse),X=n.Utils.merge({},{results:{missingTerms:"fehlende Begriffe:",resultsCount:"{count, plural, =0 {keine Ergebnisse} one {# Ergebnis} other {# Ergebnisse}}"},userRatings:{average:"Durchschnittlich: {average}"}},c.deSearch,l.deMetadata,r.deCollapse);e.ResultExtracts=C,e.ResultIcon=q,e.ResultMissingTerms=w,e.ResultModule=J,e.ResultSource=U,e.ResultThumbnail=F,e.ResultTitle=O,e.ResultsCounter=Q,e.SponsoredResults=A,e.UserRating=j,e.deResult=X,e.enResult=G,e.frResult=K,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-components-result.umd.min.js.map