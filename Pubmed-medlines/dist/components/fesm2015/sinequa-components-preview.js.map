{"version":3,"file":"sinequa-components-preview.js","sources":["../../../projects/components/preview/preview-document.ts","../../../projects/components/preview/preview-document-iframe.component.ts","../../../projects/components/preview/preview-tooltip.component.html","../../../projects/components/preview/preview-tooltip.component.ts","../../../projects/components/preview/preview.service.ts","../../../projects/components/preview/preview.module.ts","../projects/components/preview/bootstrap/facet-preview/facet-preview.html","../projects/components/preview/bootstrap/facet-preview/facet-preview.ts","../projects/components/preview/bootstrap/facet-preview-2/facet-preview.component.html","../projects/components/preview/bootstrap/facet-preview-2/facet-preview.component.ts","../projects/components/preview/bootstrap/preview-highlights/preview-highlights.html","../projects/components/preview/bootstrap/preview-highlights/preview-highlights.ts","../projects/components/preview/bootstrap/preview-links/preview-links.html","../projects/components/preview/bootstrap/preview-links/preview-links.ts","../projects/components/preview/bootstrap/similar-documents/similar-documents.html","../projects/components/preview/bootstrap/similar-documents/similar-documents.ts","../projects/components/preview/bootstrap/preview-panel/preview-panel.html","../projects/components/preview/bootstrap/preview-panel/preview-panel.ts","../projects/components/preview/bootstrap/preview-popup/preview-popup.html","../projects/components/preview/bootstrap/preview-popup/preview-popup.ts","../projects/components/preview/bootstrap/result-link-preview/result-link-preview.html","../projects/components/preview/bootstrap/result-link-preview/result-link-preview.ts","../projects/components/preview/bootstrap/preview-entity-facet/preview-entity-facet.component.html","../projects/components/preview/bootstrap/preview-entity-facet/preview-entity-facet.component.ts","../projects/components/preview/bootstrap/preview-entity-panel/preview-entity-panel.component.html","../projects/components/preview/bootstrap/preview-entity-panel/preview-entity-panel.component.ts","../projects/components/preview/bootstrap/preview-extracts-panel/preview-extracts-panel.component.html","../projects/components/preview/bootstrap/preview-extracts-panel/preview-extracts-panel.component.ts","../projects/components/preview/bootstrap/preview-search-form/preview-search-form.component.ts","../projects/components/preview/bootstrap/preview-search-form/preview-search-form.component.html","../projects/components/preview/bootstrap/preview-pages-panel/preview-pages-panel.component.html","../projects/components/preview/bootstrap/preview-pages-panel/preview-pages-panel.component.ts","../projects/components/preview/bootstrap/preview-page-form/preview-page-form.component.html","../projects/components/preview/bootstrap/preview-page-form/preview-page-form.component.ts","../../projects/components/preview/bootstrap/preview.module.ts","../../projects/components/preview/messages/en.ts","../../projects/components/preview/messages/fr.ts","../../projects/components/preview/messages/de.ts","../../projects/components/preview/messages/index.ts","../../../projects/components/preview/sinequa-components-preview.ts"],"sourcesContent":["import { ElementRef } from \"@angular/core\";\n\nimport { Utils } from \"@sinequa/core/base\";\n\nexport enum HighlightCategoryFilterChoice {\n    All, None, Value\n}\n\nexport interface HighlightCategoryFilterState {\n    choice: HighlightCategoryFilterChoice;\n    filterValue: string;\n}\n\nexport type HighlightFilters = { [key: string]: HighlightCategoryFilterState } | string[];\n\n// forEach on a NodeList is polyfilled for IE but not at all necessarily when the list comes from a document\n// in another frame. This function is used to perform the forEach taking this into account.\nfunction forEach<T extends Node>(nodeList: NodeListOf<T>, callbackfn: (value: T, key: number, parent: NodeListOf<T> | T[]) => void): void {\n    if (!nodeList.forEach) {\n        Array.from(nodeList).forEach(callbackfn);\n    }\n    else {\n        nodeList.forEach(callbackfn);\n    }\n}\n\n/**\n * This class offers an API to manipulate the HTML of a preview document.\n * - Insert elements dynamically in the DOM of the preview (eg. tooltips)\n * - Retrieve the text of entities or extracts\n * - Select the elements of entities or extracts (by altering their CSS classes)\n * - Highlight (or not) specific entities or categories in the HTML (by altering their CSS classes)\n */\nexport class PreviewDocument {\n\n    private static readonly SELECTED_HIGHLIGHT_CLASS: string = \"sq-current\";\n    private static readonly SELECTED_HIGHLIGHT_FIRST_FRAGMENT_CLASS: string = \"sq-first\";\n    private static readonly SELECTED_HIGHLIGHT_LAST_FRAGMENT_CLASS: string = \"sq-last\";\n    private static readonly FILTERED_OUT_HIGHLIGHT_CLASS: string = \"sq-inactive\";\n    private static readonly SVG_LINE_CLASS: string = \"sq-svg\";\n\n    private static readonly BASIC_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE = \"data-entity-basic\";\n    private static readonly ADVANCED_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE = \"data-entity-display\";\n\n    private readonly _window: Window;\n    private readonly _document: Document;\n    \n    private previousElement: HTMLElement | null;\n    \n    constructor(element: ElementRef | Document){\n        if (element instanceof ElementRef) {\n            this._window = element?.nativeElement?.contentWindow;\n            if (this._window?.frames && this._window.frames[\"frSheet\"]) {\n                this._window = this._window.frames[\"frSheet\"];  // aspose xls preview\n            }\n        } else {\n            this._document = element;\n        }\n    }\n\n\n    // PUBLIC METHODS\n\n    /**\n     * Return the Window of the iframe containing the element\n     */\n    public getContentWindow(): Window {\n        return this._window;\n    }\n\n    /**\n     * Returns the root Document element of the HTML Preview\n     */\n    public get document(): Document {\n        return this._document || this._window.document;\n    }\n\n    /**\n     * Insert a given DOM Element in the body of the document preview\n     * @param component\n     */\n    public insertComponent(component){\n        this.document.body.appendChild(component);\n    }\n\n    /**\n     * Returns the text of a given entity\n     * @param categoryId Category of the entity\n     * @param index Index of the entity in that category\n     */\n    public getHighlightText(categoryId: string, index: number) : string {\n        if (index < 0) {\n            return \"\";\n        }\n        const nodes = this.document.querySelectorAll(\"#\"+categoryId + \"_\" + index);\n        if (!nodes || nodes.length === 0) {\n            return \"\";\n        }\n        let text = \"\";\n        forEach(nodes, n => text += (n['innerHTML'] || n.textContent));\n        return text;\n    }\n\n    /**\n     * Update the location of the entities' SVG background (for some converters)\n     */\n    public setSvgBackgroundPositionAndSize(): void {\n        const svgList: NodeListOf<Element> = this.document.querySelectorAll(\"svg\");\n        if (svgList != null) {\n            for (let i = 0, ic = svgList.length; i < ic; i++) {\n                const svg = svgList.item(i);\n                const tspanList: HTMLCollectionOf<SVGTSpanElement> = svg.getElementsByTagName(\"tspan\");\n                if (tspanList != null) {\n                    for (let j = 0, jc = tspanList.length; j < jc; j++) {\n                        const tspan = tspanList.item(j);\n                        if (tspan) {\n                            const bgId = tspan.getAttribute(\"data-entity-background\");\n                            if (bgId) {\n                                const rect = this.getFirst(this.getDocElements(bgId));\n                                if (rect) {\n                                    this.resizeSvgBackground(rect, tspan);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Select a specific entity by applying specific highlight classes\n     * to the DOM elements and scrolling the view to center around them.\n     * @param categoryId Category of the entity\n     * @param index Index of the entity in that category\n     */\n    public selectHighlight(categoryId: string, index: number) : void {\n        \n        this.clearHighlightSelection();\n        // current element becomes previous element\n        this.previousElement = this.document.getElementById(categoryId + '_' + index);\n        \n        if (this.previousElement) {\n            // highlight new selected element\n            this.setHighlightSelection(this.previousElement,true, true);\n            this.previousElement.scrollIntoView({block: 'center'});\n        }\n    }\n\n    /**\n     * Removes all entity selection classes from the document HTML elements\n     */\n    public clearHighlightSelection(): void {\n        // Clear HTML elements borders\n        if (this.previousElement) {\n            this.previousElement.classList.remove(PreviewDocument.SELECTED_HIGHLIGHT_CLASS);\n        }\n        // Clear SVG elements borders\n        const elements: NodeListOf<Element> = this.document.querySelectorAll(\"line.sq-svg\");\n        for (let i = 0; i < elements.length; i++) {\n            const parentNode = elements[i].parentNode;\n            if (parentNode) {\n                parentNode.removeChild(elements[i]);\n            }\n        }\n    }\n\n    /**\n     * Turns highlights on or off based on the provided filter object. Additionally clears the selected entity\n     * @param filters object where each key provides a filter for each category of entity/highlight\n     */\n    public filterHighlights(filters: HighlightFilters){\n\n        this.updateHighlightFilterState(filters);\n        this.clearHighlightSelection();\n    }\n\n    /**\n     * Loop through every highlighted element in the document and turn highlights on or off based on the filters object.\n     * If the filters object is an array then only the specified categories are highlighted.\n     * @param filters object where each key provides a filter for each category of entity/highlight\n     */\n    public updateHighlightFilterState(filters: HighlightFilters): void {\n        const elements = this.document.querySelectorAll(\"[data-entity-display], .extractslocations, .matchlocations\");\n        if (Utils.isArray(filters)) {\n            forEach<Element>(elements, element => {\n                const highlight = filters.some(category => element.classList.contains(category));\n                if (highlight) {\n                    element.classList.remove(PreviewDocument.FILTERED_OUT_HIGHLIGHT_CLASS);\n                }\n                else {\n                    element.classList.add(PreviewDocument.FILTERED_OUT_HIGHLIGHT_CLASS);\n                }\n            });\n        }\n        else {\n            forEach(elements, element => {\n                if (PreviewDocument.elementIsFilteredOut(element, filters)) {\n                    element.classList.add(PreviewDocument.FILTERED_OUT_HIGHLIGHT_CLASS);\n                }\n                else {\n                    element.classList.remove(PreviewDocument.FILTERED_OUT_HIGHLIGHT_CLASS);\n                }\n            });\n        }\n    }\n\n    /**\n     * Turns on/off the highlights of one category of entities or a specific value if provided\n     * @param category e.g. person\n     * @param on true for highlighting / false for turning off\n     * @param value e.g. \"BILL GATES\"\n     */\n    public toggleHighlight(category: string, on: boolean, value?: string) {\n        const elements = this.document.querySelectorAll(\".\"+category);\n        forEach(elements, element => {\n            if(!value\n                || (element.hasAttribute(PreviewDocument.BASIC_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE) && value === element.getAttribute(PreviewDocument.BASIC_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE))\n                || (element.hasAttribute(PreviewDocument.ADVANCED_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE) && value === element.getAttribute(PreviewDocument.ADVANCED_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE))) {\n\n                if(on){\n                    element.classList.remove(PreviewDocument.FILTERED_OUT_HIGHLIGHT_CLASS);\n                }\n                else{\n                    element.classList.add(PreviewDocument.FILTERED_OUT_HIGHLIGHT_CLASS);\n                }\n            }\n        });\n    }\n\n    // PRIVATE METHODS\n\n    private setHighlightSelection(elt: Element, isFirst: boolean, isLast: boolean): void {\n        if (this.isSvgElement(elt)) {\n            this.setHighlightSelectionSVG(elt, isFirst, isLast);\n        }\n        else {\n            this.setHighlightSelectionHTML(elt, isFirst, isLast);\n        }\n    }\n\n    private setHighlightSelectionHTML(elt: Element, isFirst: boolean, isLast: boolean): void {\n        elt.classList.add(PreviewDocument.SELECTED_HIGHLIGHT_CLASS);\n        if (isFirst) {\n            elt.classList.add(PreviewDocument.SELECTED_HIGHLIGHT_FIRST_FRAGMENT_CLASS);\n        }\n        if (isLast) {\n            elt.classList.add(PreviewDocument.SELECTED_HIGHLIGHT_LAST_FRAGMENT_CLASS);\n        }\n    }\n\n    private setHighlightSelectionSVG(elt: Element, isFirst: boolean, isLast: boolean): void {\n        const bgId = elt.getAttribute(\"data-entity-background\");\n        if (!bgId) return;\n        const rect: SVGRectElement = <SVGRectElement>this.getFirst(this.getDocElements(bgId));\n        const group = rect.parentNode;\n        const rectPosition = rect.getBBox();\n\n        if (group) {\n            const top = rectPosition.y;\n            const bottom = rectPosition.y + rectPosition.height;\n            const left = rectPosition.x;\n            const right = rectPosition.x + rectPosition.width;\n            const valueTransform = rect.getAttribute(\"transform\");\n            this.addSvgLine(group, left, top   , right, top   , valueTransform);\n            this.addSvgLine(group, left, bottom, right, bottom, valueTransform);\n            if (isFirst) this.addSvgLine(group, left , top, left , bottom, valueTransform);\n            if (isLast)  this.addSvgLine(group, right, top, right, bottom, valueTransform);\n        }\n    }\n\n    private addSvgLine(group: Node, x1: number, y1: number, x2: number, y2: number, transform: string | null): void {\n        const line: Element = this.document.createElementNS(\"http://www.w3.org/2000/svg\",\"line\");\n        line.setAttribute(\"class\", PreviewDocument.SVG_LINE_CLASS);\n        line.setAttribute(\"x1\", String(x1));\n        line.setAttribute(\"y1\", String(y1));\n        line.setAttribute(\"x2\", String(x2));\n        line.setAttribute(\"y2\", String(y2));\n        if (transform) line.setAttribute(\"transform\", transform);\n        group.appendChild(line);\n    }\n\n\n    private resizeSvgBackground(rect: Element, tspan: SVGTSpanElement): void {\n        let elt: Element = tspan;\n        while (elt.tagName !== \"text\") {\n            elt = elt.parentNode as Element;\n            if (elt == null) break;\n        }\n        const text: SVGTextElement = elt as SVGTextElement;\n        const textBoxPixel: ClientRect = text.getBoundingClientRect();\n        const textBoxSVG: SVGRect = text.getBBox();\n        if (textBoxPixel.height === 0 || textBoxPixel.width === 0) return;\n        const scaleX = textBoxSVG.width / textBoxPixel.width;\n        const scaleY = textBoxSVG.height / textBoxPixel.height;\n        const deltaX = 2 * scaleX;\n        const deltaY = 2 * scaleY;\n\n        const firstCharRect = tspan.getExtentOfChar(0);\n        const tspanWidth = tspan.getComputedTextLength();\n\n        rect.setAttribute(\"x\", String(firstCharRect.x - deltaX));\n        rect.setAttribute(\"y\", String(firstCharRect.y - deltaY));\n        rect.setAttribute(\"width\", String(tspanWidth + 2 * deltaX));\n        rect.setAttribute(\"height\", String(textBoxSVG.height + 2 * deltaY));\n        const valueTransform = text.getAttribute(\"transform\");\n        if (valueTransform) rect.setAttribute(\"transform\", valueTransform);\n    }\n\n    private getDocElements(id: string): Array<Element> {\n        const list = Array<Element>();\n        // Get HTML elements directly by id\n        const eltList: NodeListOf<Element> = this.document.querySelectorAll(\"#\" + id);\n        for (let i = 0; i < eltList.length; i++) {\n            list.push(eltList[i]);\n        }\n        // Get SVG tspan iterating on them (jquery querySelectorAll didn't return SVG inner elements)\n        const svgList: NodeListOf<Element> = this.document.querySelectorAll(\"svg\");\n        if (svgList != null) {\n            for (let i = 0, ic = svgList.length; i < ic; i++) {\n                const svg = svgList.item(i);\n                const tspanList: HTMLCollectionOf<SVGTSpanElement> = svg.getElementsByTagName(\"tspan\");\n                if (tspanList != null) {\n                    for (let j = 0, jc = tspanList.length; j < jc; j++) {\n                        const tspan = tspanList.item(j);\n                        if (tspan) {\n                            if (tspan.id === id) list.push(tspan);\n                        }\n                    }\n                }\n            }\n        }\n        return list;\n    }\n\n    private getFirst(nodes: Array<Element>): Element | null {\n        return (nodes != null && nodes.length > 0) ? nodes[0] : null;\n    }\n\n    private isSvgElement(elt: Element): boolean {\n        if (elt == null) return false;\n        return \"viewportElement\" in <any>elt;\n    }\n\n\n\n    // PRIVATE STATIC (from highlight helper)\n\n\n    private static elementIsFilteredOut(element: Element, filters: {[key: string]: HighlightCategoryFilterState}): boolean {\n        const elementClass: string = this.getElementCategory(element, Object.keys(filters));\n        if (elementClass == null) {\n            return false;\n        }\n        const filterState = filters[elementClass];\n        if (filterState == null) {\n            return false;\n        }\n        if (filterState.choice === HighlightCategoryFilterChoice.None) {\n            return true;\n        }\n        if (filterState.choice === HighlightCategoryFilterChoice.All) {\n            return false;\n        }\n        if (element.hasAttribute(PreviewDocument.BASIC_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE)) {\n            return filterState.filterValue !== element.getAttribute(PreviewDocument.BASIC_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE);\n        }\n        return filterState.filterValue !== element.getAttribute(PreviewDocument.ADVANCED_ENTITY_DISPLAY_ELEMENT_ATTRIBUTE);\n    }\n\n    private static getElementCategory(element: Element, categoryIds: string[]): string {\n        for (const categoryId of categoryIds) {\n            if (element.classList.contains(categoryId)) {\n                return categoryId;\n            }\n        }\n        return \"\";\n    }\n}\n","import { Component, Input, Output, ViewChild, ElementRef, EventEmitter, ContentChild, OnChanges, SimpleChanges, AfterViewInit, ChangeDetectorRef, OnInit, OnDestroy, ChangeDetectionStrategy } from \"@angular/core\";\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Utils } from \"@sinequa/core/base\";\nimport { PreviewDocument } from \"./preview-document\";\n\n\n/**\n * This component manages the iframe containing the document's preview.\n * The main input is the URL of the document's preview.\n * The main output is an event emitter providing an instance of PreviewDocument.\n *\n * PreviewDocument is a wrapper around the HTML Document, allowing to interact with\n * the HTML of the preview (for example to highlight some entities)\n *\n * It is possible to insert a tooltip in the preview via transclusion.\n * Example:\n    <sq-preview-document-iframe\n        [downloadUrl]=\"downloadUrl\"\n        (onPreviewReady)=\"onPreviewReady($event)\">\n        <sq-preview-tooltip #tooltip\n            [previewDocument]=\"previewDocument\"\n            [previewData]=\"previewDocument\">\n        </sq-preview-tooltip>\n    </sq-preview-document-iframe>\n */\n@Component({\n    selector: \"sq-preview-document-iframe\",\n    template: `\n                <iframe #documentFrame\n                    [attr.sandbox]=\"_sandbox\"\n                    [src]=\"sanitizedUrlSrc\"\n                    [style.--factor]=\"scalingFactor\"\n                    [ngStyle]=\"{'-ms-zoom': scalingFactor, '-moz-transform': 'scale(var(--factor))', '-o-transform': 'scale(var(--factor))', '-webkit-transform': 'scale(var(--factor))'}\">\n                </iframe>`,\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    styles: [`\n:host{\n    flex: 1;\n}\n\n\niframe {\n    background-color: white;\n    flex: 1;\n    position: relative;\n    display: block;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    height: calc(100% / var(--factor));\n    width: calc(100% / var(--factor));\n    border: 0;\n\n    -moz-transform-origin: 0 0;\n    -o-transform-origin: 0 0;\n    -webkit-transform-origin: 0 0;\n}\n\n.spinner-grow {\n    width: 3rem;\n    height: 3rem\n}\n    `]\n})\nexport class PreviewDocumentIframe implements OnChanges, OnInit, OnDestroy, AfterViewInit {\n    defaultSandbox: string = \"allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts\";\n    @Input() sandbox: string | null | undefined;\n    @Input() downloadUrl: string;\n    @Input() scalingFactor: number = 1.0;\n    @Output() onPreviewReady = new EventEmitter<PreviewDocument>();\n    \n    // page could change when location.href change or when user click on a tab (sheet case)\n    // when URL a string is sent otherwise a PreviewDocument\n    @Output() pageChange = new EventEmitter<string | PreviewDocument>();\n    @ViewChild('documentFrame', {static: true}) documentFrame: ElementRef;  // Reference to the preview HTML in the iframe\n    @ContentChild('tooltip', {read: ElementRef, static: false}) tooltip: ElementRef; // see https://stackoverflow.com/questions/45343810/how-to-access-the-nativeelement-of-a-component-in-angular4\n\n    public sanitizedUrlSrc: SafeResourceUrl;\n    // Must be undefined by default, because if a default value is set, \n    // if we set it to undefined in the future, this new (undefined) value \n    // is not used by the iFrame as if it used the previous value\n    public _sandbox: string | null | undefined;\n    \n    private previewDocument: PreviewDocument;\n    readonly previewDocLoadHandler;\n\n    constructor(\n        private cdr: ChangeDetectorRef,\n        private sanitizer: DomSanitizer) {\n            this.previewDocLoadHandler = this.onPreviewDocLoad.bind(this);\n    }\n\n    public onPreviewDocLoad() {\n        \n        if(this.downloadUrl === undefined) return;\n        // previewDocument must be created here when document is fully loaded\n        // because in case of sheet, PreviewDocument constructor change.\n        this.previewDocument = new PreviewDocument(this.documentFrame);\n        \n        // SVG highlight:\n        //   background rectangle (highlight) were added to the SVG by the HTML generator (C#), but html generation is\n        //   not able to know the geometry of the text. It is up to the browser to compute the position and size of the\n        //   background. That needs to be done now that the iFrame is loaded.\n        try {\n            this.previewDocument.setSvgBackgroundPositionAndSize();\n        } catch (error) {\n            console.error(error);\n        }\n\n        /* To catch tab's sheet changes\n         * Sheet structure:\n         * <iframe #preview>\n         *      #document\n         *          ...\n         *          <frameset>\n         *              <iframe name=\"frSheet\"> // current sheet displayed\n         *              <iframe name=\"frTabs\">  // contains all sheet's tabs\n         *          </frameset>\n         *          ...\n         * </iframe>\n         */ \n        const sheetFrame = this.documentFrame.nativeElement.contentDocument.getElementsByName(\"frSheet\");\n        if(sheetFrame.length > 0) {\n            sheetFrame[0].removeEventListener(\"load\", () => {});\n            sheetFrame[0].addEventListener(\"load\", () => {\n                this.previewDocument = new PreviewDocument(this.documentFrame);\n                this.pageChange.next(this.previewDocument);\n                this.cdr.markForCheck();\n            }, true);\n        }\n\n        if (this.tooltip)\n            this.addTooltip(this.previewDocument);\n\n        // Let upstream component know document is now ready\n        this.onPreviewReady.next(this.previewDocument);\n        this.cdr.markForCheck();\n    }\n\n    addTooltip(previewDocument: PreviewDocument) {\n        previewDocument.insertComponent(this.tooltip.nativeElement);\n    }\n\n    ngOnInit() {\n        this.documentFrame.nativeElement.addEventListener(\"load\", this.previewDocLoadHandler, true);\n    }\n\n    ngOnDestroy() {\n        this.documentFrame.nativeElement.removeEventListener(\"load\", this.previewDocLoadHandler);\n    }\n\n    ngOnChanges(simpleChanges: SimpleChanges) {\n        if (simpleChanges.scalingFactor && !simpleChanges.scalingFactor.firstChange) {\n            return;\n        }\n\n        this.resetContent();\n        if (simpleChanges.downloadUrl && simpleChanges.downloadUrl.currentValue !== undefined) {\n            // set sandbox attribute only when downloadUrl is defined, so iframe is created without sandbox attribute\n            // if sandbox is null, keep sandbox attribute to undefined\n            // otherwise put sanbox value in the sanbox attribute or default sandbox value\n            this._sandbox = (this.sandbox === null) ? undefined : Utils.isString(this.sandbox) ? this.sandbox : this.defaultSandbox;\n            this.sanitizedUrlSrc = this.sanitizer.bypassSecurityTrustResourceUrl(this.downloadUrl);\n        }\n    }\n\n    ngAfterViewInit() {\n        this.resetContent();\n        this.iframeURLChange(this.documentFrame.nativeElement, (newURL: string) => {\n            this.previewDocument = new PreviewDocument(this.documentFrame);\n            this.pageChange.next(newURL);\n        });\n    }\n\n    iframeURLChange(iframe, callback) {\n        let lastDispatched = null;\n\n        const dispatchChange = function () {\n            if (iframe.contentWindow) {\n                const newHref = iframe.contentWindow.location.href;\n                if (newHref === \"about:blank\") return;\n                if (newHref !== lastDispatched) {\n                    callback(newHref);\n                    lastDispatched = newHref;\n                }\n            }\n        };\n\n        const unloadHandler = function (e: Event) {\n            setTimeout(dispatchChange, 0);\n        };\n\n        function attachUnload() {\n            // Remove the unloadHandler in case it was already attached.\n            // Otherwise, there will be two handlers, which is unnecessary.\n            if (iframe.contentWindow) {\n                iframe.contentWindow.removeEventListener(\"unload\", unloadHandler);\n                iframe.contentWindow.addEventListener(\"unload\", unloadHandler);\n            }\n        }\n\n        iframe.addEventListener(\"load\", function () {\n\n            attachUnload();\n\n            // Just in case the change wasn't dispatched during the unload event...\n            dispatchChange();\n        });\n\n        attachUnload();\n    }\n\n    resetContent() {\n        this.sanitizedUrlSrc = this.sanitizer.bypassSecurityTrustResourceUrl('about:blank');\n    }\n}\n","<div #tooltip\n    class=\"sq-selection-tooltip\" [ngClass]=\"isBottom ? 'sq-bottom-tooltip' : 'sq-top-tooltip'\"\n    [style.--left]=\"leftPin\" [ngStyle]=\"{'visibility' : visibility, 'bottom' : bottom, 'left' : left}\"\n    [style.--factor]=\"1.0/scalingFactor\">\n\n    <ng-container *ngIf=\"entityType && !selectedText\">\n        <span class=\"display\">{{ entityDisplay }} </span> <span class=\"label\">({{ entityLabel | sqMessage }}) </span>\n        <span class=\"index\">{{ entityIdx }} </span>/<span class=\"count\"> {{ entityCount }} </span>\n        <ng-container *ngIf=\"entityNavActions\">\n            <span class=\"nav-btn previous\" (click)=\"previousEntity($event)\" [ngClass]=\"{disabled: entityIdx <= 1}\" title=\"{{ 'msg#preview.previousHighlightButtonAltText' | sqMessage }}\">❬</span>\n            <span class=\"nav-btn next\" (click)=\"nextEntity($event)\" [ngClass]=\"{disabled: entityIdx >= entityCount}\" title=\"{{ 'msg#preview.nextHighlightButtonAltText' | sqMessage }}\">❭</span>\n        </ng-container>\n        <div class=\"btn-list\">\n            <button *ngFor=\"let action of entityActions\" (click)=\"entityAction(action, $event)\" [disabled]=\"action.disabled\" [hidden]=\"action.hidden\" title=\"{{ (action.title || '') | sqMessage:{values: {type: entityType, value: entityValue, display: entityDisplay} } }}\">\n                <span *ngIf=\"action.icon\" class=\"{{action.icon}}\"></span>\n                <span *ngIf=\"action.text\">{{ action.text | sqMessage:{values: {type: entityType, value: entityValue, display: entityDisplay} } }}</span>\n                <span *ngIf=\"action.iconAfter\" class=\"{{action.iconAfter}}\"></span>\n            </button>\n        </div>\n    </ng-container>\n\n\n    <ng-container *ngIf=\"selectedText\">\n        <ng-container *ngFor=\"let action of selectedTextActions\">\n            <button (click)=\"selectedTextAction(action, $event)\" [disabled]=\"action.disabled\" [hidden]=\"action.hidden\" title=\"{{ (action.title || '') | sqMessage:{values: {text: selectedText.slice(0,50)} } }}\">\n                <span *ngIf=\"action.icon\" class=\"{{action.icon}}\"></span> <span *ngIf=\"action.text\">{{ action.text | sqMessage:{values: {text: selectedText.slice(0,50)} } }}</span> <span *ngIf=\"action.iconAfter\" class=\"{{action.iconAfter}}\"></span>\n            </button>\n        </ng-container>\n    </ng-container>\n</div>\n","import {Component, Input, OnChanges, SimpleChanges, ChangeDetectorRef, NgZone, ViewChild, ElementRef} from \"@angular/core\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport {PreviewData} from \"@sinequa/core/web-services\";\nimport {PreviewDocument} from \"./preview-document\";\nimport {Action} from \"@sinequa/components/action\";\n\n@Component({\n    selector: \"sq-preview-tooltip\",\n    templateUrl: \"./preview-tooltip.component.html\"\n})\nexport class PreviewTooltip implements OnChanges {\n\n    @Input() previewDocument: PreviewDocument;\n    @Input() previewData: PreviewData;\n    @Input() entityActions: Action[] = [];\n    @Input() entityNavActions: boolean = true;\n    @Input() selectedTextActions: Action[] = [];\n    @Input() scalingFactor = 1.0;\n    @ViewChild('tooltip', {static: false}) tooltip : ElementRef;\n\n    // Selected text mode\n    selectedText: string = \"\";\n\n    // Entity hover mode\n    entityType: string = \"\";\n    entityValue: string;\n    entityDisplay: string;\n    entityLabel: string;\n    entityCount: number;\n    entityIdx: number;\n\n    // Tooltip fixed positioning\n    bottom: string = \"0px\";\n    left: string = \"0px\";\n    leftPin; // position of the tooltip pin relative to left\n    isBottom: boolean = false;\n\n    constructor(\n        private zone: NgZone,\n        private changeDetectorRef: ChangeDetectorRef,\n        private sanitizer: DomSanitizer){\n\n        }\n\n    /**\n     * Add mouse listeners to a new preview document in order to display the tooltip\n     * in response to specific hover of click events\n     * @param changes\n     */\n    ngOnChanges(changes: SimpleChanges){\n        if(changes[\"previewDocument\"] && !!this.previewDocument){\n\n            if (typeof this.previewDocument.document.addEventListener !== undefined) {\n                this.document.addEventListener(\"mouseup\", this.handleMouseUp, false);\n                this.document.addEventListener(\"mousedown\", this.handleMouseDown, false);\n                this.document.addEventListener(\"mousemove\", this.handleMouseMove, false);\n                this.window.addEventListener(\"scroll\", this.handleScroll, false);\n            }\n\n        }\n\n        if(changes[\"scalingFactor\"] && this.previewDocument) {\n            setTimeout(() => this.handleMouseUp());\n        }\n    }\n\n    /**\n     * Shortcut to the preview document\n     */\n    private get document(): Document{\n        return this.previewDocument.document;\n    }\n\n    /**\n     * Shortcut to the preview Window\n     */\n    private get window(): Window {\n        return this.previewDocument.getContentWindow();\n    }\n\n    /**\n     * Control the visibility of the tooltip\n     */\n    get visibility() : \"visible\" | \"hidden\" {\n        return (this.selectedText !== \"\" || this.entityType !== \"\")? \"visible\" : \"hidden\";\n    }\n\n    /**\n     * Position the tooltip above a bounding box\n     */\n    positionTooltipAbove(box: DOMRect | ClientRect){\n        this.zone.run(() => {   // Necessary to compute the right size of the tooltip when updating the text\n            const tooltipWidth = this.tooltip.nativeElement.getBoundingClientRect().width;\n            const tooltipHeight = this.tooltip.nativeElement.getBoundingClientRect().height;\n            let left = this.scalingFactor*(box.left + 0.5*box.width) - 0.5*tooltipWidth\n            left = Math.min(Math.max(left, 0), this.scalingFactor*this.document.body.clientWidth - tooltipWidth); // Avoid tooltip overflow\n            this.left = Math.round(left)+\"px\";\n\n            const leftPin = Math.round(100 * (this.scalingFactor*(box.left + 0.5*box.width) - left) / tooltipWidth);\n            this.leftPin = this.sanitizer.bypassSecurityTrustStyle(`${leftPin}%`);\n            //absolute top positioning\n            //this.bottom = Math.round(box.top-tooltipHeight-5+this.window.scrollY)+\"px\";\n            //absolute bottom positioning\n            //this.bottom = Math.round(this.document.documentElement.clientHeight - this.window.scrollY - box.top + 5)+\"px\";\n            //fixed bottom positioning\n            if (Math.round(box.top - 5 - tooltipHeight) > 0) {\n              this.isBottom = false;\n              this.bottom = Math.round(this.scalingFactor* (this.window.innerHeight - box.top) + 5)+\"px\";\n            } else {\n              this.isBottom = true;\n              this.bottom = Math.round(this.scalingFactor* (this.window.innerHeight - box.top - box.height) - tooltipHeight - 5)+\"px\";\n            }\n            this.changeDetectorRef.detectChanges();\n        });\n    }\n\n    /**\n     * Handle mouse button down: reinitilizes selection\n     */\n    handleMouseDown = (event: MouseEvent) => {\n        //if(event.target !== this.tooltip)\n        this.selectedText = \"\";\n        //this.changeDetectorRef.detectChanges();\n    }\n\n    /**\n     * Handle mouse button up: get the selected text and display a tooltip above it\n     */\n    handleMouseUp = () => {\n        const selection = this.document.getSelection();\n        this.selectedText = selection ? selection.toString().trim() : \"\";\n        if(selection && this.selectedText){\n            const range = selection.getRangeAt(0);\n            //console.log(\"Selected text: \", text);\n            //console.log(event);\n            //console.log(range.getBoundingClientRect());\n            this.changeDetectorRef.detectChanges(); // Refresh size of tooltip\n            this.positionTooltipAbove(range.getBoundingClientRect());\n        }\n        this.changeDetectorRef.detectChanges();\n    }\n\n    private _inTime: number = 0;\n    /**\n     * Handle mouse movements. If hovering an entity and no text is selected, will display a tooltip for this entity\n     */\n    handleMouseMove = (event: MouseEvent) => {\n        if(!this.selectedText && event[\"path\"]){\n            const path = <Element[]> event[\"path\"];\n            if(path.length>0){\n                const element = path[0];\n                if(element.nodeType === 1 && element.nodeName === \"SPAN\" && (element.attributes[\"data-entity-basic\"] || element.attributes[\"data-entity-display\"])){\n                    if(this.entityType !== element.className.split(\" \")[0] || this.entityDisplay !== element.textContent){  // Tooltip not already displayed\n                        this.entityType = element.className.split(\" \")[0];    // Update text (and visibility)\n                        this.entityDisplay = element.textContent || \"\";   // Tooltip content\n                        const value = element.attributes[\"data-entity-basic\"] || element.attributes[\"data-entity-display\"];\n                        this.entityValue = value.value;\n                        const highlights = this.previewData.highlightsPerCategory[this.entityType].values\n                            .find(v => v.value === value.value);\n                        this.entityCount = highlights ? highlights.locations.length : 0;\n                        this.entityLabel = this.previewData.highlightsPerCategory[this.entityType].categoryDisplayLabel;\n\n                        const idsplt = element.id.split(\"_\");\n                        const idx = parseInt(idsplt[idsplt.length-1], 10);\n                        const entity = this.findEntity(this.entityType, this.entityValue, (_, idIndex) => idIndex === idx);\n                        this.entityIdx = entity ? entity.valueIndex : 0;\n\n                        this.changeDetectorRef.detectChanges(); // Refresh size of tooltip\n                        this.positionTooltipAbove(element.getBoundingClientRect());\n                    }\n                    this._inTime = Date.now(); // Reset the timer over an entity\n                    return;\n                }\n            }\n        }\n        // We are not hovering an entity\n        if(this.entityType){    // If still displaying the tooltip...\n            const isOverTooltip = !!event[\"path\"].find(el => el.localName === \"sq-preview-tooltip\");\n            if(!isOverTooltip) {\n                if(Date.now() - this._inTime > 200){ // 200 ms tolerance before closing tooltip\n                    this.entityType = \"\";\n                    this.entityValue = \"\";\n                    this.entityDisplay = \"\";\n                    this.entityLabel = \"\";\n                    this.entityCount = 0;\n                    this.entityIdx = 0;\n                    this.changeDetectorRef.detectChanges(); // Turn off tooltip\n                }\n            }\n            else{\n                this._inTime = Date.now(); // Reset the timer over the tooltip\n            }\n        }\n    }\n\n    /**\n     * Handle scroll events\n     */\n    handleScroll = (event) => {\n        if(this.selectedText !== \"\"){\n            this.handleMouseUp(); // Reposition tooltip above selected text\n        }\n        else if(this.entityType !== \"\"){\n            this.entityType = \"\";\n            this.entityValue = \"\";\n            this.changeDetectorRef.detectChanges(); // Turn off tooltip\n        }\n    }\n\n    /**\n     * Move to the previous entity if possible\n     * @param event\n     */\n    previousEntity(event: Event){\n        event.stopPropagation(); // stop the propagation to avoid triggering the tooltip listeners\n        if(this.entityIdx > 1){\n            // Find the index of the previous entity\n            const entity = this.findEntity(this.entityType, this.entityValue, (valueIdx,_) => valueIdx === this.entityIdx-1);\n            if (entity) {\n                const idx = entity.idIndex;\n                this.previewDocument.selectHighlight(this.entityType, idx);\n            }\n        }\n    }\n\n    /**\n     * Move to the next entity if possible\n     * @param event\n     */\n    nextEntity(event: Event){\n        event.stopPropagation(); // stop the propagation to avoid triggering the tooltip listeners\n        if(this.entityIdx < this.entityCount){\n            // Find the index of the next entity\n            const entity = this.findEntity(this.entityType, this.entityValue, (valueIdx,_) => valueIdx === this.entityIdx+1);\n            if (entity) {\n                const idx = entity.idIndex;\n                this.previewDocument.selectHighlight(this.entityType, idx);\n            }\n        }\n    }\n\n    /**\n     * Executes a clicked action button in the context of a tooltip for hovered entities\n     * @param action\n     * @param event\n     */\n    entityAction(action: Action, event: Event){\n        event.stopPropagation(); // stop the propagation to avoid triggering the tooltip listeners\n        this.zone.run(() => {\n            if(action.action) {\n                action.action(action, <any> {type: this.entityType, idx: this.entityIdx, value: this.entityValue, display: this.entityDisplay});\n            }\n        });\n    }\n\n    /**\n     * Executes a clicked action button in the context of a tooltip for text selection\n     * @param action the action to execute\n     * @param event\n     */\n    selectedTextAction(action: Action, event: Event){\n        event.stopPropagation(); // stop the propagation to avoid triggering the tooltip listeners\n        this.zone.run(() => {\n            if(action.action) {\n                action.action(action, <any> {text: this.selectedText});\n            }\n        });\n    }\n\n    /**\n     * Helper function to find the indexes of a specific entity *occurrence*. Returns both the index within all\n     * of its own occurrences: valueIndex (eg. BILL GATES 3/14) AND the index corresponding to the\n     * entity id inside the document: idIndex (eg. id=\"person_32\").\n     * @param category eg. person\n     * @param value eg. BILL GATES\n     * @param predicate function testing whether it is the entity occurrence of interest\n     * @returns an object with both indexes\n     */\n    private findEntity(entityType: string, entityValue: string, predicate: (index: number, idIndex: number) => boolean)\n            : {valueIndex: number, idIndex: number} | undefined {\n        let currentIdx = 0;\n        // For each highlight in the doc\n        for(let i=0; i<this.previewData.highlightsPerLocation['length']; i++) {\n            const highlight = this.previewData.highlightsPerLocation[i];\n            const categories = Object.keys(highlight.positionInCategories);\n            // For each value of the highlight\n            for(let j=0; j<categories.length; j++){\n                // If this is the right entity type and value\n                if(categories[j] === entityType && highlight.values[j] === entityValue) {\n                    // Increase the counter\n                    currentIdx++;\n                    // If this is the idx we are looking for, return\n                    if(predicate(currentIdx, highlight.positionInCategories[entityType])){\n                        return {valueIndex: currentIdx, idIndex: highlight.positionInCategories[entityType]};\n                    }\n                }\n            }\n        }\n        return undefined;\n    }\n\n}\n","import {Injectable, InjectionToken, Inject, Type, Optional} from \"@angular/core\";\nimport {Router} from \"@angular/router\";\nimport {Observable, Subject} from \"rxjs\";\nimport {AppService, ExprBuilder, Query} from \"@sinequa/core/app-utils\";\nimport {AuthenticationService} from \"@sinequa/core/login\";\nimport {PreviewWebService, PreviewData, AuditEventType, Record, AuditEvent, Results} from \"@sinequa/core/web-services\";\nimport {JsonObject, Utils} from \"@sinequa/core/base\";\nimport {ModalService} from \"@sinequa/core/modal\";\nimport {SearchService} from \"@sinequa/components/search\";\nimport {RecentDocumentsService} from '@sinequa/components/saved-queries';\n\nexport const enum PreviewEventType {\n    Data = \"Preview_Data\",\n    Modal = \"Preview_Modal\",\n    Route = \"Preview_Route\",\n    Window = \"Preview_Window\"\n}\n\nexport interface PreviewEvent {\n    type: PreviewEventType;\n    record?: Record;\n    query: Query;\n}\n\nexport const PREVIEW_MODAL = new InjectionToken<Type<any>>(\"PREVIEW_MODAL\");\n\n\n@Injectable({\n    providedIn: \"root\"\n})\nexport class PreviewService {\n\n    private readonly _events = new Subject<PreviewEvent>();\n    private rank: number;\n\n    constructor(\n        @Optional() @Inject(PREVIEW_MODAL) public previewModal: Type<any>,\n        private router: Router,\n        private previewWebService: PreviewWebService,\n        private appService: AppService,\n        private authenticationService: AuthenticationService,\n        private searchService: SearchService,\n        private modalService: ModalService,\n        private recentDocumentsService: RecentDocumentsService,\n        public exprBuilder: ExprBuilder) {\n\n        // Subscribe to own events and add documents to the recent documents service\n        this.events.subscribe(event => {\n            if(event.record && (event.type === PreviewEventType.Modal || event.type === PreviewEventType.Route || event.type === PreviewEventType.Window)){\n                this.recentDocumentsService.addDocument(event.record, false);\n            }\n        });\n    }\n\n    /**\n     * Triggers any event among PreviewEvent\n     */\n    public get events() : Subject<PreviewEvent> {\n        return this._events;\n    }\n\n    private makeQuery(query: Query): Query {\n        query = Utils.copy(query);\n        delete query.sort;\n        delete query.scope;\n        delete query.tab;\n        delete query.basket;\n        delete query.page;\n        delete query.queryId;\n        if (query.select) {\n            query.select = query.select.filter(value => Utils.eqNC(value.facet, \"refine\"));\n            if (query.select.length === 0) {\n                delete query.select;\n            }\n        }\n        return query;\n    }\n\n    public getPreviewData(id: string, query: Query, audit = true): Observable<PreviewData> {\n        let auditEvent: AuditEvent | undefined;\n        const record = this.searchService.getRecordFromId(id);\n        const resultId = record ? this.searchService.results?.id : undefined;\n        if (audit) {\n            auditEvent = {\n                type: AuditEventType.Doc_Preview,\n                detail: this.getAuditPreviewDetail(id, query, record, resultId)\n            };\n        }\n        query = this.makeQuery(query);\n        const observable = this.previewWebService.get(id, query, auditEvent);\n        Utils.subscribe(observable,\n            (previewData) => {\n                previewData.resultId = resultId || \"\";\n                return previewData;\n            });\n        this._events.next({type: PreviewEventType.Data, record, query});\n\n        return observable;\n    }\n\n    public makeDownloadUrl(url: string): string | undefined {\n        return url ? this.appService.updateUrlForCors(url) : undefined;\n    }\n\n    openModal(record: Record, query: Query, model: any) {\n        model.record = record;\n        model.query = query;\n\n        this._events.next({type: PreviewEventType.Modal, record, query});\n\n        this.modalService.open(this.previewModal, { model });\n    }\n\n    private getQueryStr(query: Query): string {\n        query = this.makeQuery(query);\n        return query.toJsonForQueryString();\n    }\n\n    openNewWindow(record: Record, query: Query): Window | null {\n        const params = {\n            id: record.id,\n            query: this.getQueryStr(query),\n            app: this.appService.appName\n        };\n\n        if (this.authenticationService.userOverrideActive && this.authenticationService.userOverride) {\n            params[\"overrideUser\"] = this.authenticationService.userOverride.userName;\n            params[\"overrideDomain\"] = this.authenticationService.userOverride.domain;\n        }\n        const httpParams = Utils.makeHttpParams(params);\n        const url = \"#/preview?\" + httpParams.toString();\n\n        this._events.next({type: PreviewEventType.Window, record, query});\n\n        return window.open(url, \"_blank\");\n    }\n\n    openRoute(record: Record, query: Query, path = \"preview\"): Promise<Boolean> {\n\n        this._events.next({type:PreviewEventType.Route, record, query});\n        this.rank = record.rank;\n\n        return this.router.navigate([path], {\n            queryParams: {\n                id: record.id,\n                query: this.getQueryStr(query)\n            }\n        });\n    }\n\n    /**\n     * Get the page number of a splitted document's record or undefined if\n     * it is not in fact splitted. Stores the page number in the record itself ($page property)\n     * @param record \n     */\n    getPageNumber(record: Record): number | undefined {\n        const containerid: string | undefined = record.containerid;\n        if(containerid && record.id.startsWith(containerid)) {\n            const pageNumberStr = record.id.slice(containerid.length+1);\n            if(/#\\d+#/g.test(pageNumberStr)) {\n                const pageNumber = parseInt(pageNumberStr.slice(1, pageNumberStr.length-1), 10);\n                if(!isNaN(pageNumber)) {\n                    record.$page = pageNumber;\n                    return pageNumber;\n                }\n            }\n        }\n        return undefined;\n    }\n\n    /**\n     * Returns the pages of a given record id\n     * @param containerid\n     * @param query\n     */\n    fetchPages(containerid: string, query: Query): Observable<Results> {\n        query = this.makeQuery(query);\n        query.groupBy = \"\"; // If the query web service uses GROUP BY containerid\n        query.addSelect(this.exprBuilder.makeExpr(\"containerid\", containerid));\n        return this.searchService.getResults(query);\n    }\n\n    getAuditPreviewDetail(id: string, query: Query, record?: Record, resultId?: string): JsonObject {\n        const queryLanguage = this.searchService.results?.queryAnalysis?.queryLanguage\n            || this.searchService?.query?.questionLanguage\n            || this.appService?.ccquery?.questionLanguage;\n        const collectionColumn = record?.collection;\n        const collection = !!collectionColumn ? collectionColumn[0] : Utils.split(id, \"|\")[0];\n        const rank = !!record ? record.rank : this.rank || 0;\n        return {\n            \"doc-id\": id,\n            rank: rank,\n            collection: collection,\n            source: Utils.treeFirstNode(collection),\n            resultid: resultId,\n            querylang: queryLanguage,\n            text: query.text,\n            filename: record?.filename,\n            fileext: record?.fileext,\n        }\n    }\n    \n    /**\n     * returns document's preview HTML\n     * @param url \n     * @returns document's preview HTML\n     */\n    public getHtmlPreview(url:string) {\n        return this.previewWebService.getHtmlPreview(url);\n    }\n}","import {NgModule, ModuleWithProviders, Type} from \"@angular/core\";\nimport {CommonModule} from \"@angular/common\";\nimport {IntlModule} from \"@sinequa/core/intl\";\nimport {WebServicesModule} from \"@sinequa/core/web-services\";\nimport {UtilsModule} from \"@sinequa/components/utils\";\nimport {PreviewDocumentIframe} from \"./preview-document-iframe.component\";\nimport {PreviewTooltip} from \"./preview-tooltip.component\";\nimport {PREVIEW_MODAL} from \"./preview.service\";\n\n@NgModule({\n    imports: [\n        CommonModule,\n        IntlModule,\n        WebServicesModule,\n        UtilsModule\n    ],\n    declarations: [\n        PreviewDocumentIframe, PreviewTooltip\n    ],\n    exports: [\n        PreviewDocumentIframe, PreviewTooltip\n    ],\n})\nexport class PreviewModule {\n    static forRoot(previewModal: Type<any>) : ModuleWithProviders<PreviewModule> {\n        return {\n            ngModule: PreviewModule,\n            providers: [\n                {provide: PREVIEW_MODAL, useValue: previewModal},\n            ]\n        };\n    }\n}","<div *ngIf=\"!similarDocuments\" class=\"d-flex flex-column {{iframeClass}}\" [ngStyle]=\"{height: height}\">\n    <sq-preview-document-iframe  [sandbox]=\"sandbox\" [downloadUrl]=\"downloadUrl\" (onPreviewReady)=\"document = $event\">\n        <sq-preview-tooltip #tooltip [previewDocument]=\"document\" [previewData]=\"data\"></sq-preview-tooltip>\n    </sq-preview-document-iframe>\n</div>\n<ul class=\"list-group\" *ngIf=\"!!similarDocuments\">\n    <li *ngFor=\"let doc of similarDocuments\" class=\"list-group-item d-flex justify-content-between align-items-center\" style=\"background-color: transparent;\">\n        <sq-result-title [record]=\"doc\" [titleLinkBehavior]=\"'open'\"></sq-result-title>\n        <div class=\"d-flex\">\n            <span class=\"badge badge-pill badge-secondary\" style=\"padding-top: 5px;\">{{100*doc.globalrelevance | number:'1.0-0'}}</span>\n            <a href=\"#\" (click)=\"openSimilarDoc(doc)\" class=\"open-record ml-2\" title=\"Open document in workspace\">\n                <i class=\"fas fa-arrow-circle-right\"></i>\n            </a>\n        </div>\n    </li>\n</ul>","import {Component, Input, Output, EventEmitter, OnChanges, SimpleChanges} from \"@angular/core\";\nimport {SafeResourceUrl} from \"@angular/platform-browser\";\nimport {Query} from '@sinequa/core/app-utils';\nimport {Record, PreviewData} from \"@sinequa/core/web-services\";\nimport {PreviewService} from \"../../preview.service\";\nimport {PreviewDocument} from \"../../preview-document\";\n\n@Component({\n    selector: \"sq-facet-preview\",\n    templateUrl: \"./facet-preview.html\",\n})\nexport class BsFacetPreview implements OnChanges {\n    @Input() record: Record;\n    @Input() sandbox: string | null;\n    @Input() query: Query;\n    @Input() height: string;\n    @Input() iframeClass: string;\n    @Input() similarDocuments: Record[];\n    @Output() recordOpened = new EventEmitter<{record: Record, query: Query, startSmall?: boolean, iframeClass?: string}>();\n    data: PreviewData;\n    document: PreviewDocument;\n    downloadUrl?: SafeResourceUrl;\n\n    constructor(\n        private previewService: PreviewService) {\n    }\n\n    ngOnChanges(changes: SimpleChanges) {\n        if (changes[\"record\"] || changes[\"query\"]) {\n            this.previewService.getPreviewData(this.record.id, this.query).subscribe(\n                previewData => {\n                    this.data = previewData;\n                    this.downloadUrl = this.data ? this.previewService.makeDownloadUrl(this.data.documentCachedContentUrl) : undefined;\n                });\n        }\n    }\n\n    openSimilarDoc(doc: Record) {\n        this.recordOpened.next({\n            record: doc,\n            query: this.query,\n            startSmall: true,\n            iframeClass: this.iframeClass\n        });\n        return false;\n    }\n}","<div class=\"d-flex flex-column {{iframeClass}}\" [ngStyle]=\"{'height.%': 100}\">\n    <sq-preview-document-iframe\n                                [sandbox]=\"sandbox\"\n                                [downloadUrl]=\"downloadUrl\"\n                                [scalingFactor]=\"scalingFactor\"\n                                (onPreviewReady)=\"onPreviewReady($event)\">\n    </sq-preview-document-iframe>\n</div>\n\n<ng-template #headerTpl>\n    <sq-result-title class=\"flex-grow-1 flex-basis-0\" [record]=\"record\" [originalDocTarget]=\"originalDocTarget\" titleLinkBehavior=\"open-if-url\"></sq-result-title>\n</ng-template>\n\n<ng-template #subHeaderTpl>\n    <sq-metadata *ngIf=\"metadata && metadata.length > 0\"\n        [record]=\"record\"\n        [items]=\"metadata\"\n        [showTitles]=\"true\"\n        [showIcons]=\"true\"\n        [clickable]=\"false\">\n    </sq-metadata>\n</ng-template>\n","import { Component, Input, Output, EventEmitter, OnChanges, SimpleChanges, HostBinding, AfterViewChecked } from \"@angular/core\";\nimport { SafeResourceUrl } from \"@angular/platform-browser\";\nimport { Query } from '@sinequa/core/app-utils';\nimport { Record, PreviewData } from \"@sinequa/core/web-services\";\nimport { PreviewService } from \"../../preview.service\";\nimport { PreviewDocument, HighlightFilters } from \"../../preview-document\";\nimport { AbstractFacet } from '@sinequa/components/facet';\nimport { Action } from '@sinequa/components/action';\n\n@Component({\n  selector: 'sq-facet-preview-2',\n  templateUrl: './facet-preview.component.html',\n  styleUrls: ['./facet-preview.component.scss']\n})\nexport class BsFacetPreviewComponent2 extends AbstractFacet implements OnChanges, AfterViewChecked {\n\n  @Input() record: Record;\n  @Input() query: Query;\n  @Input() iframeClass: string;\n  @Input() sandbox : string | null;\n  @Input() height = 500;\n  @Input() scalingFactor = 0.6;\n  @Input() metadata: string[] = [];\n  @Input() expandModal = true;\n  @Input() closable = true;\n  @Input() highlightActions = true;\n  @Input() customActions: Action[];\n  @Input() filters: HighlightFilters;\n  @Input() originalDocTarget: string | undefined;\n  @Output() recordClosed = new EventEmitter<void>();\n  @Output() previewLoaded = new EventEmitter<PreviewDocument>();\n  @HostBinding('style.height.px') _height: number = this.height;\n\n  private closeAction: Action;\n  private expandModalAction: Action;\n  private toggleEntitiesAction: Action;\n  private toggleExtractsAction: Action;\n  private minimizeAction: Action;\n  private maximizeAction: Action;\n\n  data?: PreviewData;\n  document?: PreviewDocument;\n  downloadUrl?: SafeResourceUrl;\n\n  private readonly scaleFactorThreshold = 0.1;\n  private loaded = false;\n\n  constructor(\n      private previewService: PreviewService) {\n\n    super();\n\n    this.closeAction = new Action({\n      icon: \"fas fa-times\",\n      title: \"msg#facet.preview.closeTitle\",\n      action: () => {\n        this.recordClosed.next();\n      }\n    });\n\n    this.expandModalAction = new Action({\n      icon: \"far fa-window-maximize\",\n      title: \"msg#facet.preview.expandTitle\",\n      action: () => {\n        this.previewService.openModal(this.record, this.query, {\n          displaySimilarDocuments: false,\n          metadata: this.metadata\n        });\n      }\n    });\n\n    this.toggleEntitiesAction = new Action({\n      icon: \"fas fa-lightbulb\",\n      title: \"msg#facet.preview.toggleEntities\",\n      selected: true,\n      action: (action) => {\n        action.selected = !action.selected;\n        if(this.data?.highlightsPerCategory) {\n          Object.keys(this.data.highlightsPerCategory)\n            .filter(value => value !== \"extractslocations\" && value !== \"matchlocations\")\n            .forEach(cat =>\n              this.document?.toggleHighlight(cat, action.selected!)\n            );\n        }\n      }\n    });\n\n    this.toggleExtractsAction = new Action({\n        icon: \"fas fa-highlighter\",\n        title: \"msg#facet.preview.toggleExtracts\",\n        selected: true,\n        action: (action) => {\n            action.selected = !action.selected;\n            this.document?.toggleHighlight(\"matchlocations\", action.selected);\n            this.document?.toggleHighlight(\"extractslocations\", action.selected);\n        }\n    });\n\n    this.maximizeAction = new Action({\n      icon: \"fas fa-search-plus\",\n      title: \"msg#facet.preview.maximize\",\n      action: () => {\n        this.scalingFactor = this.scalingFactor + this.scaleFactorThreshold;\n      }\n    });\n\n    this.minimizeAction = new Action({\n      icon: \"fas fa-search-minus\",\n      title: \"msg#facet.preview.minimize\",\n      disabled: this.scalingFactor === 0.1,\n      action: () => {\n        this.scalingFactor = Math.round(Math.max(0.1, this.scalingFactor - this.scaleFactorThreshold) * 100) / 100;\n      },\n      updater: (action) => {\n        action.disabled = this.scalingFactor === 0.1;\n      }\n    });\n\n  }\n\n  get actions(): Action[] {\n    const actions: Action[] = [];\n    if(this.customActions){\n      actions.push(...this.customActions);\n    }\n    if(this.highlightActions) {\n      actions.push(this.toggleExtractsAction, this.toggleEntitiesAction);\n    }\n    this.minimizeAction.update();\n    actions.push(this.minimizeAction, this.maximizeAction);\n    if(this.expandModal){\n      actions.push(this.expandModalAction);\n    }\n    if(this.closable){\n      actions.push(this.closeAction);\n    }\n    return actions;\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (changes[\"record\"]) {\n      this.previewService.getPreviewData(this.record.id, this.query).subscribe(\n        previewData => {\n          this.data = previewData;\n          this.downloadUrl = this.data ? this.previewService.makeDownloadUrl(this.data.documentCachedContentUrl) : undefined;\n        });\n      this.downloadUrl = undefined;\n      this.data = undefined;\n      this.document = undefined;\n    }\n    if(changes[\"height\"] || changes[\"scalingFactor\"]) {\n      this._height = this.height;\n    }\n  }\n\n  ngAfterViewChecked() {\n    if (this.document && this.loaded) {\n      this.loaded = false;\n      // as now view is checked, emit event\n      this.previewLoaded.emit(this.document);\n    }\n  }\n\n  onPreviewReady(document: PreviewDocument) {\n    this.document = document;\n    if (this.document && this.filters) {\n      this.document.filterHighlights(this.filters);\n    }\n\n    this.loaded = true;\n  }\n}\n","<div class=\"card sq-facet\">\n    <div class=\"card-header\">{{'msg#preview.highlightsTitle' | sqMessage}}</div>\n    <ng-container *ngIf=\"noData; else normalCase\">\n        <div class=\"card-body noEntityToHighlightMessage\">\n            {{\"msg#preview.noEntityToHighlight\" | sqMessage}}\n        </div>\n    </ng-container>\n    <ng-template #normalCase>\n        <div class=\"card-body\">\n            <div class=\"currentSelection\">\n                <div class=\"selectedHighlightTitle\">{{\"msg#preview.selectedHighlight\" | sqMessage}}:</div>\n                <div class=\"currentSelectionPanel\">\n                    <div *ngIf=\"currentValue || currentCategories; else noSelection\" class=\"selectedHighlight\">\n                        <div class=\"currentCategories\">\n                            <span *ngFor=\"let categoryId of currentCategories\">\n                                <span class=\"fas fa-bullseye {{ categoryIconClass(categoryId) }} {{ categoryId }}\"></span>\n                                <span class=\"currentCategoryLabel\">{{categoryDisplayLabel(categoryId) | sqMessage: categoryLabelPipeParams(categoryId)}}</span>\n                            </span>\n                        </div>\n                        <div class=\"selectedHighlightValue\" [innerHTML]=\"currentValue\"></div>\n                    </div>\n                    <ng-template #noSelection>\n                        <div class=\"noSelectionMessage\">\n                            {{\"msg#preview.noSelectedHighlight\" | sqMessage}}\n                        </div>\n                        <div>&nbsp;</div>\n                    </ng-template>\n                </div>\n            </div>\n            <div class=\"navigation-buttons\">\n                <button class=\"btn btn-secondary\" [disabled]=\"!previewReady\" (click)=\"first()\" title=\"{{'msg#preview.firstHighlightButtonAltText' | sqMessage}}\">\n                    <span class=\"fas fa-fast-backward\"></span>\n                </button>\n                <button class=\"btn btn-secondary\" [disabled]=\"!previewReady\" (click)=\"previous()\" title=\"{{'msg#preview.previousHighlightButtonAltText' | sqMessage}}\">\n                    <span class=\"fas fa-step-backward\"></span>\n                </button>\n                <div class=\"counter-container\">\n                    <span class=\"counter\">{{current | sqNumber}} / {{total | sqNumber}}</span>\n                    <span class=\"counter ghost\">{{total | sqNumber}} / {{total | sqNumber}}</span>\n                </div>\n                <button class=\"btn btn-secondary\" [disabled]=\"!previewReady\" (click)=\"next()\" title=\"{{'msg#preview.nextHighlightButtonAltText' | sqMessage}}\">\n                    <span class=\"fas fa-step-forward\"></span>\n                </button>\n                <button class=\"btn btn-secondary\" [disabled]=\"!previewReady\" (click)=\"last()\" title=\"{{'msg#preview.lastHighlightButtonAltText' | sqMessage}}\">\n                    <span class=\"fas fa-fast-forward\"></span>\n                </button>\n            </div>\n        </div>\n        <div class=\"card-body filterPanel\">\n            <div class=\"filterPanelTitle\">\n                <span class=\"fas fa-filter\"></span>{{ \"msg#preview.highlightFilters.title\" | sqMessage }}\n            </div>\n            <div class=\"batchSelectButtonsContainer\" *ngIf=\"nonEmptyCategoryIds.length > 1\">\n                <div class=\"batchSelectButtonsPaddingPlaceholder\"></div>\n                <div class=\"batchSelectButtonsPaddingPlaceholder\"></div>\n                <div class=\"batchSelectButtons\">\n                    <div class=\"batchSelectButton\">\n                        <button class=\"btn\" [disabled]=\"!previewReady || this.allSelected\" (click)=\"selectAll()\"\n                                title=\"{{'msg#preview.highlightFilters.keepAll' | sqMessage}}\">\n                            <span class=\"far fa-check-square\"></span>\n                            {{\"msg#preview.highlightFilters.keepAll\" | sqMessage}}\n                        </button>\n                    </div>\n                    <div class=\"batchSelectButton\">\n                        <button class=\"btn\" [disabled]=\"!previewReady || this.noneSelected\" (click)=\"selectNone()\"\n                                title=\"{{'msg#preview.highlightFilters.keepNone' | sqMessage}}\">\n                            <span class=\"fas fa-times\"></span>\n                            {{\"msg#preview.highlightFilters.keepNone\" | sqMessage}}\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class=\"filters\">\n                <div *ngFor=\"let categoryId of nonEmptyCategoryIds\" class=\"sq-highlight\">\n                    <div class=\"categoryIcon\">\n                        <span class=\"fas fa-bullseye {{ categoryIconClass(categoryId) }} {{ categoryId }}\"></span>\n                    </div>\n                    <div class=\"categoryLabel\">\n                        {{getCategoryHighlightData(categoryId)?.categoryDisplayLabelPlural | sqMessage: categoryLabelPipeParams(categoryId)}}:\n                    </div>\n                    <div class=\"categoryFilter\">\n                        <ng-container *ngIf=\"categoryHasMultipleValues(categoryId); else singleValue\">\n                            <select class=\"custom-select\" [(ngModel)]=\"navigationState.filters[categoryId]\" [compareWith]=\"compareFilters\" (ngModelChange)=\"selectFilter(categoryId, $event)\">\n                                <option [ngValue]=\"keepAllFilter\">{{getCategoryHighlightData(categoryId)?.categoryFilterAllLabel | sqMessage}} ({{getHighlightValueCount(categoryId) | sqNumber}})</option>\n                                <option [ngValue]=\"keepNoneFilter\">{{getCategoryHighlightData(categoryId)?.categoryFilterNoneLabel | sqMessage}}</option>\n                                <option class=\"selectSeparator\" disabled>&nbsp;</option>\n                                <option *ngFor=\"let entityValue of this.getCategoryHighlightData(categoryId)?.values\" [ngValue]=\"newFilter(entityValue.value)\">{{entityValue.displayValue}}</option>\n                            </select>\n                        </ng-container>\n                        <ng-template #singleValue>\n                            <select class=\"custom-select\" [(ngModel)]=\"navigationState.filters[categoryId]\" [compareWith]=\"compareFilters\" (ngModelChange)=\"selectFilter(categoryId, $event)\">\n                                <option [ngValue]=\"keepAllFilter\">\n                                    {{getCategoryHighlightData(categoryId)?.categoryFilterAllLabel | sqMessage}}\n                                    <ng-container *ngIf=\"getCategoryHighlightData(categoryId)?.values[0].displayValue as displayValue\">\n                                        ({{displayValue}})\n                                    </ng-container>\n                                </option>\n                                <option [ngValue]=\"keepNoneFilter\">{{getCategoryHighlightData(categoryId)?.categoryFilterNoneLabel | sqMessage}}</option>\n                            </select>\n                        </ng-template>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </ng-template>\n</div>","import { Component, Input, OnChanges, SimpleChanges} from \"@angular/core\";\nimport { HighlightDataPerCategory, CategoryHighlightData, HighlightDataPerLocation, PreviewData } from \"@sinequa/core/web-services\";\nimport { Utils } from \"@sinequa/core/base\";\nimport { PreviewDocument, HighlightCategoryFilterState, HighlightCategoryFilterChoice } from \"../../preview-document\";\n\n\nexport interface HighlightNavigationState {\n    current: number;\n    filters: { [key: string] : HighlightCategoryFilterState };\n}\n\n\n@Component({\n    selector: \"sq-preview-highlights\",\n    templateUrl: \"./preview-highlights.html\",\n    styleUrls: [\"./preview-highlights.scss\"]\n})\nexport class BsPreviewHighlights implements OnChanges {\n\n    @Input() previewDocument: PreviewDocument;\n    @Input() previewData: PreviewData;\n\n    // Highlight data retrieved by the server\n    public highlightDataPerCategory?: HighlightDataPerCategory;\n    private highlightDataPerLocation?: HighlightDataPerLocation;\n\n    // Selected entity & filters (the .filters[category] are the NgModel of the select elements)\n    public navigationState: HighlightNavigationState;\n\n    // highlight data resulting from filtering\n    private filteredHighlightData?: HighlightDataPerLocation;\n\n\n    ngOnChanges(changes: SimpleChanges) {\n        if(changes[\"previewData\"]){\n            this.initialize();\n        }\n        if (changes[\"previewDocument\"]) {\n            if (this.previewReady) {\n                this.moveToFirstSearchTerm();\n            }\n        }\n    }\n\n    private initialize(): void {\n        this.highlightDataPerCategory = !this.previewData ? undefined : this.previewData.highlightsPerCategory;\n        this.highlightDataPerLocation = !this.previewData ? undefined : this.previewData.highlightsPerLocation;\n        this.navigationState = new SimpleHighlightNavigationState(this.nonEmptyCategoryIds);\n        this.reset();\n    }\n\n    /**\n     * Called on init and when non-value filters are clicked\n     * Resets the navigationState entity selection.\n     * Applies the filters to the preview document.\n     * Updates the filtered data.\n     */\n    public reset(): void {\n        this.navigationState.current = -1;  // Resets the navigationState entity selection.\n        if(this.previewReady)               // Applies the filters to the preview document.\n            this.previewDocument.filterHighlights(this.navigationState.filters);\n        // Updates the filtered data.\n        this.filteredHighlightData = this.highlightDataPerLocation ?\n            new FilteredHighlightDataPerLocation(this.highlightDataPerLocation, this.navigationState.filters) : undefined;\n    }\n\n    /**\n     * Selects the first match location (highlight classes and scrolls to it)\n     */\n    private moveToFirstSearchTerm(): void {\n        if (this.filteredHighlightData) {\n            for (let i = 0, ic = this.total; i < ic; i++) {\n                const highlight = this.filteredHighlightData[i];\n                if (highlight.positionInCategories) {\n                    let category = \"term1\";\n                    let position = highlight.positionInCategories[category];\n                    if (!Utils.isNumber(position)) {\n                        category = \"matchlocations\";\n                        position = highlight.positionInCategories[category];\n                    }\n                    if (Utils.isNumber(position)) {\n                        this.navigationState.current = i;\n                        this.previewDocument.selectHighlight(category, position);\n                        break;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Index of currently selected entity (from 1)\n     */\n    get current(): number {\n        return this.navigationState.current + 1;\n    }\n\n    /**\n     * No categories to highlight\n     */\n    get noData(): boolean {\n        return this.nonEmptyCategoryIds.length === 0;\n    }\n\n    /**\n     * Total number of highlights\n     */\n    get total(): number {\n        return this.filteredHighlightData ? this.filteredHighlightData.size() : 0;\n    }\n\n    /**\n     * @returns true when the document is ready to be interacted with\n     */\n    get previewReady(): boolean {\n        return !!this.previewDocument;\n    }\n\n    /**\n     * Returns the currently selected entity/match/extract based on the PreviewData\n     * or potentially by fetching it directly from the HTML document.\n     */\n    get currentValue(): string {\n        if (this.navigationState.current < 0 || !this.filteredHighlightData) {\n            return \"\";\n        }\n        const result: string = this.filteredHighlightData[this.navigationState.current].displayValue;\n        if (result) {\n            return result;\n        }\n        const values: string[] = this.filteredHighlightData[this.navigationState.current].values;\n        if (values && values.length > 0 && values[0] && values[0].length > 0) {\n            return values[0];\n        }\n        if (Object.keys(this.filteredHighlightData[this.navigationState.current].positionInCategories).length === 1\n                && this.filteredHighlightData[this.navigationState.current].positionInCategories[\"extractslocations\"]) {\n            return this.previewDocument.getHighlightText(\n                \"extractslocations\",\n                this.filteredHighlightData[this.navigationState.current].positionInCategories[\"extractslocations\"]);\n        }\n        return \"\";\n    }\n\n    /**\n     * Get categories of the currently selected entity/match/extract\n     * based on the filtered Highlight data per location\n     */\n    get currentCategories(): string[] {\n        const result: string[] = [];\n        if (this.navigationState.current < 0 || !this.filteredHighlightData || this.navigationState.current >= this.filteredHighlightData.size()) {\n            return result;\n        }\n        for (const categoryId in this.filteredHighlightData[this.navigationState.current].positionInCategories) {\n            result.push(categoryId);\n        }\n        return result;\n    }\n\n    public categoryIconClass(categoryId: string): string {\n        if (categoryId.startsWith(\"term\")) {\n            return \"far fa-flag\";\n        }\n        return \"sq-icon-\" + categoryId;\n    }\n\n    public getCategoryHighlightData(categoryId: string): CategoryHighlightData | undefined {\n        return this.highlightDataPerCategory ? this.highlightDataPerCategory[categoryId] : undefined;\n    }\n\n    public categoryDisplayLabel(categoryId: string): string {\n        return this.highlightDataPerCategory ? this.highlightDataPerCategory[categoryId].categoryDisplayLabel : \"\";\n    }\n\n    public categoryLabelPipeParams(categoryId: string): any {\n        if (!categoryId.startsWith(\"term\")) {\n            return {};\n        }\n        const index = Number(categoryId.slice(\"term\".length));\n        if (isNaN(index)) {\n            return {};\n        }\n        return {values: {index: index}};\n    }\n\n\n    /**\n     * Returns the list of entity categories that contain values\n     */\n    get nonEmptyCategoryIds(): string[] {\n        const result: string[] = [];\n        for (const categoryId in this.highlightDataPerCategory) {\n            if (!this.categoryIsEmpty(categoryId, this.highlightDataPerCategory)) {\n                result.push(categoryId);\n            }\n        }\n        return result;\n    }\n\n    private categoryIsEmpty(categoryId: string, highlightData : HighlightDataPerCategory): boolean {\n        return highlightData[categoryId] == null\n            || highlightData[categoryId].values == null\n            || highlightData[categoryId].values.length <= 0;\n    }\n\n    /**\n     * @returns true if there is more than one option per category\n     * @param categoryId the category id\n     */\n    public categoryHasMultipleValues(categoryId: string): boolean {\n        return this.getHighlightValueCount(categoryId) > 1;\n    }\n\n    /**\n     * @returns the number of options per category\n     * @param categoryId the category id\n     */\n    public getHighlightValueCount(categoryId: string): number {\n        if (!this.highlightDataPerCategory || this.categoryIsEmpty(categoryId, this.highlightDataPerCategory)) {\n            return 0;\n        }\n        const values = this.highlightDataPerCategory[categoryId].values;\n        if (values == null) {\n            return 0;\n        }\n        return values.length;\n    }\n\n\n    // Navigation buttons handlers\n\n    first() {\n        if (this.navigationState.current > 0) {\n            this.navigationState.current = 0;\n            this.selectHighlight();\n        }\n    }\n\n    previous() {\n        if (this.navigationState.current > 0) {\n            this.navigationState.current--;\n            this.selectHighlight();\n        }\n    }\n\n    next() {\n        if (this.navigationState.current < this.total - 1) {\n            this.navigationState.current++;\n            this.selectHighlight();\n        }\n    }\n\n    last() {\n        if (this.navigationState.current !== this.total - 1) {\n            this.navigationState.current = this.total - 1;\n            this.selectHighlight();\n        }\n    }\n\n    private selectHighlight(): void {\n        if (this.filteredHighlightData) {\n            const positionInCategories: { [categoryId: string]: number } = this.filteredHighlightData[this.navigationState.current].positionInCategories;\n            const firstCategory: string = Object.keys(positionInCategories)[0];\n            this.previewDocument.selectHighlight(firstCategory, positionInCategories[firstCategory]);\n        }\n    }\n\n    public selectAll(): void {\n        for (const categoryId in this.navigationState.filters) {\n            this.navigationState.filters[categoryId] = this.keepAllFilter;\n        }\n        this.reset();\n    }\n\n    public selectNone(): void {\n        for (const categoryId in this.navigationState.filters) {\n            this.navigationState.filters[categoryId] = this.keepNoneFilter;\n        }\n        this.reset();\n    }\n\n    get allSelected(): boolean {\n        for (const categoryId in this.navigationState.filters) {\n            const filter: HighlightCategoryFilterState = this.navigationState.filters[categoryId];\n            if (filter && filter.choice !== HighlightCategoryFilterChoice.All) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    get noneSelected(): boolean {\n        for (const categoryId in this.navigationState.filters) {\n            const filter: HighlightCategoryFilterState = this.navigationState.filters[categoryId];\n            if (!filter || filter.choice !== HighlightCategoryFilterChoice.None) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n\n    // Entity filters\n\n    // Trivial filters\n    public keepAllFilter: HighlightCategoryFilterState = new SimpleHighlightCategoryFilterState();\n    public keepNoneFilter: HighlightCategoryFilterState = new SimpleHighlightCategoryFilterState(HighlightCategoryFilterChoice.None);\n\n    // Filter created for each option\n    public newFilter(value: string) {\n        return new SimpleHighlightCategoryFilterState(value);\n    }\n\n    // A filter was clicked\n    selectFilter(categoryId: string, value: HighlightCategoryFilterState){\n        //console.log(categoryId, value);\n\n        // If a specific entity/extract is selected we want to select it, rather than filter other entities\n        if(value.choice === HighlightCategoryFilterChoice.Value){\n\n            // First, let's cancel value filters EXCEPT the one that was just selected\n            for(const key in this.navigationState.filters){\n                if(key !== categoryId && this.navigationState.filters[key] !== this.keepAllFilter && this.navigationState.filters[key] !== this.keepNoneFilter){\n                    this.navigationState.filters[key] = this.keepAllFilter;\n                }\n            }\n\n            // Search the entity ID\n            let highlight;\n            for(const key in this.highlightDataPerLocation){\n                highlight = this.highlightDataPerLocation[key];\n                if(highlight.positionInCategories[categoryId] && highlight.values.includes(value.filterValue)){\n                    break;\n                }\n            }\n\n            if(highlight){\n                this.previewDocument.selectHighlight(categoryId, highlight.positionInCategories[categoryId]);\n            }\n\n        }\n        else {\n\n            // Cancel value filters\n            for(const key in this.navigationState.filters){\n                if(this.navigationState.filters[key] !== this.keepAllFilter && this.navigationState.filters[key] !== this.keepNoneFilter){\n                    this.navigationState.filters[key] = this.keepAllFilter;\n                }\n            }\n\n            // Reset just applies the (non-value) filters as they are and removes selection\n            this.reset();\n\n        }\n    }\n\n    /**\n     * Comparator allowing to sort the filters in the select\n     */\n    public compareFilters(filter1: HighlightCategoryFilterState, filter2: HighlightCategoryFilterState): boolean {\n        return SimpleHighlightCategoryFilterState.compare(filter1, filter2);\n    }\n\n\n}\n\n\n\n\n// Implementation of data structures\n\nclass SimpleHighlightNavigationState {\n\n    current: number;\n    filters: { [key: string] : HighlightCategoryFilterState};\n\n    constructor(categories: string[]) {\n        this.current = -1;  // No selection\n        this.filters = {};\n        for (const category of categories) {\n            this.filters[category] = new SimpleHighlightCategoryFilterState(); // All entities visible by default\n        }\n    }\n}\n\n\nclass SimpleHighlightCategoryFilterState implements HighlightCategoryFilterState {\n    readonly choice: HighlightCategoryFilterChoice = HighlightCategoryFilterChoice.All;\n    private _filterValue: string = \"\";\n\n    constructor(param?: string | HighlightCategoryFilterChoice) {\n        if (param == null) {\n            return;\n        }\n        if (typeof param === \"string\") {\n            this.choice = HighlightCategoryFilterChoice.Value;\n            this._filterValue = param;\n        } else {\n            this.choice = param;\n        }\n    }\n\n    get filterValue(): string {\n        if (this.choice === HighlightCategoryFilterChoice.Value) {\n            return this._filterValue;\n        }\n        return \"\";\n    }\n\n    public static compare(filter1: HighlightCategoryFilterState, filter2: HighlightCategoryFilterState) {\n        if(filter1 && filter2) {\n            if(filter1.choice !== filter2.choice) {\n                return false;\n            }\n            return filter1.choice !== HighlightCategoryFilterChoice.Value\n                || filter1.filterValue === filter2.filterValue;\n        }\n        return filter1 === filter2;\n    }\n}\n\n\nclass FilteredHighlightDataPerLocation implements HighlightDataPerLocation {\n\n    [index: number]: {\n        start: number,\n        length: number,\n        values: string[],\n        displayValue: string,\n        positionInCategories: { [category: string]: number }\n    };\n\n    public constructor(baseData: HighlightDataPerLocation, filters: { [key: string] : HighlightCategoryFilterState }) {\n        let counter: number = 0;\n        for (const i in baseData) {\n            const categories = !baseData[i].positionInCategories ? undefined : Object.keys(baseData[i].positionInCategories);\n            if (categories && this.locationIsIncluded(baseData[i].values, categories, filters)) {\n                this[counter] = baseData[i];\n                counter++;\n            }\n        }\n    }\n\n    size(): number {\n        return Object.keys(this).length;\n    }\n\n    public locationIsIncluded(values: string[], categories: string[], filters: { [key: string] : HighlightCategoryFilterState }): boolean {\n        if (!categories) {\n            return false;\n        }\n        for (const category of categories) {\n            if (filters[category] &&\n                (filters[category].choice === HighlightCategoryFilterChoice.All\n                || filters[category].choice === HighlightCategoryFilterChoice.Value && values != null && values.includes(filters[category].filterValue))) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\n","<div *ngIf=\"!!originalDocumentUrl\" class=\"card sq-facet\">\n    <div class=\"card-body\">\n        <nav>\n            <ul class=\"nav nav-pills nav-stacked\">\n                <li class=\"nav-item\">\n                    <a href=\"{{originalDocumentUrl}}\" (click)=\"click()\" class=\"nav-link originalDocumentLink\" target=\"_blank\">\n                        <span class=\"far fa-file sq-icon-file-{{record.fileext}}\"></span> {{'msg#preview.originalDocument' | sqMessage}}\n                    </a>\n                </li>\n            </ul>\n        </nav>\n    </div>\n</div>","import {Component, Input, OnChanges} from \"@angular/core\";\nimport {Record} from \"@sinequa/core/web-services\";\nimport {SearchService} from \"@sinequa/components/search\";\n\n@Component({\n    selector: \"sq-preview-links\",\n    // For highlight buttons...\n    // http://stackoverflow.com/questions/21245541/min-and-max-width-mess-up-text-align-center\n    templateUrl: \"./preview-links.html\",\n    styleUrls: [\"./preview-links.css\"]\n})\nexport class BsPreviewLinks implements OnChanges {\n    @Input() record: Record;\n    @Input() resultId: string;\n    originalDocumentUrl: string;\n\n    constructor(\n        private searchService: SearchService) {\n    }\n\n    public ngOnChanges() {\n        this.originalDocumentUrl = this.record.url1;\n    }\n\n    click() {\n        this.searchService.notifyOpenOriginalDocument(this.record, this.resultId);\n    }\n}","<sq-facet-card *ngIf=\"documents != null && documents.length > 0\" [title]=\"'msg#preview.similarDocumentsTitle'\">\n    <div class=\"card-body collapse show\" id=\"similarDocumentsBody\">\n        <ng-container *ngFor=\"let document of documents\">\n            <ng-container *ngIf=\"document\">\n                <div class=\"similarDocument\" (click)=\"onLinkClick(document)\" >\n                    <div class=\"similarDocumentIcon {{documentIconClass(document)}}\"></div>\n                    <a class=\"similarDocumentTitle\" href=\"javascript:void(0)\" >{{ document.title }}</a>\n                </div>\n            </ng-container>\n        </ng-container>\n    </div>\n</sq-facet-card>","import { Component, Input, OnChanges, ChangeDetectorRef } from \"@angular/core\";\nimport { Record, SimilarDocumentsWebService } from \"@sinequa/core/web-services\";\nimport { Query } from \"@sinequa/core/app-utils\";\nimport { PreviewService } from \"../../preview.service\";\n\n@Component({\n    selector: \"sq-similar-documents\",\n    templateUrl: \"./similar-documents.html\"\n})\nexport class BsSimilarDocuments implements OnChanges {\n    @Input() private sourceDocumentId: string;\n    @Input() private query: Query;\n    private documentList: Record[];\n\n    public get documents(): Record[] {\n        return this.documentList;\n    }\n\n    public constructor(\n        private similarDocumentsService: SimilarDocumentsWebService,\n        private previewService: PreviewService,\n        private changeDetectorRef: ChangeDetectorRef) {\n    }\n\n    public ngOnChanges(): void {\n        if (this.sourceDocumentId == null) {\n            this.documentList = [];\n            return;\n        }\n        this.similarDocumentsService.get(this.sourceDocumentId, this.query.name).subscribe(\n            (results) => {\n                this.documentList = results;\n                this.changeDetectorRef.markForCheck();\n            }\n        );\n    }\n\n    public documentIconClass(document: Record): string {\n        const documentFormat = document.fileext;\n        if (!documentFormat) {\n            return \"far fa-file\";\n        }\n        return \"far fa-file sq-icon-file-\" + document.fileext;\n    }\n\n    public onLinkClick(document: Record): void {\n        this.previewService.openNewWindow(document, this.query);\n    }\n}\n","<div *ngIf=\"!!previewData\" class=\"container-fluid sq-preview\">\n    <div class=\"row sq-row\">\n        <div class=\"col-lg-3 sq-col {{leftPaneAdditionalClasses}}\">\n            <div class=\"sq-preview-bar\">\n                <sq-preview-links class=\"d-block mb-3\"\n                    [record]=\"previewData.record\" \n                    [resultId]=\"previewData.resultId\">\n                </sq-preview-links>\n                <sq-preview-highlights class=\"d-block mb-3\"\n                    [previewDocument]=\"previewDocument\"\n                    [previewData]=\"previewData\">\n                </sq-preview-highlights>\n                <sq-facet-card [title]=\"'msg#preview.documentPropertiesTitle'\" class=\"d-block mb-3\">\n                    <div class=\"card-body collapse show\" id=\"documentPropertiesBody\">\n                        <sq-metadata *ngIf=\"previewData.record\" [record]=\"previewData.record\" [items]=\"metadata\" [showTitles]=\"false\" [showIcons]=\"true\" [clickable]=\"false\">\n                        </sq-metadata>\n                    </div>\n                </sq-facet-card>\n                <sq-similar-documents *ngIf=\"displaySimilarDocuments\" class=\"d-block mb-3\"\n                    [sourceDocumentId]=\"previewData.record.id\" [query]=\"query\">\n                </sq-similar-documents>\n            </div>\n        </div>\n        <div class=\"col-lg-9 sq-col d-flex flex-column\">\n            <sq-preview-document-iframe \n                [sandbox] = \"sandbox\" \n                [downloadUrl]=\"downloadUrl\" \n                (onPreviewReady)=\"onPreviewReady($event)\">\n                <sq-preview-tooltip #tooltip\n                    [previewDocument]=\"previewDocument\"\n                    [previewData]=\"previewDocument\">\n                </sq-preview-tooltip>\n            </sq-preview-document-iframe>\n        </div>\n    </div>\n</div>","import { Component, Input, OnChanges, SimpleChanges, ChangeDetectorRef } from \"@angular/core\";\nimport { SafeResourceUrl } from '@angular/platform-browser';\nimport { PreviewData } from \"@sinequa/core/web-services\";\nimport { Query } from \"@sinequa/core/app-utils\";\nimport { PreviewService } from \"../../preview.service\";\nimport { PreviewDocument } from \"../../preview-document\";\n\n\n@Component({\n    selector: \"sq-preview-panel\",\n    templateUrl: \"./preview-panel.html\",\n    styleUrls: [\"./preview-panel.scss\"]\n})\nexport class BsPreviewPanel implements OnChanges {\n    @Input() query: Query;\n    @Input() previewData: PreviewData;\n    @Input() sandbox: string;\n    @Input() displaySimilarDocuments: boolean;\n    @Input() metadata: string[];\n    @Input() leftPaneAdditionalClasses: string;\n\n    downloadUrl?: SafeResourceUrl;\n    previewDocument: PreviewDocument;\n\n    constructor(\n        private previewService: PreviewService,\n        private changeDetectorRef: ChangeDetectorRef) {\n    }\n\n    ngOnChanges(changes: SimpleChanges) {\n        if (changes[\"previewData\"]) {\n            this.downloadUrl = this.previewData ? this.previewService.makeDownloadUrl(this.previewData.documentCachedContentUrl) : undefined;\n        }\n    }\n\n    onPreviewReady(previewDocument: PreviewDocument){\n        this.previewDocument = previewDocument;\n        this.changeDetectorRef.markForCheck();\n    }\n}","<div class=\"modal-content sq-preview-popup\">\n    <sq-modal \n        [title]=\"recordTitle\"\n        [showFooter]=\"false\">\n        <div header *ngIf=\"showPreviousNext\" class=\"previousNextDocumentButtons\">\n            <button class=\"btn btn btn-outline-primary {{!previousEnabled ? 'disabled' : ''}}\" (click)=\"previous()\">\n                <span class=\"fas fa-arrow-left\" aria-hidden=\"true\"></span><span *ngIf=\"showPreviousNextText\"> {{'msg#preview.previousDocument' | sqMessage}}</span>\n            </button>\n            <button class=\"btn btn btn-outline-primary {{!nextEnabled ? 'disabled' : ''}}\" (click)=\"next()\">\n                <span class=\"fas fa-arrow-right\" aria-hidden=\"true\"></span><span *ngIf=\"showPreviousNextText\"> {{'msg#preview.nextDocument' | sqMessage}}</span>\n            </button>\n        </div>\n        <sq-preview-panel [leftPaneAdditionalClasses]=\"'d-none d-lg-block'\" [query]=\"model.query\" [previewData]=\"previewData\" [displaySimilarDocuments]=\"model.displaySimilarDocuments\" [metadata]=\"model.metadata\">\n        </sq-preview-panel>\n    </sq-modal>\n</div>","import {Component, OnInit, OnDestroy, ChangeDetectorRef, Inject} from \"@angular/core\";\nimport {Subscription} from \"rxjs\";\nimport {Query} from \"@sinequa/core/app-utils\";\nimport {Record} from \"@sinequa/core/web-services\";\nimport {MODAL_MODEL} from \"@sinequa/core/modal\";\nimport {Utils} from \"@sinequa/core/base\";\nimport {PreviewData} from \"@sinequa/core/web-services\";\nimport {SearchService} from \"@sinequa/components/search\";\nimport {PreviewService} from \"../../preview.service\";\nimport {UIService} from \"@sinequa/components/utils\";\n\nexport interface PreviewPopupModel {\n    record: Record;\n    query: Query;\n    displaySimilarDocuments: boolean;\n    metadata: string[];\n}\n\n@Component({\n    selector: \"sq-preview-popup\",\n    templateUrl: \"./preview-popup.html\",\n    styleUrls: [\"./preview-popup.css\"]\n})\nexport class BsPreviewPopup implements OnInit, OnDestroy {\n    private screenSize: string;\n    private resizeSubscription: Subscription;\n    previewData: PreviewData;\n    private previewDataError: boolean;\n\n    constructor(\n        @Inject(MODAL_MODEL) public model: PreviewPopupModel,\n        public searchService: SearchService,\n        public previewService: PreviewService,\n        protected uiService: UIService,\n        private changeDetectorRef: ChangeDetectorRef) {\n    }\n\n    ngOnInit() {\n        this.screenSize = this.uiService.screenSize;\n        this.resizeSubscription = Utils.subscribe(this.uiService.resizeEvent,\n            (event) => {\n                if (this.screenSize !== this.uiService.screenSize) {\n                    this.screenSize = this.uiService.screenSize;\n                    this.changeDetectorRef.markForCheck();\n                }\n            });\n        this.updatePreviewData(this.model.record.id);\n    }\n\n    public ngOnDestroy(): void {\n        this.resizeSubscription.unsubscribe();\n    }\n\n    get currentId(): string {\n        if (this.previewData && this.previewData.record) {\n            return this.previewData.record.id;\n        }\n        return \"\";\n    }\n\n    private updatePreviewData(id: string) {\n        this.previewService.getPreviewData(id, this.model.query).subscribe(\n            previewData => {\n                this.previewData = previewData;\n                this.previewDataError = false;\n                this.changeDetectorRef.markForCheck();\n            },\n            error => {\n                this.previewDataError = true;\n            }\n        );\n    }\n\n    public get recordTitle(): string {\n        if (this.previewData && this.previewData.record != null) {\n            return this.previewData.record.title;\n        }\n        return this.previewDataError ? \"msg#preview.noDocumentDataErrorPopupTitle\" : \"\";\n    }\n\n    public get showPreviousNextText(): boolean {\n        return this.uiService.screenSizeIsGreaterOrEqual(\"lg\");\n    }\n\n    public get showPreviousNext(): boolean {\n        return this.getSearchPositionInPage() >= 0 && !!this.searchService.results &&\n            !!this.searchService.results.records && this.searchService.results.records.length > 1;\n    }\n\n    public get previousEnabled(): boolean {\n        return this.getSearchPositionInPage() > 0;\n    }\n\n    public get nextEnabled(): boolean {\n        if (!this.searchService.results || !this.searchService.results.records) {\n            return false;\n        }\n        const searchPosition = this.getSearchPositionInPage();\n        return searchPosition >= 0 && searchPosition < (this.searchService.results.records.length - 1);\n    }\n\n    private getSearchPositionInPage(): number {\n        const id = this.currentId;\n        if (id && this.searchService.results && this.searchService.results.records) {\n            for (let i = 0, ic = this.searchService.results.records.length; i < ic; i++) {\n                const record = this.searchService.results.records[i];\n                if (record.id === id) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    public previous() {\n        if (!this.searchService.results || !this.searchService.results.records) {\n            return;\n        }\n        const index = this.getSearchPositionInPage();\n        if (index <= 0) {\n            return;\n        }\n        const item = this.searchService.results.records[index - 1];\n        this.updatePreviewData(item.id);\n    }\n\n    public next() {\n        if (!this.searchService.results || !this.searchService.results.records) {\n            return;\n        }\n        const index = this.getSearchPositionInPage();\n        if (index === -1 || index >= (this.searchService.results.records.length - 1)) {\n            return;\n        }\n        const item = this.searchService.results.records[index + 1];\n        this.updatePreviewData(item.id);\n    }\n}","<a href=\"#\" (click)=\"click($event)\" title=\"{{title | sqMessage}}\">\n    <ng-container *ngIf=\"!!icon\">\n        <span class=\"{{icon}}\"></span>\n    </ng-container>\n    <ng-container *ngIf=\"!!text\">{{text | sqMessage}}</ng-container>\n</a>","import {Component, Input} from \"@angular/core\";\nimport {Record} from \"@sinequa/core/web-services\";\nimport {Query} from \"@sinequa/core/app-utils\";\nimport {ModalService} from \"@sinequa/core/modal\";\nimport {PreviewService} from \"../../preview.service\";\n\n@Component({\n    selector: \"sq-result-link-preview\",\n    templateUrl: \"./result-link-preview.html\"\n})\nexport class BsResultLinkPreview {\n    @Input() query: Query;\n    @Input() record: Record;\n    @Input() icon: string = \"fas fa-search\";\n    @Input() text: string = \"\";\n    @Input() title: string = \"\";\n    @Input() usePopup: boolean;\n    @Input() newWindow: boolean;\n    @Input() displaySimilarDocuments: boolean;\n    @Input() metadata: string[];\n\n    constructor(\n        public modalService: ModalService,\n        public previewService: PreviewService) {\n    }\n\n    click(event: MouseEvent) {\n        if (this.usePopup) {\n            if (event.ctrlKey) {\n                this.previewService.openNewWindow(this.record, this.query);\n            }\n            else {\n                this.previewService.openModal(this.record, this.query, {displaySimilarDocuments: this.displaySimilarDocuments, metadata: this.metadata});\n            }\n        }\n        else {\n            if(this.newWindow){\n                this.previewService.openNewWindow(this.record, this.query);\n            }\n            else {\n                this.previewService.openRoute(this.record, this.query);\n            }\n        }\n        return false;\n    }\n}","<div class=\"list-group list-group-flush entity-facet\">\n    <div class=\"list-group-item align-items-center border-0 py-1 px-3 d-flex\" *ngFor=\"let value of entityValues\">\n        <span class=\"text-muted px-1 cursor-pointer\" (click)=\"toggleEntity(value)\">\n            <i class=\"far\" [ngClass]=\"{'fa-check-square': !entityHidden(value), 'fa-square': entityHidden(value)}\"></i>\n        </span>\n        <span class=\"mr-auto mx-1\">{{ value.displayValue | sqValue:column }}</span>\n        <span class=\"text-muted small mx-1\">{{ entityCount(value) }}</span>\n        <span *ngIf=\"previewDocument\" class=\"text-muted px-1 cursor-pointer\" (click)=\"prevEntity(value)\" title=\"{{ 'msg#preview.previousHighlightButtonAltText' | sqMessage }}\"><i class=\"fas fa-chevron-left\"></i></span>\n        <span *ngIf=\"previewDocument\" class=\"text-muted px-1 cursor-pointer\" (click)=\"nextEntity(value)\" title=\"{{ 'msg#preview.nextHighlightButtonAltText' | sqMessage }}\"><i class=\"fas fa-chevron-right\"></i></span>\n    </div>\n    <div class=\"list-group-item border-0 py-1 text-center\" *ngIf=\"data.length > count\">\n        <a class=\"text-muted small\" href=\"#\" (click)=\"showAll()\" title=\"{{ 'msg#preview.showAll' | sqMessage }}\">{{ 'msg#preview.showAll' | sqMessage }}</a>\n    </div>\n</div>\n","import { Component, Input, Output, EventEmitter, OnInit, OnChanges, SimpleChanges } from '@angular/core';\nimport { HighlightValue, PreviewData, CCColumn } from '@sinequa/core/web-services';\nimport { PreviewDocument } from '../../preview-document';\nimport { AbstractFacet } from '@sinequa/components/facet';\nimport { Action } from '@sinequa/components/action';\nimport { AppService } from '@sinequa/core/app-utils';\n\n@Component({\n  selector: 'sq-preview-entity-facet',\n  templateUrl: './preview-entity-facet.component.html',\n  styleUrls: ['./preview-entity-facet.component.scss']\n})\nexport class BsPreviewEntityFacetComponent extends AbstractFacet implements OnInit, OnChanges {\n  @Input() entity: string;  // Required from init\n  @Input() data: HighlightValue[];  // Required from init\n  @Input() previewData: PreviewData;  // Required from init and does not change (facet is rebuilt if it does)\n  @Input() previewDocument: PreviewDocument;  // May be null at the start\n  @Input() startUnchecked: boolean;\n  @Output() itemsChecked = new EventEmitter<boolean>();\n\n  count: number = 10;\n  sortFreq: boolean = true;\n  hidden = new Map<string, boolean>();\n  nav = new Map<string, number>();\n  column: CCColumn | undefined;\n\n  checkAction: Action;\n  sortFreqAction: Action;\n  sortAlphaAction: Action;\n\n  constructor(\n    private appService:AppService\n  ) {\n    super();\n\n    this.checkAction = new Action({\n      icon: \"far fa-check-square\",\n      title: \"msg#preview.highlightFilters.keepNone\",\n      action: this.unselectAll,\n      updater: (action: Action) => {\n        let foundHidden = false;\n        let foundNotHidden = false;\n        this.data.forEach(value => {\n          foundHidden = foundHidden || this.hidden.get(value.value) || false;\n          foundNotHidden = foundNotHidden || !this.hidden.get(value.value);\n        });\n        if(!foundHidden){ // All items selected\n          action.action = this.unselectAll;\n          action.icon = \"far fa-check-square\";\n          action.title = \"msg#preview.highlightFilters.keepNone\";\n        }\n        else if(!foundNotHidden){ // All items unselected\n          action.action = this.selectAll;\n          action.icon = \"far fa-square\";\n          action.title = \"msg#preview.highlightFilters.keepAll\";\n        }\n        else { // Some items selected\n          action.action = this.selectAll;\n          action.icon = \"far fa-check-square\";\n          action.title = \"msg#preview.highlightFilters.keepAll\";\n        }\n      }\n    });\n    this.sortAlphaAction = new Action({\n      icon: \"fas fa-sort-alpha-down\",\n      title: \"msg#preview.sortAlphabetically\",\n      action: () => {\n        this.sortFreq = false;\n      }\n    });\n    this.sortFreqAction = new Action({\n      icon: \"fas fa-sort-amount-down\",\n      title: \"msg#preview.sortFrequency\",\n      action: () => {\n        this.sortFreq = true;\n      }\n    });\n  }\n\n  get actions(): Action[]{\n    const actions: Action[] = [];\n    if(this.previewDocument){\n      actions.push(this.checkAction);\n    }\n    actions.push(this.sortFreq? this.sortAlphaAction : this.sortFreqAction);\n    return actions;\n  }\n\n  /**\n   * Uncheck items if needed\n   */\n  ngOnInit(){\n    if(this.startUnchecked){\n      this.unselectAll();\n      this.checkAction.update();\n    }\n    this.column = this.appService.getColumn(this.entity);\n  }\n\n  /**\n   * Since the preview document comes after the preview data, we need to wait for that change\n   * and apply the hidden state in the document.\n   * @param changes\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    if(changes[\"previewDocument\"]){\n      if(this.previewDocument){\n        this.data.forEach(val => {\n          if(this.hidden.get(val.value)){\n            this.previewDocument.toggleHighlight(this.entity, false, val.value);\n          }\n        });\n      }\n    }\n  }\n\n  /**\n   * Returns the entities to be displayed in the facet, performing truncation and sorting of the input list\n   */\n  get entityValues(): HighlightValue[] {\n    return this.data.sort((a,b) => {\n      const d = b.locations.length - a.locations.length;\n      return this.sortFreq && d !== 0?  d : a.displayValue.localeCompare(b.displayValue);\n    }).slice(0, this.count);\n  }\n\n  /**\n   * Returns the number of occurrences of a given value.\n   * If the user used the facet to navigate, the format is \"i / count\"\n   * @param value\n   */\n  entityCount(value: HighlightValue): string {\n    let count = value.locations.length + \"\";\n    const navValue = this.nav.get(value.value);\n    if(navValue !== undefined){\n      count = (navValue+1) + \" / \" + count;\n    }\n    return count;\n  }\n\n  /**\n   * Return whether the entity is hidden (unchecked) or not\n   * @param value\n   */\n  entityHidden(value: HighlightValue): boolean {\n    return !!this.hidden.get(value.value);\n  }\n\n  /**\n   * Shows all the entities in the list\n   */\n  showAll(){\n    this.count = this.data.length;\n    return false;\n  }\n\n  /**\n   * Toggles the hidden (checked/unchecked) state of a value in the list.\n   * Modifies the provided preview document.\n   * @param value\n   */\n  toggleEntity(value: HighlightValue){\n    this.hidden.set(value.value, !this.hidden.get(value.value));\n    if(this.previewDocument){\n      this.previewDocument.toggleHighlight(this.entity, !this.hidden.get(value.value), value.value);\n    }\n    this.checkAction.update();\n  }\n\n  /**\n   * Unselect all entities (set hidden)\n   */\n  unselectAll = (action?: Action) => {\n    if(this.previewDocument){\n      this.previewDocument.toggleHighlight(this.entity, false);\n    }\n    this.data.forEach((value)=> {\n      this.hidden.set(value.value, true);\n    });\n    if(action){\n      action.update();\n      this.itemsChecked.next(false);\n    }\n  }\n\n  /**\n   * Select all entities (unset hidden)\n   */\n  selectAll = (action: Action) => {\n    if(this.previewDocument){\n      this.previewDocument.toggleHighlight(this.entity, true);\n    }\n    this.data.forEach((value)=> {\n      this.hidden.set(value.value, false);\n    });\n    if(action){\n      action.update();\n      this.itemsChecked.next(true);\n    }\n  }\n\n  /**\n   * Navigate to the next value of this entity.\n   * Modifies the provided preview document.\n   * @param value\n   */\n  nextEntity(value: HighlightValue){\n    let navValue = this.nav.get(value.value);\n    if(navValue === undefined){\n      navValue = 0;\n      this.nav.set(value.value, navValue);\n    }\n    else if(navValue < value.locations.length-1){\n      navValue++;\n      this.nav.set(value.value, navValue);\n    }\n    this.selectEntity(this.entity, value.value, navValue);\n  }\n\n  /**\n   * Navigate to the next value of this entity.\n   * Modifies the provided preview document.\n   * @param value\n   */\n  prevEntity(value: HighlightValue){\n    let navValue = this.nav.get(value.value);\n    if(navValue === undefined){\n      navValue = 0;\n      this.nav.set(value.value, navValue);\n    }\n    else if(navValue > 0){\n      navValue--;\n      this.nav.set(value.value, navValue);\n    }\n    this.selectEntity(this.entity, value.value, navValue);\n  }\n\n  /**\n   * Navigate to the given occurrence of an entity in a specific category\n   * Modifies the provided preview document.\n   * @param category\n   * @param value\n   * @param i\n   */\n  selectEntity(category: string, value: string, i: number){\n    const indexes = this.getEntityIndexes(category, value);\n    this.previewDocument.selectHighlight(category, indexes[i]);\n  }\n\n  /**\n   * Helper function to find the indexes of all occurrences of a entity value in the document\n   * @param category\n   * @param value\n   */\n  private getEntityIndexes(category: string, value: string) {\n    const indexes: number[] = [];\n    for (let i = 0; i < this.previewData.highlightsPerLocation['length']; i++) {\n      const highlight = this.previewData.highlightsPerLocation[i];\n      const categories = Object.keys(highlight.positionInCategories);\n      for (const currentCategory of categories) {\n        if (currentCategory === category) {\n          for (const highlightValue of highlight.values) {\n            if (highlightValue === value) {\n              indexes.push(highlight.positionInCategories[category]);\n            }\n          }\n        }\n      }\n    }\n    return indexes;\n  }\n}\n","<ng-container *ngFor=\"let entity of _entities\">\n    <sq-facet-card *ngIf=\"entityValues(entity).length\" class=\"d-block my-3\" [title]=\"entityDisplay(entity)\" [icon]=\"entityIcon(entity)\" [collapsible]=\"collapsible\" [buttonsStyle]=\"style\">\n        <sq-preview-entity-facet #facet \n            [entity]=\"entity\" \n            [data]=\"entityValues(entity)\" \n            [previewData]=\"previewData\" \n            [previewDocument]=\"previewDocument\"\n            [startUnchecked]=\"startUnchecked[entity]\"\n            (itemsChecked)=\"itemsChecked(entity, $event)\">\n        </sq-preview-entity-facet>\n    </sq-facet-card>\n</ng-container>","import { Component, Input, OnChanges, Output, EventEmitter } from '@angular/core';\nimport { CategoryHighlightData, HighlightValue, PreviewData } from '@sinequa/core/web-services';\nimport { PreviewDocument } from '../../preview-document';\n\n@Component({\n  selector: 'sq-preview-entity-panel',\n  templateUrl: './preview-entity-panel.component.html',\n  styleUrls: ['./preview-entity-panel.component.scss']\n})\nexport class BsPreviewEntityPanelComponent implements OnChanges {\n\n  /**\n   * Preview data\n   */\n  @Input() previewData: PreviewData;\n\n  /**\n   * Preview document\n   */\n  @Input() previewDocument: PreviewDocument;\n\n  /**\n   * What is the style of the facets\n   */\n  @Input() style: string;\n\n  /**\n   * Whether the facets are collapsible\n   */\n  @Input() collapsible: boolean = true;\n\n  /**\n   * Allows to uncheck all items from specific facets\n   */\n  @Input() startUnchecked: {[entity: string]: boolean} = {};\n\n  /**\n   * The list of entities to display (if ignored, will be deducted from the preview data)\n   */\n  @Input() entities: string[];\n\n  /**\n   * Triggers an event when check all / check none is use in a facet\n   */\n  @Output() facetChecked = new EventEmitter<{entity: string, checked: boolean}>();\n\n  _entities: string[] = [];\n\n  constructor() { }\n\n  /**\n   * Extracts the list of entities from the preview data\n   */\n  ngOnChanges() {\n    if(this.entities && !!this.previewData){ // If the list of entities is provided as input\n      this._entities = this.entities;\n    }\n    else if(this.previewData){ // The list of entities is deduced from the preview data\n      this._entities = Object.keys(this.previewData.highlightsPerCategory).filter(value => value !== \"extractslocations\");\n    }\n    else {  // No entity to show\n      this._entities = [];\n    }\n  }\n\n  /**\n   * Return the data for a specific entity category\n   * @param entity\n   */\n  data(entity: string): CategoryHighlightData {\n    return this.previewData.highlightsPerCategory[entity];\n  }\n\n  /**\n   * Returns the display value of a specific entity\n   * @param entity\n   */\n  entityDisplay(entity: string): string {\n    return this.data(entity).categoryDisplayLabelPlural || this.data(entity).categoryDisplayLabel || entity;\n  }\n\n  /**\n   * Returns the icon of a specific entity\n   * @param entity\n   */\n  entityIcon(entity: string): string {\n    return \"sq-icon-\"+entity;\n  }\n\n  /**\n   * Returns the list of values of a specific entity\n   * @param entity\n   */\n  entityValues(entity: string): HighlightValue[] {\n    return this.data(entity).values;\n  }\n\n  /**\n   * Called by child facet when items are checked/unchecked\n   * @param entity\n   * @param checked\n   */\n  itemsChecked(entity: string, checked: boolean){\n    this.facetChecked.next({entity: entity, checked: checked});\n  }\n\n}\n","<ng-container *ngIf=\"previewData\">\n    <div class=\"d-flex justify-content-between p-2\" *ngIf=\"extracts?.length > 0\">\n        <button class=\"btn btn-light\" (click)=\"previousExtract()\" [disabled]=\"currentIndex < 1\">\n            <i class=\"fas fa-arrow-left\"></i>&nbsp;{{ 'msg#preview.previousDocument' | sqMessage}}\n        </button>\n        <div class=\"btn-group\" [sq-action-buttons]=\"{items: [sortAction], autoAdjust: true}\" ></div>\n        <button class=\"btn btn-light float-right\" (click)=\"nextExtract()\" [disabled]=\"currentIndex >= extracts.length-1\">\n            {{ 'msg#preview.nextDocument' | sqMessage}}&nbsp;<i class=\"fas fa-arrow-right\"></i>\n        </button>\n    </div>\n\n    <div *ngIf=\"loading\" class=\"d-flex justify-content-center align-items-center h-100\">\n        <div class=\"spinner-grow\" role=\"status\"></div>\n    </div>\n    <div class=\"text-center text-muted\" *ngIf=\"!loading && extracts?.length === 0; else extractsTpl\">\n        <span>{{ 'msg#preview.noextract' | sqMessage}}</span>\n    </div>\n    \n    <ng-template #extractsTpl>\n        <cdk-virtual-scroll-viewport #scrollViewport [itemSize]=\"64\" style=\"height: 100%;\">\n            <div *cdkVirtualFor=\"let extract of extracts; let i = index\" class=\"pl-2 pr-2\">\n                <a  href=\"#\" \n                    class=\"card my-1 list-group-item-action\"\n                    [ngClass]=\"{'active': i === currentIndex}\"\n                    (click)=\"scrollExtract(extract, i)\">\n                    <p class=\"card-body m-0\" [innerHTML]=\"extract.text\"></p>\n                </a>\n            </div>\n        </cdk-virtual-scroll-viewport>\n    </ng-template>\n</ng-container>\n\n<div class=\"text-center\" *ngIf=\"!previewData\">\n    {{ 'msg#preview.loading' | sqMessage}}\n</div>","import { ChangeDetectionStrategy, ChangeDetectorRef, Component, Inject, Input, OnChanges, OnDestroy, SimpleChanges, ViewChild } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\nimport {DOCUMENT} from '@angular/common';\nimport {CdkVirtualScrollViewport} from '@angular/cdk/scrolling';\nimport {Subscription} from 'rxjs';\n\nimport { HighlightValue, PreviewData } from '@sinequa/core/web-services';\nimport {Action} from \"@sinequa/components/action\";\n\nimport { PreviewDocument } from '../../preview-document';\nimport {PreviewService} from '../../preview.service';\n\nexport class Extract {\n  text: SafeHtml; // Sanitized HTML text\n  startIndex : number; // this is the start index of the extracts within the Document Text  \n  relevanceIndex : number; // 0 the most relevant to N the less relevant\n  textIndex : number; // index of the extract in the text. e.g 0 is the first extract displayed in the document\n}\n\n@Component({\n  selector: 'sq-preview-extracts-panel',\n  templateUrl: './preview-extracts-panel.component.html',\n  styleUrls: ['./preview-extracts-panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class BsPreviewExtractsPanelComponent implements OnChanges, OnDestroy {\n  @Input() previewData: PreviewData;\n  @Input() previewDocument: PreviewDocument;\n  @Input() downloadUrl: string;\n  @Input() style: \"light\"|\"dark\" = \"light\";\n  @ViewChild(\"scrollViewport\") cdkScrollViewport: CdkVirtualScrollViewport;\n\n  sortAction : Action;\n  extracts: Extract[] = [];\n  currentIndex = -1;\n  loading = false;\n  loadCompleteSubscription: Subscription;\n\n  constructor(\n    @Inject(DOCUMENT) document: Document,\n    private previewService: PreviewService,\n    private cdr: ChangeDetectorRef,\n    private domSanitizer: DomSanitizer) { }\n\n  ngOnDestroy() {\n    if(this.loadCompleteSubscription) {\n      this.loadCompleteSubscription.unsubscribe();\n    }\n  }\n    \n  /**\n   * Extracts the list of extracts from the preview document\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    this.extracts = [];\n    if (this.previewData && this.previewDocument) {\n      const extracts = this.previewData.highlightsPerCategory[\"extractslocations\"]?.values; //Extract locations Array ordered by \"relevance\"\n      if (!!extracts && extracts.length > 0) {\n        this.extractAll(extracts, this.previewDocument);\n        return;\n      }\n    }\n    \n    if(this.previewData && this.downloadUrl){\n      const extracts = this.previewData.highlightsPerCategory[\"extractslocations\"]?.values; //Extract locations Array ordered by \"relevance\"\n      if(!!extracts && extracts.length > 0){\n        this.loading = true;\n\n        if (this.previewDocument) {\n          this.extractAll(extracts, this.previewDocument)\n        } else {\n          this.previewService.getHtmlPreview(this.downloadUrl)\n            .subscribe((value) => {\n              const previewDocument = this.createDocument(value);\n              this.extractAll(extracts, previewDocument);\n            });\n        }\n      }\n    }\n  }\n  \n  private createDocument(value: string): PreviewDocument {\n    const doc = document.implementation.createHTMLDocument(\"\");\n    doc.write(value);\n    doc.close();\n    let previewDocument = new PreviewDocument(doc);\n\n    const count = previewDocument.document.querySelectorAll(\"[id^='extractslocations']\").length;\n    if (count === 0 && this.previewDocument) {\n      // use previous document to retrieve extracts\n      previewDocument = this.previewDocument;\n    }\n    \n    return previewDocument;\n  }\n\n  private extractAll(extracts:HighlightValue[], previewDocument: PreviewDocument) {\n    // Init the extracts Array and storing the relevancy index = i because extractsLocations is already ordered by relevance\n    // but extract's text is sort by \"start\", that why text is set to empty here\n    this.extracts = extracts[0].locations.map((el, i) => ({\n      text: \"\",\n      startIndex: el.start,\n      relevanceIndex: i,  // used to sort by relevance index\n      textIndex: 0\n    }));\n\n    // next sort the array by startIndex to extract the correct extract's text\n    // and set the textIndex\n    this.extracts.sort((a, b) => a.startIndex - b.startIndex) // Sorting by start index (text index)\n    .forEach((el, i) => {\n      el.text = this.sanitize(previewDocument.getHighlightText(\"extractslocations\", i)); // get the text\n      el.textIndex = i // Storing the TextIndex to be able to select extracts\n    });\n\n    // do not take item without text\n    this.extracts = this.extracts.filter(el => el.text !== '');\n    \n    // finally sort extracts by relevance\n    this.extracts.sort((a,b) => a.relevanceIndex - b.relevanceIndex);\n    \n    this.buildSortAction();\n          \n    this.loading = false;\n    this.currentIndex = -1;\n    this.cdr.detectChanges();\n  }\n\n  /**\n   * Build Sort Action for Extracts\n   * @param i \n   */\n  buildSortAction(){\n    this.sortAction = new Action({\n      title: \"msg#sortSelector.sortByTitle\",\n      text:  \"msg#preview.relevanceSortHighlightButtonText\",\n      children: [\n        new Action({\n          icon: 'fas fa-sort-amount-down',\n          text: \"msg#preview.relevanceSortHighlightButtonText\",\n          action: (item: Action, event: Event) => {\n            // return a new map to re-render the collection\n            this.extracts = this.extracts.map(el => el).sort((a, b) => a.relevanceIndex - b.relevanceIndex);\n            this.sortAction.text = item.text;\n            this.currentIndex = -1;\n            }\n        }),\n        new Action({\n          icon: 'fas fa-sort-amount-down',\n          text: \"msg#preview.textOrderSortHighlightButtonText\",\n          action: (item: Action, event: Event) => {\n            // return a new map to re-render the collection\n            this.extracts = this.extracts.map(el => el).sort((a,b) => a.textIndex-b.textIndex);\n            this.sortAction.text = item.text;\n            this.currentIndex = -1;\n          }\n        })\n      ]\n    });\n\n  }\n\n  /**\n   * Scroll to a specific extract\n   * @param i\n   */\n  scrollExtract(extract: Extract, index?: number) {\n    if (index !== undefined) {\n      this.currentIndex = index;\n    }\n\n    if (this.previewDocument) {\n      // extracts are always at textIndex position whatever the sort\n      this.previewDocument.selectHighlight(\"extractslocations\", extract.textIndex);\n    }\n    return false;\n  }\n\n  /**\n   * Sanitize the text of a HTML formatted extract\n   * @param text\n   */\n  sanitize(text: string): SafeHtml | string {\n    return text !== \"\" ? this.domSanitizer.bypassSecurityTrustHtml(text.replace(/sq\\-current/, \"\")) : \"\";\n  }\n\n  /**\n   * Select the previous extract in the list\n   */\n  previousExtract(){\n    this.currentIndex--;\n    this.scrollTo();\n  }\n\n  /**\n   * Select the next extract in the list\n   */\n  nextExtract(){\n    this.currentIndex++;\n    this.scrollTo();\n  }\n  \n  private scrollTo() {\n    this.cdkScrollViewport.scrollToIndex(this.currentIndex);\n    const extract = this.extracts[this.currentIndex];\n    this.scrollExtract(extract);\n  }\n}\n","import { Component, EventEmitter, Input, Output, OnChanges } from '@angular/core';\nimport { FormBuilder, FormGroup, FormControl } from '@angular/forms';\nimport { Query } from '@sinequa/core/app-utils';\n\n@Component({\n  selector: 'sq-preview-search-form',\n  templateUrl: './preview-search-form.component.html',\n  styleUrls: ['./preview-search-form.component.scss']\n})\nexport class BsPreviewSearchFormComponent implements OnChanges {\n  @Input() query: Query;\n  @Output() searchText = new EventEmitter<string>();\n\n  // Search form\n  readonly form: FormGroup;\n  readonly searchControl: FormControl;\n\n  constructor(\n    private formBuilder: FormBuilder) {\n\n    this.searchControl = new FormControl('');\n    this.form = this.formBuilder.group({\n      search: this.searchControl\n    });\n  }\n\n  /**\n   * Updates the text of the search form when the query changes\n   */\n  ngOnChanges() {\n    this.searchControl.setValue((!this.query || !this.query.text) ? \"\" : this.query.text);\n  }\n\n  /**\n   * Emits an event for the parent component to search this next text\n   */\n  search() {\n    this.searchText.next(this.searchControl.value || \"\");\n  }\n}\n","<form novalidate [formGroup]=\"form\">\n    <div class=\"input-group mb-3\">\n        <div class=\"input-group-prepend\">\n            <label for=\"search-input\" class=\"input-group-text\">{{ 'msg#preview.search' | sqMessage }}</label>\n        </div>\n\n        <input id=\"search-input\" type=\"text\" placeholder=\"{{ 'msg#searchForm.searchFor' | sqMessage }}\" formControlName=\"search\" class=\"form-control\" sqAutofocus>\n\n        <div class=\"input-group-append\">\n            <button class=\"btn btn-primary\" type=\"submit\" (click)=\"search()\" \n                title=\"{{ 'msg#searchForm.search' | sqMessage }}\">\n                <i class=\"fas fa-fw fa-search\"></i>\n            </button>\n        </div>\n    </div>\n</form>","<div class=\"list-group\" *ngIf=\"sortedPages\">\n\n    <!-- First page link if needed-->\n    <a href=\"#\" class=\"card my-1 list-group-item-action\"\n        (click)=\"selectPage(1)\"\n        *ngIf=\"!hasFirst\">\n        <div class=\"card-body\">\n            <span class=\"small text-muted\">{{ 'msg#preview.page' | sqMessage:{values:{page: 1} } }}</span>\n            <div class=\"text-center my-3\" *ngIf=\"_pendingPage === 1\">\n                <div class=\"spinner-grow\" role=\"status\"></div>\n            </div>\n        </div>\n    </a>\n\n    <!-- For each page in the document -->\n    <ng-container *ngFor=\"let page of sortedPages\">\n\n        <!-- Link to page other than current -->\n        <a href=\"#\" class=\"card my-1 list-group-item-action\"\n            (click)=\"selectPage(page.$page)\"\n            *ngIf=\"currentPage !== page.$page\">\n            <div class=\"card-body\" >\n                <span class=\"small text-muted\">{{ 'msg#preview.page' | sqMessage:{values:{page: page.$page} } }}</span>\n                <p [innerHTML]=\"page.relevantExtracts\" *ngIf=\"_pendingPage !== page.$page\"></p>\n                <div class=\"text-center my-3\" *ngIf=\"_pendingPage === page.$page\">\n                    <div class=\"spinner-grow\" role=\"status\"></div>\n                </div>\n            </div>\n        </a>\n\n        <!-- For current page we display extracts -->\n        <ng-container *ngIf=\"currentPage === page.$page\">\n            <a href=\"#\" class=\"card my-1 list-group-item-action\"\n                *ngIf=\"!hasPrevious\"\n                (click)=\"selectPrevious()\">\n                <div class=\"card-body\">\n                    <span class=\"small text-muted\">{{ 'msg#preview.page' | sqMessage:{values:{page: currentPage - 1} } }} ({{ 'msg#preview.previousDocument' | sqMessage }})</span>\n                    <div class=\"text-center my-3\" *ngIf=\"_pendingPage === currentPage - 1\">\n                        <div class=\"spinner-grow\" role=\"status\"></div>\n                    </div>\n                </div>\n            </a>\n            <div class=\"card my-1\" #currentPageEl>\n                <div class=\"card-body m-0\">\n                    <span class=\"small font-weight-bold mb-1\">{{ 'msg#preview.page' | sqMessage:{values:{page: currentPage} } }} ({{ 'msg#preview.current' | sqMessage }})</span>\n                    <sq-preview-extracts-panel \n                        *ngIf=\"!_pendingPreviewDocument\" \n                        class=\"d-flex flex-column\"\n                        style=\"height: 300px;\"\n                        [previewData]=\"previewData\"\n                        [previewDocument]=\"previewDocument\"\n                        [style]=\"style\">\n                    </sq-preview-extracts-panel>\n                </div>\n            </div>\n            <a href=\"#\" class=\"card my-1 list-group-item-action\"\n                *ngIf=\"!hasNext\"\n                (click)=\"selectNext()\">\n                <div class=\"card-body\">\n                    <span class=\"small text-muted\">{{ 'msg#preview.page' | sqMessage:{values:{page: currentPage + 1} } }} ({{ 'msg#preview.nextDocument' | sqMessage }})</span>\n                    <div class=\"text-center my-3\" *ngIf=\"_pendingPage === currentPage + 1\">\n                        <div class=\"spinner-grow\" role=\"status\"></div>\n                    </div>\n                </div>\n            </a>\n        </ng-container>\n\n    </ng-container>\n</div>","import { Component, Input, Output, OnChanges, SimpleChanges, EventEmitter, ViewChildren, ElementRef, QueryList } from \"@angular/core\";\nimport { PreviewDocument } from \"../../preview-document\";\nimport { PreviewService } from \"../../preview.service\";\nimport { PreviewData, Results, Record } from \"@sinequa/core/web-services\";\n\n@Component({\n    selector: 'sq-preview-pages-panel',\n    templateUrl: './preview-pages-panel.component.html'\n})\nexport class BsPreviewPagesPanelComponent implements OnChanges {\n    @Input() pages: Results;\n    @Input() previewData: PreviewData;\n    @Input() previewDocument: PreviewDocument;\n    @Input() style: \"light\"|\"dark\" = \"light\";\n    @Output() gotopage = new EventEmitter<number>();\n\n    @ViewChildren('currentPageEl', {read: ElementRef}) currentPageEl: QueryList<ElementRef>;\n\n    sortedPages: Record[];\n\n    containerid: string;\n    currentPage: number;\n\n    hasFirst: boolean;\n    hasPrevious: boolean;\n    hasNext: boolean;\n\n    _pendingPreviewDocument: boolean = true;\n    _pendingPages: boolean = true;\n    _pendingPage?: number;\n\n    constructor(public previewService: PreviewService) {\n\n    }\n\n    ngOnChanges(changes: SimpleChanges) {\n\n        // PreviewData should change first, which triggers the new previewDocument and pages\n        if(changes[\"previewData\"]) {\n            this._pendingPreviewDocument = true;\n            this._pendingPages = true;\n        }\n\n        if(changes[\"previewDocument\"]) {\n            this._pendingPreviewDocument = false;\n        }\n\n        if(changes[\"pages\"]) {\n            this._pendingPages = false;\n        }\n\n        // ngOnChanges is called multiple times due to async updates of the Inputs()\n        // The _pending variables let us wait for all these inputs to come in before apply the changes\n        if(!this._pendingPreviewDocument && !this._pendingPages) {\n            this._pendingPage = undefined;\n\n            if(this.previewData) {\n                this.currentPage = this.previewData.record.$page!;\n                this.containerid = this.previewData.record.containerid!;\n            }\n    \n            if(this.pages && this.currentPage && this.containerid) {\n\n                this.sortedPages = this.pages.records;\n    \n                // Parse the page number from each record id\n                this.sortedPages.forEach(record => {\n                    this.previewService.getPageNumber(record);\n                    if(!record.$page) {\n                        throw new Error(\"Record is not page... \"+ record.id);\n                    }\n                });\n    \n                // Insert current page if missing (possible when navigating to previous/next page)\n                if(!this.sortedPages.find(page => page.$page === this.currentPage)) {\n                    this.sortedPages.push(this.previewData.record);\n                }\n    \n                // Sort the pages\n                this.sortedPages.sort((a,b) => a.$page! - b.$page!);\n    \n                // Update current page neighbours\n                this.hasFirst = !!this.sortedPages.find(page => page.$page! === 1 || this.currentPage === 2 ); // include 2nd page, because is covered by the previous page below\n                this.hasPrevious = this.currentPage === 1 || !!this.sortedPages.find(page => page.$page === this.currentPage - 1);\n                this.hasNext = !!this.sortedPages.find(page => page.$page === this.currentPage + 1);\n            }\n\n            // SetTimeout is needed to scroll only after the DOM changes\n            setTimeout(() => {\n                this.currentPageEl?.first?.nativeElement.scrollIntoView({behaviour: \"smooth\", block: \"start\"});\n            });\n        }\n\n    }\n\n    selectPage(page: number) {\n        this.gotopage.next(page);\n        this._pendingPage = page;\n        return false;\n    }\n\n    selectPrevious() {\n        return this.selectPage(this.currentPage-1);\n    }\n\n    selectNext() {\n        return this.selectPage(this.currentPage+1);\n    }\n}","<form novalidate [formGroup]=\"form\" *ngIf=\"pageNumber\" class=\"mb-2\">\n    <div [sqValidation]=\"{form: form, controlName: 'page'}\" class=\"input-group mb-1\">\n        <div class=\"input-group-prepend\">\n            <label for=\"page-input\" class=\"input-group-text\">{{ 'msg#preview.gotopage' | sqMessage}}</label>\n        </div>\n        <input id=\"page-input\" type=\"text\" class=\"form-control\" placeholder=\"page\" formControlName=\"page\" autocomplete=\"off\" spellcheck=\"off\">\n        <div class=\"input-group-append\">\n            <button class=\"btn btn-primary\" type=\"submit\" (click)=\"submit()\" >\n                <i class=\"fas fa-fw fa-arrow-right\"></i>\n            </button>\n        </div>\n    </div>\n</form>","import { Component, EventEmitter, Input, OnChanges, Output } from \"@angular/core\";\nimport { FormBuilder, FormControl, FormGroup } from \"@angular/forms\";\nimport { ValidationService } from \"@sinequa/core/validation\";\n\n@Component({\n    selector: 'sq-preview-page-form',\n    templateUrl: './preview-page-form.component.html'\n})\nexport class BsPreviewPageFormComponent implements OnChanges{\n    @Input() pageNumber?: number;\n    @Output() gotopage = new EventEmitter<number>();\n\n    form: FormGroup;\n    pageControl: FormControl;\n\n    constructor(\n        formBuilder: FormBuilder,\n        validationService: ValidationService\n    ) {\n        this.pageControl = new FormControl('', [validationService.integerValidator(), validationService.minValidator(1)]);\n        this.form = formBuilder.group({\n          page: this.pageControl\n        });\n    }\n\n    ngOnChanges() {\n        this.pageControl.setValue(this.pageNumber);\n    }\n\n    submit() {\n        const page = parseInt(this.pageControl.value, 10);\n        if(!isNaN(page) && page !== this.pageNumber) {\n            // remember the page number submitted\n            // this allow us to submit again the previous page \n            // when page not exists and/or an error is triggered\n            this.pageNumber = page;\n            this.gotopage.next(page);\n        }\n    }\n\n}","import {NgModule} from \"@angular/core\";\nimport {CommonModule} from \"@angular/common\";\nimport {FormsModule, ReactiveFormsModule} from \"@angular/forms\";\nimport {ScrollingModule} from \"@angular/cdk/scrolling\";\n\nimport {IntlModule} from \"@sinequa/core/intl\";\nimport {WebServicesModule} from \"@sinequa/core/web-services\";\nimport {ValidationModule} from \"@sinequa/core/validation\";\n\nimport {UtilsModule} from \"@sinequa/components/utils\";\nimport {CollapseModule} from \"@sinequa/components/collapse\";\nimport {MetadataModule} from \"@sinequa/components/metadata\";\nimport {BsModalModule} from \"@sinequa/components/modal\";\nimport {BsFacetModule} from \"@sinequa/components/facet\";\nimport {ResultModule} from \"@sinequa/components/result\";\nimport {BsActionModule} from \"@sinequa/components/action\";\nimport {PreviewModule} from \"../preview.module\";\nimport {BsPreviewHighlights} from \"./preview-highlights/preview-highlights\";\nimport {BsPreviewLinks} from \"./preview-links/preview-links\";\nimport {BsPreviewPopup} from \"./preview-popup/preview-popup\";\nimport {BsPreviewPanel} from \"./preview-panel/preview-panel\";\nimport {BsResultLinkPreview} from \"./result-link-preview/result-link-preview\";\nimport {BsFacetPreview} from \"./facet-preview/facet-preview\";\nimport {BsSimilarDocuments} from \"./similar-documents/similar-documents\";\nimport {BsFacetPreviewComponent2 } from './facet-preview-2/facet-preview.component';\nimport {BsPreviewEntityFacetComponent} from './preview-entity-facet/preview-entity-facet.component';\nimport {BsPreviewEntityPanelComponent} from './preview-entity-panel/preview-entity-panel.component';\nimport {BsPreviewExtractsPanelComponent} from './preview-extracts-panel/preview-extracts-panel.component';\nimport {BsPreviewSearchFormComponent} from './preview-search-form/preview-search-form.component';\nimport {BsPreviewPagesPanelComponent} from './preview-pages-panel/preview-pages-panel.component';\nimport {BsPreviewPageFormComponent} from './preview-page-form/preview-page-form.component';\n\nimport {PREVIEW_MODAL} from '../preview.service';\n\n@NgModule({\n    imports: [\n        CommonModule,\n        FormsModule, ReactiveFormsModule,\n        ScrollingModule,\n\n        IntlModule,\n        WebServicesModule,\n        ValidationModule,\n\n        UtilsModule,\n        CollapseModule,\n        MetadataModule,\n        BsModalModule,\n        BsFacetModule,\n        ResultModule,\n        BsActionModule,\n        PreviewModule\n    ],\n    declarations: [\n        BsPreviewHighlights, BsPreviewLinks,\n        BsPreviewPopup, BsPreviewPanel, BsResultLinkPreview,\n        BsFacetPreview, BsFacetPreviewComponent2,\n        BsSimilarDocuments,\n        BsPreviewEntityFacetComponent,\n        BsPreviewEntityPanelComponent,\n        BsPreviewExtractsPanelComponent,\n        BsPreviewSearchFormComponent,\n        BsPreviewPagesPanelComponent,\n        BsPreviewPageFormComponent\n    ],\n    exports: [\n        PreviewModule,\n        BsPreviewHighlights, BsPreviewLinks,\n        BsPreviewPopup, BsPreviewPanel, BsResultLinkPreview,\n        BsFacetPreview, BsFacetPreviewComponent2,\n        BsSimilarDocuments,\n        BsPreviewEntityFacetComponent,\n        BsPreviewEntityPanelComponent,\n        BsPreviewExtractsPanelComponent,\n        BsPreviewSearchFormComponent,\n        BsPreviewPagesPanelComponent,\n        BsPreviewPageFormComponent\n    ],\n    providers: [\n        {provide: PREVIEW_MODAL, useValue: BsPreviewPopup}\n    ]\n})\nexport class BsPreviewModule {\n}","export default {\n    \"preview\": {\n        \"noDocumentDataErrorPopupTitle\": \"Error loading document's data\",\n        \"highlightsTitle\": \"Highlights\",\n        \"noEntityToHighlight\": \"No highlighted entity in document\",\n        \"termXLabel\": \"Search term {index, number}\",\n        \"otherTerms\": \"Other terms\",\n        \"previousDocument\": \"Previous\",\n        \"nextDocument\": \"Next\",\n        \"originalDocument\": \"Original document\",\n        \"selectedHighlight\": \"Selected highlight\",\n        \"noSelectedHighlight\": \"No highlight selected\",\n        \"firstHighlightButtonAltText\": \"First\",\n        \"previousHighlightButtonAltText\": \"Previous\",\n        \"nextHighlightButtonAltText\": \"Next\",\n        \"relevanceSortHighlightButtonText\": \"Relevance\",\n        \"textOrderSortHighlightButtonText\": \"Text order\",\n        \"lastHighlightButtonAltText\": \"Last\",\n        \"highlightFilters\": {\n            \"title\": \"Filters\",\n            \"keepAll\": \"All\",\n            \"keepNone\": \"None\",\n            \"keepAllInCategory\": \"All\",\n            \"keepNoneInCategory\": \"None\"\n        },\n        \"documentPropertiesTitle\": \"Details\",\n        \"similarDocumentsTitle\": \"Similar documents\",\n        \"showAll\": \"Show all values\",\n        \"sortAlphabetically\": \"Sort alphabetically\",\n        \"sortFrequency\": \"Sort by frequency\",\n        \"loading\": \"Loading...\",\n        \"noextract\": \"No extract\",\n        \"search\": \"Search\",\n        \"gotopage\": \"Go to page\",\n        \"page\": \"Page {page}\",\n        \"current\": \"current\"\n    },\n    \"facet\": {\n        \"preview\": {\n            \"closeTitle\": \"Close\",\n            \"expandTitle\": \"Maximize\",\n            \"minimize\": \"Zoom out\",\n            \"maximize\": \"Zoom in\",\n            \"toggleExtracts\": \"Toggle relevant extracts highlighting\",\n            \"toggleEntities\": \"Toggle entities highlighting\"\n        }\n    }\n};\n","export default {\n    \"preview\": {\n        \"noDocumentDataErrorPopupTitle\": \"Echec d'accès aux données de ce document\",\n        \"highlightsTitle\": \"Surlignage\",\n        \"noEntityToHighlight\": \"Aucune entité affichée dans ce document\",\n        \"termXLabel\": \"Terme recherché {index, number}\",\n        \"otherTerms\": \"Autres termes\",\n        \"previousDocument\": \"Précédent\",\n        \"nextDocument\": \"Suivant\",\n        \"originalDocument\": \"Document original\",\n        \"selectedHighlight\": \"Elément sélectionné\",\n        \"noSelectedHighlight\": \"Aucun élément sélectionné\",\n        \"firstHighlightButtonAltText\": \"Premier élément\",\n        \"previousHighlightButtonAltText\": \"Elément précédent\",\n        \"nextHighlightButtonAltText\": \"Elément suivant\",\n        \"relevanceSortHighlightButtonText\": \"Pertinence\",\n        \"textOrderSortHighlightButtonText\": \"Ordre du texte\",\n        \"lastHighlightButtonAltText\": \"Dernier élément\",\n        \"highlightFilters\": {\n            \"title\": \"Filtres\",\n            \"keepAll\": \"Tout inclure\",\n            \"keepNone\": \"Tout exclure\",\n            \"keepAllInCategory\": \"Toutes les entités\",\n            \"keepNoneInCategory\": \"Aucune entité\"\n        },\n        \"documentPropertiesTitle\": \"Détails\",\n        \"similarDocumentsTitle\": \"Documents similaires\",\n        \"showAll\": \"Montrer toutes les valeurs\",\n        \"sortAlphabetically\": \"Trier par ordre alphabetique\",\n        \"sortFrequency\": \"Trier par fréquence\",\n        \"loading\": \"Chargement...\",\n        \"noextract\": \"Pas d'extrait\",\n        \"search\": \"Recherche\",\n        \"gotopage\": \"Aller à la page\",\n        \"page\": \"Page {page}\",\n        \"current\": \"actuel\"\n    },\n    \"facet\": {\n        \"preview\": {\n            \"closeTitle\": \"Fermer\",\n            \"expandTitle\": \"Maximiser\",\n            \"minimize\": \"Réduire\",\n            \"maximize\": \"Agrandir\",\n            \"toggleExtracts\": \"Surlignage des extraits pertinents\",\n            \"toggleEntities\": \"Surlignage des entités\"\n        }\n    }\n};\n","export default {\n    \"preview\": {\n        \"noDocumentDataErrorPopupTitle\": \"Fehler beim Laden der Dokumentdaten\",\n        \"highlightsTitle\": \"Markierungen\",\n        \"noEntityToHighlight\": \"Keine Markierungen im Dokument verfügbar\",\n        \"termXLabel\": \"Suchbegriff\",\n        \"otherTerms\": \"Andere Begriffe\",\n        \"previousDocument\": \"Vorheriges Dokument\",\n        \"nextDocument\": \"Nächstes Dokument\",\n        \"originalDocument\": \"Originales Dokument\",\n        \"selectedHighlight\": \"Ausgewählte Markierung\",\n        \"noSelectedHighlight\": \"Keine Markierung ausgewählt\",\n        \"firstHighlightButtonAltText\": \"Erste Markierung\",\n        \"previousHighlightButtonAltText\": \"Vorherige Markierung\",\n        \"nextHighlightButtonAltText\": \"Nächste Markierung\",\n        \"lastHighlightButtonAltText\": \"Letzte Markierung\",\n        \"highlightFilters\": {\n            \"title\": \"Filter\",\n            \"keepAll\": \"Alle\",\n            \"keepNone\": \"Keine\",\n            \"keepAllInCategory\": \"Alle\",\n            \"keepNoneInCategory\": \"Keine\"\n        },\n        \"documentPropertiesTitle\": \"Dokumenteigenschaften\",\n        \"similarDocumentsTitle\": \"Ähnliche Dokumente\",\n        \"showAll\": \"Zeige alle Werte\",\n        \"sortAlphabetically\": \"Alphabetische Sortierung\",\n        \"sortFrequency\": \"Sortierung nach Häufigkeit\",\n        \"loading\": \"Laden...\",\n        \"noextract\": \"kein Auszug\",\n        \"search\": \"Suche\",\n        \"gotopage\": \"Zur Seite gehen\",\n        \"page\": \"Seite {page}\",\n        \"current\": \"aktuell\"\n    },\n    \"facet\": {\n        \"preview\": {\n            \"closeTitle\": \"Schließen\",\n            \"expandTitle\": \"Maximieren\",\n            \"minimize\": \"Rauszoomen\",\n            \"maximize\": \"hineinzoomen\",\n            \"toggleExtracts\": \"Schalten Sie die Hervorhebung relevanter Auszüge um\",\n            \"toggleEntities\": \"Schalten Sie die Hervorhebung von Objekten\"\n        }\n    }\n};\n","import {Utils} from \"@sinequa/core/base\";\nimport {enSearch, frSearch, deSearch} from \"@sinequa/components/search\";\nimport {enCollapse, frCollapse, deCollapse} from \"@sinequa/components/collapse\";\nimport {enMetadata, frMetadata, deMetadata} from \"@sinequa/components/metadata\";\nimport {enModal, frModal, deModal} from \"@sinequa/components/modal\";\nimport {enFacet, frFacet, deFacet} from \"@sinequa/components/facet\";\nimport {enResult, frResult, deResult} from \"@sinequa/components/result\";\n\nimport _enPreview from \"./en\";\nimport _frPreview from \"./fr\";\nimport _dePreview from \"./de\";\n\nconst enPreview = Utils.merge({}, _enPreview, enSearch, enCollapse, enMetadata, enModal, enFacet, enResult);\nconst frPreview = Utils.merge({}, _frPreview, frSearch, frCollapse, frMetadata, frModal, frFacet, frResult);\nconst dePreview = Utils.merge({}, _dePreview, deSearch, deCollapse, deMetadata, deModal, deFacet, deResult);\n\nexport { enPreview, frPreview, dePreview };\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["i0.ɵɵelement","i0.ɵɵstyleProp","i0.ɵɵproperty","i0.ɵɵattribute","i0.ɵɵelementContainerStart","i0.ɵɵelementStart","i0.ɵɵlistener","i0.ɵɵtext","i0.ɵɵelementEnd","i0.ɵɵelementContainerEnd","i0.ɵɵadvance","i0.ɵɵpropertyInterpolate","i0.ɵɵclassMap","i0.ɵɵtextInterpolate","i0.ɵɵtemplate","i0.ɵɵtextInterpolate1","i0.ɵɵclassMapInterpolate1","i0.ɵɵclassMapInterpolate2","i0.ɵɵtextInterpolate2","i0.ɵɵstyleMap"],"mappings":"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"}