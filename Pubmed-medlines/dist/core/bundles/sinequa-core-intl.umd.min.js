!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@sinequa/core/base"),require("rxjs"),require("rxjs/operators"),require("intl-messageformat"),require("intl-format-cache"),require("@formatjs/intl-relativetimeformat/polyfill"),require("intl-pluralrules"),require("lodash/get"),require("d3-format"),require("d3-time-format"),require("d3"),require("moment"),require("@angular/common")):"function"==typeof define&&define.amd?define("@sinequa/core/intl",["exports","@angular/core","@sinequa/core/base","rxjs","rxjs/operators","intl-messageformat","intl-format-cache","@formatjs/intl-relativetimeformat/polyfill","intl-pluralrules","lodash/get","d3-format","d3-time-format","d3","moment","@angular/common"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.core=e.sinequa.core||{},e.sinequa.core.intl={}),e.ng.core,e.sinequa.core.base,e.rxjs,e.rxjs.operators,e.IntlMessageFormat,e.memoizeFormatConstructor,null,null,e.get,e.d3Format,e.d3TimeFormat,e.d3,e.moment,e.ng.common)}(this,(function(e,t,r,a,n,i,o,l,s,u,c,m,d,f,g){"use strict";function h(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=h(i),v=h(o),y=h(u),b=h(f),L=function(e,t){return(L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};Object.create;function D(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,n,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(a=i.next()).done;)o.push(a.value)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}function w(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(P(arguments[t]));return e}Object.create;window.moment=b.default;var q={getMessageFormat:v.default(p.default),getNumberFormat:v.default(Intl.NumberFormat),getDateTimeFormat:v.default(Intl.DateTimeFormat),getRelativeTimeFormat:v.default(Intl.RelativeTimeFormat),getPluralRules:v.default(Intl.PluralRules)},F=["dateStyle","timeStyle","localeMatcher","timeZone","hour12","hourCycle","formatMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName"],S=["localeMatcher","style","currency","currencyDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"],C=["localeMatcher","numeric","style"],I=new t.InjectionToken("LOCALES_CONFIG"),x=new t.InjectionToken("INTL_CONFIG"),M={date:{sqDateTime:{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"},sqDate:{day:"2-digit",month:"2-digit",year:"numeric"},sqYear:{year:"numeric"},sqMonthYear:{month:"short",year:"numeric"}},time:{},number:{sqWeek:{minimumIntegerDigits:2,useGrouping:!1},sqYear:{useGrouping:!1},sqNoGrouping:{useGrouping:!1},sqZeroDecimalPlaces:{maximumFractionDigits:0},sqOneDecimalPlace:{maximumFractionDigits:1},sqTwoDecimalPlaces:{maximumFractionDigits:2},sqThreeDecimalPlaces:{maximumFractionDigits:3},sqFourDecimalPlaces:{maximumFractionDigits:4},sqFiveDecimalPlaces:{maximumFractionDigits:5}}},T=function(){function e(e,t){this.intlConfig=e,this.localesConfig=t,this.messagePrefix="msg#",this.textPrefix="txt#",this.intlConfig||(this.intlConfig={}),t||t||console.error("LOCALES_CONFIG has not been provided by the calling app. Please import IntlModule using the forRoot method to which you should pass a LocalesConfig object"),this._events=new a.Subject,this.locales=t.locales||[t.defaultLocale]}return e.getLanguage=function(e){var t=e.indexOf("-");return-1===t?e:e.substring(0,t)},e.getBrowserLanguages=function(){if(navigator.languages)return navigator.languages;var e=navigator.language||navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage;return e?[e]:[]},e.prototype.ngOnDestroy=function(){this._events.complete()},Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),e.prototype.getInitialLocale=function(){var t=window.localStorage.getItem("sinequa-locale"),r=t?[t]:e.getBrowserLanguages(),a=this.getLocale(r);return a||((a=this.getLocale(r,!0))||this.localesConfig.defaultLocale)},e.prototype.init=function(){this.formats=r.Utils.merge(M,this.intlConfig.formats);var e=this.use(this.localesConfig.defaultLocale.name,!1),t=this.getInitialLocale();return t!==this.localesConfig.defaultLocale&&(console.log("Setting initial locale: ",t.name),e=a.concat(e,this.use(t.name,!1)).pipe(n.last())),r.Utils.subscribe(e,(function(e){console.log("Initial locale set: ",e)})),e},e.prototype.loadData=function(e){return this.localesConfig.loadLocale?this.localesConfig.loadLocale(e):a.throwError("Dynamic locale loading has not been implemented in the calling app - please add a loadLocale handler to your LocalesConfig")},e.prototype.getLocale=function(t,r){var a,n;void 0===r&&(r=!1),"string"==typeof t&&(t=[t]);var i=function(t){var a=o.locales.find((function(a){return a.name===t||!(!r||e.getLanguage(a.name)!==e.getLanguage(t))}));if(a)return{value:a}},o=this;try{for(var l=D(t),s=l.next();!s.done;s=l.next()){var u=i(s.value);if("object"==typeof u)return u.value}}catch(e){a={error:e}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(a)throw a.error}}},e.prototype.use=function(e,t){var i=this;void 0===t&&(t=!0);var o=this.getLocale(e);if(!o)return a.throwError({error:"unsupported locale"});var l=o.data?a.of(o.data):this.loadData(e);r.Utils.subscribe(l,(function(e){return i.currentLocale=o,t&&window.localStorage.setItem("sinequa-locale",i.currentLocale.name),i.direction=i.currentLocale.direction||"ltr",i.currentLocale.data||(i.currentLocale.data=e),i.currentLocale.data.moment?b.default.locale(i.currentLocale.data.moment.locale)!==i.currentLocale.data.moment.locale&&(console.log("moment locale not defined: "+i.currentLocale.data.moment.locale+" - defaulting to en"),b.default.locale("en")):b.default.locale("en"),i.currentLocale.data.d3&&(c.formatDefaultLocale(i.currentLocale.data.d3.format),m.timeFormatDefaultLocale(i.currentLocale.data.d3.time),d.formatDefaultLocale(i.currentLocale.data.d3.format),d.timeFormatDefaultLocale(i.currentLocale.data.d3.time)),i.currentLocale.data.intl&&i.currentLocale.data.intl.locale?i.intlLocale=i.currentLocale.data.intl.locale:i.intlLocale=i.localesConfig.defaultLocale.data?i.localesConfig.defaultLocale.data.intl.locale:"en",a.of(i.intlLocale)}));var s=l.pipe(n.map((function(e){return i.currentLocale.name})));return r.Utils.subscribe(s,(function(e){i._events.next({locale:e})})),s},e.prototype.getDefaultMessages=function(){var e=this.locales.find((function(e){return!!e.data&&!!e.data.messages}));return e?e.data&&e.data.messages:{}},e.prototype.getMessages=function(){var e;return this.currentLocale&&this.currentLocale.data&&(e=this.currentLocale.data.messages),e||(e=this.getDefaultMessages()),e},e.prototype.getMessage=function(e){if(r.Utils.startsWith(e,this.messagePrefix)){e=e.substr(this.messagePrefix.length);var t=this.getMessages(),a=y.default(t,e);if(!a){var n=this.getDefaultMessages();t!==n&&(a=y.default(n,e))}return a}},e.prototype.nextLang=function(e,t,r){for(var a=t,n=e.length-3;a<n;a++)if("["===e[a]&&"]"===e[a+3])return{start:t,end:a,lang1:e.charCodeAt(a+1),lang2:e.charCodeAt(a+2)};if(r)return{start:t,end:e.length,lang1:-1,lang2:-1}},e.prototype.sysLang=function(e){if(!e)return e;var t=0,r=e.length,a=0;if("["===e[a]){for(;a<r&&e[a]>="0"&&e[a]<="9";)a++;"]"===e[a]&&(t=a+1)}var n=this.nextLang(e,t,!1);if(!n)return e;for(var i=this.currentLocale.name.charCodeAt(0),o=this.currentLocale.name.charCodeAt(1),l=n;l;){if(i===l.lang1&&o===l.lang2){var s=this.nextLang(e,l.end+4,!0);return e.substring(s.start,s.end)}l=this.nextLang(e,l.end+4,!1)}return e.substring(n.start,n.end)},e.prototype.processFormatMessage=function(e,t){if(void 0===t&&(t={}),!(Object.keys(t).length>0))return e;if(!e)return e;try{return q.getMessageFormat(e,this.intlLocale,this.formats,{formatters:q}).format(t)}catch(t){return console.log("IntlService.processFormatMessage error:",t),e}},e.prototype.formatMessage=function(e,t){var a,n;e=r.Utils.trim(e);var i=this.sysLang(e);if(i!==e)return i;var o={};if(t)try{for(var l=D(Object.keys(t)),s=l.next();!s.done;s=l.next()){var u=s.value,c=t[u];c&&r.Utils.isString(c)?o[u]=this.formatMessage(c):o[u]=c}}catch(e){a={error:e}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(a)throw a.error}}if(r.Utils.startsWith(e,this.messagePrefix)){if(r.Utils.eq(e,this.messagePrefix))return e;var m=this.getMessage(e);return r.Utils.isString(m)||(m=e),this.processFormatMessage(m,o)}return r.Utils.startsWith(e,this.textPrefix)?r.Utils.eq(e,this.textPrefix)?e:(e=e.substr(this.textPrefix.length),this.processFormatMessage(e,o)):e},e.prototype.formatText=function(e,t){return this.processFormatMessage(e,t)},e.prototype.parseDate=function(e){var t=b.default(e,"L");if(t.isValid())return t.toDate()},e.prototype.getNamedFormat=function(e,t){var r=this.formats&&this.formats[e]&&this.formats[e][t];if(r)return r;console.warn("IntlService.getNamedFormat - not found - type: "+e+", name: "+t)},e.prototype.filterProps=function(e,t,r){return void 0===r&&(r={}),t.reduce((function(t,a){return e.hasOwnProperty(a)?t[a]=e[a]:r.hasOwnProperty(a)&&(t[a]=r[a]),t}),{})},e.prototype.formatDate=function(e,t){void 0===t&&(t={});var r=t.format,a=e instanceof Date?e:new Date(e),n=r&&this.getNamedFormat("date",r)||{},i=this.filterProps(t,F,n);try{return q.getDateTimeFormat(this.intlLocale,i).format(a)}catch(e){console.warn("IntlService.formatDate:",e)}return String(a)},e.prototype.formatTime=function(e,t){void 0===t&&(t={});var r=t.format,a=e instanceof Date?e:new Date(e),n=r&&this.getNamedFormat("time",r)||{},i=this.filterProps(t,F,n);i.hour||i.minute||i.second||(i=Object.assign({},i,{hour:"numeric",minute:"numeric"}));try{return q.getDateTimeFormat(this.intlLocale,i).format(a)}catch(e){console.warn("IntlService.formatTime:",e)}return String(a)},e.prototype.makeRelativeTimeParams=function(e){var t=e.getTime()-r.Utils.now.getTime(),a=Math.abs(t);return a<r.Utils.oneSecond?{value:0,unit:"seconds"}:a<r.Utils.oneMinute?{value:r.Utils.roundAway(t/r.Utils.oneSecond),unit:"seconds"}:a<r.Utils.oneHour?{value:r.Utils.roundAway(t/r.Utils.oneMinute),unit:"minutes"}:a<r.Utils.oneDay?{value:r.Utils.roundAway(t/r.Utils.oneHour),unit:"hours"}:a<30*r.Utils.oneDay?{value:r.Utils.roundAway(t/r.Utils.oneDay),unit:"days"}:a<365*r.Utils.oneDay?{value:r.Utils.roundAway(t/(30*r.Utils.oneDay)),unit:"months"}:{value:r.Utils.roundAway(t/(365*r.Utils.oneDay)),unit:"years"}},e.prototype.formatRelativeTime=function(e,t,a){if(void 0===a&&(a={}),void 0===e)return"";if(r.Utils.isString(e)&&(e=new Date(e)),r.Utils.isDate(e)){var n=this.makeRelativeTimeParams(e);e=n.value,t=n.unit}var i=a.format,o=i&&this.getNamedFormat("relativeTime",i)||{},l=this.filterProps(a,C,o);l.numeric||(l.numeric="auto");try{return q.getRelativeTimeFormat(this.intlLocale,l).format(e,t)}catch(e){console.warn("IntlService.formatRelativeTime:",e)}return String(e)},e.prototype.formatNumber=function(e,t){void 0===t&&(t={});var r=t.format,a=r&&this.getNamedFormat("number",r),n=this.filterProps(t,S,a);try{return q.getNumberFormat(this.intlLocale,n).format(e)}catch(e){console.warn("IntlService.formatNumber:",e)}return String(e)},e}();T.ɵfac=function(e){return new(e||T)(t.ɵɵinject(x,8),t.ɵɵinject(I,8))},T.ɵprov=t.ɵɵdefineInjectable({token:T,factory:T.ɵfac,providedIn:"root"});var U=function(){function e(e,t){this.intlService=e,this.changeDetectorRef=t,this.value=""}return e.prototype.updateValue=function(e,t){this.lastValue=e,this.lastParams=t,this.changeDetectorRef.markForCheck()},e.prototype.transform=function(e,t){var a=this;return r.Utils.equals(e,this.lastValue)&&r.Utils.equals(t,this.lastParams)||(this.updateValue(e,t),this.localeChange||(this.localeChange=this.intlService.events.subscribe((function(n){r.Utils.isEmpty(a.lastValue)||(a.lastValue=null,a.updateValue(e,t))})))),this.value},e.prototype.ngOnDestroy=function(){this.localeChange&&this.localeChange.unsubscribe()},e}();U.ɵfac=function(e){return new(e||U)(t.ɵɵdirectiveInject(T),t.ɵɵinjectPipeChangeDetectorRef())},U.ɵpipe=t.ɵɵdefinePipe({name:"sqAbstractIntlPipe",type:U,pure:!1});var j=function(e){function t(t,r){return e.call(this,t,r)||this}return function(e,t){function r(){this.constructor=e}L(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.updateValue=function(t,a){var n;(r.Utils.isEmpty(t)||(t+=""),e.prototype.updateValue.call(this,t,a),t)?(a&&(n=a.values?a.values:a),this.value=this.intlService.formatMessage(t,n)):this.value=t},t}(U);j.ɵfac=function(e){return new(e||j)(t.ɵɵdirectiveInject(T),t.ɵɵinjectPipeChangeDetectorRef())},j.ɵpipe=t.ɵɵdefinePipe({name:"sqMessage",type:j,pure:!1});var O=[];function E(e){return function(){return e.init().toPromise()}}var N=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:I,useClass:t}]}},e}();N.ɵmod=t.ɵɵdefineNgModule({type:N}),N.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||N)},providers:w([{provide:t.APP_INITIALIZER,useFactory:E,deps:[T],multi:!0}],O),imports:[[g.CommonModule,r.BaseModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(N,{declarations:[j],imports:[g.CommonModule,r.BaseModule],exports:[j]});e.AbstractIntlPipe=U,e.INTL_CONFIG=x,e.IntlInitializer=E,e.IntlModule=N,e.IntlService=T,e.LOCALES_CONFIG=I,e.MessagePipe=j,e.deIntl={system:{date:"{time, selectordinal, =0 {{date, date}} other {{date, date}, {date, time, medium}}}",number:"{value, number}",boolean:"{value, select, true {wahr} other {falsch}}",percent:"{value, number, percent}",fieldSeparator:": ",memorySize:{bytes:"{value, number, sqZeroDecimalPlaces} B",kb:"{value, number, sqZeroDecimalPlaces} KB",mb:"{value, number, sqOneDecimalPlace} MB",gb:"{value, number, sqTwoDecimalPlaces} GB",tb:"{value, number, sqThreeDecimalPlaces} TB",pb:"{value, number, sqFourDecimalPlaces} PB"}},error:{serverError:"Serverfehler",loginCancelled:"Anmeldung abgebrochen (login cancelled)",processedCredentialsError:"Verarbeitete Anmeldeinformationen konnten nicht ermittelt werden (unable to get processed credentials)",autoLoginError:"Anmeldung fehlgeschlagen (login failed)",principalSwitched:"Der angemeldete Benutzer hat sich geändert (the logged in user has changed)",userOverrideFailure:"Benutzerwechsel fehlgeschlagen (unable to override user)",responseLoadFailure:"Antwort konnte nicht geladen werden (failed to load response)",unknownError:"Unbekannter Fehler"},language:{ar:"Arabisch",da:"Dänisch",de:"Deutsch",el:"Griechisch",en:"Englisch",es:"Spanisch",fi:"Finnisch",fr:"Französisch",it:"Italienisch",ja:"Japanisch",ko:"Koreanisch",nl:"Niederländisch",no:"Norwegisch",pl:"Polnisch",pt:"Portugiesisch",ro:"Rumänisch",ru:"Russisch",sv:"Schwedisch",th:"Thailändisch",zh:"Traditionelles Chinesisch",zs:"Vereinfachtes Chinesisch",zz:"Unbekannt"}},e.enIntl={system:{date:"{time, selectordinal, =0 {{date, date}} other {{date, date}, {date, time, medium}}}",number:"{value, number}",boolean:"{value, select, true {true} other {false}}",percent:"{value, number, percent}",fieldSeparator:": ",memorySize:{bytes:"{value, number, sqZeroDecimalPlaces} B",kb:"{value, number, sqZeroDecimalPlaces} KB",mb:"{value, number, sqOneDecimalPlace} MB",gb:"{value, number, sqTwoDecimalPlaces} GB",tb:"{value, number, sqThreeDecimalPlaces} TB",pb:"{value, number, sqFourDecimalPlaces} PB"}},error:{serverError:"Server error",loginCancelled:"login cancelled",processedCredentialsError:"unable to get processed credentials",autoLoginError:"login failed",principalSwitched:"the logged in user has changed",userOverrideFailure:"unable to override user",responseLoadFailure:"failed to load response",unknownError:"unknown error"},language:{ar:"Arabic",da:"Danish",de:"German",el:"Greek",en:"English",es:"Spanish",fi:"Finnish",fr:"French",it:"Italian",ja:"Japanese",ko:"Korean",nl:"Dutch",no:"Norwegian",pl:"Polish",pt:"Portuguese",ro:"Romanian",ru:"Russian",sv:"Swedish",th:"Thai",zh:"Traditional Chinese",zs:"Simplified Chinese",zz:"Unknown"}},e.frIntl={system:{date:"{time, selectordinal, =0 {{date, date}} other {{date, date} à {date, time, medium}}}",number:"{value, number}",boolean:"{value, select, true {vrai} other {faux}}",percent:"{value, number, percent}",fieldSeparator:" : ",memorySize:{bytes:"{value, number, sqZeroDecimalPlaces} o",kb:"{value, number, sqZeroDecimalPlaces} Ko",mb:"{value, number, sqOneDecimalPlace} Mo",gb:"{value, number, sqTwoDecimalPlaces} Go",tb:"{value, number, sqThreeDecimalPlaces} To",pb:"{value, number, sqFourDecimalPlaces} Po"}},error:{serverError:"Erreur de serveur",loginCancelled:"Connexion annulée",processedCredentialsError:"Impossible d'obtenir les informations d'identification",autoLoginError:"Echec de la connexion",principalSwitched:"L'utilisateur connecté a été modifié",userOverrideFailure:"Echec de surchargement de l'utilisateur",responseLoadFailure:"Echec de chargement de la réponse",unknownError:"Erreur inconnue"},language:{ar:"Arabe",da:"Danois",de:"Allemand",el:"Grec",en:"Anglais",es:"Espagnol",fi:"Finlandais",fr:"Français",it:"Italien",ja:"Japonais",ko:"Coréen",nl:"Néerlandais",no:"Norvégien",pl:"Polonais",pt:"Portugais",ro:"Roumain",ru:"Russe",sv:"Suédois",th:"Thaïlandais",zh:"Chinois traditionnel",zs:"Chinois simplifié",zz:"Inconnu"}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-core-intl.umd.min.js.map