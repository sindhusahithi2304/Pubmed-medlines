!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("@sinequa/core/base"),require("@sinequa/core/load-component"),require("@sinequa/core/app-utils"),require("@sinequa/core/intl"),require("@angular/common")):"function"==typeof define&&define.amd?define("@sinequa/core/validation",["exports","@angular/core","@angular/forms","@sinequa/core/base","@sinequa/core/load-component","@sinequa/core/app-utils","@sinequa/core/intl","@angular/common"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.core=e.sinequa.core||{},e.sinequa.core.validation={}),e.ng.core,e.ng.forms,e.sinequa.core.base,e.sinequa.core["load-component"],e.sinequa.core["app-utils"],e.sinequa.core.intl,e.ng.common)}(this,(function(e,t,r,i,n,a,o,l){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};Object.create;function u(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}Object.create;function v(e){return null==e||0===e.length}var f,h=function(e){return i.Utils.isArray(e)?e.map((function(e){return i.Utils.isObject(e)&&e.hasOwnProperty("value")?e.value:e})):i.Utils.isObject(e)&&e.hasOwnProperty("value")?[e.value]:[e]},m=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;(f=e.ValidatorType||(e.ValidatorType={})).Min="Min",f.Max="Max",f.Required="Required",f.Email="Email",f.Pattern="Pattern",f.Integer="Integer",f.Number="Number",f.Date="Date",f.Range="Range";var p={min:"msg#validation.min",max:"msg#validation.max",required:"msg#validation.required",requiredTrue:"msg#validation.requiredTrue",email:"msg#validation.email",minlength:"msg#validation.minLength",maxlength:"msg#validation.maxLength",pattern:"msg#validation.pattern",unique:"msg#validation.unique",integer:"msg#validation.integer",number:"msg#validation.number",date:"msg#validation.date",range:"msg#validation.range"},g=function(){function e(e,t){this.formatService=e,this.intlService=t}return e.patternValidator=function(e){return e?("string"==typeof e?(i="","^"!==e.charAt(0)&&(i+="^"),i+=e,"$"!==e.charAt(e.length-1)&&(i+="$"),t=new RegExp(i)):(i=e.toString(),t=e),function(r){var i,n;if(v(r.value))return null;var a;a=h(r.value);try{for(var o=u(a),l=o.next();!l.done;l=o.next()){var s=l.value;if(!t.test(s))return{pattern:{requiredPattern:e.toString(),actualValue:s}}}}catch(e){i={error:e}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return null}):r.Validators.nullValidator;var t,i},e.emailValidation=function(e){var t,r;if(v(e.value))return null;var i;i=h(e.value);try{for(var n=u(i),a=n.next();!a.done;a=n.next()){var o=a.value;if(!m.test(o))return{email:!0}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return null},e.prototype.getFirstError=function(e){if(e)return Object.keys(e)[0]},e.prototype.getErrorText=function(e){var t=e?p[e]:void 0;return t||"Unknown validator: "+e},e.prototype.getFirstErrorText=function(e){if(e){var t=this.getFirstError(e);if(t)return this.getErrorText(t)}},e.prototype.getFirstErrorInfo=function(e){if(e){var t=this.getFirstError(e);if(t)return e[t]}},e.prototype.minValidator=function(e,t){var r=this;return function(n){var a,o;if(v(n.value)||v(e))return null;var l;l=h(n.value);try{for(var s=u(l),c=s.next();!c.done;c=s.next()){var d=c.value;if(!v(d)){var f=d;t&&(f=r.formatService.parseValue(f,t));var m=0;if(i.Utils.isNumber(e)?i.Utils.testFloat(f)&&(m=(f=i.Utils.toNumber(f))-e):i.Utils.isString(e)?m=i.Utils.compare(f,e):i.Utils.isDate(e)&&(i.Utils.isString(f)?(f=r.intlService.parseDate(f))&&(m=f.getTime()-e.getTime()):i.Utils.isDate(f)&&(m=f.getTime()-e.getTime())),m<0)return{min:{min:e,actual:d}}}}}catch(e){a={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(a)throw a.error}}return null}},e.prototype.maxValidator=function(e,t){var r=this;return function(n){var a,o;if(v(n.value)||v(e))return null;var l;l=h(n.value);try{for(var s=u(l),c=s.next();!c.done;c=s.next()){var d=c.value;if(!v(d)){var f=d;t&&(f=r.formatService.parseValue(f,t));var m=0;if(i.Utils.isNumber(e)?i.Utils.testFloat(f)&&(m=(f=i.Utils.toNumber(f))-e):i.Utils.isString(e)?m=i.Utils.compare(f,e):i.Utils.isDate(e)&&(i.Utils.isString(f)?(f=r.intlService.parseDate(f))&&(m=f.getTime()-e.getTime()):i.Utils.isDate(f)&&(m=f.getTime()-e.getTime())),m>0)return{max:{max:e,actual:d}}}}}catch(e){a={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(a)throw a.error}}return null}},e.prototype.integerValidator=function(e){var t=this;return function(r){var n,a;if(v(r.value))return null;var o;o=h(r.value);try{for(var l=u(o),s=l.next();!s.done;s=l.next()){var c=s.value;if(!v(c)){var d=c;if(e&&(d=t.formatService.parseValue(d,e)),!i.Utils.testInteger(d))return{integer:{value:c}}}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return null}},e.prototype.numberValidator=function(e){var t=this;return function(r){var n,a;if(v(r.value))return null;var o;o=h(r.value);try{for(var l=u(o),s=l.next();!s.done;s=l.next()){var c=s.value;if(!v(c)){var d=c;if(e&&(d=t.formatService.parseValue(d,e)),!i.Utils.testFloat(d))return{number:{value:c}}}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return null}},e.prototype.dateValidator=function(e){var t=this;return function(r){var n,a;if(v(r.value))return null;var o;o=h(r.value);try{for(var l=u(o),s=l.next();!s.done;s=l.next()){var c=s.value;if(!v(c))if(i.Utils.isString(c)){var d=c;if(e&&(d=t.formatService.parseValue(d,e)),!t.intlService.parseDate(d))return{date:{value:c}}}else if(i.Utils.isDate(c)&&isNaN(c.getTime()))return{date:{value:c}}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return null}},e.prototype.rangeValidator=function(e,t){var r=this;return function(n){if(v(n.value)||!i.Utils.isArray(n.value)||2!==n.value.length)return null;var a=n.value[0],o=n.value[1];if(v(a)||v(o))return null;t&&(a=r.formatService.parseValue(a,t),o=r.formatService.parseValue(o,t));var l=0;if(i.Utils.isString(e))l=i.Utils.compare(o,a);else if(i.Utils.isDate(e)){var s=void 0,u=void 0;i.Utils.isString(a)?s=r.intlService.parseDate(a):i.Utils.isDate(a)&&(s=a),i.Utils.isString(o)?u=r.intlService.parseDate(o):i.Utils.isDate(o)&&(u=o),s&&u&&(l=u.getTime()-s.getTime())}else if(i.Utils.isNumber(e)&&i.Utils.testFloat(a)&&i.Utils.testFloat(o)){var c=i.Utils.toNumber(a),d=i.Utils.toNumber(o);null!==c&&null!==d&&(l=d-c)}return l<0?{range:{value1:a,value2:o}}:null}},e}();g.ɵfac=function(e){return new(e||g)(t.ɵɵinject(a.FormatService),t.ɵɵinject(o.IntlService))},g.ɵprov=t.ɵɵdefineInjectable({token:g,factory:g.ɵfac,providedIn:"root"});var y=new t.InjectionToken("VALIDATION_MESSAGE_COMPONENT"),q=function(){function e(e,t,r,i){this.validationMessageComponent=e,this.viewContainerRef=t,this.loadComponentService=r,this.validationService=i,this.element=t.element.nativeElement}return e.prototype.ngOnInit=function(){var e;if(this.options)if(this.options instanceof r.FormGroup?this.form=this.options:(this.form=this.options.form,e=this.options.controlName,this.validClass=this.options.validClass,this.invalidClass=this.options.invalidClass,this.childSelector=this.options.childSelector,this.errorMessages=this.options.errorMessages),this.form)if(this.form.controls){if(e)this.control=this.form.controls[e];else{var t=this.element.getAttribute("formControlName");t&&(this.control=this.form.controls[t])}this.control?(this.validClass||(this.validClass="is-valid"),this.invalidClass||(this.invalidClass="is-invalid"),i.Utils.isUndefined(this.childSelector)&&(this.childSelector=".form-control"),this.valid=this.control.valid,this.dirty=this.control.dirty,this.active=!0,this.error=void 0):console.log("Validation.ngOnInit - no control")}else console.log("Validation.ngOnInit - no form controls");else console.log("Validation.ngOnInit - no form model");else console.log("Validation.ngOnInit - no options")},e.prototype.getFirstError=function(){if(this.control.errors)return Object.keys(this.control.errors)[0]},e.prototype.getErrorText=function(e){return e&&this.errorMessages&&this.errorMessages[e]?this.errorMessages[e]:this.validationService.getErrorText(e)},e.prototype.getErrorInfo=function(e){if(e&&this.control.errors)return this.control.errors[e]},e.prototype.setValidityClasses=function(){var e=this.control.valid?this.validClass:this.invalidClass,t=this.control.valid?this.invalidClass:this.validClass;(t&&this.element.classList.remove(t),e&&this.element.classList.add(e),this.childSelector)&&Array.from(this.element.querySelectorAll(this.childSelector)).forEach((function(r){t&&r.classList.remove(t),e&&r.classList.add(e)}))},e.prototype.removeValidityClasses=function(){var e=this;(this.validClass&&this.element.classList.remove(this.validClass),this.invalidClass&&this.element.classList.remove(this.invalidClass),this.childSelector)&&Array.from(this.element.querySelectorAll(this.childSelector)).forEach((function(t){e.validClass&&t.classList.remove(e.validClass),e.invalidClass&&t.classList.remove(e.invalidClass)}))},e.prototype.ngDoCheck=function(){if(this.active){if(this.valid===this.control.valid&&this.dirty===this.control.dirty){var e=this.getFirstError(),t=this.getErrorInfo(e);if(e===this.error&&t===this.errorInfo)return;this.error=e,this.errorInfo=t}if(this.valid=this.control.valid,this.dirty=this.control.dirty,this.control.dirty)if(this.setValidityClasses(),this.control.valid)this.validationMessage&&(this.validationMessage.componentRef.instance.text="");else{this.validationMessage||(this.validationMessage=this.loadComponentService.loadComponent({component:this.validationMessageComponent},this.viewContainerRef));var r=this.getFirstError();this.validationMessage.componentRef.instance.text=this.getErrorText(r),this.validationMessage.componentRef.instance.info=this.getErrorInfo(r)}else this.removeValidityClasses(),this.validationMessage&&(this.validationMessage.componentRef.instance.text="")}},e}();q.ɵfac=function(e){return new(e||q)(t.ɵɵdirectiveInject(y),t.ɵɵdirectiveInject(t.ViewContainerRef),t.ɵɵdirectiveInject(n.LoadComponentService),t.ɵɵdirectiveInject(g))},q.ɵdir=t.ɵɵdefineDirective({type:q,selectors:[["","sqValidation",""]],inputs:{options:["sqValidation","options"]}});var S=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.validationService=i,n}return function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.updateValue=function(t,r){e.prototype.updateValue.call(this,t,r);var i=this.validationService.getFirstErrorText(t),n=this.validationService.getFirstErrorInfo(t);this.value=i?this.intlService.formatMessage(i,{values:n}):void 0},t}(o.AbstractIntlPipe);S.ɵfac=function(e){return new(e||S)(t.ɵɵdirectiveInject(o.IntlService),t.ɵɵinjectPipeChangeDetectorRef(),t.ɵɵdirectiveInject(g))},S.ɵpipe=t.ɵɵdefinePipe({name:"sqValidationError",type:S,pure:!1});var x=function(e){return{values:e}},b=function(){};b.ɵfac=function(e){return new(e||b)},b.ɵcmp=t.ɵɵdefineComponent({type:b,selectors:[["sq-validation-message"]],inputs:{text:"text",info:"info"},decls:3,vars:6,consts:[[1,"sq-validation-message"]],template:function(e,r){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵtext(1),t.ɵɵpipe(2,"sqMessage"),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(1),t.ɵɵtextInterpolate(t.ɵɵpipeBind2(2,1,r.text,t.ɵɵpureFunction1(4,x,r.info))))},pipes:[o.MessagePipe],encapsulation:2});var C=[],M=function(){};M.ɵmod=t.ɵɵdefineNgModule({type:M}),M.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||M)},providers:d([{provide:y,useValue:b}],C),imports:[[l.CommonModule,i.BaseModule,a.AppUtilsModule,o.IntlModule,n.LoadComponentModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(M,{declarations:[q,b,S],imports:[l.CommonModule,i.BaseModule,a.AppUtilsModule,o.IntlModule,n.LoadComponentModule],exports:[q,b,S]});var U=i.Utils.merge({},{validation:{min:"The value must be at least {min}",max:"The value can be no more than {max}",required:"This field is required",requiredTrue:"This field must be set",email:"A valid email address is required",minLength:"The value must have at least {requiredLength, plural, one {# character} other {# characters}}",maxLength:"The value can have no more than {requiredLength, plural, one {# character} other {# characters}}",pattern:"The value is invalid",unique:"This field must be unique",integer:"The value must be an integer",number:"The value must be a number",date:"",range:"The first value must be less than or equal to the second"}},o.enIntl),V=i.Utils.merge({},{validation:{min:"La valeur doit être supérieure ou égale à {min}",max:"La valeur ne peut pas être supérieure à {max}",required:"Ce champ est obligatoire",requiredTrue:"Ce champ doit être positionné",email:"Une adresse e-mail valide est exigée",minLength:"La valeur doit comporter au moins {requiredLength, plural, one {# caractère} autre que {# caractère}}",maxLength:"La valeur ne peut comporter plus de {requiredLength, plural, one {# caractère} autre que {# caractères}}",pattern:"La valeur est invalide",unique:"Ce champ doit être unique",integer:"La valeur doit être un entier",number:"La valeur doit être un nombre",date:"",range:"La première valeur doit être inférieure ou égale à la seconde"}},o.frIntl),T=i.Utils.merge({},{validation:{min:"Der Mindestwert ist {min}",max:"Der Wert kann nicht größer sein als {max}",required:"Dies ist ein Mussfeld",requiredTrue:"Dieses Feld muss ausgefüllt werden",email:"Eine gültige E-Mail-Adresse ist einzutragen",minLength:"Die Mindestlänge des Wertes beträgt {requiredLength, plural, one {# Zeichen} other {# Zeichen}}",maxLength:"Der Wert darf nicht mehr als {requiredLength, plural, one {# Zeichen} other {# Zeichen}} haben",pattern:"Der Wert ist ungültig",unique:"Dieses Feld muss eindeutig sein",integer:"Der Wert muss eine ganze Zahl sein",number:"Der Wert muss eine Nummer sein",date:"",range:"Der erste Wert muss kleiner oder gleich dem zweiten Wert sein"}},o.deIntl);e.VALIDATION_MESSAGE_COMPONENT=y,e.ValidationDirective=q,e.ValidationErrorPipe=S,e.ValidationMessageComponent=b,e.ValidationModule=M,e.ValidationService=g,e.deValidation=T,e.enValidation=U,e.frValidation=V,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-core-validation.umd.min.js.map