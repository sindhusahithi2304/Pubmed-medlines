!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/cdk/overlay"),require("@angular/cdk/portal"),require("@sinequa/core/base"),require("rxjs"),require("@angular/cdk/a11y"),require("@angular/common"),require("@sinequa/core/intl"),require("@angular/forms"),require("@sinequa/core/validation")):"function"==typeof define&&define.amd?define("@sinequa/core/modal",["exports","@angular/core","@angular/cdk/overlay","@angular/cdk/portal","@sinequa/core/base","rxjs","@angular/cdk/a11y","@angular/common","@sinequa/core/intl","@angular/forms","@sinequa/core/validation"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.core=e.sinequa.core||{},e.sinequa.core.modal={}),e.ng.core,e.ng.cdk.overlay,e.ng.cdk.portal,e.sinequa.core.base,e.rxjs,e.ng.cdk.a11y,e.ng.common,e.sinequa.core.intl,e.ng.forms,e.sinequa.core.validation)}(this,(function(e,t,o,n,r,i,a,s,l,c,u){"use strict";var p=function(){function e(e){var t=this;this.overlayRef=e,this._checkClose=new i.Subject,this._beforeClosed=new i.Subject,this._afterClosed=new i.Subject,this.submitListener=function(e){return t.submitted=!0,e.preventDefault(),!1}}return e.prototype.checkClose=function(){return this._checkClose.asObservable()},e.prototype.beforeClosed=function(){return this._beforeClosed.asObservable()},e.prototype.afterClosed=function(){return this._afterClosed.asObservable()},e.prototype.close=function(e){var t=this;void 0===e&&(e=-2),r.Utils.delay().then((function(){var o={result:e};t._checkClose.next(o),(o.cancelled||i.of(!1)).subscribe((function(o){o||(t._checkClose.complete(),t._beforeClosed.next(e),t._beforeClosed.complete(),t.removeSubmitListener(),t.overlayRef.detachBackdrop(),t.overlayRef.dispose(),t.componentInstance=void 0,t._afterClosed.next(e),t._afterClosed.complete())}))}))},e.prototype.disableSubmit=function(){if(!this.formElement){var e=this.overlayRef.overlayElement.querySelector("form");e&&(this.formElement=e,this.formElement.addEventListener("submit",this.submitListener))}},e.prototype.removeSubmitListener=function(){this.formElement&&(this.formElement.removeEventListener("submit",this.submitListener),this.formElement=void 0)},e}(),d={hasBackdrop:!0,backdropClass:["cdk-overlay-dark-backdrop","sq-modal-backdrop"],panelClass:"sq-modal-pane",model:null,closeOnBackdropClick:!0},m=new t.InjectionToken("MODAL_MODEL"),f=function(){function e(e){r.Utils.extend(this,{visible:!0,anchor:!1},e)}return e.prototype.getText=function(){if(this.text)return this.text;switch(this.result){case-1:return"msg#modal.buttons.ok";case-2:return"msg#modal.buttons.cancel";case-3:return"msg#modal.buttons.yes";case-4:return"msg#modal.buttons.no";case-5:return"msg#modal.buttons.abort";case-6:return"msg#modal.buttons.retry";case-7:return"msg#modal.buttons.ignore";default:return""}},e.prototype.click=function(e){this.validation&&!this.validation.valid||(this.action&&this.action(this),0!==this.result&&e.close(this.result))},e}(),v=new t.InjectionToken("MODAL_CONFIRM"),g=new t.InjectionToken("MODAL_PROMPT"),y=function(){function e(e,t,o,n){this.injector=e,this.overlay=t,this.confirmModal=o,this.promptModal=n}return e.prototype.openRef=function(e,t){void 0===t&&(t={});var o=Object.assign(Object.assign({},d),t);o.fullscreen&&(o.width="100%",o.height="100%",r.Utils.isString(o.panelClass)?o.panelClass=[o.panelClass,"sq-modal-fullscreen"]:o.panelClass?o.panelClass.push("sq-modal-fullscreen"):o.panelClass="sq-modal-fullscreen");var n=this.createOverlay(o),i=new p(n),a=this.attachDialogContainer(e,n,o,i);return i.componentInstance=a,n.hostElement.classList.add("sq-modal-host"),o.closeOnBackdropClick&&(n.backdropClick().subscribe((function(){return i.close()})),n.hostElement.addEventListener("click",(function(e){e.target===n.hostElement&&i.close()}))),n.keydownEvents().subscribe((function(e){e.keyCode===r.Keys.esc&&i.close()})),i.disableSubmit(),i},e.prototype.open=function(e,t){return void 0===t&&(t={}),this.openRef(e,t).afterClosed().toPromise()},e.prototype.createOverlay=function(e){var t=this.getOverlayConfig(e);return this.overlay.create(t)},e.prototype.attachDialogContainer=function(e,o,r,i){var a=t.Injector.create({providers:[{provide:p,useValue:i},{provide:m,useValue:r.model}],parent:this.injector}),s=new n.ComponentPortal(e,null,a);return o.attach(s).instance},e.prototype.getOverlayConfig=function(e){var t=this.overlay.position().global().centerHorizontally().centerVertically();return new o.OverlayConfig({hasBackdrop:e.hasBackdrop,backdropClass:e.backdropClass,panelClass:e.panelClass,scrollStrategy:this.overlay.scrollStrategies.block(),positionStrategy:t})},e.prototype.confirm=function(e){return this.open(this.confirmModal,{model:e})},e.prototype.prompt=function(e){return this.open(this.promptModal,{model:e})},e.prototype.oK=function(e,t,o,n){return void 0===n&&(n=0),this.confirm({title:o,message:e,messageParams:t,confirmType:n,buttons:[new f({visible:!0,result:-1,primary:!0})]})},e.prototype.oKCancel=function(e,t,o,n,r){return void 0===n&&(n=1),void 0===r&&(r=-1),this.confirm({title:o,message:e,messageParams:t,confirmType:n,buttons:[new f({visible:!0,result:-1,primary:-1===r}),new f({visible:!0,result:-2,primary:-2===r})]})},e.prototype.yesNo=function(e,t,o,n,r){return void 0===n&&(n=1),void 0===r&&(r=-3),this.confirm({title:o,message:e,messageParams:t,confirmType:n,buttons:[new f({visible:!0,result:-3,primary:-3===r}),new f({visible:!0,result:-4,primary:-4===r})]})},e}();function h(e,o){if(1&e){var n=t.ɵɵgetCurrentView();t.ɵɵelementStart(0,"button",4),t.ɵɵlistener("click",(function(){t.ɵɵrestoreView(n);var e=t.ɵɵnextContext().$implicit;return t.ɵɵnextContext().buttonClick(e)})),t.ɵɵtext(1),t.ɵɵpipe(2,"sqMessage"),t.ɵɵelementEnd()}if(2&e){var r=t.ɵɵnextContext().$implicit;t.ɵɵpropertyInterpolate("type",r.primary?"submit":"button"),t.ɵɵadvance(1),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(2,2,r.getText()))}}function b(e,o){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵtemplate(1,h,3,4,"button",3),t.ɵɵelementContainerEnd()),2&e){var n=o.$implicit;t.ɵɵadvance(1),t.ɵɵproperty("ngIf",n.visible)}}y.ɵfac=function(e){return new(e||y)(t.ɵɵinject(t.Injector),t.ɵɵinject(o.Overlay),t.ɵɵinject(v),t.ɵɵinject(g))},y.ɵprov=t.ɵɵdefineInjectable({token:y,factory:y.ɵfac,providedIn:"root"});var C=function(){function e(e,t){this.model=e,this.modalRef=t}return Object.defineProperty(e.prototype,"title",{get:function(){return this.model.title?this.model.title:"msg#modal.confirm.title"},enumerable:!1,configurable:!0}),e.prototype.buttonClick=function(e){e.click(this.modalRef)},e}();function k(e,o){1&e&&t.ɵɵelement(0,"input",7)}function M(e,o){if(1&e&&(t.ɵɵelementStart(0,"textarea",8),t.ɵɵtext(1,"            "),t.ɵɵelementEnd()),2&e){var n=t.ɵɵnextContext();t.ɵɵpropertyInterpolate("rows",n.model.rowCount)}}function x(e,o){if(1&e&&(t.ɵɵelementContainerStart(0),t.ɵɵelement(1,"br"),t.ɵɵelementStart(2,"span",9),t.ɵɵtext(3),t.ɵɵpipe(4,"sqValidationError"),t.ɵɵelementEnd(),t.ɵɵelementContainerEnd()),2&e){var n,r=t.ɵɵnextContext();t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(4,1,null==(n=r.form.get("input"))?null:n.errors))}}C.ɵfac=function(e){return new(e||C)(t.ɵɵdirectiveInject(m),t.ɵɵdirectiveInject(p))},C.ɵcmp=t.ɵɵdefineComponent({type:C,selectors:[["sq-core-confirm"]],decls:9,vars:9,consts:[["cdkTrapFocus","",2,"border","solid","padding","16px","background-color","white",3,"cdkTrapFocusAutoCapture"],[2,"margin-top","0"],[4,"ngFor","ngForOf"],[3,"type","click",4,"ngIf"],[3,"type","click"]],template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div",0),t.ɵɵelementStart(1,"h3",1),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"div"),t.ɵɵtext(5),t.ɵɵpipe(6,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelement(7,"hr"),t.ɵɵtemplate(8,b,2,1,"ng-container",2),t.ɵɵelementEnd()),2&e&&(t.ɵɵproperty("cdkTrapFocusAutoCapture",!0),t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(3,4,o.title)),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind2(6,6,o.model.message,o.model.messageParams)),t.ɵɵadvance(3),t.ɵɵproperty("ngForOf",o.model.buttons))},directives:[a.CdkTrapFocus,s.NgForOf,s.NgIf],pipes:[l.MessagePipe],encapsulation:2});var I=function(){function e(e,t,o){this.model=e,this.modalRef=t,this.formBuilder=o}return e.prototype.ngOnInit=function(){var e=this;this.inputControl=new c.FormControl(this.model.output,this.model.validators||c.Validators.required),this.form=this.formBuilder.group({input:this.inputControl}),this.formChanges=r.Utils.subscribe(this.form.valueChanges,(function(t){e.model.output=e.inputControl.value}))},e.prototype.ngOnDestroy=function(){this.formChanges.unsubscribe()},e.prototype.showError=function(e){return e.invalid&&(e.dirty||this.modalRef.submitted)},e.prototype.ok=function(){this.form.valid&&this.modalRef.close(-1)},e.prototype.cancel=function(){this.modalRef.close(-2)},Object.defineProperty(e.prototype,"title",{get:function(){return this.model.title?this.model.title:"msg#modal.prompt.title"},enumerable:!1,configurable:!0}),e}();I.ɵfac=function(e){return new(e||I)(t.ɵɵdirectiveInject(m),t.ɵɵdirectiveInject(p),t.ɵɵdirectiveInject(c.FormBuilder))},I.ɵcmp=t.ɵɵdefineComponent({type:I,selectors:[["sq-core-prompt"]],decls:17,vars:18,consts:[["novalidate","","cdkTrapFocus","",2,"border","solid","padding","16px","background-color","white",3,"formGroup","cdkTrapFocusAutoCapture"],[2,"margin-top","0"],["type","text","formControlName","input",4,"ngIf"],["type","text","formControlName","input","spellcheck","on","autofocus","",3,"rows",4,"ngIf"],[4,"ngIf"],["type","submit",3,"click"],["type","button",3,"click"],["type","text","formControlName","input"],["type","text","formControlName","input","spellcheck","on","autofocus","",3,"rows"],[2,"color","red"]],template:function(e,o){1&e&&(t.ɵɵelementStart(0,"form",0),t.ɵɵelementStart(1,"h3",1),t.ɵɵtext(2),t.ɵɵpipe(3,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"div"),t.ɵɵtext(5),t.ɵɵpipe(6,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵtemplate(7,k,1,0,"input",2),t.ɵɵtemplate(8,M,2,1,"textarea",3),t.ɵɵtemplate(9,x,5,3,"ng-container",4),t.ɵɵelement(10,"hr"),t.ɵɵelementStart(11,"button",5),t.ɵɵlistener("click",(function(){return o.ok()})),t.ɵɵtext(12),t.ɵɵpipe(13,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementStart(14,"button",6),t.ɵɵlistener("click",(function(){return o.cancel()})),t.ɵɵtext(15),t.ɵɵpipe(16,"sqMessage"),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵproperty("formGroup",o.form)("cdkTrapFocusAutoCapture",!0),t.ɵɵadvance(2),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(3,9,o.title)),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind2(6,11,o.model.message,o.model.messageParams)),t.ɵɵadvance(2),t.ɵɵproperty("ngIf",!o.model.rowCount),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",!!o.model.rowCount),t.ɵɵadvance(1),t.ɵɵproperty("ngIf",o.showError(o.inputControl)),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(13,14,"msg#modal.buttons.ok")),t.ɵɵadvance(3),t.ɵɵtextInterpolate(t.ɵɵpipeBind1(16,16,"msg#modal.buttons.cancel")))},directives:[c.ɵangular_packages_forms_forms_y,c.NgControlStatusGroup,a.CdkTrapFocus,c.FormGroupDirective,s.NgIf,c.DefaultValueAccessor,c.NgControlStatus,c.FormControlName],pipes:[l.MessagePipe,u.ValidationErrorPipe],encapsulation:2});Object.create;function q(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a}function O(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(q(arguments[t]));return e}Object.create;var w=[],E=function(){function e(){}return e.forRoot=function(t,o){return void 0===t&&(t=C),void 0===o&&(o=I),{ngModule:e,providers:[{provide:v,useValue:t},{provide:g,useValue:o}]}},e}();E.ɵmod=t.ɵɵdefineNgModule({type:E}),E.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||E)},providers:O(w),imports:[[s.CommonModule,c.FormsModule,c.ReactiveFormsModule,o.OverlayModule,a.A11yModule,r.BaseModule,l.IntlModule,u.ValidationModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(E,{declarations:[C,I],imports:[s.CommonModule,c.FormsModule,c.ReactiveFormsModule,o.OverlayModule,a.A11yModule,r.BaseModule,l.IntlModule,u.ValidationModule]});var j=r.Utils.merge({},{modal:{buttons:{ok:"OK",cancel:"Cancel",yes:"Yes",no:"No",abort:"Abort",retry:"Retry",ignore:"Ignore"},confirm:{title:"Confirm"},prompt:{title:"Enter a value"}}},l.enIntl),S=r.Utils.merge({},{modal:{buttons:{ok:"OK",cancel:"Annuler",yes:"Oui",no:"Non",abort:"Abandonner",retry:"Réessayer",ignore:"Ignorer"},confirm:{title:"Confirmer"},prompt:{title:"Saississez une valeur"}}},l.frIntl),_=r.Utils.merge({},{modal:{buttons:{ok:"OK",cancel:"Abbrechen",yes:"Ja",no:"Nein",abort:"Abbrechen",retry:"Wiederholen",ignore:"Ignorieren"},confirm:{title:"Bestätigen"},prompt:{title:"Geben Sie einen Wert ein"}}},l.deIntl);e.Confirm=C,e.MODAL_CONFIRM=v,e.MODAL_MODEL=m,e.MODAL_PROMPT=g,e.ModalButton=f,e.ModalModule=E,e.ModalRef=p,e.ModalService=y,e.Prompt=I,e.deModal=_,e.enModal=j,e.frModal=S,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-core-modal.umd.min.js.map