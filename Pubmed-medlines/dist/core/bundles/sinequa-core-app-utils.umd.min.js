!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@sinequa/core/base"),require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@sinequa/core/web-services"),require("@sinequa/core/intl"),require("d3-format"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@sinequa/core/app-utils",["exports","@sinequa/core/base","@angular/core","rxjs","rxjs/operators","@sinequa/core/web-services","@sinequa/core/intl","d3-format","@angular/common/http"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).sinequa=e.sinequa||{},e.sinequa.core=e.sinequa.core||{},e.sinequa.core["app-utils"]={}),e.sinequa.core.base,e.ng.core,e.rxjs,e.rxjs.operators,e.sinequa.core["web-services"],e.sinequa.core.intl,e.d3Format,e.ng.common.http)}(this,(function(e,t,r,i,s,n,a,o,l){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function u(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,s,n=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return a}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}Object.create;var c=function(){function e(){}return e.isString=function(e){return!!e&&(14===e.eType||15===e.eType&&8388608==(8388608&e.eTypeModifier))},e.isCsv=function(e){return!!e&&(15===e.eType&&8388608!=(8388608&e.eTypeModifier))},e.isTree=function(e){return!!e&&(15===e.eType&&524292==(524292&e.eTypeModifier))},e.isEntity=function(e){return!!e&&(15===e.eType&&2068==(2068&e.eTypeModifier))},e.isBoolean=function(e){return!!e&&1===e.eType},e.isDate=function(e){return!!e&&(2===e.eType||3===e.eType||4===e.eType)},e.isDouble=function(e){return!!e&&(8===e.eType||7===e.eType)},e.isInteger=function(e){return!!e&&(6===e.eType||5===e.eType)},e.isNumber=function(t){return e.isInteger(t)||e.isDouble(t)},e.isScalar=function(t){return e.isNumber(t)||e.isDate(t)||e.isBoolean(t)},e.isSortable=function(t){return e.isString(t)||e.isScalar(t)||e.isCsv(t)&&!!t&&2052==(2052&t.eTypeModifier)},e}(),f=function(){function e(e){if(this._field=void 0,this._display=void 0,this._displayObj=void 0,this.values=void 0,e.op1){var r=e;this.exprContext=r.exprContext,this.field=r.field,this.display=r.display,this.addOperand(r.op1),this.addOperand(r.op2),this.and=r.and,this.near=-1,this.start=-1,this.length=0}else{var i=e;this.exprContext=i.exprContext,t.Utils.isUndefined(i.value)?t.Utils.isUndefined(i.values)||(this.values=v.unescapeList(i.values)):this.value=v.unescape(i.value),this.locations=i.locations,this.field=i.field,this.display=i.display,this.operator=t.Utils.isUndefined(i.operator)?0:i.operator,this.near=-1,this.start=-1,this.length=0}}return Object.defineProperty(e.prototype,"field",{get:function(){for(var e=this;e;){if(!t.Utils.isEmpty(e._field))return e._field;e=e.parent}},set:function(e){this._field=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){for(var e=this;e;){if(!t.Utils.isEmpty(e._display))return e._display;e=e.parent}},set:function(e){if(this._display=e,this._display)if("{"===this._display[0]&&"}"===this._display[this._display.length-1])try{this._displayObj=t.Utils.fromJson(this._display)}catch(e){this._displayObj=void 0}else this._displayObj=void 0;else this._displayObj=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayObj",{get:function(){for(var e=this;e;){if(e._displayObj)return e._displayObj;e=e.parent}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){if(this.values&&0!==this.values.length)return this.values[0]},set:function(e){void 0===e?this.values=void 0:(this.values||(this.values=[]),this.values[0]=e,this.values.length=1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"evaluationRegExps",{get:function(){return this._evaluationRegExps||(this._evaluationRegExps={}),this._evaluationRegExps},enumerable:!1,configurable:!0}),e.prototype.addOperand=function(e,r,i){var s,n;if(void 0===i&&(i=!1),t.Utils.isUndefined(r)&&(r=this.field),this.operands||(this.operands=[]),!t.Utils.isEmpty(this.field)&&t.Utils.isEmpty(e.field)&&!e.isStructured&&t.Utils.isEmpty(r)){try{for(var a=u(this.operands),o=a.next();!o.done;o=a.next()){var l=o.value;t.Utils.isEmpty(l._field)&&(l._field=this.field)}}catch(e){s={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(s)throw s.error}}this.field=void 0}t.Utils.eqNC(this.field||"",e.field||"")?e._field=void 0:e._field=e.field,t.Utils.isEmpty(this.display)||(e._display=void 0),i?this.operands.unshift(e):this.operands.push(e),e.parent=this},Object.defineProperty(e.prototype,"isLeaf",{get:function(){return!!this.value},enumerable:!1,configurable:!0}),e.makeExpr=function(r,i,s,n,a){if(!e.getIsStructuredField(r,e.resolveField(r,s)))return new e({exprContext:r,value:i,field:s,display:n});var o={value:void 0},l={value:void 0},u={value:0},p={value:0};if(e.parseValue(r,i,s,a,o,l,u,p),0!==p.value&&o.value&&l.value){var h=o.value[0],c=o.value[1],f=l.value[0],d=l.value[1];if(1===p.value&&!t.Utils.eqNC(h,"*")&&!t.Utils.eqNC(c,"*"))return new e({exprContext:r,values:o.value,locations:l.value,field:s,display:n,operator:11});var v=t.Utils.eqNC(h,"*")?null:new e({exprContext:r,value:h,locations:[f],field:s,display:n,operator:2===p.value||1===p.value?3:2}),y=t.Utils.eqNC(c,"*")?void 0:new e({exprContext:r,value:c,locations:[d],field:s,display:n,operator:1===p.value||3===p.value?5:4});if(!v&&!y)return;return v&&y?new e({exprContext:r,op1:v,and:!0,op2:y,display:n}):v||y}return new e({exprContext:r,values:o.value,locations:l.value,field:s,display:n,operator:u.value})},e.resolveField=function(e,r){return t.Utils.isString(r)?e.appService.resolveColumnName(r):""},e.getColumn=function(e,t){return e.appService.getColumn(t)},Object.defineProperty(e.prototype,"column",{get:function(){return e.getColumn(this.exprContext,this.field)},enumerable:!1,configurable:!0}),e.getIsStructuredField=function(r,i){return!!i&&(!!r.disallowFulltext||":"!==i[0]&&(!!t.Utils.eqNCN(i,"exists","missing")||!!e.getColumn(r,i)))},Object.defineProperty(e.prototype,"isStructuredField",{get:function(){return!!this.isLeaf&&e.getIsStructuredField(this.exprContext,this.field)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isStructured",{get:function(){var e,t;if(this.mergedStructured)return!0;if(this.isLeaf)return this.isStructuredField;if(!this.operands)return!1;try{for(var r=u(this.operands),i=r.next();!i.done;i=r.next()){if(!i.value.isStructured)return!1}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPositive",{get:function(){for(var e=!0,t=this;null!=t;)e=e&&!t.not,t=t.parent;return e},enumerable:!1,configurable:!0}),e.getValueAndLocation=function(e){var r=0,i=e.length,s=t.Utils.trimStart(e);r+=i-s.length,i-=i-s.length;var n=t.Utils.trimEnd(s);return{value:n,start:r,length:i-=i-n.length}},e.parseValue=function(r,i,s,n,a,o,l,u){if(!t.Utils.isEmpty(i)||n){var p,h=i[0],c=i[i.length-1];if("[{".includes(h)&&"]}".includes(c)){var f=4,d=(i=i.substr(1,i.length-2)).indexOf(" TO ");if(-1===d&&(f=2,d=i.indexOf("..")),-1===d){var y=v.valuesAndLocationsFromText(i,",");return a.value=[],o.value=[],y.forEach((function(e){a.value.push(e.value),o.value.push({start:1+e.start,length:e.length})})),void(l.value=10)}return p=e.getValueAndLocation(i.substr(0,d)),a.value=[p.value],o.value=[{start:1+p.start,length:p.length}],p=e.getValueAndLocation(i.substr(d+f)),a.value.push(p.value),o.value.push({start:1+d+f+p.start,length:p.length}),void(u.value="["===h?"]"===c?1:2:"}"===c?4:3)}p={value:i,start:0,length:i.length},i.startsWith("=")?(l.value=1,(p=e.getValueAndLocation(i.substr(1))).start+=1):i.startsWith(">=")?(l.value=3,(p=e.getValueAndLocation(i.substr(2))).start+=2):i.startsWith(">")?(l.value=2,(p=e.getValueAndLocation(i.substr(1))).start+=1):i.startsWith("<=")?(l.value=5,(p=e.getValueAndLocation(i.substr(2))).start+=2):i.startsWith("<>")?(l.value=6,(p=e.getValueAndLocation(i.substr(2))).start+=2):i.startsWith("<")?(l.value=4,(p=e.getValueAndLocation(i.substr(1))).start+=1):i.startsWith("~")?(l.value=7,(p=e.getValueAndLocation(i.substr(1))).start+=1):i.length>1&&i.startsWith("/")&&i.endsWith("/")&&(l.value=7,p.value=i.substr(1,i.length-2),p.start=1,p.length=p.value.length),i.startsWith('"')&&i.endsWith('"')&&(p.value=i.substr(1,i.length-2),p.start=1,p.length=p.value.length),a.value=[p.value],o.value=[{start:p.start,length:p.length}]}},e.getOperatorText=function(e){switch(e){case 1:return"=";case 2:return">";case 3:return">=";case 4:return"<";case 5:return"<=";case 6:return"<>";case 7:return"REGEXP";case 8:return"LIKE";case 9:return"CONTAINS";case 10:return"IN";case 11:return"BETWEEN";default:return"="}},e.prototype.findValue=function(e){var t,r;if(this.isLeaf){if(e>=this.start&&e<=this.start+this.length){if(!this.isStructured)return{value:this.value,field:this.field,start:this.start,length:this.length};if(this.locations&&this.values&&this.values.length===this.locations.length)for(var i=0,s=this.values.length;i<s;i++){var n=this.values[i],a=this.locations[i];if(e>=this.start+a.start&&e<=this.start+a.start+a.length)return{value:n,field:this.field,start:this.start+a.start,length:a.length}}}}else if(this.operands)try{for(var o=u(this.operands),l=o.next();!l.done;l=o.next()){if(n=l.value.findValue(e))return n}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.combine=function(t,r){var i,s;if(!t)return r;if(!r)return t;if(!t.isLeaf&&t.and&&!t.not){if(t.isLeaf||!r.and||r.not)t.addOperand(r);else try{for(var n=u(r.operands),a=n.next();!a.done;a=n.next()){var o=a.value;t.addOperand(o)}}catch(e){i={error:e}}finally{try{a&&!a.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}}return t}return new e({exprContext:t.exprContext,op1:t,and:!0,op2:r})},e.prototype.normalizeField=function(e){return e&&e[0]===v.fieldPartnamePrefix?e.substr(1):e},e.prototype.shouldDisplayField=function(){return!this.field&&!this.parent||!(!this.field||this.parent&&t.Utils.eqNC(this.field,this.parent.field||""))},e.prototype.getOperatorString=function(){return 0===this.operator||1===this.operator?"":e.getOperatorText(this.operator)},e.prototype.escapeValue=function(e){return e&&this.column&&(c.isString(this.column)||c.isCsv(this.column))?v.escape(e):e||""},e.prototype.getValueString=function(){var e,t;if(11===this.operator&&this.values&&2===this.values.length)return"["+this.escapeValue(this.values[0])+".."+this.escapeValue(this.values[1])+"]";if(this.values&&this.values.length>1){var r=[];try{for(var i=u(this.values),s=i.next();!s.done;s=i.next()){var n=s.value;r.length>0&&r.push(", "),r.push(this.escapeValue(n))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r.unshift("["),r.push("]"),r.join("")}return this.escapeValue(this.value)},e.prototype.addFieldToString=function(e){var t=!1;return this.shouldDisplayField()&&(e.push(this.normalizeField(this.field)||"text"),t=!0),this.display&&(e.push(v.escape(this.display)),t=!0),t&&e.push(":"),t},e.prototype._toString=function(e,t){var r,i,s=[];if(this.isLeaf)this.not&&s.push("NOT "),e&&this.addFieldToString(s),s.push(this.getOperatorString()),s.push(this.getValueString());else{if(!this.operands)return"";this.not&&s.push("NOT ");var n=t;this.addFieldToString(s)&&(n=!0),n&&s.push("(");var a=!0;try{for(var o=u(this.operands),l=o.next();!l.done;l=o.next()){var p=l.value;a||(this.and?s.push(" AND "):s.push(" OR ")),a=!1,s.push(p._toString(e,!0))}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}n&&s.push(")")}return s.join("")},e.prototype.toString=function(e){return void 0===e&&(e=!0),this._toString(e,!1)},e.prototype.addDisplay=function(e,t,r){this._addValue(e,t,this.value||"",r)},e.prototype.encodeHTML=function(e,r){return r&&r.asHTML?t.Utils.encodeHTML(e):e},e.prototype._addValue=function(e,r,i,s){e.asHTML&&r.message.push('<span class="sq-value">');var n,a=this.exprContext.appService.getColumn(this.field),o="value"+r.valueIndex++,l=i;s&&(n=this.encodeHTML(v.unescape(s),e)),a&&c.isNumber(a)&&t.Utils.testFloat(i)?l=+i:a&&c.isDate(a)?l=t.Utils.fromSysDateStr(i)||i:a&&c.isBoolean(a)?l=t.Utils.isTrue(i):t.Utils.isString(l)&&(l=this.encodeHTML(l,e)),r.message.push("{"+o+"}"),r.values[o]=a?this.exprContext.formatService.formatFieldValue({value:l,display:n},a):n||l,e.asHTML&&r.message.push("</span>")},e.prototype.addValue=function(e,t){var r,i;if(this.values)if(11===this.operator&&2===this.values.length)this._addValue(e,t,this.values[0]),t.message.push(" "),this.addOperator("AND",e,t),t.message.push(" "),this._addValue(e,t,this.values[1]);else if(this.values.length>1){var s=!0;try{for(var n=u(this.values),a=n.next();!a.done;a=n.next()){var o=a.value;t.message.push(s?"[":", "),s=!1,this._addValue(e,t,o)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}t.message.push("]")}else this._addValue(e,t,this.values[0])},e.prototype.addText=function(e,t,r){var i="value"+t.valueIndex++,s="{"+i+"}";t.message.push(s),t.values[i]=this.encodeHTML(r,e)},e.prototype.addFieldLabel=function(e,t){var r=this,i=this.displayObj;if(i&&i.label)this.addText(e,t,i.label);else if(this.field){var s=this.exprContext.appService.getLabel(this.normalizeField(this.field)||"");this.addText(e,t,s)}else if(this.isStructured){this.getFields().forEach((function(i,s){0!==s&&r.addText(e,t,"/");var n=r.exprContext.appService.getLabel(i);r.addText(e,t,n)}))}else{s=this.exprContext.appService.getLabel("text");this.addText(e,t,s)}},e.prototype.addField=function(e,t){e.asHTML&&t.message.push('<span class="sq-field">'),this.addFieldLabel(e,t),e.asHTML&&(t.message.push("</span>"),t.message.push('<span class="sq-separator">')),this.addText(e,t,"msg#system.fieldSeparator"),e.asHTML&&t.message.push("</span>")},e.prototype.addOperator=function(e,t,r){e&&(t.asHTML&&r.message.push('<span class="sq-operator">'),r.message.push(this.encodeHTML(e,t)),t.asHTML&&r.message.push("</span>"))},e.prototype._toMessage=function(e,r){var i,s,n=e.inner;e.inner=!0,r||(r={}),t.Utils.isUndefined(r.useDisplay)&&(r.useDisplay=!0);var a=this.displayObj,o=(a?a.display:void 0)||this.display,l=this.not&&(n||!r.hideOuterNot),p=(r.withFields||n)&&this.shouldDisplayField();if(r.useDisplay&&o)l&&(this.addOperator("NOT",r,e),e.message.push(" ")),p&&this.addField(r,e),this.addDisplay(r,e,o);else if(this.isLeaf){l&&(this.addOperator("NOT",r,e),e.message.push(" ")),p&&this.addField(r,e);var h=this.getOperatorString();h&&(this.addOperator(h,r,e),e.message.push(" ")),this.addValue(r,e)}else{if(!this.operands)return{message:""};l&&(this.addOperator("NOT",r,e),e.message.push(" "));var c=n;p&&(this.addField(r,e),c=!0),c&&e.message.push("(");var f=!0;try{for(var d=u(this.operands),v=d.next();!v.done;v=d.next()){var y=v.value;f||(this.and?(e.message.push(" "),this.addOperator("AND",r,e),e.message.push(" ")):(e.message.push(" "),this.addOperator("OR",r,e),e.message.push(" "))),f=!1,y._toMessage(e,r)}}catch(e){i={error:e}}finally{try{v&&!v.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}c&&e.message.push(")")}return n?{message:""}:{message:e.message.join(""),values:e.values}},e.prototype.toMessage=function(e){return this._toMessage({inner:!1,message:["txt#"],values:{},valueIndex:0},e)},e.matchNode=function(e,r,i){var s,n,a,o;if(r.isLeaf!==i.isLeaf)return!1;if(r.isLeaf){if(r.isStructured!==i.isStructured)return!1;if(r.not!==i.not)return!1;if(e.appService.resolveColumnAlias(r.field)!==e.appService.resolveColumnAlias(i.field))return!1;if((0===r.operator?1:r.operator)!==(0===i.operator?1:i.operator))return!1}if(!r.isLeaf){if(r.and!==i.and)return!1;if(!r.operands!=!i.operands)return!1;var l=0,p=0,h=0,c=0;if(r.operands.forEach((function(e){e.isStructured?l++:p++})),i.operands.forEach((function(e){e.isStructured?h++:c++})),h>l||c>p)return!1}var f=r.values?r.values.length:0;if(f!==(i.values?i.values.length:0))return!1;if(f&&r.values&&i.values)try{for(var d=u(r.values),v=d.next();!v.done;v=d.next()){var y=v.value,m=!1;try{for(var g=(a=void 0,u(i.values)),x=g.next();!x.done;x=g.next()){var b=x.value;t.Utils.eqNC(y,b)&&(m=!0)}}catch(e){a={error:e}}finally{try{x&&!x.done&&(o=g.return)&&o.call(g)}finally{if(a)throw a.error}}if(!m)return!1}}catch(e){s={error:e}}finally{try{v&&!v.done&&(n=d.return)&&n.call(d)}finally{if(s)throw s.error}}return!0},e.prototype.matchNode=function(t){return e.matchNode(this.exprContext,this,t)},e.prototype.find=function(e,t){var r,i,s,n,a,o;if(this.matchNode(e)){if(!this.isLeaf&&this.operands)try{for(var l=u(e.operands),p=l.next();!p.done;p=l.next()){var h=p.value,c=!1;try{for(var f=(s=void 0,u(this.operands)),d=f.next();!d.done;d=f.next()){var v=d.value;if((!t||!t(v))&&v.find(h)){c=!0;break}}}catch(e){s={error:e}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(s)throw s.error}}if(!c)return null}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return this}if(!this.isLeaf&&this.operands)try{for(var y=u(this.operands),m=y.next();!m.done;m=y.next()){var g=m.value;if((!t||!t(g))&&g.find(e))return g}}catch(e){a={error:e}}finally{try{m&&!m.done&&(o=y.return)&&o.call(y)}finally{if(a)throw a.error}}return null},e.prototype.forEach=function(e){var t,r;if(e(this),this.operands)try{for(var i=u(this.operands),s=i.next();!s.done;s=i.next()){s.value.forEach(e)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.some=function(e){var t,r;if(e(this))return!0;if(this.operands)try{for(var i=u(this.operands),s=i.next();!s.done;s=i.next()){if(s.value.some(e))return!0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!1},e.prototype.every=function(e){var t,r;if(!e(this))return!1;if(this.operands)try{for(var i=u(this.operands),s=i.next();!s.done;s=i.next()){if(!s.value.every(e))return!1}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!0},Object.defineProperty(e.prototype,"hasRelevance",{get:function(){return this.some((function(e){return e.isLeaf&&!e.isStructured&&e.isPositive}))},enumerable:!1,configurable:!0}),e.prototype.getFields=function(){var e=this,r=[];return this.forEach((function(i){var s=e.exprContext.appService.resolveColumnAlias(i.field);s&&(r.find((function(e){return t.Utils.eqNC(s,e)}))||r.push(s))})),r},e.prototype.getValues=function(e,r){var i=this;void 0===r&&(r=!0);var s=[],n=this.exprContext.appService.resolveColumnName(e);return this.forEach((function(e){if(n){var a=i.exprContext.appService.resolveColumnName(e.field);if(!t.Utils.eqNC(n,a))return}e.isLeaf&&e.isPositive===r&&e.values&&s.push.apply(s,h(e.values))})),s},e.prototype.getDataValue=function(e,r,i){var s,n;if(e){var a=t.Utils.split(r||"",".");a.length>=1&&t.Utils.isUndefined(e[a[0]])&&i&&a.unshift.apply(a,h(t.Utils.split(i,".")));var o=e;try{for(var l=u(a),p=l.next();!p.done;p=l.next()){var c=p.value;if(!o)break;o=o[c]}}catch(e){s={error:e}}finally{try{p&&!p.done&&(n=l.return)&&n.call(l)}finally{if(s)throw s.error}}return o}},e.prototype.getWildcardRegExp=function(e){var r,i;if(e){var s=this.evaluationRegExps[e];if(!t.Utils.isUndefined(s))return s;var n=!1,a=!1,o=[];try{for(var l=u(e),p=l.next();!p.done;p=l.next()){var h=p.value;switch(h){case"\\":a?(o.push("\\\\"),a=!1):a=!0;break;case"*":a?(o.push("\\"),o.push(h),a=!1):(n=!0,o.push(".*?"));break;case"?":a?(o.push("\\"),o.push(h),a=!1):(n=!0,o.push("."));break;case"-":case"/":case"^":case"$":case"+":case".":case"(":case")":case"|":case"[":case"]":case"{":case"}":o.push("\\"),o.push(h),a=!1;break;default:o.push(h),a=!1}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}if(n)return s=new RegExp("^"+o.join("")+"$","i"),this.evaluationRegExps[e]=s,s;this.evaluationRegExps[e]=void 0}},e.prototype.compare=function(r,i,s){var n,a,o,l;if(t.Utils.isArray(i)&&0===i.length)return NaN;var p=e.getColumn(this.exprContext,this.field||"");if(t.Utils.isArray(i)||t.Utils.isArray(r)){if(t.Utils.isArray(i)||(i=[i]),t.Utils.isArray(r)){if(0===r.length)return NaN}else r=[r+""];try{for(var h=u(r),f=h.next();!f.done;f=h.next()){var d=f.value;try{for(var y=(o=void 0,u(i)),m=y.next();!m.done;m=y.next()){var g=m.value;if(0===this.compare(d,g,!0))return 0}}catch(e){o={error:e}}finally{try{m&&!m.done&&(l=y.return)&&l.call(y)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}return NaN}if(!t.Utils.isArray(r)){if(r=v.unescape(r||""),p&&p.parser&&(r=this.exprContext.formatService.parseValue(r,p.parser)),c.isNumber(p))return t.Utils.isNumber(i)||(i=0),i-(x=t.Utils.toNumber(r));if(c.isDate(p)){var x;if(t.Utils.isString(i)&&(i=t.Utils.toDate(i)),t.Utils.isDate(i))if(x=this.exprContext.intlService.parseDate(r))return i.getTime()-x.getTime();return NaN}if(c.isBoolean(p))return(i?1:0)-(x=t.Utils.isTrue(r)?1:0);if(i=i||"",t.Utils.isString(i)){if(i=v.unescape(i),s){var b=this.getWildcardRegExp(r);if(b)return b.test(i)?0:-1}return t.Utils.compare(i,r)}}return NaN},e.prototype.evaluate=function(e,r){var i,s,n;if(this.isLeaf)if(this.isStructured)if(t.Utils.eqNC(this.field||"","exists")){var a=this.getDataValue(e,this.value,r);n=!t.Utils.isUndefined(a)}else if(t.Utils.eqNC(this.field||"","missing")){a=this.getDataValue(e,this.value,r);n=t.Utils.isUndefined(a)}else{a=this.getDataValue(e,this.field,r);switch(this.operator){case 0:case 1:n=0===this.compare(this.value,a,!0);break;case 2:n=this.compare(this.value,a)>0;break;case 3:n=this.compare(this.value,a)>=0;break;case 4:n=this.compare(this.value,a)<0;break;case 5:n=this.compare(this.value,a)<=0;break;case 6:n=0!==this.compare(this.value,a,!0);break;case 7:n=new RegExp(this.value||"").test(a+"");break;case 8:n=0===this.compare(this.value+"*",a,!0);break;case 10:n=0===this.compare(this.values,a,!0);break;case 9:n=0===this.compare(this.value,a,!0);break;case 11:n=!!this.values&&this.compare(this.values[0],a)>=0&&this.compare(this.values[1],a)<=0}}else n=!1;else{n=!!this.and;try{for(var o=u(this.operands),l=o.next();!l.done;l=o.next()){var p=l.value.evaluate(e,r);if(this.and){if(!(n=n&&p))break}else n=n||p}}catch(e){i={error:e}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}return this.not&&(n=!n),n},e}(),d=function(e,t,r,i){void 0===t&&(t=""),void 0===r&&(r=-1),void 0===i&&(i=-1),this.tok=e,this.tokValue=t,this.tokValuePos=r,this.tokValueLen=i};d.invalid=new d(-1),d.or=new d(0),d.and=new d(1),d.not=new d(2),d.lPar=new d(5),d.rPar=new d(6),d.eof=new d(7);var v=function(){function e(e,t){this.exprContext=e,this.options=t||{},this.exprContext.disallowFulltext=this.options.disallowFulltext,this.expressions=[],this.operators=[],this.fields=[],this.displays=[],this.text="",this.current=0,this.length=0,this.op=this.prevOp=this.saveOp=d.invalid}return e.escape=function(e){if(!e)return"``";if(-1===(e=String(e)).search(/[\\`]/))return"`"+e+"`";for(var t=["`"],r=0,i=e.length;r<i;r++){var s=e[r];"\\"!==s&&"`"!==s||t.push("\\"),t.push(s)}return t.push("`"),t.join("")},e.isEscaped=function(e){return!!e&&e.length>=2&&"`"===e[0]&&"`"===e[e.length-1]},e.unescape=function(t){if(!e.isEscaped(t))return t;for(var r=[],i=1,s=t.length-1;i<s;i++){var n=t[i];if("\\"===n){if(i>=s-1)continue;n=t[++i]}r.push(n)}return r.join("")},e.unescapeList=function(t){if(!t)return t;for(var r=[],i=0,s=t;i<s.length;i++){var n=s[i];r.push(e.unescape(n))}return r},e.valuesAndLocationsFromText=function(r,i){if(t.Utils.isEmpty(r))return[];if(!r.includes(i))return[{value:r,start:0,length:r.length}];for(var s,n=[],a=r.length,o=0,l=0,u=[];;){if(o>=a){(s=f.getValueAndLocation(u.join(""))).start+=l,t.Utils.isEmpty(s.value)||n.push(s);break}var p=r[o];if("\\"===p){if(u.push(p),++o<a){var h=r[o];"\\"!==h&&"`"!==h||(u.push(h),o++)}}else if("`"===p){var c={value:0},d=e.matchUntil(r,a,o,o+1,"`",c);d?(u.push(d),o=c.value):(u.push(p),o++)}else p===i?((s=f.getValueAndLocation(u.join(""))).start+=l,u.length=0,t.Utils.isEmpty(s.value)||n.push(s),l=++o):(u.push(p),o++)}return n},e.prototype.matchKeyword=function(e,r,i){if(0!==r.length){var s=r.join("");if(s&&!" \r\n\t".includes(s[s.length-1]))return!1}if(t.Utils.isEmpty(e))return!1;var n=e.length;if(this.current+n>this.length)return!1;for(var a=0,o=n;a<o;a++){if(this.text[this.current+a]!==e[a])return!1}if(this.current+n<this.length){var l=this.text[this.current+n];if(l!==i&&!" \r\n\t(".includes(l))return!1}return!0},e.prototype.matchUntil=function(t,r,i,s){return e.matchUntil(this.text,this.length,t,r,i,s)},e.matchUntil=function(e,t,r,i,s,n){n.value=i;for(var a=!1,o=[e.substr(r,i-r)];n.value<t;){var l=e[n.value++];if("\\"===l&&(o.push(l),n.value<t&&("\\"===(l=e[n.value++])||"`"===l)))o.push(l);else if(o.push(l),s.includes(l)){a=!0;break}}if(a)return o.join("")},e.prototype.matchSimpleValue=function(e){for(var t=this.current,r=e;r<this.length;){var i=this.text[r];if(" \r\n\t)".includes(i))break;r++}return r===e?"":this.text.substr(t,r-t)},e.prototype.getTerminators=function(e,t){return'"'===e?'"':"["===e?t?"]}":"]":"{"===e?t?"}]":"}":"/"===e?"/":"("===e?")":"`"===e?"`":""},e.prototype.canBeTokValue=function(e,r){return void 0===r&&(r=!0),!t.Utils.isEmpty(e)||r&&this.options.allowEmptyValues&&!t.Utils.isEmpty(this.field)},e.prototype._getTokValue=function(e,r){if(void 0===r&&(r=!0),null===e)return!1;var i=this.current;return i-=e.length-(e=t.Utils.trimEnd(e)).length,e=e.trim(),!!this.canBeTokValue(e,r)&&(this.op=new d(8,e,i-e.length,e.length),!0)},e.prototype.getTokValue=function(e,t){return void 0===t&&(t=!0),!!e&&this._getTokValue(e.join(""),t)},e.prototype.ensureNearValue=function(e){var r=this.exprContext.appService.ccquery?this.exprContext.appService.ccquery.defaultNearValue:0,i=t.Utils.toInt(e,r);return i<0&&(i=r),i.toString()},e.prototype.findDisplay=function(e){if(!e||e.length<3)return-1;if("`"!==e[e.length-1])return-1;for(var t=e.length-2;-1!==t;)if(-1!==(t=e.lastIndexOf("`",t))){for(var r=0,i=t-1;i>=0&&"\\"===e[i];)r++,i--;if(r%2==0)return t;t--}return-1},e.prototype.isValidFieldName=function(e){return this.options.allowScopedFields?t.Utils.isValidScopedSimpleName(e):t.Utils.isValidSimpleName(e)},e.prototype.isAllowedField=function(e,r,i){if(i.value=!1,t.Utils.eqNCN(e,"exists","missing"))return!0;if(t.Utils.eqNCN(e,"text","concepts","refine","matchingpartnames"))return i.value=!0,!0;var s=this.exprContext.appService.ccquery;if(s){var n=(r=r&&!this.exprContext.disallowFulltext)?void 0:this.exprContext.appService.getColumn(e);if(n&&(12===n.eType||s.$columnFieldsPattern&&s.$columnFieldsPattern.hasPatterns()&&!s.$columnFieldsPattern.isIncluded(e)&&!s.$columnFieldsPattern.isIncluded(n.name))&&(n=void 0),!this.exprContext.disallowFulltext&&!n&&(i.value=!0,s.$partnameFieldsPattern&&s.$partnameFieldsPattern.hasPatterns()&&!s.$partnameFieldsPattern.isIncluded(e)))return!1}return!0},e.prototype.readToken=function(){if(this.saveOp!==d.invalid)return this.prevOp=this.op,this.op=this.saveOp,void(this.saveOp=d.invalid);var r,i;this.prevOp=this.op;for(var s=[],n=-1,a=!1;;){if(this.current>=this.length){if(this.getTokValue(s))return;return void(this.op=d.eof)}if("\\"===(r=this.text[this.current])){if(s.push(r),this.current++,this.current<this.length)"\\"!==(p=this.text[this.current])&&"`"!==p||(s.push(p),this.current++)}else{if("("===r){if(this.getTokValue(s,!1))return;return this.op=d.lPar,void this.current++}if(")"===r){if(this.getTokValue(s))return;return this.op=d.rPar,void this.current++}if(this.matchKeyword("AND",s)){if(this.getTokValue(s))return;return this.op=d.and,void(this.current+=3)}if(this.matchKeyword("OR",s)){if(this.getTokValue(s))return;return this.op=d.or,void(this.current+=2)}if(this.matchKeyword("NOT",s)){if(this.getTokValue(s))return;return this.op=d.not,void(this.current+=3)}if(this.matchKeyword("NEAR",s,"/")){if(this.getTokValue(s))return;if(this.current+=4,i=void 0,this.current<this.length&&"/"===this.text[this.current]){var o={value:0},l=-1;if(void 0!==(i=this.matchUntil(this.current+1,this.current+1,' \r\n\t`"([/',o))&&(i=i.substr(0,i.length-1),l=t.Utils.toInt(i,-1)),l<0)return"bad operator";this.current=o.value-1}i=this.ensureNearValue(i||"");var u=this.current>=this.length||"("!==this.text[this.current];return void(this.op=u?new d(4,(t.Utils.toInt(i)+2).toString()):new d(3,i))}if("+"===r||"-"===r){if(this.current+1<this.length){var p=this.text[this.current+1],h=(o={value:0},void 0);if('("[/`'.includes(p)?(i=this.matchUntil(this.current,this.current+2,this.getTerminators(p,!1),o),h=o.value-this.current):h=(i=this.matchSimpleValue(this.current+1))?i.length:0,i){s.push(i),this.current+=h;continue}}return"bad operator: "+r}if('"[{/`'.includes(r)){o={value:0};if(i=this.matchUntil(this.current,this.current+1,this.getTerminators(r,!0),o)){var c=a&&"[{".includes(r)&&0===s.length;if(s.push(i),this.current=o.value,c&&this.getTokValue(s))return;continue}return"bad operator: "+r}if(":"===r){var f=s.join("");if(-1===n&&-1===(n=this.findDisplay(f)))return this.op=d.invalid,"invalid token";var v=f.substr(n).trim(),y="",m=this.findDisplay(v);if(-1!==m&&(y=e.unescape(v.substr(m,v.length-m)),v=v.substr(0,m)),this.isValidFieldName(v)||t.Utils.isEmpty(v)&&!t.Utils.isEmpty(y)){var g=f.substr(0,n);if(this.canBeTokValue(g.trim()))return this.current-=s.join("").length-n,void this._getTokValue(g);if(!t.Utils.isEmpty(v)){var x=!1;this.current+1<this.length&&":"===this.text[this.current+1]&&(x=!0,this.current++);var b={value:!1};if(!this.isAllowedField(v,x,b)){n=-1,s.push(":"),x&&s.push(":"),this.current++;continue}b.value&&(v=e.fieldPartnamePrefix+v)}t.Utils.isEmpty(v)||(this.field=v,a=!0),t.Utils.isEmpty(y)||(this.display=y),s.length=0,this.current++;continue}}" \r\n\t)".includes(r)?n=-1:-1===n&&(n=s.join("").length),s.push(r),this.current++}}},e.prototype.clear=function(){this.text="",this.current=0,this.length=0,this.operators.length=0,this.expressions.length=0,this.fields.length=0,this.displays.length=0},e.parse=function(t,r,i){var s=new e(r,i),n=s.parse(t);return n||s.parseResult()},e.prototype.parseResult=function(){return 1!==this.expressions.length?"no expression found":this.expressions[0]},Object.defineProperty(e.prototype,"contextField",{get:function(){var e=this.field;return t.Utils.isEmpty(e)&&(e=this.peekField()),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contextDisplay",{get:function(){var e=this.display;return t.Utils.isEmpty(e)&&(e=this.peekDisplay()),e},enumerable:!1,configurable:!0}),e.prototype.parse=function(r){if(this.clear(),this.options.allowEmptyValues&&!t.Utils.len(r.trim())){var i=f.makeExpr(this.exprContext,"",this.contextField,this.contextDisplay,this.options.allowEmptyValues);return i&&(i.start=0,i.length=0,this.expressions.push(i)),""}this.text=r||"",this.length=this.text.length,this.operators.push(d.eof);var s=this.readToken();if(s)return s;for(;;){8!==this.op.tok&&5!==this.op.tok&&2!==this.op.tok&&3!==this.op.tok||8!==this.prevOp.tok&&6!==this.prevOp.tok||(this.saveOp=this.op,this.op=d.and);switch(8===this.op.tok?0:e.parsetbl[this.operators[this.operators.length-1].tok][this.op.tok]){case 1:if(s=this.reduce())return s;break;case 0:if(s=this.shift())return s;break;case 2:return 1!==this.expressions.length?"syntax error":"";case 3:return"missing ')'";case 4:return"missing operator (AND,OR,NOT)";case 5:return"missing '('";case 6:return"invalid argument"}}},e.prototype.shift=function(){var e=this;if(8===this.op.tok){var r=this.op.tokValue.trim();if(t.Utils.isEmpty(r)&&!this.options.allowEmptyValues)return"empty token";var i=f.makeExpr(this.exprContext,r,this.contextField,this.contextDisplay,!!this.options.allowEmptyValues);if(!i)return"invalid expression";i.start=this.op.tokValuePos,i.length=this.op.tokValueLen,i.operands&&i.operands.forEach((function(t){t.start=e.op.tokValuePos,t.length=e.op.tokValueLen})),this.expressions.push(i),this.field="",this.display=""}else this.operators.push(this.op),5===this.op.tok&&(t.Utils.isEmpty(this.field)?this.fields.push(this.peekField()):this.fields.push(this.field),this.field="",t.Utils.isEmpty(this.display)?this.displays.push(this.peekDisplay()):this.displays.push(this.display),this.display="");return this.readToken()},e.prototype.peekField=function(){return 0===this.fields.length?"":this.fields[this.fields.length-1]},e.prototype.peekDisplay=function(){return 0===this.displays.length?"":this.displays[this.displays.length-1]},e.prototype.canBeMergeTarget=function(e,t){return!e.isLeaf&&(!(e.near>=0)&&(e.and===t&&!e.not))},e.prototype.mergeExpr=function(e,r,i){var s,n,a,o,l=!1;if(this.canBeMergeTarget(e,i))o=e,a=r;else{if(!this.canBeMergeTarget(r,i))return new f({exprContext:e.exprContext,op1:e,and:i,op2:r,field:this.peekField(),display:this.peekDisplay()});o=r,a=e,l=!0}if(a.isLeaf||a.and!==i||a.not||!t.Utils.eq(a.display||"",o.display||""))o.addOperand(a,this.peekField(),l);else if(a.operands)try{for(var p=u(a.operands),h=p.next();!h.done;h=p.next()){var c=h.value;o.addOperand(c,this.peekField(),l)}}catch(e){s={error:e}}finally{try{h&&!h.done&&(n=p.return)&&n.call(p)}finally{if(s)throw s.error}}return o},e.prototype.reduce=function(){var e,r,i,s=this.operators[this.operators.length-1];switch(s.tok){case 2:if(!(e=this.expressions.pop()))return"syntax error";e.not=!e.not,this.expressions.push(e);break;case 1:if(i=this.expressions.pop(),!(r=this.expressions.pop())||!i)return"syntax error";this.expressions.push(this.mergeExpr(r,i,!0));break;case 0:if(i=this.expressions.pop(),!(r=this.expressions.pop())||!i)return"syntax error";this.expressions.push(this.mergeExpr(r,i,!1));break;case 3:if(!(e=this.expressions.pop()))return"syntax error";e.near=t.Utils.toInt(this.ensureNearValue(s.tokValue)),this.expressions.push(e);break;case 4:if(i=this.expressions.pop(),!(r=this.expressions.pop())||!i)return"syntax error";if(!i.isLeaf||i.isStructured||!r.isLeaf||r.isStructured||i.not||r.not||!t.Utils.eqNC(i.field||"",r.field||""))return"syntax error";(e=new f({exprContext:r.exprContext,op1:r,and:!1,op2:i,field:this.peekField(),display:this.peekDisplay()})).near=t.Utils.toInt(this.ensureNearValue(s.tokValue)),this.expressions.push(e);break;case 6:if(this.operators.pop(),0===this.fields.length)return"missing field";if(0===this.expressions.length)return"syntax error";var n=this.fields.pop(),a=this.displays.pop();(e=this.expressions[this.expressions.length-1]).isLeaf&&(t.Utils.isEmpty(e.field)&&(e.field=n),t.Utils.isEmpty(e.display)&&(e.display=a))}this.operators.pop()},e}();v.fieldPartnamePrefix="@",v.parsetbl=[[1,0,0,0,0,0,1,1],[1,1,0,0,0,0,1,1],[1,1,0,0,1,0,1,1],[1,1,0,0,1,0,1,1],[1,1,0,0,1,0,1,1],[0,0,0,0,0,0,0,3],[1,1,1,1,1,4,1,1],[0,0,0,0,0,0,5,2]];var y=function(){function e(){}return e.prototype.makeExpr=function(e,t,r){return(e=this.formatField(e,r))+": "+v.escape(t)},e.prototype.makeBooleanExpr=function(e,r,i){return(e=this.formatField(e,i))+": "+v.escape(t.Utils.toSqlValue(r))},e.prototype.makeNumericalExpr=function(e,r,i,s){return e=this.formatField(e,s),t.Utils.isString(i)&&(i=v.escape(i)),(t.Utils.isDate(i)||t.Utils.isNumber(i))&&(i=t.Utils.toSqlValue(i)),e+":"+r+" "+i},e.prototype.makeListExpr=function(e,t,r){return(e=this.formatField(e,r))+": ["+t.map((function(e){return v.escape(e)})).join(",")+"]"},e.prototype.makeRangeExpr=function(e,r,i,s){return(e=this.formatField(e,s))+": ["+t.Utils.toSqlValue(r)+".."+t.Utils.toSqlValue(i)+"]"},e.prototype.makeRegexpExpr=function(e,t,r){return(e=this.formatField(e,r))+":~ "+v.escape(t)},e.prototype.makeRefineExpr=function(e){return"refine: "+v.escape(e)},e.prototype.makeAndExpr=function(e,t,r){return(e=this.formatField(e,r))+": ("+this.concatWithOperator(t,"AND")+")"},e.prototype.makeOrExpr=function(e,t,r){return(e=this.formatField(e,r))+": ("+this.concatWithOperator(t,"OR")+")"},e.prototype.concatWithOperator=function(e,r){return e.map((function(e){return t.Utils.isString(e)?v.escape(e):e.display?v.escape(e.display)+":"+v.escape(t.Utils.toSqlValue(e.value)):v.escape(t.Utils.toSqlValue(e.value))})).join(" "+r+" ")},e.prototype.makeNotExpr=function(e){return"NOT ("+e+")"},e.prototype.concatOrExpr=function(e){return e.length<=1?e[0]||"":"("+e.join(") OR (")+")"},e.prototype.concatAndExpr=function(e){return e.length<=1?e[0]||"":"("+e.join(") AND (")+")"},e.prototype.makeFieldExpr=function(e,r,i){return t.Utils.isArray(r)||(r=[r]),0===r.length?"":i?this.makeAndExpr(e,r):this.makeOrExpr(e,r)},e.prototype.makeAggregationExpr=function(e,r,i){if(t.Utils.isArray(r)||(r=[r]),e.valuesAreExpressions){var s=r.map((function(e){return e.value.toString()}));return i?this.concatAndExpr(s):this.concatOrExpr(s)}var n=this.asValueItems(r,e.isTree);return this.makeFieldExpr(e.column,n,i)},e.prototype.formatField=function(e,t){return t&&(e=""+e+v.escape(t)),e},e.prototype.asValueItems=function(e,t){return t?e.map((function(e){return{value:e.$path+"*",display:e.display||e.value}})):e},e}();y.ɵfac=function(e){return new(e||y)},y.ɵprov=r.ɵɵdefineInjectable({token:y,factory:y.ɵfac,providedIn:"root"});var m="advanced_",g=function(){function e(e){this.name=e}return e.copy=function(e){return e?e.copy():e},Object.defineProperty(e.prototype,"hasRelevance",{get:function(){return!t.Utils.isEmpty(this.text)||!!this.findSelect("refine")},enumerable:!1,configurable:!0}),e.prototype.addSelect=function(e,t){return this.pushSelect({expression:e,facet:t||""})},e.prototype.pushSelect=function(e){return this.select||(this.select=[]),this.select.push(e)},e.prototype.popSelect=function(){if(this.select)return this.select.pop()},e.prototype.removeSelect=function(e,r){if(void 0===r&&(r=!1),this.select)if(t.Utils.isString(e))for(var i=this.select.length-1;i>=0;i--){var s=this.select[i];if(t.Utils.eqNC(s.facet,e)){if(this.select.splice(i,1),0===this.select.length)return void delete this.select;if(!r)return}}else{if(e<0||e>=this.select.length)return;this.select.splice(e,1),0===this.select.length&&delete this.select}},e.prototype.replaceSelect=function(e,t){this.select&&this.select.splice(e,1,t)},e.prototype.findSelectIndex=function(e,r){var i,s;if(void 0===r&&(r=0),!this.select)return-1;var n=0,a=0,o=-1;try{for(var l=u(this.select),p=l.next();!p.done;p=l.next()){var h=p.value;if(t.Utils.eqNC(e,h.facet)){if(o=n,a===r)break;a++}n++}}catch(e){i={error:e}}finally{try{p&&!p.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}return o},e.prototype.findSelect=function(e,t){void 0===t&&(t=!0);var r=this.findSelectIndex(e,t?-1:0);return r>=0?this.select&&this.select[r]:void 0},e.prototype.lastSelect=function(){if(this.select)return this.select[this.select.length-1]},Object.defineProperty(e.prototype,"selectLength",{get:function(){return this.select?this.select.length:0},enumerable:!1,configurable:!0}),e.prototype.addOpen=function(e,r){return this.open&&t.Utils.isArray(this.open)||(this.open=[]),this.open.push({expression:e,aggregation:r})},e.prototype.clear=function(){var e=this.name;t.Utils.clearObject(this),this.name=e},e.prototype.toStandard=function(){var e,t=this,r=null===(e=this.select)||void 0===e?void 0:e.filter((function(e){return e.facet&&e.facet.startsWith(m)}));return null==r||r.forEach((function(e){return t.removeSelect(e.facet,!0)})),this},e.prototype.copy=function(){var r=new e(this.name);return t.Utils.copy(this,r),r},e.prototype.copyStandard=function(){return this.copy().toStandard()},e.prototype.toAdvanced=function(e){var r,i=this;for(var s in void 0===e&&(e=!1),this)!this.hasOwnProperty(s)||t.Utils.eqNC(s,"select")||e&&t.Utils.eqNC(s,"text")||delete this[s];var n=null===(r=this.select)||void 0===r?void 0:r.filter((function(e){return e.facet&&!e.facet.startsWith(m)}));return null==n||n.forEach((function(e){return i.removeSelect(e.facet)})),this},e.prototype.copyAdvanced=function(e){return void 0===e&&(e=!1),this.copy().toAdvanced(e)},e.prototype.hasAdvanced=function(){var e;return!!(null===(e=this.select)||void 0===e?void 0:e.find((function(e){return e.facet&&e.facet.startsWith(m)})))},e.prototype.fromJson=function(e){this.clear();var r=t.Utils.fromJson(e),i=r.select;t.Utils.isArray(i)&&(r.select=i.map((function(e){return t.Utils.isArray(e)?{expression:e[0],facet:e[1]}:e})));var s=r.open;return t.Utils.isArray(s)&&(r.open=s.map((function(e){return t.Utils.isArray(e)?{expression:e[0],aggregation:e[1]}:e}))),t.Utils.extend(this,r),this},e.prototype.toJsonForQueryString=function(){var e={};return t.Utils.merge(e,this),this.select&&(e.select=this.select.map((function(e){var t=[e.expression];return e.facet&&t.push(e.facet),t}))),this.open&&(e.open=this.open.map((function(e){return[e.expression,e.aggregation]}))),t.Utils.toJson(e)},e.prototype.hash=function(){var e={};t.Utils.mergeAndSort(e,this),delete e.page,delete e.pageSize;var r=t.Utils.toJson(e);return t.Utils.sha512(r)},e}(),x=function(){function e(e){var t=this;this.intlService=e,this.bigNumberFormatter=o.format("~s"),this.moneyFormatter=function(e){return t.bigNumberFormatter(e).replace(/G/,"B")}}return e.prototype.isValueItem=function(e){return!(!t.Utils.isObject(e)||t.Utils.isDate(e)||t.Utils.isArray(e))},e.prototype.getValueAndDisplay=function(e){var t,r;return this.isValueItem(e)?(t=e.value,r=e.display||""):(t=e,r=""),[t,r]},e.prototype.formatLanguage=function(e){return this.intlService.formatMessage("msg#language."+t.Utils.toLowerCase(e+""))},e.prototype.formatMemorySize=function(e){var t=e/1024,r=t/1024,i=r/1024,s=i/1024,n=s/1024,a="msg#system.memorySize.bytes",o={value:e};return Math.abs(n)>=1?(a="msg#system.memorySize.pb",o.value=n):Math.abs(s)>=1?(a="msg#system.memorySize.tb",o.value=s):Math.abs(i)>=1?(a="msg#system.memorySize.gb",o.value=i):Math.abs(r)>=1?(a="msg#system.memorySize.mb",o.value=r):Math.abs(t)>=1&&(a="msg#system.memorySize.kb",o.value=t),this.intlService.formatMessage(a,o)},e.prototype.formatMoney=function(e){var t=p(e.split(" "),2),r=t[0],i=t[1];return r+" "+this.moneyFormatter(+i)},e.prototype.formatValue=function(e,r){var i=this,s=p(this.getValueAndDisplay(e),2),n=s[0],a=s[1];if(r&&r.formatter)switch(t.Utils.toLowerCase(r.formatter)){case"language":return this.formatLanguage(n);case"memorysize":if(t.Utils.isNumber(n))return this.formatMemorySize(n);break;case"money":if(t.Utils.isString(n))return this.formatMoney(n);if(t.Utils.isArray(n))return n.map((function(e){return i.formatMoney(t.Utils.isString(e)?e:e.value)})).join(", ")}if(a)return t.Utils.isDate(a)&&(a=t.Utils.toSysDateStr(a)),this.intlService.formatMessage(a,{value:n});if(t.Utils.isNumber(n))return(o=this.intlService.getMessage("msg#system.number"))?this.intlService.formatText(o,{value:n}):this.intlService.formatNumber(n);if(r&&c.isDate(r)&&t.Utils.isString(n)&&(n=t.Utils.fromSysDateStr(n)||n),t.Utils.isDate(n)){if(!r||c.isDate(r)){var o;if(o=this.intlService.getMessage("msg#system.date"))return this.intlService.formatText(o,{date:n,time:t.Utils.getTime(n)});var l=this.intlService.formatDate(n);return 0!==t.Utils.getTime(n)&&(l+=", "+this.intlService.formatTime(n)),l}n=t.Utils.toSysDateStr(n)}if(t.Utils.isBoolean(n))return(o=this.intlService.getMessage("msg#system.boolean"))?this.intlService.formatText(o,{value:n}):n.toString();if(t.Utils.isArray(n)){var u=[];n.forEach((function(e){var r;u.length>0&&u.push(";"),r=e?t.Utils.isDate(e)?t.Utils.toSysDateStr(e):t.Utils.isString(e)?e:e.display||e.value||"<null>":"<null>",u.push(r)})),n=u.join("")}return n?this.intlService.formatMessage(n):n},e.prototype.transformValue=function(e,r){var i,s,n=r?t.Utils.split(r.transforms||"",","):void 0;if(!n||0===n.length)return e;try{for(var a=u(n),o=a.next();!o.done;o=a.next()){var l=o.value;switch(t.Utils.toLowerCase(l)){case"uppercase":e=t.Utils.toUpperCase(e);break;case"upperfirst":e=t.Utils.toUpperFirst(e);break;case"lowercase":e=t.Utils.toLowerCase(e);break;case"lowerfirst":e=t.Utils.toLowerFirst(e);break;case"startcase":e=t.Utils.toStartCase(e);break;case"kebabcase":e=t.Utils.toKebabCase(e);break;case"snakecase":e=t.Utils.toSnakeCase(e);break;case"camelcase":e=t.Utils.toCamelCase(e)}}}catch(e){i={error:e}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}return e},e.prototype.formatFieldValue=function(e,t){var r=this.formatValue(e,t);return r=this.transformValue(r,t)},e.prototype.parseValue=function(e,r){if(t.Utils.isString(e)&&r)switch(t.Utils.toLowerCase(r)){case"memorysize":return this.parseMemorySize(e)+""}return e},e.prototype.parseMemorySize=function(e,r){return void 0===r&&(r=0),t.Utils.toSize(e,r)},e.prototype.formatRaw=function(e){var r=p(this.getValueAndDisplay(e),1)[0];return t.Utils.isArray(r)?r.map((function(e){return t.Utils.isString(e)?e:e.value})).join(";"):null==r?void 0:r.toString()},e}();x.ɵfac=function(e){return new(e||x)(r.ɵɵinject(a.IntlService))},x.ɵprov=r.ɵɵdefineInjectable({token:x,factory:x.ɵfac,providedIn:"root"});var b=function(){function e(e,t,r,s){this.startConfig=e,this.appWebService=t,this.intlService=r,this.formatService=s,this._events=new i.Subject,this.appName||console.error("Missing app name!")}return e.toEngineType=function(e){if(!e)return 0;switch(t.Utils.toLowerCase(e)){case"bool":case"boolean":return 1;case"date":return 2;case"datetime":return 3;case"time":return 4;case"unsigned":return 5;case"integer":return 6;case"float":return 7;case"double":return 8;case"dates":return 9;case"datetimes":return 10;case"times":return 11;case"varchar":return 12;case"binary":return 13;case"string":return 14;case"csv":return 15;default:return 0}},e.toEngineTypeModifierSimple=function(e){switch(e){case"a":return 2053;case"c":return 4;case"d":return 8;case"e":return 2068;case"i":return 256;case"l":return 2052;case"n":return 8192;case"t":return 524292;case"x":return 8388608;case"z":return 33554432;default:return 0}},e.toEngineTypeModifier=function(t,r){var i,s,n=0;if(r)try{for(var a=u(r),o=a.next();!o.done;o=a.next()){var l=o.value;n|=e.toEngineTypeModifierSimple(l)}}catch(e){i={error:e}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}return n},e.makeColumn=function(t,r,i,s){var n=e.toEngineType(r);return{name:t,type:r,typeModifier:i,eType:n,eTypeModifier:e.toEngineTypeModifier(n,i||""),aliases:s}},e.isString=function(e){return c.isString(e)},e.isCsv=function(e){return c.isCsv(e)},e.isTree=function(e){return c.isTree(e)},e.isEntity=function(e){return c.isEntity(e)},e.isBoolean=function(e){return c.isBoolean(e)},e.isDate=function(e){return c.isDate(e)},e.isDouble=function(e){return c.isDouble(e)},e.isInteger=function(e){return c.isInteger(e)},e.isNumber=function(e){return c.isNumber(e)},e.isScalar=function(e){return c.isScalar(e)},e.isSortable=function(e){return c.isSortable(e)},e.prototype.ngOnDestroy=function(){this._events.complete()},Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appName",{get:function(){return this.startConfig.app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this.startConfig.origin},enumerable:!1,configurable:!0}),e.prototype.initDefaultQuery=function(){if(this.app){var e=this.app.defaultQueryName||t.Utils.split(this.app.queryNames,",")[0];this._defaultCCQuery=t.Utils.getField(this.app.queries,e),this._defaultCCQuery||console.warn("Query not configured for app: "+this.appName),this.ccquery=this._defaultCCQuery}else console.warn("No app configured")},e.prototype.setApp=function(e){this.app=e,this.verifyServerApiVersionCompatibility(e),this.cclabels=this.getWebService(this.app.labels),this.ccautocomplete=this.getWebService(this.app.autocomplete),this.initDefaultQuery(),this.makeMaps(),this.suggestQueries=t.Utils.split(this.ccautocomplete?this.ccautocomplete.suggestQueries:"",",")},e.prototype.verifyServerApiVersionCompatibility=function(e){e?e.apiVersion?e.apiVersion!==n.MINIMUM_COMPATIBLE_SERVER_API_VERSION&&console.warn("This SBA is not compatible with the REST API of Sinequa Server.\nThe SBA expects the server API version to be at least '"+n.MINIMUM_COMPATIBLE_SERVER_API_VERSION+"', whereas the server API version is '"+e.apiVersion+"'."):console.error("The App config '"+e.name+"' is not of 'Angular Workspace application' type."):console.warn("Unexpected empty app configuration.")},e.prototype.init=function(){var e=this;return this.appWebService.get().pipe(s.map((function(t){return e.setApp(t),t})))},e.prototype.initFromApp=function(e){e&&this.setApp(e)},e.prototype.refresh=function(e){var t=this,r=this.appWebService.refresh(this.app?this.app.versionId:"",e);return r.subscribe((function(e){return!e.upToDate&&e.app&&t.setApp(e.app),e})),r.pipe(s.map((function(e){return t.app})))},e.prototype.clear=function(){this.app=void 0,this.cclabels=void 0,this._defaultCCQuery=void 0,this.ccquery=void 0,this.clearMaps()},e.prototype.indexIsNormal=function(e){return!!e&&(!e.indexType||t.Utils.startsWith(e.indexType,"normal"))},e.prototype.getIndexForQuery=function(e){if(e){var r=t.Utils.split(e.searchIndexes,[","]);if(0===r.length)return this.app?this.app.indexes._:void 0;var i=this.getIndex(r[0]);return i&&this.indexIsNormal(i)?this.app?this.app.indexes._:void 0:i}},e.prototype._makeColumnMapForIndex=function(e,r){var i,s,n,a;if(r&&r.columns)try{for(var o=u(Object.keys(r.columns)),l=o.next();!l.done;l=o.next()){var p=l.value,h=r.columns[p];if(e[t.Utils.toLowerCase(h.name)]=h,h.aliases)try{for(var c=(n=void 0,u(h.aliases)),f=c.next();!f.done;f=c.next()){var d=f.value;e[t.Utils.toLowerCase(d)]=h}}catch(e){n={error:e}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}}}catch(e){i={error:e}}finally{try{l&&!l.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},e.prototype._makeColumnMapForQuery=function(r,i){var s,n,a,o;if(i&&i.columnsInfo&&i.columnsInfo.columns){var l=this.getIndexForQuery(i);if(l&&l.columns)try{for(var p=u(i.columnsInfo.columns),h=p.next();!h.done;h=p.next()){var c=h.value;if(c.name){var f=t.Utils.toLowerCase(c.name),d=l.columns[f];if(d||(d=e.extraColumns[f]),d){if(d=t.Utils.copy(d),r[f]=d,c.aliases){d.aliases=t.Utils.split(c.aliases,[",",";"]);try{for(var v=(a=void 0,u(d.aliases)),y=v.next();!y.done;y=v.next()){var m=y.value;r[t.Utils.toLowerCase(m)]=d}}catch(e){a={error:e}}finally{try{y&&!y.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}}c.label&&(d.label=c.label),c.labelPlural&&(d.labelPlural=c.labelPlural),c.formatter&&(d.formatter=c.formatter),c.transforms&&(d.transforms=c.transforms),c.parser&&(d.parser=c.parser),c.description&&(d.description=c.description)}}}}catch(e){s={error:e}}finally{try{h&&!h.done&&(n=p.return)&&n.call(p)}finally{if(s)throw s.error}}}},e.prototype.makeMaps=function(){var e,r,i,s,n,a,o,l,p,h;if(this.columnsByQuery={},this.columnsByIndex={},this.fieldsByQuery={},this.app){var c;if(this.app.queries)try{for(var f=u(Object.keys(this.app.queries)),d=f.next();!d.done;d=f.next()){var v=d.value,y=this.app.queries[v];y&&(y.$columnFieldsPattern=new t.PatternMatcher("included column fields","excluded column fields"),y.$columnFieldsPattern.includedPattern.setText(y.columnFieldsIncluded),y.$columnFieldsPattern.excludedPattern.setText(y.columnFieldsExcluded),y.$partnameFieldsPattern=new t.PatternMatcher("included part name fields","excluded part name fields"),y.$partnameFieldsPattern.includedPattern.setText(y.partnameFieldsIncluded),y.$partnameFieldsPattern.excludedPattern.setText(y.partnameFieldsExcluded),y.columnsInfo&&(c={},this.columnsByQuery[t.Utils.toLowerCase(y.name)]=c,this._makeColumnMapForQuery(c,y)))}}catch(t){e={error:t}}finally{try{d&&!d.done&&(r=f.return)&&r.call(f)}finally{if(e)throw e.error}}if(this.app.indexes){var m=this.app.indexes._;m&&(c={},this.columnsByIndex._=c,this._makeColumnMapForIndex(c,m));try{for(var g=u(Object.keys(this.app.indexes)),x=g.next();!x.done;x=g.next()){var b=x.value,U=this.app.indexes[t.Utils.toLowerCase(b)];U&&(this.indexIsNormal(U)?"_"!==U.name&&(this.columnsByIndex[t.Utils.toLowerCase(U.name)]=this.columnsByIndex._):(c={},this.columnsByIndex[t.Utils.toLowerCase(U.name)]=c,this._makeColumnMapForIndex(c,U)))}}catch(e){i={error:e}}finally{try{x&&!x.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}var S=new Map,C=this.columnsByIndex._;if(C)try{for(var k=u(Object.keys(C)),w=k.next();!w.done;w=k.next()){if((A=C[w.value]).aliases&&A.aliases.length>0)(I=A.aliases[0])&&S.set(I,I)}}catch(e){n={error:e}}finally{try{w&&!w.done&&(a=k.return)&&a.call(k)}finally{if(n)throw n.error}}try{for(var T=u(Object.keys(this.columnsByQuery)),E=T.next();!E.done;E=T.next()){v=E.value;var O=new Map(S),N=this.columnsByQuery[t.Utils.toLowerCase(this.defaultCCQuery?this.defaultCCQuery.name:"")];if(N){try{for(var V=(p=void 0,u(Object.keys(N))),F=V.next();!F.done;F=V.next()){var A,I;if((A=N[F.value]).aliases&&A.aliases.length>0)(I=A.aliases[0])&&O.set(I,I)}}catch(e){p={error:e}}finally{try{F&&!F.done&&(h=V.return)&&h.call(V)}finally{if(p)throw p.error}}this.fieldsByQuery[v]=Array.from(O.keys())}}}catch(e){o={error:e}}finally{try{E&&!E.done&&(l=T.return)&&l.call(T)}finally{if(o)throw o.error}}}},e.prototype.clearMaps=function(){this.columnsByQuery={},this.columnsByIndex={},this.fieldsByQuery={}},e.prototype.getWebService=function(e){if(this.app)return t.Utils.getField(this.app.webServices,e)},e.prototype.getList=function(e){if(this.app)return this.app.lists[e]},Object.defineProperty(e.prototype,"defaultCCQuery",{get:function(){return this._defaultCCQuery},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ccquery",{get:function(){return this._ccquery?this._ccquery:this._defaultCCQuery},set:function(e){if(e!==this._ccquery){var t=this._ccquery;this._ccquery=e,this._events.next({type:"query-changed",current:this._ccquery,previous:t})}},enumerable:!1,configurable:!0}),e.prototype.getCCQuery=function(e){return this.app?this.app.queries[t.Utils.toLowerCase(e)]:void 0},e.prototype.setCCQuery=function(e){var t=e?this.getCCQuery(e):this.defaultCCQuery;return t?(this.ccquery=t,!0):(console.warn("AppService.setCCQuery - query '"+e+"' does not exist"),!1)},Object.defineProperty(e.prototype,"fields",{get:function(){return this.ccquery&&this.fieldsByQuery[t.Utils.toLowerCase(this.ccquery.name)]||[]},enumerable:!1,configurable:!0}),e.prototype.getCCAggregation=function(e){if(this.ccquery&&this.ccquery.aggregations)return this.ccquery.aggregations.find((function(r){return t.Utils.eqNC(e,r.name)}))},e.prototype.getIndex=function(e){if(this.app)return t.Utils.getField(this.app.indexes,e)},e.prototype.getColumn=function(r){var i,s;if(r&&this.ccquery){var n,a=this.columnsByQuery[t.Utils.toLowerCase(this.ccquery.name)];if(a&&(n=a[t.Utils.toLowerCase(r)]))return n;var o=t.Utils.split(this.ccquery.searchIndexes,[","]),l=0===o.length?void 0:this.getIndex(o[0]);if(0===o.length||l&&this.indexIsNormal(l)){if((a=this.columnsByIndex._)&&(n=a[t.Utils.toLowerCase(r)]))return n}else try{for(var p=u(o),h=p.next();!h.done;h=p.next()){var c=h.value;if((a=this.columnsByIndex[t.Utils.toLowerCase(c)])&&(n=a[t.Utils.toLowerCase(r)]))return n}}catch(e){i={error:e}}finally{try{h&&!h.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}return(n=e.extraColumns[t.Utils.toLowerCase(r)])||void 0}},e.prototype.getColumnDefaultAlias=function(e){return e&&e.aliases&&e.aliases.length>0?e.aliases[0]:""},e.prototype.getColumnName=function(e,t){return void 0===t&&(t=""),e?e.name:t},e.prototype.getColumnAlias=function(e,t){if(void 0===t&&(t=""),e){var r=this.getColumnDefaultAlias(e);if(r)return r}return t},e.prototype.resolveColumnName=function(e){var t=this.getColumn(e);return this.getColumnName(t,e||"")},e.prototype.resolveColumnAlias=function(e){var t=this.getColumn(e);return this.getColumnAlias(t,e||"")},e.prototype.parseExpr=function(e,t){return v.parse(e,{appService:this,formatService:this.formatService,intlService:this.intlService},t)},e.prototype.escapeFieldValue=function(r,i){if(t.Utils.isDate(i))return t.Utils.toSysDateStr(i);i+="";var s=this.getColumn(r);return s&&!e.isScalar(s)?v.escape(i):i},e.prototype.getLabel=function(r,i){var s=this.getColumn(r);if(s){var n=e.isCsv(s)?s.labelPlural:s.label;if(n)return n}return t.Utils.isUndefined(i)?r:i},e.prototype.getSingularLabel=function(e,r){var i=this.getColumn(e);return i&&i.label?i.label:t.Utils.isUndefined(r)?e:r},e.prototype.getPluralLabel=function(e,r){var i=this.getColumn(e);return i&&i.labelPlural?i.labelPlural:t.Utils.isUndefined(r)?e:r},e.prototype.isString=function(t){var r=this.getColumn(t);return!!r&&e.isString(r)},e.prototype.isCsv=function(t){var r=this.getColumn(t);return!!r&&e.isCsv(r)},e.prototype.isTree=function(t){var r=this.getColumn(t);return!!r&&e.isTree(r)},e.prototype.isEntity=function(t){var r=this.getColumn(t);return!!r&&e.isEntity(r)},e.prototype.isBoolean=function(t){var r=this.getColumn(t);return!!r&&e.isBoolean(r)},e.prototype.isDate=function(t){var r=this.getColumn(t);return!!r&&e.isDate(r)},e.prototype.isDouble=function(t){var r=this.getColumn(t);return!!r&&e.isDouble(r)},e.prototype.isInteger=function(t){var r=this.getColumn(t);return!!r&&e.isInteger(r)},e.prototype.isNumber=function(e){return this.isInteger(e)||this.isDouble(e)},e.prototype.isScalar=function(t){var r=this.getColumn(t);return!!r&&e.isScalar(r)},e.prototype.isSortable=function(t){var r=this.getColumn(t);return!!r&&e.isSortable(r)},e.prototype.updateUrlForCors=function(e){return this.startConfig.corsActive&&e&&!t.Utils.isUrlAbsolute(e)&&(e=t.Utils.addUrl(this.origin,e)),e},Object.defineProperty(e.prototype,"adminUrl",{get:function(){return this.updateUrlForCors(t.Utils.addUrl(this.startConfig.applicationPath,"admin"))},enumerable:!1,configurable:!0}),e}();b.extraColumns={id:b.makeColumn("id","string"),text:b.makeColumn("text","varchar"),documentlanguages:b.makeColumn("documentlanguages","csv","ci"),databasealias:b.makeColumn("databasealias","varchar"),globalrelevance:b.makeColumn("globalrelevance","double"),matchingpartnames:b.makeColumn("matchingpartnames","csv"),matchlocations:b.makeColumn("matchlocations","csv"),matchlocationsperpartname:b.makeColumn("matchlocationsperpartname","varchar"),extracts:b.makeColumn("extracts","csv"),extractsperpartname:b.makeColumn("extractsperpartname","varchar"),extractslocations:b.makeColumn("extractslocations","csv"),documentweight:b.makeColumn("documentweight","varchar"),groupcount:b.makeColumn("groupcount","integer"),accesslists:b.makeColumn("accesslists","varchar",void 0,["accessLists"])},b.ɵfac=function(e){return new(e||b)(r.ɵɵinject(n.START_CONFIG),r.ɵɵinject(n.AppWebService),r.ɵɵinject(a.IntlService),r.ɵɵinject(x))},b.ɵprov=r.ɵɵdefineInjectable({token:b,factory:b.ɵfac,providedIn:"root"});var U=function(){function e(e){this.startConfig=e}return e.prototype.shouldIntercept=function(e){return t.Utils.startsWith(e,this.startConfig.apiPath)},e.prototype.isJsonable=function(e){return(t.Utils.isObject(e)||t.Utils.isArray(e))&&!t.Utils.isArrayBuffer(e)&&!t.Utils.isBlob(e)&&!t.Utils.isString(e)&&!(e instanceof l.HttpParams)},e.prototype.ensureAuditRecord=function(e){if(e){var r;if(t.Utils.isArray(e))r=e;else if(t.Utils.isObject(e)){var i=e;if(i.auditEvents||i.mlAuditEvents)return i;r=[e]}return{auditEvents:r}}},e.prototype.addSessionId=function(e){var t,r=this.getSessionId();null===(t=null==e?void 0:e.auditEvents)||void 0===t||t.forEach((function(e){e.detail||(e.detail={}),e.detail["session-id"]=r}))},e.prototype.getSessionId=function(){return this.sessionid&&!this.isSessionStale()||(this.sessionid=t.Utils.guid()),this.sessionstart=new Date,this.sessionid},e.prototype.isSessionStale=function(){return(new Date).getTime()-this.sessionstart.getTime()>6e5},e.prototype.updateAuditRecord=function(e){},e.prototype.intercept=function(e,t){return this.shouldIntercept(e.url)&&this.isJsonable(e.body)&&(e.body.$auditRecord=this.ensureAuditRecord(e.body.$auditRecord),this.addSessionId(e.body.$auditRecord),this.updateAuditRecord(e.body.$auditRecord)),t.handle(e)},e}();U.ɵfac=function(e){return new(e||U)(r.ɵɵinject(n.START_CONFIG))},U.ɵprov=r.ɵɵdefineInjectable({token:U,factory:U.ɵfac,providedIn:"root"});var S=[],C=function(){};C.ɵmod=r.ɵɵdefineNgModule({type:C}),C.ɵinj=r.ɵɵdefineInjector({factory:function(e){return new(e||C)},providers:h(S),imports:[[t.BaseModule,a.IntlModule,n.WebServicesModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&r.ɵɵsetNgModuleScope(C,{imports:[t.BaseModule,a.IntlModule,n.WebServicesModule]}),e.AppService=b,e.AppUtilsModule=C,e.AuditInterceptor=U,e.Expr=f,e.ExprBuilder=y,e.ExprParser=v,e.ExprParserOperator=d,e.FormatService=x,e.Query=g,e.advancedFacetPrefix=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sinequa-core-app-utils.umd.min.js.map