import { Injectable, Inject } from "@angular/core";
import { of } from "rxjs";
import { HttpService } from "./http.service";
import { START_CONFIG } from "./start-config.web.service";
import { Utils } from "@sinequa/core/base";
import * as i0 from "@angular/core";
import * as i1 from "./http-client";
/**
 * A service to notify the audit manager on the Sinequa server of client-side events
 */
export class AuditWebService extends HttpService {
    constructor(startConfig, httpClient) {
        super(startConfig);
        this.httpClient = httpClient;
    }
    /**
     * Notify the Sinequa server of a sponsored link event
     *
     * @param evt The audit event type
     * @param sl The sponsored link
     * @param resultId The id of the results that showed the sponsored link
     * @param parameters Additional information
     */
    notifySponsoredLink(evt, sl, resultId, parameters) {
        const detail = {
            "link-id": sl.id,
            rank: sl.rank || 0,
            title: sl.title,
            url: sl.url,
            "result-id": resultId
        };
        if (parameters) {
            Object.keys(parameters).forEach(key => detail[key] = parameters[key]);
        }
        const data = {
            type: evt,
            detail
        };
        return this.notify(data);
    }
    /**
     * Notify the Sinequa server of a document event
     *
     * @param evt The audit event type
     * @param doc The document (record) in question
     * @param resultsOrId The results or resultid that contain the document
     * @param parameters Additional parameters
     * @param rfmParameters Additional RFM parameters
     */
    notifyDocument(evt, doc, resultsOrId, parameters, rfmParameters) {
        let resultId;
        let results;
        if (Utils.isString(resultsOrId)) {
            resultId = resultsOrId;
        }
        else {
            results = resultsOrId;
            resultId = results ? results.id : null;
        }
        const detail = {
            app: this.appName,
            "doc-id": doc.id,
            rank: doc.rank,
            title: doc.title,
            source: Utils.treeFirstNode(doc.collection[0]),
            collection: doc.collection[0],
            "result-id": resultId,
            filename: doc.filename,
            fileext: doc.fileext,
            index: doc.databasealias
        };
        if (results) {
            detail["result-count"] = results.totalRowCount;
        }
        if (parameters) {
            Object.keys(parameters).forEach(key => detail[key] = parameters[key]);
        }
        const data = {
            type: evt,
            detail
        };
        if (rfmParameters) {
            const rfmDetail = {};
            Object.keys(rfmParameters).forEach(key => rfmDetail[key] = rfmParameters[key]);
            data.rfmDetail = rfmDetail;
        }
        return this.notify(data);
    }
    /**
     * Notify the Sinequa server of a document event
     *
     * @param evt The audit event type
     * @param id The id of the document (record) in question
     * @param parameters Additional parameters
     * @param rfmParameters Additional RFM parameters
     */
    notifyDocumentById(evt, id, parameters, rfmParameters) {
        const collection = id.substr(0, id.indexOf("|"));
        const detail = {
            app: this.appName,
            "doc-id": id,
            rank: -1,
            source: Utils.treeFirstNode(collection),
            collection
        };
        if (parameters) {
            Object.keys(parameters).forEach(key => detail[key] = parameters[key]);
        }
        const data = {
            type: evt,
            detail
        };
        if (rfmParameters) {
            const rfmDetail = {};
            Object.keys(rfmParameters).forEach(key => rfmDetail[key] = rfmParameters[key]);
            data.rfmDetail = rfmDetail;
        }
        return this.notify(data);
    }
    /**
     * Notify logout
     */
    notifyLogout() {
        const detail = {
            app: this.appName,
        };
        const data = {
            type: "Search_Exit_Logout" /* Search_Exit_Logout */,
            detail
        };
        return this.notify(data);
    }
    /**
     * Notify the Sinequa server of a set of audit events
     *
     * @param auditEvents The audit events
     */
    notify(auditEvents) {
        if (!this.startConfig.auditEnabled) {
            return of(undefined);
        }
        const observable = this.httpClient.post(this.makeUrl(AuditWebService.endpoint), {
            event: "None" /* None */,
            app: this.appName,
            $auditRecord: auditEvents
        });
        Utils.subscribe(observable, (response) => {
            return response;
        }, (error) => {
            console.log("auditService.notify failure - error: ", error);
        });
        return observable;
    }
}
AuditWebService.endpoint = "audit.notify";
AuditWebService.ɵfac = function AuditWebService_Factory(t) { return new (t || AuditWebService)(i0.ɵɵinject(START_CONFIG), i0.ɵɵinject(i1.SqHttpClient)); };
AuditWebService.ɵprov = i0.ɵɵdefineInjectable({ token: AuditWebService, factory: AuditWebService.ɵfac, providedIn: "root" });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(AuditWebService, [{
        type: Injectable,
        args: [{
                providedIn: "root"
            }]
    }], function () { return [{ type: undefined, decorators: [{
                type: Inject,
                args: [START_CONFIG]
            }] }, { type: i1.SqHttpClient }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVkaXQud2ViLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vcHJvamVjdHMvY29yZS93ZWItc2VydmljZXMvIiwic291cmNlcyI6WyJhdWRpdC53ZWIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFFLE1BQU0sRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNqRCxPQUFPLEVBQWEsRUFBRSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRXBDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUMsWUFBWSxFQUFjLE1BQU0sNEJBQTRCLENBQUM7QUFDckUsT0FBTyxFQUFDLEtBQUssRUFBb0IsTUFBTSxvQkFBb0IsQ0FBQzs7O0FBb0k1RDs7R0FFRztBQUlILE1BQU0sT0FBTyxlQUFnQixTQUFRLFdBQVc7SUFHNUMsWUFDMEIsV0FBd0IsRUFDcEMsVUFBd0I7UUFDbEMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRFQsZUFBVSxHQUFWLFVBQVUsQ0FBYztJQUV0QyxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNILG1CQUFtQixDQUNmLEdBQW1CLEVBQUUsRUFBYyxFQUFFLFFBQWdCLEVBQ3JELFVBQXlEO1FBQ3pELE1BQU0sTUFBTSxHQUFlO1lBQ3ZCLFNBQVMsRUFBRSxFQUFFLENBQUMsRUFBRTtZQUNoQixJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDO1lBQ2xCLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSztZQUNmLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRztZQUNYLFdBQVcsRUFBRSxRQUFRO1NBQ3hCLENBQUM7UUFDRixJQUFJLFVBQVUsRUFBRTtZQUNaLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FB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QUUsV0FBVztTQUM1QixDQUFDLENBQUM7UUFDSCxLQUFLLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFDdEIsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNULE9BQU8sUUFBUSxDQUFDO1FBQ3BCLENBQUMsRUFDRCxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNoRSxDQUFDLENBQUMsQ0FBQztRQUNQLE9BQU8sVUFBVSxDQUFDO0lBQ3RCLENBQUM7O0FBakt1Qix3QkFBUSxHQUFHLGNBQWMsQ0FBQzs4RUFEekMsZUFBZSxjQUlaLFlBQVk7dURBSmYsZUFBZSxXQUFmLGVBQWUsbUJBRlosTUFBTTtrREFFVCxlQUFlO2NBSDNCLFVBQVU7ZUFBQztnQkFDUixVQUFVLEVBQUUsTUFBTTthQUNyQjs7c0JBS1EsTUFBTTt1QkFBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJbmplY3RhYmxlLCBJbmplY3R9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge09ic2VydmFibGUsIG9mfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHtTcUh0dHBDbGllbnR9IGZyb20gXCIuL2h0dHAtY2xpZW50XCI7XG5pbXBvcnQge0h0dHBTZXJ2aWNlfSBmcm9tIFwiLi9odHRwLnNlcnZpY2VcIjtcbmltcG9ydCB7U1RBUlRfQ09ORklHLCBTdGFydENvbmZpZ30gZnJvbSBcIi4vc3RhcnQtY29uZmlnLndlYi5zZXJ2aWNlXCI7XG5pbXBvcnQge1V0aWxzLCBNYXBPZiwgSnNvbk9iamVjdH0gZnJvbSBcIkBzaW5lcXVhL2NvcmUvYmFzZVwiO1xuaW1wb3J0IHtSZXN1bHRzLCBSZWNvcmR9IGZyb20gXCIuL3F1ZXJ5LndlYi5zZXJ2aWNlXCI7XG5pbXBvcnQge0xpbmtSZXN1bHR9IGZyb20gXCIuL3Nwb25zb3JlZC1saW5rcy53ZWIuc2VydmljZVwiO1xuXG4vKipcbiAqIERlc2NyaWJlcyBhIHNpbmdsZSBhdWRpdCBldmVudFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGl0RXZlbnQge1xuICAgIHR5cGU6IEF1ZGl0RXZlbnRUeXBlIHwgc3RyaW5nOyAvLyBhbGxvdyBjdXN0b20gZXZlbnQgdHlwZXNcbiAgICBkZXRhaWw/OiBKc29uT2JqZWN0O1xuICAgIHJmbURldGFpbD86IEpzb25PYmplY3Q7XG59XG5cbi8qKlxuICogQ29udGFpbnMgYW4gYXJyYXkgb2Yge0BsaW5rIEF1ZGl0RXZlbnR9IG9iamVjdHMgYW5kIGFuIGFycmF5IG9mIE1MIGF1ZGl0IGV2ZW50IHJlY29yZHNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBdWRpdFJlY29yZCB7XG4gICAgYXVkaXRFdmVudHM/OiBBdWRpdEV2ZW50W107XG4gICAgbWxBdWRpdEV2ZW50cz86IGFueVtdO1xufVxuXG4vKipcbiAqIEEgY29tcG9zaXRlIHR5cGUgZGVzY3JpYmluZyBhIHNldCBvZiBBdWRpdEV2ZW50c1xuICovXG5leHBvcnQgdHlwZSBBdWRpdEV2ZW50cyA9IEF1ZGl0RXZlbnQgfCBBdWRpdEV2ZW50W10gfCBBdWRpdFJlY29yZDtcblxuLyoqXG4gKiBUaGUgc3RhbmRhcmQgYXVkaXQgZXZlbnQgdHlwZXNcbiAqL1xuZXhwb3J0IGNvbnN0IGVudW0gQXVkaXRFdmVudFR5cGUge1xuICAgIC8vIFNob3VsZCBiZSBpbiBwYXIgd2l0aCBBdWRpdEV2ZW50VHlwZSBlbnVtIGZyb20gQXVkaXRNYW5hZ2VyLmNzXG4gICAgTm9uZSA9IFwiTm9uZVwiLFxuXG4gICAgLy8gV2ViQXBwIGV2ZW50IHR5cGVzXG4gICAgU2VhcmNoX0ZpcnN0UGFnZSA9IFwiU2VhcmNoX0ZpcnN0UGFnZVwiLFxuICAgIFNlYXJjaF9UZXh0ID0gXCJTZWFyY2hfVGV4dFwiLFxuICAgIFNlYXJjaF9SZWZpbmUgPSBcIlNlYXJjaF9SZWZpbmVcIixcbiAgICBTZWFyY2hfU2VsZWN0X0l0ZW0gPSBcIlNlYXJjaF9TZWxlY3RfSXRlbVwiLFxuICAgIFNlYXJjaF9TZWxlY3RfQ3VzdG9tID0gXCJTZWFyY2hfU2VsZWN0X0N1c3RvbVwiLFxuICAgIFNlYXJjaF9TZWxlY3RfQ29uY2VwdCA9IFwiU2VhcmNoX1NlbGVjdF9Db25jZXB0XCIsXG4gICAgU2VhcmNoX1NlbGVjdF9Db3JyZWN0aW9uID0gXCJTZWFyY2hfU2VsZWN0X0NvcnJlY3Rpb25cIixcbiAgICBTZWFyY2hfR290b1BhZ2UgPSBcIlNlYXJjaF9Hb3RvUGFnZVwiLFxuICAgIFNlYXJjaF9Hb3RvVGFiID0gXCJTZWFyY2hfR290b1RhYlwiLFxuICAgIFNlYXJjaF9EaXNwbGF5UmVzdWx0ID0gXCJTZWFyY2hfRGlzcGxheVJlc3VsdFwiLFxuICAgIFNlYXJjaF9SZW1vdmVSZXN1bHQgPSBcIlNlYXJjaF9SZW1vdmVSZXN1bHRcIixcbiAgICBTZWFyY2hfUmVtb3ZlQWR2YW5jZWQgPSBcIlNlYXJjaF9SZW1vdmVBZHZhbmNlZFwiLFxuICAgIFNlYXJjaF9TYXZlZFF1ZXJ5ID0gXCJTZWFyY2hfU2F2ZWRRdWVyeVwiLFxuICAgIFNlYXJjaF9XZWJTZXJ2aWNlID0gXCJTZWFyY2hfV2ViU2VydmljZVwiLFxuICAgIFNlYXJjaF9EaWRZb3VNZWFuX09yaWdpbmFsID0gXCJTZWFyY2hfRGlkWW91TWVhbl9PcmlnaW5hbFwiLFxuICAgIFNlYXJjaF9EaWRZb3VNZWFuX0NvcnJlY3Rpb24gPSBcIlNlYXJjaF9EaWRZb3VNZWFuX0NvcnJlY3Rpb25cIixcbiAgICBTZWFyY2hfRXhwb3J0Q1NWID0gXCJTZWFyY2hfRXhwb3J0Q1NWXCIsXG4gICAgU2VhcmNoX1NhdmVkUXVlcnlfRXhwb3J0Q1NWID0gXCJTZWFyY2hfU2F2ZWRRdWVyeV9FeHBvcnRDU1ZcIixcbiAgICBTZWFyY2hfU2VsZWN0aW9uX0V4cG9ydENTViA9IFwiU2VhcmNoX1NlbGVjdGlvbl9FeHBvcnRDU1ZcIixcbiAgICBTZWFyY2hfQWxlcnRRdWVyeSA9IFwiU2VhcmNoX0FsZXJ0UXVlcnlcIixcbiAgICBTZWFyY2hfU2VsZWN0X0FuYWx5dGljc0l0ZW0gPSBcIlNlYXJjaF9TZWxlY3RfQW5hbHl0aWNzSXRlbVwiLFxuICAgIFNlYXJjaF9Tb3J0ID0gXCJTZWFyY2hfU29ydFwiLFxuICAgIFNlYXJjaF9FeGl0X0xvZ291dCA9IFwiU2VhcmNoX0V4aXRfTG9nb3V0XCIsXG4gICAgU2VhcmNoX1RpbWVsaW5lX1VzYWdlID0gXCJTZWFyY2hfVGltZWxpbmVfVXNhZ2VcIixcbiAgICBTZWFyY2hfQXV0b0NvbXBsZXRlID0gXCJTZWFyY2hfQXV0b2NvbXBsZXRlXCIsXG5cbiAgICBTYXZlZFF1ZXJ5X0FkZCA9IFwiU2F2ZWRRdWVyeV9BZGRcIixcbiAgICBTYXZlZFF1ZXJ5X0RlbGV0ZSA9IFwiU2F2ZWRRdWVyeV9EZWxldGVcIixcbiAgICBTYXZlZFF1ZXJ5X0RlbGV0ZUFsbCA9IFwiU2F2ZWRRdWVyeV9EZWxldGVBbGxcIixcbiAgICBTYXZlZFF1ZXJ5X1JlbmFtZSA9IFwiU2F2ZWRRdWVyeV9SZW5hbWVcIixcblxuICAgIEFsZXJ0X0VkaXQgPSBcIkFsZXJ0X0VkaXRcIixcbiAgICBBbGVydF9EZWxldGUgPSBcIkFsZXJ0X0RlbGV0ZVwiLFxuICAgIEFsZXJ0X0RlbGV0ZUFsbCA9IFwiQWxlcnRfRGVsZXRlQWxsXCIsXG5cbiAgICBMaW5rX0Rpc3BsYXkgPSBcIkxpbmtfRGlzcGxheVwiLFxuICAgIExpbmtfQ2xpY2sgPSBcIkxpbmtfQ2xpY2tcIixcblxuICAgIEJhc2tldF9BZGQgPSBcIkJhc2tldF9BZGRcIixcbiAgICBCYXNrZXRfRGVsZXRlID0gXCJCYXNrZXRfRGVsZXRlXCIsXG4gICAgQmFza2V0X0RlbGV0ZUFsbCA9IFwiQmFza2V0X0RlbGV0ZUFsbFwiLFxuICAgIEJhc2tldF9SZW5hbWUgPSBcIkJhc2tldF9SZW5hbWVcIixcbiAgICBCYXNrZXRfQWRkRG9jID0gXCJCYXNrZXRfQWRkRG9jXCIsXG4gICAgQmFza2V0X1JlbW92ZURvYyA9IFwiQmFza2V0X1JlbW92ZURvY1wiLFxuICAgIEJhc2tldF9PcGVuID0gXCJCYXNrZXRfT3BlblwiLFxuICAgIEJhc2tldF9FeHBvcnRDU1YgPSBcIkJhc2tldF9FeHBvcnRDU1ZcIixcblxuICAgIExhYmVsX0FkZCA9IFwiTGFiZWxfQWRkXCIsXG4gICAgTGFiZWxfRGVsZXRlID0gXCJMYWJlbF9EZWxldGVcIixcbiAgICBMYWJlbF9SZW5hbWUgPSBcIkxhYmVsX1JlbmFtZVwiLFxuICAgIExhYmVsX09wZW4gPSBcIkxhYmVsX09wZW5cIixcbiAgICBMYWJlbF9BZGREb2MgPSBcIkxhYmVsX0FkZERvY1wiLFxuICAgIExhYmVsX1JlbW92ZURvYyA9IFwiTGFiZWxfUmVtb3ZlRG9jXCIsXG4gICAgTGFiZWxfRXhwb3J0Q1NWID0gXCJMYWJlbF9FeHBvcnRDU1ZcIixcbiAgICBMYWJlbF9NZW51X0V4cG9ydENTViA9IFwiTGFiZWxfTWVudV9FeHBvcnRDU1ZcIixcblxuICAgIFJhdGluZ19TZXQgPSBcIlJhdGluZ19TZXRcIixcbiAgICBSYXRpbmdfRGVsZXRlID0gXCJSYXRpbmdfRGVsZXRlXCIsXG5cbiAgICBEb2NfUHJldmlldyA9IFwiRG9jX1ByZXZpZXdcIixcbiAgICBEb2NfQ2FjaGVIdG1sID0gXCJEb2NfQ2FjaGVIdG1sXCIsXG4gICAgRG9jX0NhY2hlUGRmID0gXCJEb2NfQ2FjaGVQZGZcIixcbiAgICBEb2NfQ2FjaGVPcmlnaW5hbCA9IFwiRG9jX0NhY2hlT3JpZ2luYWxcIixcbiAgICBEb2NfVXJsMSA9IFwiRG9jX1VybDFcIixcbiAgICBEb2NfVXJsMiA9IFwiRG9jX1VybDJcIixcblxuICAgIENsaWNrX1Jlc3VsdExpbmsgPSBcIkNsaWNrX1Jlc3VsdExpbmtcIixcbiAgICBDbGlja19SZXN1bHRMaW5rMSA9IFwiQ2xpY2tfUmVzdWx0TGluazFcIixcbiAgICBDbGlja19SZXN1bHRMaW5rMiA9IFwiQ2xpY2tfUmVzdWx0TGluazJcIixcbiAgICBDbGlja19SZXN1bHRMaW5rMyA9IFwiQ2xpY2tfUmVzdWx0TGluazNcIixcbiAgICBDbGlja19SZXN1bHRMaW5rNCA9IFwiQ2xpY2tfUmVzdWx0TGluazRcIixcbiAgICBDbGlja19SZXN1bHRMaW5rNSA9IFwiQ2xpY2tfUmVzdWx0TGluazVcIixcbiAgICBDbGlja19SZXN1bHRMaW5rNiA9IFwiQ2xpY2tfUmVzdWx0TGluazZcIixcbiAgICBDbGlja19SZXN1bHRMaW5rNyA9IFwiQ2xpY2tfUmVzdWx0TGluazdcIixcbiAgICBDbGlja19SZXN1bHRMaW5rOCA9IFwiQ2xpY2tfUmVzdWx0TGluazhcIixcbiAgICBDbGlja19SZXN1bHRMaW5rOSA9IFwiQ2xpY2tfUmVzdWx0TGluazlcIixcbiAgICBDbGlja19SZXN1bHRMaW5rMTAgPSBcIkNsaWNrX1Jlc3VsdExpbmsxMFwiLFxuICAgIENsaWNrX1ByZXZpZXdMaW5rMSA9IFwiQ2xpY2tfUHJldmlld0xpbmsxXCIsXG4gICAgQ2xpY2tfUHJldmlld0xpbmsyID0gXCJDbGlja19QcmV2aWV3TGluazJcIixcbiAgICBDbGlja19QcmV2aWV3TGluazMgPSBcIkNsaWNrX1ByZXZpZXdMaW5rM1wiLFxuICAgIENsaWNrX1ByZXZpZXdMaW5rNCA9IFwiQ2xpY2tfUHJldmlld0xpbms0XCIsXG4gICAgQ2xpY2tfUHJldmlld0xpbms1ID0gXCJDbGlja19QcmV2aWV3TGluazVcIixcbiAgICBDbGlja19QcmV2aWV3TGluazYgPSBcIkNsaWNrX1ByZXZpZXdMaW5rNlwiLFxuICAgIENsaWNrX1ByZXZpZXdMaW5rNyA9IFwiQ2xpY2tfUHJldmlld0xpbms3XCIsXG4gICAgQ2xpY2tfUHJldmlld0xpbms4ID0gXCJDbGlja19QcmV2aWV3TGluazhcIixcbiAgICBDbGlja19QcmV2aWV3TGluazkgPSBcIkNsaWNrX1ByZXZpZXdMaW5rOVwiLFxuICAgIENsaWNrX1ByZXZpZXdMaW5rMTAgPSBcIkNsaWNrX1ByZXZpZXdMaW5rMTBcIixcblxuICAgIFJGTV9DbGlja1NldCA9IFwiUkZNX0NsaWNrU2V0XCIsXG4gICAgUkZNX0NsaWNrUmVzZXQgPSBcIlJGTV9DbGlja1Jlc2V0XCIsXG4gICAgUkZNX0xpa2UgPSBcIlJGTV9MaWtlXCIsXG4gICAgUkZNX0xpa2VSZXNldCA9IFwiUkZNX0xpa2VSZXNldFwiLFxuICAgIFJGTV9EaXNsaWtlID0gXCJSRk1fRGlzbGlrZVwiLFxuICAgIFJGTV9JbXBvcnRhbnQgPSBcIlJGTV9JbXBvcnRhbnRcIixcbiAgICBSRk1fSW1wb3J0YW50UmVzZXQgPSBcIlJGTV9JbXBvcnRhbnRSZXNldFwiLFxuICAgIFJGTV9CYW4gPSBcIlJGTV9CYW5cIlxufVxuXG4vKipcbiAqIEEgc2VydmljZSB0byBub3RpZnkgdGhlIGF1ZGl0IG1hbmFnZXIgb24gdGhlIFNpbmVxdWEgc2VydmVyIG9mIGNsaWVudC1zaWRlIGV2ZW50c1xuICovXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogXCJyb290XCJcbn0pXG5leHBvcnQgY2xhc3MgQXVkaXRXZWJTZXJ2aWNlIGV4dGVuZHMgSHR0cFNlcnZpY2Uge1xuICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IGVuZHBvaW50ID0gXCJhdWRpdC5ub3RpZnlcIjtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBASW5qZWN0KFNUQVJUX0NPTkZJRykgc3RhcnRDb25maWc6IFN0YXJ0Q29uZmlnLFxuICAgICAgICBwcm90ZWN0ZWQgaHR0cENsaWVudDogU3FIdHRwQ2xpZW50KSB7XG4gICAgICAgIHN1cGVyKHN0YXJ0Q29uZmlnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBOb3RpZnkgdGhlIFNpbmVxdWEgc2VydmVyIG9mIGEgc3BvbnNvcmVkIGxpbmsgZXZlbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldnQgVGhlIGF1ZGl0IGV2ZW50IHR5cGVcbiAgICAgKiBAcGFyYW0gc2wgVGhlIHNwb25zb3JlZCBsaW5rXG4gICAgICogQHBhcmFtIHJlc3VsdElkIFRoZSBpZCBvZiB0aGUgcmVzdWx0cyB0aGF0IHNob3dlZCB0aGUgc3BvbnNvcmVkIGxpbmtcbiAgICAgKiBAcGFyYW0gcGFyYW1ldGVycyBBZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gICAgICovXG4gICAgbm90aWZ5U3BvbnNvcmVkTGluayhcbiAgICAgICAgZXZ0OiBBdWRpdEV2ZW50VHlwZSwgc2w6IExpbmtSZXN1bHQsIHJlc3VsdElkOiBzdHJpbmcsXG4gICAgICAgIHBhcmFtZXRlcnM/OiBNYXBPZjxzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgdW5kZWZpbmVkPik6IE9ic2VydmFibGU8dm9pZD4gIHtcbiAgICAgICAgY29uc3QgZGV0YWlsOiBKc29uT2JqZWN0ID0ge1xuICAgICAgICAgICAgXCJsaW5rLWlkXCI6IHNsLmlkLFxuICAgICAgICAgICAgcmFuazogc2wucmFuayB8fCAwLFxuICAgICAgICAgICAgdGl0bGU6IHNsLnRpdGxlLFxuICAgICAgICAgICAgdXJsOiBzbC51cmwsXG4gICAgICAgICAgICBcInJlc3VsdC1pZFwiOiByZXN1bHRJZFxuICAgICAgICB9O1xuICAgICAgICBpZiAocGFyYW1ldGVycykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMocGFyYW1ldGVycykuZm9yRWFjaChrZXkgPT4gZGV0YWlsW2tleV0gPSBwYXJhbWV0ZXJzW2tleV0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGE6IEF1ZGl0RXZlbnQgPSB7XG4gICAgICAgICAgICB0eXBlOiBldnQsXG4gICAgICAgICAgICBkZXRhaWxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5KGRhdGEpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5vdGlmeSB0aGUgU2luZXF1YSBzZXJ2ZXIgb2YgYSBkb2N1bWVudCBldmVudFxuICAgICAqXG4gICAgICogQHBhcmFtIGV2dCBUaGUgYXVkaXQgZXZlbnQgdHlwZVxuICAgICAqIEBwYXJhbSBkb2MgVGhlIGRvY3VtZW50IChyZWNvcmQpIGluIHF1ZXN0aW9uXG4gICAgICogQHBhcmFtIHJlc3VsdHNPcklkIFRoZSByZXN1bHRzIG9yIHJlc3VsdGlkIHRoYXQgY29udGFpbiB0aGUgZG9jdW1lbnRcbiAgICAgKiBAcGFyYW0gcGFyYW1ldGVycyBBZGRpdGlvbmFsIHBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gcmZtUGFyYW1ldGVycyBBZGRpdGlvbmFsIFJGTSBwYXJhbWV0ZXJzXG4gICAgICovXG4gICAgbm90aWZ5RG9jdW1lbnQoXG4gICAgICAgIGV2dDogQXVkaXRFdmVudFR5cGUsIGRvYzogUmVjb3JkLCByZXN1bHRzT3JJZDogUmVzdWx0cyB8IHN0cmluZyxcbiAgICAgICAgcGFyYW1ldGVycz86IE1hcE9mPHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCB1bmRlZmluZWQ+LFxuICAgICAgICByZm1QYXJhbWV0ZXJzPzogTWFwT2Y8c3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHVuZGVmaW5lZD4pOiBPYnNlcnZhYmxlPHZvaWQ+ICB7XG4gICAgICAgIGxldCByZXN1bHRJZDogc3RyaW5nIHwgbnVsbDtcbiAgICAgICAgbGV0IHJlc3VsdHM6IFJlc3VsdHMgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChVdGlscy5pc1N0cmluZyhyZXN1bHRzT3JJZCkpIHtcbiAgICAgICAgICAgIHJlc3VsdElkID0gcmVzdWx0c09ySWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0c09ySWQ7XG4gICAgICAgICAgICByZXN1bHRJZCA9IHJlc3VsdHMgPyByZXN1bHRzLmlkIDogbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZXRhaWw6IEpzb25PYmplY3QgPSB7XG4gICAgICAgICAgICBhcHA6IHRoaXMuYXBwTmFtZSxcbiAgICAgICAgICAgIFwiZG9jLWlkXCI6IGRvYy5pZCxcbiAgICAgICAgICAgIHJhbms6IGRvYy5yYW5rLFxuICAgICAgICAgICAgdGl0bGU6IGRvYy50aXRsZSxcbiAgICAgICAgICAgIHNvdXJjZTogVXRpbHMudHJlZUZpcnN0Tm9kZShkb2MuY29sbGVjdGlvblswXSksXG4gICAgICAgICAgICBjb2xsZWN0aW9uOiBkb2MuY29sbGVjdGlvblswXSxcbiAgICAgICAgICAgIFwicmVzdWx0LWlkXCI6IHJlc3VsdElkLFxuICAgICAgICAgICAgZmlsZW5hbWU6IGRvYy5maWxlbmFtZSxcbiAgICAgICAgICAgIGZpbGVleHQ6IGRvYy5maWxlZXh0LFxuICAgICAgICAgICAgaW5kZXg6IGRvYy5kYXRhYmFzZWFsaWFzXG4gICAgICAgIH07XG4gICAgICAgIGlmIChyZXN1bHRzKSB7XG4gICAgICAgICAgICBkZXRhaWxbXCJyZXN1bHQtY291bnRcIl0gPSByZXN1bHRzLnRvdGFsUm93Q291bnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHBhcmFtZXRlcnMpLmZvckVhY2goa2V5ID0+IGRldGFpbFtrZXldID0gcGFyYW1ldGVyc1trZXldKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRhOiBBdWRpdEV2ZW50ID0ge1xuICAgICAgICAgICAgdHlwZTogZXZ0LFxuICAgICAgICAgICAgZGV0YWlsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChyZm1QYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICBjb25zdCByZm1EZXRhaWw6IEpzb25PYmplY3QgPSB7fTtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKHJmbVBhcmFtZXRlcnMpLmZvckVhY2goa2V5ID0+IHJmbURldGFpbFtrZXldID0gcmZtUGFyYW1ldGVyc1trZXldKTtcbiAgICAgICAgICAgIGRhdGEucmZtRGV0YWlsID0gcmZtRGV0YWlsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLm5vdGlmeShkYXRhKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBOb3RpZnkgdGhlIFNpbmVxdWEgc2VydmVyIG9mIGEgZG9jdW1lbnQgZXZlbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldnQgVGhlIGF1ZGl0IGV2ZW50IHR5cGVcbiAgICAgKiBAcGFyYW0gaWQgVGhlIGlkIG9mIHRoZSBkb2N1bWVudCAocmVjb3JkKSBpbiBxdWVzdGlvblxuICAgICAqIEBwYXJhbSBwYXJhbWV0ZXJzIEFkZGl0aW9uYWwgcGFyYW1ldGVyc1xuICAgICAqIEBwYXJhbSByZm1QYXJhbWV0ZXJzIEFkZGl0aW9uYWwgUkZNIHBhcmFtZXRlcnNcbiAgICAgKi9cbiAgICBub3RpZnlEb2N1bWVudEJ5SWQoXG4gICAgICAgIGV2dDogQXVkaXRFdmVudFR5cGUsIGlkOiBzdHJpbmcsXG4gICAgICAgIHBhcmFtZXRlcnM/OiBNYXBPZjxzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgdW5kZWZpbmVkPixcbiAgICAgICAgcmZtUGFyYW1ldGVycz86IE1hcE9mPHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCB1bmRlZmluZWQ+KTogT2JzZXJ2YWJsZTx2b2lkPiAge1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gaWQuc3Vic3RyKDAsIGlkLmluZGV4T2YoXCJ8XCIpKTtcbiAgICAgICAgY29uc3QgZGV0YWlsOiBKc29uT2JqZWN0ID0ge1xuICAgICAgICAgICAgYXBwOiB0aGlzLmFwcE5hbWUsXG4gICAgICAgICAgICBcImRvYy1pZFwiOiBpZCxcbiAgICAgICAgICAgIHJhbms6IC0xLFxuICAgICAgICAgICAgc291cmNlOiBVdGlscy50cmVlRmlyc3ROb2RlKGNvbGxlY3Rpb24pLFxuICAgICAgICAgICAgY29sbGVjdGlvblxuICAgICAgICB9O1xuICAgICAgICBpZiAocGFyYW1ldGVycykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMocGFyYW1ldGVycykuZm9yRWFjaChrZXkgPT4gZGV0YWlsW2tleV0gPSBwYXJhbWV0ZXJzW2tleV0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRhdGE6IEF1ZGl0RXZlbnQgPSB7XG4gICAgICAgICAgICB0eXBlOiBldnQsXG4gICAgICAgICAgICBkZXRhaWxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHJmbVBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJmbURldGFpbDogSnNvbk9iamVjdCA9IHt9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXMocmZtUGFyYW1ldGVycykuZm9yRWFjaChrZXkgPT4gcmZtRGV0YWlsW2tleV0gPSByZm1QYXJhbWV0ZXJzW2tleV0pO1xuICAgICAgICAgICAgZGF0YS5yZm1EZXRhaWwgPSByZm1EZXRhaWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5KGRhdGEpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5vdGlmeSBsb2dvdXRcbiAgICAgKi9cbiAgICBub3RpZnlMb2dvdXQoKSA6IE9ic2VydmFibGU8dm9pZD4ge1xuICAgICAgICBjb25zdCBkZXRhaWw6IEpzb25PYmplY3QgPSB7XG4gICAgICAgICAgICBhcHA6IHRoaXMuYXBwTmFtZSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBkYXRhOiBBdWRpdEV2ZW50ID0ge1xuICAgICAgICAgICAgdHlwZTogQXVkaXRFdmVudFR5cGUuU2VhcmNoX0V4aXRfTG9nb3V0LFxuICAgICAgICAgICAgZGV0YWlsXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5KGRhdGEpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5vdGlmeSB0aGUgU2luZXF1YSBzZXJ2ZXIgb2YgYSBzZXQgb2YgYXVkaXQgZXZlbnRzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXVkaXRFdmVudHMgVGhlIGF1ZGl0IGV2ZW50c1xuICAgICAqL1xuICAgIG5vdGlmeShhdWRpdEV2ZW50czogQXVkaXRFdmVudHMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXJ0Q29uZmlnLmF1ZGl0RW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIG9mKHVuZGVmaW5lZCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2JzZXJ2YWJsZSA9IHRoaXMuaHR0cENsaWVudC5wb3N0PHZvaWQ+KHRoaXMubWFrZVVybChBdWRpdFdlYlNlcnZpY2UuZW5kcG9pbnQpLCB7XG4gICAgICAgICAgICBldmVudDogQXVkaXRFdmVudFR5cGUuTm9uZSxcbiAgICAgICAgICAgIGFwcDogdGhpcy5hcHBOYW1lLFxuICAgICAgICAgICAgJGF1ZGl0UmVjb3JkOiBhdWRpdEV2ZW50c1xuICAgICAgICB9KTtcbiAgICAgICAgVXRpbHMuc3Vic2NyaWJlKG9ic2VydmFibGUsXG4gICAgICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJhdWRpdFNlcnZpY2Uubm90aWZ5IGZhaWx1cmUgLSBlcnJvcjogXCIsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZTtcbiAgICB9XG59Il19