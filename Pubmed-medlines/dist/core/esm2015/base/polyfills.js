import "fast-text-encoding"; // IE 11 / Edge
// NB the name of the intl polyfill (below) conflicts with @sinequa/core/intl in the module resolution.
// Output of traceResolution: true gives the following:
//
// Resolving module name 'intl' relative to base url 'D:/ice/sba/ng-ws/projects/core' - 'D:/ice/sba/ng-ws/projects/core/intl'.
// Loading module as file / folder, candidate module location 'D:/ice/sba/ng-ws/projects/core/intl', target file type 'TypeScript'.
// ...
// This can be worked around in a number of ways:
// 1. Rename the @sinequa/core/intl folder and all references to it (not overly desirable)
// 2. Install the intl polyfill using an alias: npm install my-intl-alias@npm:intl. But then references in the locale files would have
//    to use import "my-intl-alias/..."
// 3. Don't use index.ts as the entry point filename. This is a bit hacky but it works and has the least impact so that's what we've gone with
//    _index.ts is used and referenced in package.json: { "ngPackage": { "lib": { "entryFile": "index.ts" } } }
//    We also put an explicit Path to @sinequa/core/intl => ./intl/_index in the local tsconfig.json so that references to @sinequa/core/intl
//    are resolved correctly in VSCode
import "intl"; // Safari
import "intl/locale-data/jsonp/en-US"; // Locale needed for formatjs initialization (new Intl.NumberFormat())
import "js-polyfills/url";
import "matchmedia-polyfill";
import focusWithin from "focus-within"; // IE 11 / Edge - https://github.com/jonathantneal/focus-within
focusWithin(document);
// String.trimStart, String.trimEnd
if (!String.prototype.trimStart) {
    String.prototype.trimStart = function () {
        return this.replace(/^[\s\uFEFF\xA0]+/g, '');
    };
}
if (!String.prototype.trimEnd) {
    String.prototype.trimEnd = function () {
        return this.replace(/[\s\uFEFF\xA0]+$/g, '');
    };
}
// See https://gist.github.com/jocki84/6ffafd003387179a988e
if (!Element.prototype.scrollIntoViewIfNeeded) {
    Element.prototype.scrollIntoViewIfNeeded = function (centerIfNeeded) {
        function withinBounds(value, min, max, extent) {
            if (false === centerIfNeeded || max <= value + extent && value <= min + extent) {
                return Math.min(max, Math.max(min, value));
            }
            else {
                return (min + max) / 2;
            }
        }
        function makeArea(left, top, width, height) {
            return { "left": left, "top": top, "width": width, "height": height,
                "right": left + width, "bottom": top + height,
                "translate": function (x, y) {
                    return makeArea(x + left, y + top, width, height);
                },
                "relativeFromTo": function (lhs, rhs) {
                    let newLeft = left, newTop = top;
                    lhs = lhs.offsetParent;
                    rhs = rhs.offsetParent;
                    if (lhs === rhs) {
                        return area;
                    }
                    for (; lhs; lhs = lhs.offsetParent) {
                        newLeft += lhs.offsetLeft + lhs.clientLeft;
                        newTop += lhs.offsetTop + lhs.clientTop;
                    }
                    for (; rhs; rhs = rhs.offsetParent) {
                        newLeft -= rhs.offsetLeft + rhs.clientLeft;
                        newTop -= rhs.offsetTop + rhs.clientTop;
                    }
                    return makeArea(newLeft, newTop, width, height);
                }
            };
        }
        let parent, elem = this, area = makeArea(this.offsetLeft, this.offsetTop, this.offsetWidth, this.offsetHeight);
        while ((parent = elem.parentNode) instanceof HTMLElement) {
            const clientLeft = parent.offsetLeft + parent.clientLeft;
            const clientTop = parent.offsetTop + parent.clientTop;
            // Make area relative to parent's client area.
            area = area.
                relativeFromTo(elem, parent).
                translate(-clientLeft, -clientTop);
            parent.scrollLeft = withinBounds(parent.scrollLeft, area.right - parent.clientWidth, area.left, parent.clientWidth);
            parent.scrollTop = withinBounds(parent.scrollTop, area.bottom - parent.clientHeight, area.top, parent.clientHeight);
            // Determine actual scroll amount by reading back scroll properties.
            area = area.translate(clientLeft - parent.scrollLeft, clientTop - parent.scrollTop);
            elem = parent;
        }
    };
}
// https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent
(function () {
    if (typeof window.CustomEvent === "function")
        return;
    function CustomEvent(event, params) {
        params = params || { bubbles: false, cancelable: false, detail: undefined };
        const evt = document.createEvent('CustomEvent');
        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
        return evt;
    }
    CustomEvent.prototype = window.Event.prototype;
    window.CustomEvent = CustomEvent;
})();
// IE
if (!window.location.origin) { // Some browsers (mainly IE) do not have this property, so we need to build it manually...
    try {
        window.location[ /*foo readonly*/"origin"] = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
    }
    catch (e) {
    }
}
// fake storage (eg for Safari private browsing)
function fakeStorage(storageName) {
    let fakeStorage = {};
    let storage;
    let needed = false;
    if (typeof window[storageName] === "object") {
        // Storage is there, does it work (eg Safari private browsing)
        try {
            window[storageName].setItem("fakeStorageTest", "1");
            window[storageName].removeItem("fakeStorageTest");
        }
        catch (e) {
            needed = true;
        }
    }
    else {
        needed = true;
    }
    if (!needed) {
        return;
    }
    if (typeof window[storageName] === "object") {
        // Override with fake implementation
        storage = window[storageName];
    }
    else {
        // Implement with fake
        try {
            storage = window[ /*fool readonly*/storageName] = {};
        }
        catch (e) {
            console.warn("Unable to set fake", storageName);
            return;
        }
    }
    console.warn("Using fake", storageName);
    const dispatchStorageEvent = function (key, newValue) {
        const oldValue = (!key) ? null : storage.getItem(key);
        const url = location.href.substr(location.origin.length);
        const storageEvent = document.createEvent("StorageEvent"); // For IE, http://stackoverflow.com/a/25514935/1214183
        storageEvent["initStorageEvent"]("storage", false, false, key, oldValue, newValue, url, storage);
        window.dispatchEvent(storageEvent);
    };
    storage.key = function (i) {
        const key = Object.keys(fakeStorage)[i];
        return typeof key === "string" ? key : null;
    };
    storage.getItem = function (key) {
        return typeof fakeStorage[key] === 'string' ? fakeStorage[key] : null;
    };
    storage.setItem = function (key, value) {
        dispatchStorageEvent(key, value);
        fakeStorage[key] = String(value);
    };
    storage.removeItem = function (key) {
        dispatchStorageEvent(key, null);
        delete fakeStorage[key];
    };
    storage.clear = function () {
        dispatchStorageEvent(null, null);
        fakeStorage = {};
    };
}
fakeStorage("localStorage");
fakeStorage("sessionStorage");
// DOMRect polyfill
// Credit: https://github.com/Financial-Times/polyfill-service/pull/1732
(function (global) {
    if (global.DOMRect) {
        return;
    }
    function number(v) {
        return v === undefined ? 0 : Number(v);
    }
    function different(u, v) {
        return u !== v && !(isNaN(u) && isNaN(v));
    }
    function DOMRect(xArg, yArg, wArg, hArg) {
        let x;
        let y;
        let width;
        let height;
        let left;
        let right;
        let top;
        let bottom;
        x = number(xArg);
        y = number(yArg);
        width = number(wArg);
        height = number(hArg);
        Object.defineProperties(this, {
            x: {
                get: function () { return x; },
                set: function (newX) {
                    if (different(x, newX)) {
                        x = newX;
                        left = right = undefined;
                    }
                },
                enumerable: true
            },
            y: {
                get: function () { return y; },
                set: function (newY) {
                    if (different(y, newY)) {
                        y = newY;
                        top = bottom = undefined;
                    }
                },
                enumerable: true
            },
            width: {
                get: function () { return width; },
                set: function (newWidth) {
                    if (different(width, newWidth)) {
                        width = newWidth;
                        left = right = undefined;
                    }
                },
                enumerable: true
            },
            height: {
                get: function () { return height; },
                set: function (newHeight) {
                    if (different(height, newHeight)) {
                        height = newHeight;
                        top = bottom = undefined;
                    }
                },
                enumerable: true
            },
            left: {
                get: function () {
                    if (left === undefined) {
                        left = x + Math.min(0, width);
                    }
                    return left;
                },
                enumerable: true
            },
            right: {
                get: function () {
                    if (right === undefined) {
                        right = x + Math.max(0, width);
                    }
                    return right;
                },
                enumerable: true
            },
            top: {
                get: function () {
                    if (top === undefined) {
                        top = y + Math.min(0, height);
                    }
                    return top;
                },
                enumerable: true
            },
            bottom: {
                get: function () {
                    if (bottom === undefined) {
                        bottom = y + Math.max(0, height);
                    }
                    return bottom;
                },
                enumerable: true
            }
        });
    }
    global.DOMRect = DOMRect;
}(window));
// Element.closest and Element.matches polyfills (see https://developer.mozilla.org/en-US/docs/Web/API/Element/closest)
if (!Element.prototype.matches) {
    Element.prototype.matches =
        Element.prototype.msMatchesSelector ||
            Element.prototype.webkitMatchesSelector;
}
if (!Element.prototype.closest) {
    Element.prototype.closest = function (s) {
        let el = this;
        do {
            if (el.matches(s)) {
                return el;
            }
            el = el.parentElement || el.parentNode;
        } while (el !== null && el.nodeType === 1);
        return null;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWZpbGxzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUvYmFzZS8iLCJzb3VyY2VzIjpbInBvbHlmaWxscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLG9CQUFvQixDQUFDLENBQUMsZUFBZTtBQUU1Qyx1R0FBdUc7QUFDdkcsdURBQXVEO0FBQ3ZELEVBQUU7QUFDRiw4SEFBOEg7QUFDOUgsbUlBQW1JO0FBQ25JLE1BQU07QUFDTixpREFBaUQ7QUFDakQsMEZBQTBGO0FBQzFGLHNJQUFzSTtBQUN0SSx1Q0FBdUM7QUFDdkMsOElBQThJO0FBQzlJLCtHQUErRztBQUMvRyw2SUFBNkk7QUFDN0ksc0NBQXNDO0FBQ3RDLE9BQU8sTUFBTSxDQUFDLENBQUMsU0FBUztBQUN4QixPQUFPLDhCQUE4QixDQUFDLENBQUMsc0VBQXNFO0FBQzdHLE9BQU8sa0JBQWtCLENBQUM7QUFDMUIsT0FBTyxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLFdBQVcsTUFBTSxjQUFjLENBQUMsQ0FBQywrREFBK0Q7QUFFdkcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRXRCLG1DQUFtQztBQUNuQyxJQUFJLENBQU8sTUFBTSxDQUFDLFNBQVUsQ0FBQyxTQUFTLEVBQUU7SUFDaEMsTUFBTSxDQUFDLFNBQVUsQ0FBQyxTQUFTLEdBQUc7UUFDbEMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLG1CQUFtQixFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQy9DLENBQUMsQ0FBQztDQUNIO0FBRUQsSUFBSSxDQUFPLE1BQU0sQ0FBQyxTQUFVLENBQUMsT0FBTyxFQUFFO0lBQzlCLE1BQU0sQ0FBQyxTQUFVLENBQUMsT0FBTyxHQUFHO1FBQ2hDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMvQyxDQUFDLENBQUM7Q0FDSDtBQUVELDJEQUEyRDtBQUMzRCxJQUFJLENBQU8sT0FBTyxDQUFDLFNB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QUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFO0lBQzVCLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLFVBQVMsQ0FBQztRQUNsQyxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDZCxHQUFHO1lBQ0MsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNmLE9BQU8sRUFBRSxDQUFDO2FBQ2I7WUFDRCxFQUFFLEdBQUcsRUFBRSxDQUFDLGFBQWEsSUFBSSxFQUFFLENBQUMsVUFBcUIsQ0FBQztTQUNyRCxRQUFRLEVBQUUsS0FBSyxJQUFJLElBQUksRUFBRSxDQUFDLFFBQVEsS0FBSyxDQUFDLEVBQUU7UUFDM0MsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQyxDQUFDO0NBQ0wiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCJmYXN0LXRleHQtZW5jb2RpbmdcIjsgLy8gSUUgMTEgLyBFZGdlXG5cbi8vIE5CIHRoZSBuYW1lIG9mIHRoZSBpbnRsIHBvbHlmaWxsIChiZWxvdykgY29uZmxpY3RzIHdpdGggQHNpbmVxdWEvY29yZS9pbnRsIGluIHRoZSBtb2R1bGUgcmVzb2x1dGlvbi5cbi8vIE91dHB1dCBvZiB0cmFjZVJlc29sdXRpb246IHRydWUgZ2l2ZXMgdGhlIGZvbGxvd2luZzpcbi8vXG4vLyBSZXNvbHZpbmcgbW9kdWxlIG5hbWUgJ2ludGwnIHJlbGF0aXZlIHRvIGJhc2UgdXJsICdEOi9pY2Uvc2JhL25nLXdzL3Byb2plY3RzL2NvcmUnIC0gJ0Q6L2ljZS9zYmEvbmctd3MvcHJvamVjdHMvY29yZS9pbnRsJy5cbi8vIExvYWRpbmcgbW9kdWxlIGFzIGZpbGUgLyBmb2xkZXIsIGNhbmRpZGF0ZSBtb2R1bGUgbG9jYXRpb24gJ0Q6L2ljZS9zYmEvbmctd3MvcHJvamVjdHMvY29yZS9pbnRsJywgdGFyZ2V0IGZpbGUgdHlwZSAnVHlwZVNjcmlwdCcuXG4vLyAuLi5cbi8vIFRoaXMgY2FuIGJlIHdvcmtlZCBhcm91bmQgaW4gYSBudW1iZXIgb2Ygd2F5czpcbi8vIDEuIFJlbmFtZSB0aGUgQHNpbmVxdWEvY29yZS9pbnRsIGZvbGRlciBhbmQgYWxsIHJlZmVyZW5jZXMgdG8gaXQgKG5vdCBvdmVybHkgZGVzaXJhYmxlKVxuLy8gMi4gSW5zdGFsbCB0aGUgaW50bCBwb2x5ZmlsbCB1c2luZyBhbiBhbGlhczogbnBtIGluc3RhbGwgbXktaW50bC1hbGlhc0BucG06aW50bC4gQnV0IHRoZW4gcmVmZXJlbmNlcyBpbiB0aGUgbG9jYWxlIGZpbGVzIHdvdWxkIGhhdmVcbi8vICAgIHRvIHVzZSBpbXBvcnQgXCJteS1pbnRsLWFsaWFzLy4uLlwiXG4vLyAzLiBEb24ndCB1c2UgaW5kZXgudHMgYXMgdGhlIGVudHJ5IHBvaW50IGZpbGVuYW1lLiBUaGlzIGlzIGEgYml0IGhhY2t5IGJ1dCBpdCB3b3JrcyBhbmQgaGFzIHRoZSBsZWFzdCBpbXBhY3Qgc28gdGhhdCdzIHdoYXQgd2UndmUgZ29uZSB3aXRoXG4vLyAgICBfaW5kZXgudHMgaXMgdXNlZCBhbmQgcmVmZXJlbmNlZCBpbiBwYWNrYWdlLmpzb246IHsgXCJuZ1BhY2thZ2VcIjogeyBcImxpYlwiOiB7IFwiZW50cnlGaWxlXCI6IFwiaW5kZXgudHNcIiB9IH0gfVxuLy8gICAgV2UgYWxzbyBwdXQgYW4gZXhwbGljaXQgUGF0aCB0byBAc2luZXF1YS9jb3JlL2ludGwgPT4gLi9pbnRsL19pbmRleCBpbiB0aGUgbG9jYWwgdHNjb25maWcuanNvbiBzbyB0aGF0IHJlZmVyZW5jZXMgdG8gQHNpbmVxdWEvY29yZS9pbnRsXG4vLyAgICBhcmUgcmVzb2x2ZWQgY29ycmVjdGx5IGluIFZTQ29kZVxuaW1wb3J0IFwiaW50bFwiOyAvLyBTYWZhcmlcbmltcG9ydCBcImludGwvbG9jYWxlLWRhdGEvanNvbnAvZW4tVVNcIjsgLy8gTG9jYWxlIG5lZWRlZCBmb3IgZm9ybWF0anMgaW5pdGlhbGl6YXRpb24gKG5ldyBJbnRsLk51bWJlckZvcm1hdCgpKVxuaW1wb3J0IFwianMtcG9seWZpbGxzL3VybFwiO1xuaW1wb3J0IFwibWF0Y2htZWRpYS1wb2x5ZmlsbFwiO1xuaW1wb3J0IGZvY3VzV2l0aGluIGZyb20gXCJmb2N1cy13aXRoaW5cIjsgLy8gSUUgMTEgLyBFZGdlIC0gaHR0cHM6Ly9naXRodWIuY29tL2pvbmF0aGFudG5lYWwvZm9jdXMtd2l0aGluXG5cbmZvY3VzV2l0aGluKGRvY3VtZW50KTtcblxuLy8gU3RyaW5nLnRyaW1TdGFydCwgU3RyaW5nLnRyaW1FbmRcbmlmICghKDxhbnk+U3RyaW5nLnByb3RvdHlwZSkudHJpbVN0YXJ0KSB7XG4gICg8YW55PlN0cmluZy5wcm90b3R5cGUpLnRyaW1TdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC9eW1xcc1xcdUZFRkZcXHhBMF0rL2csICcnKTtcbiAgfTtcbn1cblxuaWYgKCEoPGFueT5TdHJpbmcucHJvdG90eXBlKS50cmltRW5kKSB7XG4gICg8YW55PlN0cmluZy5wcm90b3R5cGUpLnRyaW1FbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvW1xcc1xcdUZFRkZcXHhBMF0rJC9nLCAnJyk7XG4gIH07XG59XG5cbi8vIFNlZSBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9qb2NraTg0LzZmZmFmZDAwMzM4NzE3OWE5ODhlXG5pZiAoISg8YW55PkVsZW1lbnQucHJvdG90eXBlKS5zY3JvbGxJbnRvVmlld0lmTmVlZGVkKSB7XG4gICAgKDxhbnk+RWxlbWVudC5wcm90b3R5cGUpLnNjcm9sbEludG9WaWV3SWZOZWVkZWQgPSBmdW5jdGlvbiAoY2VudGVySWZOZWVkZWQpIHtcbiAgICAgICAgZnVuY3Rpb24gd2l0aGluQm91bmRzKHZhbHVlLCBtaW4sIG1heCwgZXh0ZW50KSB7XG4gICAgICAgICAgICBpZiAoZmFsc2UgPT09IGNlbnRlcklmTmVlZGVkIHx8IG1heCA8PSB2YWx1ZSArIGV4dGVudCAmJiB2YWx1ZSA8PSBtaW4gKyBleHRlbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5taW4obWF4LCBNYXRoLm1heChtaW4sIHZhbHVlKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAobWluICsgbWF4KSAvIDI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBtYWtlQXJlYShsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybiAgeyBcImxlZnRcIjogbGVmdCwgXCJ0b3BcIjogdG9wLCBcIndpZHRoXCI6IHdpZHRoLCBcImhlaWdodFwiOiBoZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgLCBcInJpZ2h0XCI6IGxlZnQgKyB3aWR0aCwgXCJib3R0b21cIjogdG9wICsgaGVpZ2h0XG4gICAgICAgICAgICAgICAgICAgICwgXCJ0cmFuc2xhdGVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1ha2VBcmVhKHggKyBsZWZ0LCB5ICsgdG9wLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBcInJlbGF0aXZlRnJvbVRvXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAobGhzLCByaHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV3TGVmdCA9IGxlZnQsIG5ld1RvcCA9IHRvcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaHMgPSBsaHMub2Zmc2V0UGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJocyA9IHJocy5vZmZzZXRQYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxocyA9PT0gcmhzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcmVhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgbGhzOyBsaHMgPSBsaHMub2Zmc2V0UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0xlZnQgKz0gbGhzLm9mZnNldExlZnQgKyBsaHMuY2xpZW50TGVmdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3VG9wICs9IGxocy5vZmZzZXRUb3AgKyBsaHMuY2xpZW50VG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgcmhzOyByaHMgPSByaHMub2Zmc2V0UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0xlZnQgLT0gcmhzLm9mZnNldExlZnQgKyByaHMuY2xpZW50TGVmdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3VG9wIC09IHJocy5vZmZzZXRUb3AgKyByaHMuY2xpZW50VG9wO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFrZUFyZWEobmV3TGVmdCwgbmV3VG9wLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBwYXJlbnQsIGVsZW0gPSB0aGlzLCBhcmVhID0gbWFrZUFyZWEoXG4gICAgICAgICAgICB0aGlzLm9mZnNldExlZnQsIHRoaXMub2Zmc2V0VG9wLFxuICAgICAgICAgICAgdGhpcy5vZmZzZXRXaWR0aCwgdGhpcy5vZmZzZXRIZWlnaHQpO1xuICAgICAgICB3aGlsZSAoKHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZSkgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50TGVmdCA9IHBhcmVudC5vZmZzZXRMZWZ0ICsgcGFyZW50LmNsaWVudExlZnQ7XG4gICAgICAgICAgICBjb25zdCBjbGllbnRUb3AgPSBwYXJlbnQub2Zmc2V0VG9wICsgcGFyZW50LmNsaWVudFRvcDtcblxuICAgICAgICAgICAgLy8gTWFrZSBhcmVhIHJlbGF0aXZlIHRvIHBhcmVudCdzIGNsaWVudCBhcmVhLlxuICAgICAgICAgICAgYXJlYSA9IGFyZWEuXG4gICAgICAgICAgICAgICAgcmVsYXRpdmVGcm9tVG8oZWxlbSwgcGFyZW50KS5cbiAgICAgICAgICAgICAgICB0cmFuc2xhdGUoLWNsaWVudExlZnQsIC1jbGllbnRUb3ApO1xuXG4gICAgICAgICAgICBwYXJlbnQuc2Nyb2xsTGVmdCA9IHdpdGhpbkJvdW5kcyhcbiAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsTGVmdCxcbiAgICAgICAgICAgICAgICBhcmVhLnJpZ2h0IC0gcGFyZW50LmNsaWVudFdpZHRoLCBhcmVhLmxlZnQsXG4gICAgICAgICAgICAgICAgcGFyZW50LmNsaWVudFdpZHRoKTtcblxuICAgICAgICAgICAgcGFyZW50LnNjcm9sbFRvcCA9IHdpdGhpbkJvdW5kcyhcbiAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wLFxuICAgICAgICAgICAgICAgIGFyZWEuYm90dG9tIC0gcGFyZW50LmNsaWVudEhlaWdodCwgYXJlYS50b3AsXG4gICAgICAgICAgICAgICAgcGFyZW50LmNsaWVudEhlaWdodCk7XG5cbiAgICAgICAgICAgIC8vIERldGVybWluZSBhY3R1YWwgc2Nyb2xsIGFtb3VudCBieSByZWFkaW5nIGJhY2sgc2Nyb2xsIHByb3BlcnRpZXMuXG4gICAgICAgICAgICBhcmVhID0gYXJlYS50cmFuc2xhdGUoY2xpZW50TGVmdCAtIHBhcmVudC5zY3JvbGxMZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFRvcCAtIHBhcmVudC5zY3JvbGxUb3ApO1xuICAgICAgICAgICAgZWxlbSA9IHBhcmVudDtcbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DdXN0b21FdmVudC9DdXN0b21FdmVudFxuKGZ1bmN0aW9uICgpIHtcblxuICBpZiAoIHR5cGVvZiAoPGFueT53aW5kb3cpLkN1c3RvbUV2ZW50ID09PSBcImZ1bmN0aW9uXCIgKSByZXR1cm47XG5cbiAgZnVuY3Rpb24gQ3VzdG9tRXZlbnQgKCBldmVudCwgcGFyYW1zICkge1xuICAgIHBhcmFtcyA9IHBhcmFtcyB8fCB7IGJ1YmJsZXM6IGZhbHNlLCBjYW5jZWxhYmxlOiBmYWxzZSwgZGV0YWlsOiB1bmRlZmluZWQgfTtcbiAgICBjb25zdCBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCggJ0N1c3RvbUV2ZW50JyApO1xuICAgIGV2dC5pbml0Q3VzdG9tRXZlbnQoIGV2ZW50LCBwYXJhbXMuYnViYmxlcywgcGFyYW1zLmNhbmNlbGFibGUsIHBhcmFtcy5kZXRhaWwgKTtcbiAgICByZXR1cm4gZXZ0O1xuICAgfVxuXG4gIEN1c3RvbUV2ZW50LnByb3RvdHlwZSA9ICg8YW55PndpbmRvdykuRXZlbnQucHJvdG90eXBlO1xuXG4gICg8YW55PndpbmRvdykuQ3VzdG9tRXZlbnQgPSBDdXN0b21FdmVudDtcbn0pKCk7XG5cbi8vIElFXG5pZiAoIXdpbmRvdy5sb2NhdGlvbi5vcmlnaW4pIHsgLy8gU29tZSBicm93c2VycyAobWFpbmx5IElFKSBkbyBub3QgaGF2ZSB0aGlzIHByb3BlcnR5LCBzbyB3ZSBuZWVkIHRvIGJ1aWxkIGl0IG1hbnVhbGx5Li4uXG4gICAgdHJ5IHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uWy8qZm9vIHJlYWRvbmx5Ki88c3RyaW5nPlwib3JpZ2luXCJdID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArICh3aW5kb3cubG9jYXRpb24ucG9ydCA/ICgnOicgKyB3aW5kb3cubG9jYXRpb24ucG9ydCkgOiAnJyk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgfVxufVxuXG4vLyBmYWtlIHN0b3JhZ2UgKGVnIGZvciBTYWZhcmkgcHJpdmF0ZSBicm93c2luZylcbmZ1bmN0aW9uIGZha2VTdG9yYWdlKHN0b3JhZ2VOYW1lOiBzdHJpbmcpIHtcbiAgICBsZXQgZmFrZVN0b3JhZ2UgPSB7fTtcbiAgICBsZXQgc3RvcmFnZTtcbiAgICBsZXQgbmVlZGVkID0gZmFsc2U7XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvd1tzdG9yYWdlTmFtZV0gPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgLy8gU3RvcmFnZSBpcyB0aGVyZSwgZG9lcyBpdCB3b3JrIChlZyBTYWZhcmkgcHJpdmF0ZSBicm93c2luZylcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHdpbmRvd1tzdG9yYWdlTmFtZV0uc2V0SXRlbShcImZha2VTdG9yYWdlVGVzdFwiLCBcIjFcIik7XG4gICAgICAgICAgICB3aW5kb3dbc3RvcmFnZU5hbWVdLnJlbW92ZUl0ZW0oXCJmYWtlU3RvcmFnZVRlc3RcIik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIG5lZWRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG5lZWRlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKCFuZWVkZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygd2luZG93W3N0b3JhZ2VOYW1lXSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICAvLyBPdmVycmlkZSB3aXRoIGZha2UgaW1wbGVtZW50YXRpb25cbiAgICAgICAgc3RvcmFnZSA9IHdpbmRvd1tzdG9yYWdlTmFtZV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBJbXBsZW1lbnQgd2l0aCBmYWtlXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBzdG9yYWdlID0gd2luZG93Wy8qZm9vbCByZWFkb25seSovPHN0cmluZz5zdG9yYWdlTmFtZV0gPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiVW5hYmxlIHRvIHNldCBmYWtlXCIsIHN0b3JhZ2VOYW1lKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUud2FybihcIlVzaW5nIGZha2VcIiwgc3RvcmFnZU5hbWUpO1xuXG4gICAgY29uc3QgZGlzcGF0Y2hTdG9yYWdlRXZlbnQgPSBmdW5jdGlvbihrZXksIG5ld1ZhbHVlKSB7XG4gICAgICAgIGNvbnN0IG9sZFZhbHVlID0gKCFrZXkpID8gbnVsbCA6IHN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgICAgICBjb25zdCB1cmwgPSBsb2NhdGlvbi5ocmVmLnN1YnN0cihsb2NhdGlvbi5vcmlnaW4ubGVuZ3RoKTtcbiAgICAgICAgY29uc3Qgc3RvcmFnZUV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJTdG9yYWdlRXZlbnRcIik7IC8vIEZvciBJRSwgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjU1MTQ5MzUvMTIxNDE4M1xuXG4gICAgICAgIHN0b3JhZ2VFdmVudFtcImluaXRTdG9yYWdlRXZlbnRcIl0oXCJzdG9yYWdlXCIsIGZhbHNlLCBmYWxzZSwga2V5LCBvbGRWYWx1ZSwgbmV3VmFsdWUsIHVybCwgc3RvcmFnZSk7XG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KHN0b3JhZ2VFdmVudCk7XG4gICAgfTtcblxuICAgIHN0b3JhZ2Uua2V5ID0gZnVuY3Rpb24oaSkge1xuICAgICAgICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyhmYWtlU3RvcmFnZSlbaV07XG4gICAgICAgIHJldHVybiB0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiID8ga2V5IDogbnVsbDtcbiAgICB9O1xuXG4gICAgc3RvcmFnZS5nZXRJdGVtID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgZmFrZVN0b3JhZ2Vba2V5XSA9PT0gJ3N0cmluZycgPyBmYWtlU3RvcmFnZVtrZXldIDogbnVsbDtcbiAgICB9O1xuXG4gICAgc3RvcmFnZS5zZXRJdGVtID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICBkaXNwYXRjaFN0b3JhZ2VFdmVudChrZXksIHZhbHVlKTtcbiAgICAgICAgZmFrZVN0b3JhZ2Vba2V5XSA9IFN0cmluZyh2YWx1ZSk7XG4gICAgfTtcblxuICAgIHN0b3JhZ2UucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBkaXNwYXRjaFN0b3JhZ2VFdmVudChrZXksIG51bGwpO1xuICAgICAgICBkZWxldGUgZmFrZVN0b3JhZ2Vba2V5XTtcbiAgICB9O1xuXG4gICAgc3RvcmFnZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkaXNwYXRjaFN0b3JhZ2VFdmVudChudWxsLCBudWxsKTtcbiAgICAgICAgZmFrZVN0b3JhZ2UgPSB7fTtcbiAgICB9O1xufVxuXG5mYWtlU3RvcmFnZShcImxvY2FsU3RvcmFnZVwiKTtcbmZha2VTdG9yYWdlKFwic2Vzc2lvblN0b3JhZ2VcIik7XG5cbi8vIERPTVJlY3QgcG9seWZpbGxcbi8vIENyZWRpdDogaHR0cHM6Ly9naXRodWIuY29tL0ZpbmFuY2lhbC1UaW1lcy9wb2x5ZmlsbC1zZXJ2aWNlL3B1bGwvMTczMlxuKGZ1bmN0aW9uKGdsb2JhbDogYW55KSB7XG4gICAgaWYgKGdsb2JhbC5ET01SZWN0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZnVuY3Rpb24gbnVtYmVyKHYpIHtcbiAgICAgICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCA/IDAgOiBOdW1iZXIodik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRpZmZlcmVudCh1LCB2KSB7XG4gICAgICAgIHJldHVybiB1ICE9PSB2ICYmICEoaXNOYU4odSkgJiYgaXNOYU4odikpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBET01SZWN0KHRoaXM6IERPTVJlY3QsIHhBcmcsIHlBcmcsIHdBcmcsIGhBcmcpIHtcbiAgICAgICAgbGV0IHg7IGxldCB5OyBsZXQgd2lkdGg7IGxldCBoZWlnaHQ7IGxldCBsZWZ0OyBsZXQgcmlnaHQ7IGxldCB0b3A7IGxldCBib3R0b207XG4gICAgICAgIHggPSBudW1iZXIoeEFyZyk7XG4gICAgICAgIHkgPSBudW1iZXIoeUFyZyk7XG4gICAgICAgIHdpZHRoID0gbnVtYmVyKHdBcmcpO1xuICAgICAgICBoZWlnaHQgPSBudW1iZXIoaEFyZyk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcbiAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHg7IH0sXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAobmV3WCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZmVyZW50KHgsIG5ld1gpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB4ID0gbmV3WDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQgPSByaWdodCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHk6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHk7IH0sXG4gICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAobmV3WSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZmVyZW50KHksIG5ld1kpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB5ID0gbmV3WTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IGJvdHRvbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdpZHRoOiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB3aWR0aDsgfSxcbiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChuZXdXaWR0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlmZmVyZW50KHdpZHRoLCBuZXdXaWR0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gbmV3V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gcmlnaHQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoZWlnaHQ6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGhlaWdodDsgfSxcbiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChuZXdIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpZmZlcmVudChoZWlnaHQsIG5ld0hlaWdodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IG5ld0hlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IGJvdHRvbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxlZnQ6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxlZnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHggKyBNYXRoLm1pbigwLCB3aWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxlZnQ7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmlnaHQ6IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJpZ2h0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geCArIE1hdGgubWF4KDAsIHdpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmlnaHQ7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9wOiB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b3AgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geSArIE1hdGgubWluKDAsIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvcDtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib3R0b206IHtcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJvdHRvbSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBib3R0b20gPSB5ICsgTWF0aC5tYXgoMCwgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYm90dG9tO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2xvYmFsLkRPTVJlY3QgPSBET01SZWN0O1xufSh3aW5kb3cpKTtcblxuLy8gRWxlbWVudC5jbG9zZXN0IGFuZCBFbGVtZW50Lm1hdGNoZXMgcG9seWZpbGxzIChzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0VsZW1lbnQvY2xvc2VzdClcbmlmICghRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcykge1xuICAgIEVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXMgPVxuICAgICAgICAoRWxlbWVudC5wcm90b3R5cGUgYXMgYW55KS5tc01hdGNoZXNTZWxlY3RvciB8fFxuICAgICAgICBFbGVtZW50LnByb3RvdHlwZS53ZWJraXRNYXRjaGVzU2VsZWN0b3I7XG59XG5cbmlmICghRWxlbWVudC5wcm90b3R5cGUuY2xvc2VzdCkge1xuICAgIEVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QgPSBmdW5jdGlvbihzKSB7XG4gICAgICAgIGxldCBlbCA9IHRoaXM7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGlmIChlbC5tYXRjaGVzKHMpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWwgPSBlbC5wYXJlbnRFbGVtZW50IHx8IGVsLnBhcmVudE5vZGUgYXMgRWxlbWVudDtcbiAgICAgICAgfSB3aGlsZSAoZWwgIT09IG51bGwgJiYgZWwubm9kZVR5cGUgPT09IDEpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xufVxuXG5leHBvcnQge1xufTtcbiJdfQ==